let process = requireNativeModule('process');
var LF=Object.create;var{getPrototypeOf:UF,defineProperty:J4,getOwnPropertyNames:DF}=Object;var wF=Object.prototype.hasOwnProperty;var QJ=(Q,W,$)=>{$=Q!=null?LF(UF(Q)):{};let Y=W||!Q||!Q.__esModule?J4($,"default",{value:Q,enumerable:!0}):$;for(let J of DF(Q))if(!wF.call(Y,J))J4(Y,J,{get:()=>Q[J],enumerable:!0});return Y};var C=(Q,W)=>()=>(W||Q((W={exports:{}}).exports,W),W.exports);var X4=(Q,W)=>{for(var $ in W)J4(Q,$,{get:W[$],enumerable:!0,configurable:!0,set:(Y)=>W[$]=()=>Y})};var I9=C((Q0)=>{Object.defineProperty(Q0,"__esModule",{value:!0});Q0.regexpCode=Q0.getEsmExportName=Q0.getProperty=Q0.safeStringify=Q0.stringify=Q0.strConcat=Q0.addCodeArg=Q0.str=Q0._=Q0.nil=Q0._Code=Q0.Name=Q0.IDENTIFIER=Q0._CodeOrName=void 0;class KW{}Q0._CodeOrName=KW;Q0.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class R8 extends KW{constructor(Q){super();if(!Q0.IDENTIFIER.test(Q))throw Error("CodeGen: name must be a valid identifier");this.str=Q}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}Q0.Name=R8;class j1 extends KW{constructor(Q){super();this._items=typeof Q==="string"?[Q]:Q}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let Q=this._items[0];return Q===""||Q==='""'}get str(){var Q;return(Q=this._str)!==null&&Q!==void 0?Q:this._str=this._items.reduce((W,$)=>`${W}${$}`,"")}get names(){var Q;return(Q=this._names)!==null&&Q!==void 0?Q:this._names=this._items.reduce((W,$)=>{if($ instanceof R8)W[$.str]=(W[$.str]||0)+1;return W},{})}}Q0._Code=j1;Q0.nil=new j1("");function r3(Q,...W){let $=[Q[0]],Y=0;while(Y<W.length)d$($,W[Y]),$.push(Q[++Y]);return new j1($)}Q0._=r3;var p$=new j1("+");function a3(Q,...W){let $=[R9(Q[0])],Y=0;while(Y<W.length)$.push(p$),d$($,W[Y]),$.push(p$,R9(Q[++Y]));return wD($),new j1($)}Q0.str=a3;function d$(Q,W){if(W instanceof j1)Q.push(...W._items);else if(W instanceof R8)Q.push(W);else Q.push(ND(W))}Q0.addCodeArg=d$;function wD(Q){let W=1;while(W<Q.length-1){if(Q[W]===p$){let $=AD(Q[W-1],Q[W+1]);if($!==void 0){Q.splice(W-1,3,$);continue}Q[W++]="+"}W++}}function AD(Q,W){if(W==='""')return Q;if(Q==='""')return W;if(typeof Q=="string"){if(W instanceof R8||Q[Q.length-1]!=='"')return;if(typeof W!="string")return`${Q.slice(0,-1)}${W}"`;if(W[0]==='"')return Q.slice(0,-1)+W.slice(1);return}if(typeof W=="string"&&W[0]==='"'&&!(Q instanceof R8))return`"${Q}${W.slice(1)}`;return}function OD(Q,W){return W.emptyStr()?Q:Q.emptyStr()?W:a3`${Q}${W}`}Q0.strConcat=OD;function ND(Q){return typeof Q=="number"||typeof Q=="boolean"||Q===null?Q:R9(Array.isArray(Q)?Q.join(","):Q)}function MD(Q){return new j1(R9(Q))}Q0.stringify=MD;function R9(Q){return JSON.stringify(Q).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}Q0.safeStringify=R9;function jD(Q){return typeof Q=="string"&&Q0.IDENTIFIER.test(Q)?new j1(`.${Q}`):r3`[${Q}]`}Q0.getProperty=jD;function zD(Q){if(typeof Q=="string"&&Q0.IDENTIFIER.test(Q))return new j1(`${Q}`);throw Error(`CodeGen: invalid export name: ${Q}, use explicit $id name mapping`)}Q0.getEsmExportName=zD;function PD(Q){return new j1(Q.toString())}Q0.regexpCode=PD});var o$=C((a0)=>{Object.defineProperty(a0,"__esModule",{value:!0});a0.ValueScope=a0.ValueScopeName=a0.Scope=a0.varKinds=a0.UsedValueState=void 0;var r0=I9();class t3 extends Error{constructor(Q){super(`CodeGen: "code" for ${Q} not defined`);this.value=Q.value}}var FW;(function(Q){Q[Q.Started=0]="Started",Q[Q.Completed=1]="Completed"})(FW||(a0.UsedValueState=FW={}));a0.varKinds={const:new r0.Name("const"),let:new r0.Name("let"),var:new r0.Name("var")};class i${constructor({prefixes:Q,parent:W}={}){this._names={},this._prefixes=Q,this._parent=W}toName(Q){return Q instanceof r0.Name?Q:this.name(Q)}name(Q){return new r0.Name(this._newName(Q))}_newName(Q){let W=this._names[Q]||this._nameGroup(Q);return`${Q}${W.index++}`}_nameGroup(Q){var W,$;if((($=(W=this._parent)===null||W===void 0?void 0:W._prefixes)===null||$===void 0?void 0:$.has(Q))||this._prefixes&&!this._prefixes.has(Q))throw Error(`CodeGen: prefix "${Q}" is not allowed in this scope`);return this._names[Q]={prefix:Q,index:0}}}a0.Scope=i$;class n$ extends r0.Name{constructor(Q,W){super(W);this.prefix=Q}setValue(Q,{property:W,itemIndex:$}){this.value=Q,this.scopePath=r0._`.${new r0.Name(W)}[${$}]`}}a0.ValueScopeName=n$;var ED=r0._`\n`;class s3 extends i${constructor(Q){super(Q);this._values={},this._scope=Q.scope,this.opts={...Q,_n:Q.lines?ED:r0.nil}}get(){return this._scope}name(Q){return new n$(Q,this._newName(Q))}value(Q,W){var $;if(W.ref===void 0)throw Error("CodeGen: ref must be passed in value");let Y=this.toName(Q),{prefix:J}=Y,X=($=W.key)!==null&&$!==void 0?$:W.ref,G=this._values[J];if(G){let K=G.get(X);if(K)return K}else G=this._values[J]=new Map;G.set(X,Y);let H=this._scope[J]||(this._scope[J]=[]),B=H.length;return H[B]=W.ref,Y.setValue(W,{property:J,itemIndex:B}),Y}getValue(Q,W){let $=this._values[Q];if(!$)return;return $.get(W)}scopeRefs(Q,W=this._values){return this._reduceValues(W,($)=>{if($.scopePath===void 0)throw Error(`CodeGen: name "${$}" has no value`);return r0._`${Q}${$.scopePath}`})}scopeCode(Q=this._values,W,$){return this._reduceValues(Q,(Y)=>{if(Y.value===void 0)throw Error(`CodeGen: name "${Y}" has no value`);return Y.value.code},W,$)}_reduceValues(Q,W,$={},Y){let J=r0.nil;for(let X in Q){let G=Q[X];if(!G)continue;let H=$[X]=$[X]||new Map;G.forEach((B)=>{if(H.has(B))return;H.set(B,FW.Started);let K=W(B);if(K){let F=this.opts.es5?a0.varKinds.var:a0.varKinds.const;J=r0._`${J}${F} ${B} = ${K};${this.opts._n}`}else if(K=Y===null||Y===void 0?void 0:Y(B))J=r0._`${J}${K}${this.opts._n}`;else throw new t3(B);H.set(B,FW.Completed)})}return J}}a0.ValueScope=s3});var p=C((i)=>{Object.defineProperty(i,"__esModule",{value:!0});i.or=i.and=i.not=i.CodeGen=i.operators=i.varKinds=i.ValueScopeName=i.ValueScope=i.Scope=i.Name=i.regexpCode=i.stringify=i.getProperty=i.nil=i.strConcat=i.str=i._=void 0;var s=I9(),z1=o$(),V6=I9();Object.defineProperty(i,"_",{enumerable:!0,get:function(){return V6._}});Object.defineProperty(i,"str",{enumerable:!0,get:function(){return V6.str}});Object.defineProperty(i,"strConcat",{enumerable:!0,get:function(){return V6.strConcat}});Object.defineProperty(i,"nil",{enumerable:!0,get:function(){return V6.nil}});Object.defineProperty(i,"getProperty",{enumerable:!0,get:function(){return V6.getProperty}});Object.defineProperty(i,"stringify",{enumerable:!0,get:function(){return V6.stringify}});Object.defineProperty(i,"regexpCode",{enumerable:!0,get:function(){return V6.regexpCode}});Object.defineProperty(i,"Name",{enumerable:!0,get:function(){return V6.Name}});var wW=o$();Object.defineProperty(i,"Scope",{enumerable:!0,get:function(){return wW.Scope}});Object.defineProperty(i,"ValueScope",{enumerable:!0,get:function(){return wW.ValueScope}});Object.defineProperty(i,"ValueScopeName",{enumerable:!0,get:function(){return wW.ValueScopeName}});Object.defineProperty(i,"varKinds",{enumerable:!0,get:function(){return wW.varKinds}});i.operators={GT:new s._Code(">"),GTE:new s._Code(">="),LT:new s._Code("<"),LTE:new s._Code("<="),EQ:new s._Code("==="),NEQ:new s._Code("!=="),NOT:new s._Code("!"),OR:new s._Code("||"),AND:new s._Code("&&"),ADD:new s._Code("+")};class q6{optimizeNodes(){return this}optimizeNames(Q,W){return this}}class e3 extends q6{constructor(Q,W,$){super();this.varKind=Q,this.name=W,this.rhs=$}render({es5:Q,_n:W}){let $=Q?z1.varKinds.var:this.varKind,Y=this.rhs===void 0?"":` = ${this.rhs}`;return`${$} ${this.name}${Y};`+W}optimizeNames(Q,W){if(!Q[this.name.str])return;if(this.rhs)this.rhs=b8(this.rhs,Q,W);return this}get names(){return this.rhs instanceof s._CodeOrName?this.rhs.names:{}}}class t$ extends q6{constructor(Q,W,$){super();this.lhs=Q,this.rhs=W,this.sideEffects=$}render({_n:Q}){return`${this.lhs} = ${this.rhs};`+Q}optimizeNames(Q,W){if(this.lhs instanceof s.Name&&!Q[this.lhs.str]&&!this.sideEffects)return;return this.rhs=b8(this.rhs,Q,W),this}get names(){let Q=this.lhs instanceof s.Name?{}:{...this.lhs.names};return DW(Q,this.rhs)}}class QG extends t${constructor(Q,W,$,Y){super(Q,$,Y);this.op=W}render({_n:Q}){return`${this.lhs} ${this.op}= ${this.rhs};`+Q}}class WG extends q6{constructor(Q){super();this.label=Q,this.names={}}render({_n:Q}){return`${this.label}:`+Q}}class $G extends q6{constructor(Q){super();this.label=Q,this.names={}}render({_n:Q}){return`break${this.label?` ${this.label}`:""};`+Q}}class YG extends q6{constructor(Q){super();this.error=Q}render({_n:Q}){return`throw ${this.error};`+Q}get names(){return this.error.names}}class JG extends q6{constructor(Q){super();this.code=Q}render({_n:Q}){return`${this.code};`+Q}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Q,W){return this.code=b8(this.code,Q,W),this}get names(){return this.code instanceof s._CodeOrName?this.code.names:{}}}class AW extends q6{constructor(Q=[]){super();this.nodes=Q}render(Q){return this.nodes.reduce((W,$)=>W+$.render(Q),"")}optimizeNodes(){let{nodes:Q}=this,W=Q.length;while(W--){let $=Q[W].optimizeNodes();if(Array.isArray($))Q.splice(W,1,...$);else if($)Q[W]=$;else Q.splice(W,1)}return Q.length>0?this:void 0}optimizeNames(Q,W){let{nodes:$}=this,Y=$.length;while(Y--){let J=$[Y];if(J.optimizeNames(Q,W))continue;RD(Q,J.names),$.splice(Y,1)}return $.length>0?this:void 0}get names(){return this.nodes.reduce((Q,W)=>g6(Q,W.names),{})}}class L6 extends AW{render(Q){return"{"+Q._n+super.render(Q)+"}"+Q._n}}class XG extends AW{}class b9 extends L6{}b9.kind="else";class d1 extends L6{constructor(Q,W){super(W);this.condition=Q}render(Q){let W=`if(${this.condition})`+super.render(Q);if(this.else)W+="else "+this.else.render(Q);return W}optimizeNodes(){super.optimizeNodes();let Q=this.condition;if(Q===!0)return this.nodes;let W=this.else;if(W){let $=W.optimizeNodes();W=this.else=Array.isArray($)?new b9($):$}if(W){if(Q===!1)return W instanceof d1?W:W.nodes;if(this.nodes.length)return this;return new d1(FG(Q),W instanceof d1?[W]:W.nodes)}if(Q===!1||!this.nodes.length)return;return this}optimizeNames(Q,W){var $;if(this.else=($=this.else)===null||$===void 0?void 0:$.optimizeNames(Q,W),!(super.optimizeNames(Q,W)||this.else))return;return this.condition=b8(this.condition,Q,W),this}get names(){let Q=super.names;if(DW(Q,this.condition),this.else)g6(Q,this.else.names);return Q}}d1.kind="if";class I8 extends L6{}I8.kind="for";class GG extends I8{constructor(Q){super();this.iteration=Q}render(Q){return`for(${this.iteration})`+super.render(Q)}optimizeNames(Q,W){if(!super.optimizeNames(Q,W))return;return this.iteration=b8(this.iteration,Q,W),this}get names(){return g6(super.names,this.iteration.names)}}class HG extends I8{constructor(Q,W,$,Y){super();this.varKind=Q,this.name=W,this.from=$,this.to=Y}render(Q){let W=Q.es5?z1.varKinds.var:this.varKind,{name:$,from:Y,to:J}=this;return`for(${W} ${$}=${Y}; ${$}<${J}; ${$}++)`+super.render(Q)}get names(){let Q=DW(super.names,this.from);return DW(Q,this.to)}}class r$ extends I8{constructor(Q,W,$,Y){super();this.loop=Q,this.varKind=W,this.name=$,this.iterable=Y}render(Q){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Q)}optimizeNames(Q,W){if(!super.optimizeNames(Q,W))return;return this.iterable=b8(this.iterable,Q,W),this}get names(){return g6(super.names,this.iterable.names)}}class VW extends L6{constructor(Q,W,$){super();this.name=Q,this.args=W,this.async=$}render(Q){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Q)}}VW.kind="func";class qW extends AW{render(Q){return"return "+super.render(Q)}}qW.kind="return";class BG extends L6{render(Q){let W="try"+super.render(Q);if(this.catch)W+=this.catch.render(Q);if(this.finally)W+=this.finally.render(Q);return W}optimizeNodes(){var Q,W;return super.optimizeNodes(),(Q=this.catch)===null||Q===void 0||Q.optimizeNodes(),(W=this.finally)===null||W===void 0||W.optimizeNodes(),this}optimizeNames(Q,W){var $,Y;return super.optimizeNames(Q,W),($=this.catch)===null||$===void 0||$.optimizeNames(Q,W),(Y=this.finally)===null||Y===void 0||Y.optimizeNames(Q,W),this}get names(){let Q=super.names;if(this.catch)g6(Q,this.catch.names);if(this.finally)g6(Q,this.finally.names);return Q}}class LW extends L6{constructor(Q){super();this.error=Q}render(Q){return`catch(${this.error})`+super.render(Q)}}LW.kind="catch";class UW extends L6{render(Q){return"finally"+super.render(Q)}}UW.kind="finally";class KG{constructor(Q,W={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...W,_n:W.lines?`
`:""},this._extScope=Q,this._scope=new z1.Scope({parent:Q}),this._nodes=[new XG]}toString(){return this._root.render(this.opts)}name(Q){return this._scope.name(Q)}scopeName(Q){return this._extScope.name(Q)}scopeValue(Q,W){let $=this._extScope.value(Q,W);return(this._values[$.prefix]||(this._values[$.prefix]=new Set)).add($),$}getScopeValue(Q,W){return this._extScope.getValue(Q,W)}scopeRefs(Q){return this._extScope.scopeRefs(Q,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Q,W,$,Y){let J=this._scope.toName(W);if($!==void 0&&Y)this._constants[J.str]=$;return this._leafNode(new e3(Q,J,$)),J}const(Q,W,$){return this._def(z1.varKinds.const,Q,W,$)}let(Q,W,$){return this._def(z1.varKinds.let,Q,W,$)}var(Q,W,$){return this._def(z1.varKinds.var,Q,W,$)}assign(Q,W,$){return this._leafNode(new t$(Q,W,$))}add(Q,W){return this._leafNode(new QG(Q,i.operators.ADD,W))}code(Q){if(typeof Q=="function")Q();else if(Q!==s.nil)this._leafNode(new JG(Q));return this}object(...Q){let W=["{"];for(let[$,Y]of Q){if(W.length>1)W.push(",");if(W.push($),$!==Y||this.opts.es5)W.push(":"),(0,s.addCodeArg)(W,Y)}return W.push("}"),new s._Code(W)}if(Q,W,$){if(this._blockNode(new d1(Q)),W&&$)this.code(W).else().code($).endIf();else if(W)this.code(W).endIf();else if($)throw Error('CodeGen: "else" body without "then" body');return this}elseIf(Q){return this._elseNode(new d1(Q))}else(){return this._elseNode(new b9)}endIf(){return this._endBlockNode(d1,b9)}_for(Q,W){if(this._blockNode(Q),W)this.code(W).endFor();return this}for(Q,W){return this._for(new GG(Q),W)}forRange(Q,W,$,Y,J=this.opts.es5?z1.varKinds.var:z1.varKinds.let){let X=this._scope.toName(Q);return this._for(new HG(J,X,W,$),()=>Y(X))}forOf(Q,W,$,Y=z1.varKinds.const){let J=this._scope.toName(Q);if(this.opts.es5){let X=W instanceof s.Name?W:this.var("_arr",W);return this.forRange("_i",0,s._`${X}.length`,(G)=>{this.var(J,s._`${X}[${G}]`),$(J)})}return this._for(new r$("of",Y,J,W),()=>$(J))}forIn(Q,W,$,Y=this.opts.es5?z1.varKinds.var:z1.varKinds.const){if(this.opts.ownProperties)return this.forOf(Q,s._`Object.keys(${W})`,$);let J=this._scope.toName(Q);return this._for(new r$("in",Y,J,W),()=>$(J))}endFor(){return this._endBlockNode(I8)}label(Q){return this._leafNode(new WG(Q))}break(Q){return this._leafNode(new $G(Q))}return(Q){let W=new qW;if(this._blockNode(W),this.code(Q),W.nodes.length!==1)throw Error('CodeGen: "return" should have one node');return this._endBlockNode(qW)}try(Q,W,$){if(!W&&!$)throw Error('CodeGen: "try" without "catch" and "finally"');let Y=new BG;if(this._blockNode(Y),this.code(Q),W){let J=this.name("e");this._currNode=Y.catch=new LW(J),W(J)}if($)this._currNode=Y.finally=new UW,this.code($);return this._endBlockNode(LW,UW)}throw(Q){return this._leafNode(new YG(Q))}block(Q,W){if(this._blockStarts.push(this._nodes.length),Q)this.code(Q).endBlock(W);return this}endBlock(Q){let W=this._blockStarts.pop();if(W===void 0)throw Error("CodeGen: not in self-balancing block");let $=this._nodes.length-W;if($<0||Q!==void 0&&$!==Q)throw Error(`CodeGen: wrong number of nodes: ${$} vs ${Q} expected`);return this._nodes.length=W,this}func(Q,W=s.nil,$,Y){if(this._blockNode(new VW(Q,W,$)),Y)this.code(Y).endFunc();return this}endFunc(){return this._endBlockNode(VW)}optimize(Q=1){while(Q-- >0)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Q){return this._currNode.nodes.push(Q),this}_blockNode(Q){this._currNode.nodes.push(Q),this._nodes.push(Q)}_endBlockNode(Q,W){let $=this._currNode;if($ instanceof Q||W&&$ instanceof W)return this._nodes.pop(),this;throw Error(`CodeGen: not in block "${W?`${Q.kind}/${W.kind}`:Q.kind}"`)}_elseNode(Q){let W=this._currNode;if(!(W instanceof d1))throw Error('CodeGen: "else" without "if"');return this._currNode=W.else=Q,this}get _root(){return this._nodes[0]}get _currNode(){let Q=this._nodes;return Q[Q.length-1]}set _currNode(Q){let W=this._nodes;W[W.length-1]=Q}}i.CodeGen=KG;function g6(Q,W){for(let $ in W)Q[$]=(Q[$]||0)+(W[$]||0);return Q}function DW(Q,W){return W instanceof s._CodeOrName?g6(Q,W.names):Q}function b8(Q,W,$){if(Q instanceof s.Name)return Y(Q);if(!J(Q))return Q;return new s._Code(Q._items.reduce((X,G)=>{if(G instanceof s.Name)G=Y(G);if(G instanceof s._Code)X.push(...G._items);else X.push(G);return X},[]));function Y(X){let G=$[X.str];if(G===void 0||W[X.str]!==1)return X;return delete W[X.str],G}function J(X){return X instanceof s._Code&&X._items.some((G)=>G instanceof s.Name&&W[G.str]===1&&$[G.str]!==void 0)}}function RD(Q,W){for(let $ in W)Q[$]=(Q[$]||0)-(W[$]||0)}function FG(Q){return typeof Q=="boolean"||typeof Q=="number"||Q===null?!Q:s._`!${a$(Q)}`}i.not=FG;var ID=VG(i.operators.AND);function bD(...Q){return Q.reduce(ID)}i.and=bD;var SD=VG(i.operators.OR);function ZD(...Q){return Q.reduce(SD)}i.or=ZD;function VG(Q){return(W,$)=>W===s.nil?$:$===s.nil?W:s._`${a$(W)} ${Q} ${a$($)}`}function a$(Q){return Q instanceof s.Name?Q:s._`(${Q})`}});var W0=C((n)=>{Object.defineProperty(n,"__esModule",{value:!0});n.checkStrictMode=n.getErrorPath=n.Type=n.useFunc=n.setEvaluated=n.evaluatedPropsToName=n.mergeEvaluated=n.eachItem=n.unescapeJsonPointer=n.escapeJsonPointer=n.escapeFragment=n.unescapeFragment=n.schemaRefOrVal=n.schemaHasRulesButRef=n.schemaHasRules=n.checkUnknownRules=n.alwaysValidSchema=n.toHash=void 0;var H0=p(),CD=I9();function vD(Q){let W={};for(let $ of Q)W[$]=!0;return W}n.toHash=vD;function kD(Q,W){if(typeof W=="boolean")return W;if(Object.keys(W).length===0)return!0;return UG(Q,W),!DG(W,Q.self.RULES.all)}n.alwaysValidSchema=kD;function UG(Q,W=Q.schema){let{opts:$,self:Y}=Q;if(!$.strictSchema)return;if(typeof W==="boolean")return;let J=Y.RULES.keywords;for(let X in W)if(!J[X])OG(Q,`unknown keyword: "${X}"`)}n.checkUnknownRules=UG;function DG(Q,W){if(typeof Q=="boolean")return!Q;for(let $ in Q)if(W[$])return!0;return!1}n.schemaHasRules=DG;function TD(Q,W){if(typeof Q=="boolean")return!Q;for(let $ in Q)if($!=="$ref"&&W.all[$])return!0;return!1}n.schemaHasRulesButRef=TD;function _D({topSchemaRef:Q,schemaPath:W},$,Y,J){if(!J){if(typeof $=="number"||typeof $=="boolean")return $;if(typeof $=="string")return H0._`${$}`}return H0._`${Q}${W}${(0,H0.getProperty)(Y)}`}n.schemaRefOrVal=_D;function xD(Q){return wG(decodeURIComponent(Q))}n.unescapeFragment=xD;function yD(Q){return encodeURIComponent(e$(Q))}n.escapeFragment=yD;function e$(Q){if(typeof Q=="number")return`${Q}`;return Q.replace(/~/g,"~0").replace(/\//g,"~1")}n.escapeJsonPointer=e$;function wG(Q){return Q.replace(/~1/g,"/").replace(/~0/g,"~")}n.unescapeJsonPointer=wG;function gD(Q,W){if(Array.isArray(Q))for(let $ of Q)W($);else W(Q)}n.eachItem=gD;function qG({mergeNames:Q,mergeToName:W,mergeValues:$,resultToName:Y}){return(J,X,G,H)=>{let B=G===void 0?X:G instanceof H0.Name?(X instanceof H0.Name?Q(J,X,G):W(J,X,G),G):X instanceof H0.Name?(W(J,G,X),X):$(X,G);return H===H0.Name&&!(B instanceof H0.Name)?Y(J,B):B}}n.mergeEvaluated={props:qG({mergeNames:(Q,W,$)=>Q.if(H0._`${$} !== true && ${W} !== undefined`,()=>{Q.if(H0._`${W} === true`,()=>Q.assign($,!0),()=>Q.assign($,H0._`${$} || {}`).code(H0._`Object.assign(${$}, ${W})`))}),mergeToName:(Q,W,$)=>Q.if(H0._`${$} !== true`,()=>{if(W===!0)Q.assign($,!0);else Q.assign($,H0._`${$} || {}`),QY(Q,$,W)}),mergeValues:(Q,W)=>Q===!0?!0:{...Q,...W},resultToName:AG}),items:qG({mergeNames:(Q,W,$)=>Q.if(H0._`${$} !== true && ${W} !== undefined`,()=>Q.assign($,H0._`${W} === true ? true : ${$} > ${W} ? ${$} : ${W}`)),mergeToName:(Q,W,$)=>Q.if(H0._`${$} !== true`,()=>Q.assign($,W===!0?!0:H0._`${$} > ${W} ? ${$} : ${W}`)),mergeValues:(Q,W)=>Q===!0?!0:Math.max(Q,W),resultToName:(Q,W)=>Q.var("items",W)})};function AG(Q,W){if(W===!0)return Q.var("props",!0);let $=Q.var("props",H0._`{}`);if(W!==void 0)QY(Q,$,W);return $}n.evaluatedPropsToName=AG;function QY(Q,W,$){Object.keys($).forEach((Y)=>Q.assign(H0._`${W}${(0,H0.getProperty)(Y)}`,!0))}n.setEvaluated=QY;var LG={};function hD(Q,W){return Q.scopeValue("func",{ref:W,code:LG[W.code]||(LG[W.code]=new CD._Code(W.code))})}n.useFunc=hD;var s$;(function(Q){Q[Q.Num=0]="Num",Q[Q.Str=1]="Str"})(s$||(n.Type=s$={}));function fD(Q,W,$){if(Q instanceof H0.Name){let Y=W===s$.Num;return $?Y?H0._`"[" + ${Q} + "]"`:H0._`"['" + ${Q} + "']"`:Y?H0._`"/" + ${Q}`:H0._`"/" + ${Q}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return $?(0,H0.getProperty)(Q).toString():"/"+e$(Q)}n.getErrorPath=fD;function OG(Q,W,$=Q.opts.strictSchema){if(!$)return;if(W=`strict mode: ${W}`,$===!0)throw Error(W);Q.self.logger.warn(W)}n.checkStrictMode=OG});var i1=C((WY)=>{Object.defineProperty(WY,"__esModule",{value:!0});var g0=p(),uD={data:new g0.Name("data"),valCxt:new g0.Name("valCxt"),instancePath:new g0.Name("instancePath"),parentData:new g0.Name("parentData"),parentDataProperty:new g0.Name("parentDataProperty"),rootData:new g0.Name("rootData"),dynamicAnchors:new g0.Name("dynamicAnchors"),vErrors:new g0.Name("vErrors"),errors:new g0.Name("errors"),this:new g0.Name("this"),self:new g0.Name("self"),scope:new g0.Name("scope"),json:new g0.Name("json"),jsonPos:new g0.Name("jsonPos"),jsonLen:new g0.Name("jsonLen"),jsonPart:new g0.Name("jsonPart")};WY.default=uD});var S9=C((h0)=>{Object.defineProperty(h0,"__esModule",{value:!0});h0.extendErrors=h0.resetErrorsCount=h0.reportExtraError=h0.reportError=h0.keyword$DataError=h0.keywordError=void 0;var e=p(),OW=W0(),d0=i1();h0.keywordError={message:({keyword:Q})=>e.str`must pass "${Q}" keyword validation`};h0.keyword$DataError={message:({keyword:Q,schemaType:W})=>W?e.str`"${Q}" keyword must be ${W} ($data)`:e.str`"${Q}" keyword is invalid ($data)`};function lD(Q,W=h0.keywordError,$,Y){let{it:J}=Q,{gen:X,compositeRule:G,allErrors:H}=J,B=jG(Q,W,$);if(Y!==null&&Y!==void 0?Y:G||H)NG(X,B);else MG(J,e._`[${B}]`)}h0.reportError=lD;function mD(Q,W=h0.keywordError,$){let{it:Y}=Q,{gen:J,compositeRule:X,allErrors:G}=Y,H=jG(Q,W,$);if(NG(J,H),!(X||G))MG(Y,d0.default.vErrors)}h0.reportExtraError=mD;function cD(Q,W){Q.assign(d0.default.errors,W),Q.if(e._`${d0.default.vErrors} !== null`,()=>Q.if(W,()=>Q.assign(e._`${d0.default.vErrors}.length`,W),()=>Q.assign(d0.default.vErrors,null)))}h0.resetErrorsCount=cD;function pD({gen:Q,keyword:W,schemaValue:$,data:Y,errsCount:J,it:X}){if(J===void 0)throw Error("ajv implementation error");let G=Q.name("err");Q.forRange("i",J,d0.default.errors,(H)=>{if(Q.const(G,e._`${d0.default.vErrors}[${H}]`),Q.if(e._`${G}.instancePath === undefined`,()=>Q.assign(e._`${G}.instancePath`,(0,e.strConcat)(d0.default.instancePath,X.errorPath))),Q.assign(e._`${G}.schemaPath`,e.str`${X.errSchemaPath}/${W}`),X.opts.verbose)Q.assign(e._`${G}.schema`,$),Q.assign(e._`${G}.data`,Y)})}h0.extendErrors=pD;function NG(Q,W){let $=Q.const("err",W);Q.if(e._`${d0.default.vErrors} === null`,()=>Q.assign(d0.default.vErrors,e._`[${$}]`),e._`${d0.default.vErrors}.push(${$})`),Q.code(e._`${d0.default.errors}++`)}function MG(Q,W){let{gen:$,validateName:Y,schemaEnv:J}=Q;if(J.$async)$.throw(e._`new ${Q.ValidationError}(${W})`);else $.assign(e._`${Y}.errors`,W),$.return(!1)}var h6={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function jG(Q,W,$){let{createErrors:Y}=Q.it;if(Y===!1)return e._`{}`;return dD(Q,W,$)}function dD(Q,W,$={}){let{gen:Y,it:J}=Q,X=[iD(J,$),nD(Q,$)];return oD(Q,W,X),Y.object(...X)}function iD({errorPath:Q},{instancePath:W}){let $=W?e.str`${Q}${(0,OW.getErrorPath)(W,OW.Type.Str)}`:Q;return[d0.default.instancePath,(0,e.strConcat)(d0.default.instancePath,$)]}function nD({keyword:Q,it:{errSchemaPath:W}},{schemaPath:$,parentSchema:Y}){let J=Y?W:e.str`${W}/${Q}`;if($)J=e.str`${J}${(0,OW.getErrorPath)($,OW.Type.Str)}`;return[h6.schemaPath,J]}function oD(Q,{params:W,message:$},Y){let{keyword:J,data:X,schemaValue:G,it:H}=Q,{opts:B,propertyName:K,topSchemaRef:F,schemaPath:q}=H;if(Y.push([h6.keyword,J],[h6.params,typeof W=="function"?W(Q):W||e._`{}`]),B.messages)Y.push([h6.message,typeof $=="function"?$(Q):$]);if(B.verbose)Y.push([h6.schema,G],[h6.parentSchema,e._`${F}${q}`],[d0.default.data,X]);if(K)Y.push([h6.propertyName,K])}});var PG=C((S8)=>{Object.defineProperty(S8,"__esModule",{value:!0});S8.boolOrEmptySchema=S8.topBoolOrEmptySchema=void 0;var rD=S9(),aD=p(),tD=i1(),sD={message:"boolean schema is false"};function eD(Q){let{gen:W,schema:$,validateName:Y}=Q;if($===!1)zG(Q,!1);else if(typeof $=="object"&&$.$async===!0)W.return(tD.default.data);else W.assign(aD._`${Y}.errors`,null),W.return(!0)}S8.topBoolOrEmptySchema=eD;function Qw(Q,W){let{gen:$,schema:Y}=Q;if(Y===!1)$.var(W,!1),zG(Q);else $.var(W,!0)}S8.boolOrEmptySchema=Qw;function zG(Q,W){let{gen:$,data:Y}=Q,J={gen:$,keyword:"false schema",data:Y,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:Q};(0,rD.reportError)(J,sD,void 0,W)}});var $Y=C((Z8)=>{Object.defineProperty(Z8,"__esModule",{value:!0});Z8.getRules=Z8.isJSONType=void 0;var Ww=["string","number","integer","boolean","null","object","array"],$w=new Set(Ww);function Yw(Q){return typeof Q=="string"&&$w.has(Q)}Z8.isJSONType=Yw;function Jw(){let Q={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...Q,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},Q.number,Q.string,Q.array,Q.object],post:{rules:[]},all:{},keywords:{}}}Z8.getRules=Jw});var YY=C((U6)=>{Object.defineProperty(U6,"__esModule",{value:!0});U6.shouldUseRule=U6.shouldUseGroup=U6.schemaHasRulesForType=void 0;function Xw({schema:Q,self:W},$){let Y=W.RULES.types[$];return Y&&Y!==!0&&EG(Q,Y)}U6.schemaHasRulesForType=Xw;function EG(Q,W){return W.rules.some(($)=>RG(Q,$))}U6.shouldUseGroup=EG;function RG(Q,W){var $;return Q[W.keyword]!==void 0||(($=W.definition.implements)===null||$===void 0?void 0:$.some((Y)=>Q[Y]!==void 0))}U6.shouldUseRule=RG});var Z9=C((f0)=>{Object.defineProperty(f0,"__esModule",{value:!0});f0.reportTypeError=f0.checkDataTypes=f0.checkDataType=f0.coerceAndCheckDataType=f0.getJSONTypes=f0.getSchemaTypes=f0.DataType=void 0;var Gw=$Y(),Hw=YY(),Bw=S9(),c=p(),IG=W0(),C8;(function(Q){Q[Q.Correct=0]="Correct",Q[Q.Wrong=1]="Wrong"})(C8||(f0.DataType=C8={}));function Kw(Q){let W=bG(Q.type);if(W.includes("null")){if(Q.nullable===!1)throw Error("type: null contradicts nullable: false")}else{if(!W.length&&Q.nullable!==void 0)throw Error('"nullable" cannot be used without "type"');if(Q.nullable===!0)W.push("null")}return W}f0.getSchemaTypes=Kw;function bG(Q){let W=Array.isArray(Q)?Q:Q?[Q]:[];if(W.every(Gw.isJSONType))return W;throw Error("type must be JSONType or JSONType[]: "+W.join(","))}f0.getJSONTypes=bG;function Fw(Q,W){let{gen:$,data:Y,opts:J}=Q,X=Vw(W,J.coerceTypes),G=W.length>0&&!(X.length===0&&W.length===1&&(0,Hw.schemaHasRulesForType)(Q,W[0]));if(G){let H=XY(W,Y,J.strictNumbers,C8.Wrong);$.if(H,()=>{if(X.length)qw(Q,W,X);else GY(Q)})}return G}f0.coerceAndCheckDataType=Fw;var SG=new Set(["string","number","integer","boolean","null"]);function Vw(Q,W){return W?Q.filter(($)=>SG.has($)||W==="array"&&$==="array"):[]}function qw(Q,W,$){let{gen:Y,data:J,opts:X}=Q,G=Y.let("dataType",c._`typeof ${J}`),H=Y.let("coerced",c._`undefined`);if(X.coerceTypes==="array")Y.if(c._`${G} == 'object' && Array.isArray(${J}) && ${J}.length == 1`,()=>Y.assign(J,c._`${J}[0]`).assign(G,c._`typeof ${J}`).if(XY(W,J,X.strictNumbers),()=>Y.assign(H,J)));Y.if(c._`${H} !== undefined`);for(let K of $)if(SG.has(K)||K==="array"&&X.coerceTypes==="array")B(K);Y.else(),GY(Q),Y.endIf(),Y.if(c._`${H} !== undefined`,()=>{Y.assign(J,H),Lw(Q,H)});function B(K){switch(K){case"string":Y.elseIf(c._`${G} == "number" || ${G} == "boolean"`).assign(H,c._`"" + ${J}`).elseIf(c._`${J} === null`).assign(H,c._`""`);return;case"number":Y.elseIf(c._`${G} == "boolean" || ${J} === null
              || (${G} == "string" && ${J} && ${J} == +${J})`).assign(H,c._`+${J}`);return;case"integer":Y.elseIf(c._`${G} === "boolean" || ${J} === null
              || (${G} === "string" && ${J} && ${J} == +${J} && !(${J} % 1))`).assign(H,c._`+${J}`);return;case"boolean":Y.elseIf(c._`${J} === "false" || ${J} === 0 || ${J} === null`).assign(H,!1).elseIf(c._`${J} === "true" || ${J} === 1`).assign(H,!0);return;case"null":Y.elseIf(c._`${J} === "" || ${J} === 0 || ${J} === false`),Y.assign(H,null);return;case"array":Y.elseIf(c._`${G} === "string" || ${G} === "number"
              || ${G} === "boolean" || ${J} === null`).assign(H,c._`[${J}]`)}}}function Lw({gen:Q,parentData:W,parentDataProperty:$},Y){Q.if(c._`${W} !== undefined`,()=>Q.assign(c._`${W}[${$}]`,Y))}function JY(Q,W,$,Y=C8.Correct){let J=Y===C8.Correct?c.operators.EQ:c.operators.NEQ,X;switch(Q){case"null":return c._`${W} ${J} null`;case"array":X=c._`Array.isArray(${W})`;break;case"object":X=c._`${W} && typeof ${W} == "object" && !Array.isArray(${W})`;break;case"integer":X=G(c._`!(${W} % 1) && !isNaN(${W})`);break;case"number":X=G();break;default:return c._`typeof ${W} ${J} ${Q}`}return Y===C8.Correct?X:(0,c.not)(X);function G(H=c.nil){return(0,c.and)(c._`typeof ${W} == "number"`,H,$?c._`isFinite(${W})`:c.nil)}}f0.checkDataType=JY;function XY(Q,W,$,Y){if(Q.length===1)return JY(Q[0],W,$,Y);let J,X=(0,IG.toHash)(Q);if(X.array&&X.object){let G=c._`typeof ${W} != "object"`;J=X.null?G:c._`!${W} || ${G}`,delete X.null,delete X.array,delete X.object}else J=c.nil;if(X.number)delete X.integer;for(let G in X)J=(0,c.and)(J,JY(G,W,$,Y));return J}f0.checkDataTypes=XY;var Uw={message:({schema:Q})=>`must be ${Q}`,params:({schema:Q,schemaValue:W})=>typeof Q=="string"?c._`{type: ${Q}}`:c._`{type: ${W}}`};function GY(Q){let W=Dw(Q);(0,Bw.reportError)(W,Uw)}f0.reportTypeError=GY;function Dw(Q){let{gen:W,data:$,schema:Y}=Q,J=(0,IG.schemaRefOrVal)(Q,Y,"type");return{gen:W,keyword:"type",data:$,schema:Y.type,schemaCode:J,schemaValue:J,parentSchema:Y,params:{},it:Q}}});var CG=C((NW)=>{Object.defineProperty(NW,"__esModule",{value:!0});NW.assignDefaults=void 0;var v8=p(),ww=W0();function Aw(Q,W){let{properties:$,items:Y}=Q.schema;if(W==="object"&&$)for(let J in $)ZG(Q,J,$[J].default);else if(W==="array"&&Array.isArray(Y))Y.forEach((J,X)=>ZG(Q,X,J.default))}NW.assignDefaults=Aw;function ZG(Q,W,$){let{gen:Y,compositeRule:J,data:X,opts:G}=Q;if($===void 0)return;let H=v8._`${X}${(0,v8.getProperty)(W)}`;if(J){(0,ww.checkStrictMode)(Q,`default is ignored for: ${H}`);return}let B=v8._`${H} === undefined`;if(G.useDefaults==="empty")B=v8._`${B} || ${H} === null || ${H} === ""`;Y.if(B,v8._`${H} = ${(0,v8.stringify)($)}`)}});var K1=C((G0)=>{Object.defineProperty(G0,"__esModule",{value:!0});G0.validateUnion=G0.validateArray=G0.usePattern=G0.callValidateCode=G0.schemaProperties=G0.allSchemaProperties=G0.noPropertyInData=G0.propertyInData=G0.isOwnProperty=G0.hasPropFunc=G0.reportMissingProp=G0.checkMissingProp=G0.checkReportMissingProp=void 0;var q0=p(),HY=W0(),D6=i1(),Ow=W0();function Nw(Q,W){let{gen:$,data:Y,it:J}=Q;$.if(KY($,Y,W,J.opts.ownProperties),()=>{Q.setParams({missingProperty:q0._`${W}`},!0),Q.error()})}G0.checkReportMissingProp=Nw;function Mw({gen:Q,data:W,it:{opts:$}},Y,J){return(0,q0.or)(...Y.map((X)=>(0,q0.and)(KY(Q,W,X,$.ownProperties),q0._`${J} = ${X}`)))}G0.checkMissingProp=Mw;function jw(Q,W){Q.setParams({missingProperty:W},!0),Q.error()}G0.reportMissingProp=jw;function vG(Q){return Q.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:q0._`Object.prototype.hasOwnProperty`})}G0.hasPropFunc=vG;function BY(Q,W,$){return q0._`${vG(Q)}.call(${W}, ${$})`}G0.isOwnProperty=BY;function zw(Q,W,$,Y){let J=q0._`${W}${(0,q0.getProperty)($)} !== undefined`;return Y?q0._`${J} && ${BY(Q,W,$)}`:J}G0.propertyInData=zw;function KY(Q,W,$,Y){let J=q0._`${W}${(0,q0.getProperty)($)} === undefined`;return Y?(0,q0.or)(J,(0,q0.not)(BY(Q,W,$))):J}G0.noPropertyInData=KY;function kG(Q){return Q?Object.keys(Q).filter((W)=>W!=="__proto__"):[]}G0.allSchemaProperties=kG;function Pw(Q,W){return kG(W).filter(($)=>!(0,HY.alwaysValidSchema)(Q,W[$]))}G0.schemaProperties=Pw;function Ew({schemaCode:Q,data:W,it:{gen:$,topSchemaRef:Y,schemaPath:J,errorPath:X},it:G},H,B,K){let F=K?q0._`${Q}, ${W}, ${Y}${J}`:W,q=[[D6.default.instancePath,(0,q0.strConcat)(D6.default.instancePath,X)],[D6.default.parentData,G.parentData],[D6.default.parentDataProperty,G.parentDataProperty],[D6.default.rootData,D6.default.rootData]];if(G.opts.dynamicRef)q.push([D6.default.dynamicAnchors,D6.default.dynamicAnchors]);let U=q0._`${F}, ${$.object(...q)}`;return B!==q0.nil?q0._`${H}.call(${B}, ${U})`:q0._`${H}(${U})`}G0.callValidateCode=Ew;var Rw=q0._`new RegExp`;function Iw({gen:Q,it:{opts:W}},$){let Y=W.unicodeRegExp?"u":"",{regExp:J}=W.code,X=J($,Y);return Q.scopeValue("pattern",{key:X.toString(),ref:X,code:q0._`${J.code==="new RegExp"?Rw:(0,Ow.useFunc)(Q,J)}(${$}, ${Y})`})}G0.usePattern=Iw;function bw(Q){let{gen:W,data:$,keyword:Y,it:J}=Q,X=W.name("valid");if(J.allErrors){let H=W.let("valid",!0);return G(()=>W.assign(H,!1)),H}return W.var(X,!0),G(()=>W.break()),X;function G(H){let B=W.const("len",q0._`${$}.length`);W.forRange("i",0,B,(K)=>{Q.subschema({keyword:Y,dataProp:K,dataPropType:HY.Type.Num},X),W.if((0,q0.not)(X),H)})}}G0.validateArray=bw;function Sw(Q){let{gen:W,schema:$,keyword:Y,it:J}=Q;if(!Array.isArray($))throw Error("ajv implementation error");if($.some((B)=>(0,HY.alwaysValidSchema)(J,B))&&!J.opts.unevaluated)return;let G=W.let("valid",!1),H=W.name("_valid");W.block(()=>$.forEach((B,K)=>{let F=Q.subschema({keyword:Y,schemaProp:K,compositeRule:!0},H);if(W.assign(G,q0._`${G} || ${H}`),!Q.mergeValidEvaluated(F,H))W.if((0,q0.not)(G))})),Q.result(G,()=>Q.reset(),()=>Q.error(!0))}G0.validateUnion=Sw});var xG=C((k1)=>{Object.defineProperty(k1,"__esModule",{value:!0});k1.validateKeywordUsage=k1.validSchemaType=k1.funcKeywordCode=k1.macroKeywordCode=void 0;var i0=p(),f6=i1(),Zw=K1(),Cw=S9();function vw(Q,W){let{gen:$,keyword:Y,schema:J,parentSchema:X,it:G}=Q,H=W.macro.call(G.self,J,X,G),B=_G($,Y,H);if(G.opts.validateSchema!==!1)G.self.validateSchema(H,!0);let K=$.name("valid");Q.subschema({schema:H,schemaPath:i0.nil,errSchemaPath:`${G.errSchemaPath}/${Y}`,topSchemaRef:B,compositeRule:!0},K),Q.pass(K,()=>Q.error(!0))}k1.macroKeywordCode=vw;function kw(Q,W){var $;let{gen:Y,keyword:J,schema:X,parentSchema:G,$data:H,it:B}=Q;_w(B,W);let K=!H&&W.compile?W.compile.call(B.self,X,G,B):W.validate,F=_G(Y,J,K),q=Y.let("valid");Q.block$data(q,U),Q.ok(($=W.valid)!==null&&$!==void 0?$:q);function U(){if(W.errors===!1){if(w(),W.modifying)TG(Q);A(()=>Q.error())}else{let O=W.async?L():D();if(W.modifying)TG(Q);A(()=>Tw(Q,O))}}function L(){let O=Y.let("ruleErrs",null);return Y.try(()=>w(i0._`await `),(j)=>Y.assign(q,!1).if(i0._`${j} instanceof ${B.ValidationError}`,()=>Y.assign(O,i0._`${j}.errors`),()=>Y.throw(j))),O}function D(){let O=i0._`${F}.errors`;return Y.assign(O,null),w(i0.nil),O}function w(O=W.async?i0._`await `:i0.nil){let j=B.opts.passContext?f6.default.this:f6.default.self,z=!(("compile"in W)&&!H||W.schema===!1);Y.assign(q,i0._`${O}${(0,Zw.callValidateCode)(Q,F,j,z)}`,W.modifying)}function A(O){var j;Y.if((0,i0.not)((j=W.valid)!==null&&j!==void 0?j:q),O)}}k1.funcKeywordCode=kw;function TG(Q){let{gen:W,data:$,it:Y}=Q;W.if(Y.parentData,()=>W.assign($,i0._`${Y.parentData}[${Y.parentDataProperty}]`))}function Tw(Q,W){let{gen:$}=Q;$.if(i0._`Array.isArray(${W})`,()=>{$.assign(f6.default.vErrors,i0._`${f6.default.vErrors} === null ? ${W} : ${f6.default.vErrors}.concat(${W})`).assign(f6.default.errors,i0._`${f6.default.vErrors}.length`),(0,Cw.extendErrors)(Q)},()=>Q.error())}function _w({schemaEnv:Q},W){if(W.async&&!Q.$async)throw Error("async keyword in sync schema")}function _G(Q,W,$){if($===void 0)throw Error(`keyword "${W}" failed to compile`);return Q.scopeValue("keyword",typeof $=="function"?{ref:$}:{ref:$,code:(0,i0.stringify)($)})}function xw(Q,W,$=!1){return!W.length||W.some((Y)=>Y==="array"?Array.isArray(Q):Y==="object"?Q&&typeof Q=="object"&&!Array.isArray(Q):typeof Q==Y||$&&typeof Q>"u")}k1.validSchemaType=xw;function yw({schema:Q,opts:W,self:$,errSchemaPath:Y},J,X){if(Array.isArray(J.keyword)?!J.keyword.includes(X):J.keyword!==X)throw Error("ajv implementation error");let G=J.dependencies;if(G===null||G===void 0?void 0:G.some((H)=>!Object.prototype.hasOwnProperty.call(Q,H)))throw Error(`parent schema must have dependencies of ${X}: ${G.join(",")}`);if(J.validateSchema){if(!J.validateSchema(Q[X])){let B=`keyword "${X}" value is invalid at path "${Y}": `+$.errorsText(J.validateSchema.errors);if(W.validateSchema==="log")$.logger.error(B);else throw Error(B)}}}k1.validateKeywordUsage=yw});var gG=C((w6)=>{Object.defineProperty(w6,"__esModule",{value:!0});w6.extendSubschemaMode=w6.extendSubschemaData=w6.getSubschema=void 0;var T1=p(),yG=W0();function gw(Q,{keyword:W,schemaProp:$,schema:Y,schemaPath:J,errSchemaPath:X,topSchemaRef:G}){if(W!==void 0&&Y!==void 0)throw Error('both "keyword" and "schema" passed, only one allowed');if(W!==void 0){let H=Q.schema[W];return $===void 0?{schema:H,schemaPath:T1._`${Q.schemaPath}${(0,T1.getProperty)(W)}`,errSchemaPath:`${Q.errSchemaPath}/${W}`}:{schema:H[$],schemaPath:T1._`${Q.schemaPath}${(0,T1.getProperty)(W)}${(0,T1.getProperty)($)}`,errSchemaPath:`${Q.errSchemaPath}/${W}/${(0,yG.escapeFragment)($)}`}}if(Y!==void 0){if(J===void 0||X===void 0||G===void 0)throw Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:Y,schemaPath:J,topSchemaRef:G,errSchemaPath:X}}throw Error('either "keyword" or "schema" must be passed')}w6.getSubschema=gw;function hw(Q,W,{dataProp:$,dataPropType:Y,data:J,dataTypes:X,propertyName:G}){if(J!==void 0&&$!==void 0)throw Error('both "data" and "dataProp" passed, only one allowed');let{gen:H}=W;if($!==void 0){let{errorPath:K,dataPathArr:F,opts:q}=W,U=H.let("data",T1._`${W.data}${(0,T1.getProperty)($)}`,!0);B(U),Q.errorPath=T1.str`${K}${(0,yG.getErrorPath)($,Y,q.jsPropertySyntax)}`,Q.parentDataProperty=T1._`${$}`,Q.dataPathArr=[...F,Q.parentDataProperty]}if(J!==void 0){let K=J instanceof T1.Name?J:H.let("data",J,!0);if(B(K),G!==void 0)Q.propertyName=G}if(X)Q.dataTypes=X;function B(K){Q.data=K,Q.dataLevel=W.dataLevel+1,Q.dataTypes=[],W.definedProperties=new Set,Q.parentData=W.data,Q.dataNames=[...W.dataNames,K]}}w6.extendSubschemaData=hw;function fw(Q,{jtdDiscriminator:W,jtdMetadata:$,compositeRule:Y,createErrors:J,allErrors:X}){if(Y!==void 0)Q.compositeRule=Y;if(J!==void 0)Q.createErrors=J;if(X!==void 0)Q.allErrors=X;Q.jtdDiscriminator=W,Q.jtdMetadata=$}w6.extendSubschemaMode=fw});var FY=C((d2,hG)=>{hG.exports=function Q(W,$){if(W===$)return!0;if(W&&$&&typeof W=="object"&&typeof $=="object"){if(W.constructor!==$.constructor)return!1;var Y,J,X;if(Array.isArray(W)){if(Y=W.length,Y!=$.length)return!1;for(J=Y;J--!==0;)if(!Q(W[J],$[J]))return!1;return!0}if(W.constructor===RegExp)return W.source===$.source&&W.flags===$.flags;if(W.valueOf!==Object.prototype.valueOf)return W.valueOf()===$.valueOf();if(W.toString!==Object.prototype.toString)return W.toString()===$.toString();if(X=Object.keys(W),Y=X.length,Y!==Object.keys($).length)return!1;for(J=Y;J--!==0;)if(!Object.prototype.hasOwnProperty.call($,X[J]))return!1;for(J=Y;J--!==0;){var G=X[J];if(!Q(W[G],$[G]))return!1}return!0}return W!==W&&$!==$}});var uG=C((i2,fG)=>{var A6=fG.exports=function(Q,W,$){if(typeof W=="function")$=W,W={};$=W.cb||$;var Y=typeof $=="function"?$:$.pre||function(){},J=$.post||function(){};MW(W,Y,J,Q,"",Q)};A6.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};A6.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};A6.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};A6.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function MW(Q,W,$,Y,J,X,G,H,B,K){if(Y&&typeof Y=="object"&&!Array.isArray(Y)){W(Y,J,X,G,H,B,K);for(var F in Y){var q=Y[F];if(Array.isArray(q)){if(F in A6.arrayKeywords)for(var U=0;U<q.length;U++)MW(Q,W,$,q[U],J+"/"+F+"/"+U,X,J,F,Y,U)}else if(F in A6.propsKeywords){if(q&&typeof q=="object")for(var L in q)MW(Q,W,$,q[L],J+"/"+F+"/"+uw(L),X,J,F,Y,L)}else if(F in A6.keywords||Q.allKeys&&!(F in A6.skipKeywords))MW(Q,W,$,q,J+"/"+F,X,J,F,Y)}$(Y,J,X,G,H,B,K)}}function uw(Q){return Q.replace(/~/g,"~0").replace(/\//g,"~1")}});var C9=C((t0)=>{Object.defineProperty(t0,"__esModule",{value:!0});t0.getSchemaRefs=t0.resolveUrl=t0.normalizeId=t0._getFullPath=t0.getFullPath=t0.inlineRef=void 0;var lw=W0(),mw=FY(),cw=uG(),pw=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function dw(Q,W=!0){if(typeof Q=="boolean")return!0;if(W===!0)return!VY(Q);if(!W)return!1;return lG(Q)<=W}t0.inlineRef=dw;var iw=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function VY(Q){for(let W in Q){if(iw.has(W))return!0;let $=Q[W];if(Array.isArray($)&&$.some(VY))return!0;if(typeof $=="object"&&VY($))return!0}return!1}function lG(Q){let W=0;for(let $ in Q){if($==="$ref")return 1/0;if(W++,pw.has($))continue;if(typeof Q[$]=="object")(0,lw.eachItem)(Q[$],(Y)=>W+=lG(Y));if(W===1/0)return 1/0}return W}function mG(Q,W="",$){if($!==!1)W=k8(W);let Y=Q.parse(W);return cG(Q,Y)}t0.getFullPath=mG;function cG(Q,W){return Q.serialize(W).split("#")[0]+"#"}t0._getFullPath=cG;var nw=/#\/?$/;function k8(Q){return Q?Q.replace(nw,""):""}t0.normalizeId=k8;function ow(Q,W,$){return $=k8($),Q.resolve(W,$)}t0.resolveUrl=ow;var rw=/^[a-z_][-a-z0-9._]*$/i;function aw(Q,W){if(typeof Q=="boolean")return{};let{schemaId:$,uriResolver:Y}=this.opts,J=k8(Q[$]||W),X={"":J},G=mG(Y,J,!1),H={},B=new Set;return cw(Q,{allKeys:!0},(q,U,L,D)=>{if(D===void 0)return;let w=G+U,A=X[D];if(typeof q[$]=="string")A=O.call(this,q[$]);j.call(this,q.$anchor),j.call(this,q.$dynamicAnchor),X[U]=A;function O(z){let S=this.opts.uriResolver.resolve;if(z=k8(A?S(A,z):z),B.has(z))throw F(z);B.add(z);let Z=this.refs[z];if(typeof Z=="string")Z=this.refs[Z];if(typeof Z=="object")K(q,Z.schema,z);else if(z!==k8(w))if(z[0]==="#")K(q,H[z],z),H[z]=q;else this.refs[z]=w;return z}function j(z){if(typeof z=="string"){if(!rw.test(z))throw Error(`invalid anchor "${z}"`);O.call(this,`#${z}`)}}}),H;function K(q,U,L){if(U!==void 0&&!mw(q,U))throw F(L)}function F(q){return Error(`reference "${q}" resolves to more than one schema`)}}t0.getSchemaRefs=aw});var T9=C((O6)=>{Object.defineProperty(O6,"__esModule",{value:!0});O6.getData=O6.KeywordCxt=O6.validateFunctionCode=void 0;var oG=PG(),pG=Z9(),LY=YY(),jW=Z9(),tw=CG(),k9=xG(),qY=gG(),x=p(),l=i1(),sw=C9(),n1=W0(),v9=S9();function ew(Q){if(tG(Q)){if(sG(Q),aG(Q)){$A(Q);return}}rG(Q,()=>(0,oG.topBoolOrEmptySchema)(Q))}O6.validateFunctionCode=ew;function rG({gen:Q,validateName:W,schema:$,schemaEnv:Y,opts:J},X){if(J.code.es5)Q.func(W,x._`${l.default.data}, ${l.default.valCxt}`,Y.$async,()=>{Q.code(x._`"use strict"; ${dG($,J)}`),WA(Q,J),Q.code(X)});else Q.func(W,x._`${l.default.data}, ${QA(J)}`,Y.$async,()=>Q.code(dG($,J)).code(X))}function QA(Q){return x._`{${l.default.instancePath}="", ${l.default.parentData}, ${l.default.parentDataProperty}, ${l.default.rootData}=${l.default.data}${Q.dynamicRef?x._`, ${l.default.dynamicAnchors}={}`:x.nil}}={}`}function WA(Q,W){Q.if(l.default.valCxt,()=>{if(Q.var(l.default.instancePath,x._`${l.default.valCxt}.${l.default.instancePath}`),Q.var(l.default.parentData,x._`${l.default.valCxt}.${l.default.parentData}`),Q.var(l.default.parentDataProperty,x._`${l.default.valCxt}.${l.default.parentDataProperty}`),Q.var(l.default.rootData,x._`${l.default.valCxt}.${l.default.rootData}`),W.dynamicRef)Q.var(l.default.dynamicAnchors,x._`${l.default.valCxt}.${l.default.dynamicAnchors}`)},()=>{if(Q.var(l.default.instancePath,x._`""`),Q.var(l.default.parentData,x._`undefined`),Q.var(l.default.parentDataProperty,x._`undefined`),Q.var(l.default.rootData,l.default.data),W.dynamicRef)Q.var(l.default.dynamicAnchors,x._`{}`)})}function $A(Q){let{schema:W,opts:$,gen:Y}=Q;rG(Q,()=>{if($.$comment&&W.$comment)QH(Q);if(HA(Q),Y.let(l.default.vErrors,null),Y.let(l.default.errors,0),$.unevaluated)YA(Q);eG(Q),FA(Q)});return}function YA(Q){let{gen:W,validateName:$}=Q;Q.evaluated=W.const("evaluated",x._`${$}.evaluated`),W.if(x._`${Q.evaluated}.dynamicProps`,()=>W.assign(x._`${Q.evaluated}.props`,x._`undefined`)),W.if(x._`${Q.evaluated}.dynamicItems`,()=>W.assign(x._`${Q.evaluated}.items`,x._`undefined`))}function dG(Q,W){let $=typeof Q=="object"&&Q[W.schemaId];return $&&(W.code.source||W.code.process)?x._`/*# sourceURL=${$} */`:x.nil}function JA(Q,W){if(tG(Q)){if(sG(Q),aG(Q)){XA(Q,W);return}}(0,oG.boolOrEmptySchema)(Q,W)}function aG({schema:Q,self:W}){if(typeof Q=="boolean")return!Q;for(let $ in Q)if(W.RULES.all[$])return!0;return!1}function tG(Q){return typeof Q.schema!="boolean"}function XA(Q,W){let{schema:$,gen:Y,opts:J}=Q;if(J.$comment&&$.$comment)QH(Q);BA(Q),KA(Q);let X=Y.const("_errs",l.default.errors);eG(Q,X),Y.var(W,x._`${X} === ${l.default.errors}`)}function sG(Q){(0,n1.checkUnknownRules)(Q),GA(Q)}function eG(Q,W){if(Q.opts.jtd)return iG(Q,[],!1,W);let $=(0,pG.getSchemaTypes)(Q.schema),Y=(0,pG.coerceAndCheckDataType)(Q,$);iG(Q,$,!Y,W)}function GA(Q){let{schema:W,errSchemaPath:$,opts:Y,self:J}=Q;if(W.$ref&&Y.ignoreKeywordsWithRef&&(0,n1.schemaHasRulesButRef)(W,J.RULES))J.logger.warn(`$ref: keywords ignored in schema at path "${$}"`)}function HA(Q){let{schema:W,opts:$}=Q;if(W.default!==void 0&&$.useDefaults&&$.strictSchema)(0,n1.checkStrictMode)(Q,"default is ignored in the schema root")}function BA(Q){let W=Q.schema[Q.opts.schemaId];if(W)Q.baseId=(0,sw.resolveUrl)(Q.opts.uriResolver,Q.baseId,W)}function KA(Q){if(Q.schema.$async&&!Q.schemaEnv.$async)throw Error("async schema in sync schema")}function QH({gen:Q,schemaEnv:W,schema:$,errSchemaPath:Y,opts:J}){let X=$.$comment;if(J.$comment===!0)Q.code(x._`${l.default.self}.logger.log(${X})`);else if(typeof J.$comment=="function"){let G=x.str`${Y}/$comment`,H=Q.scopeValue("root",{ref:W.root});Q.code(x._`${l.default.self}.opts.$comment(${X}, ${G}, ${H}.schema)`)}}function FA(Q){let{gen:W,schemaEnv:$,validateName:Y,ValidationError:J,opts:X}=Q;if($.$async)W.if(x._`${l.default.errors} === 0`,()=>W.return(l.default.data),()=>W.throw(x._`new ${J}(${l.default.vErrors})`));else{if(W.assign(x._`${Y}.errors`,l.default.vErrors),X.unevaluated)VA(Q);W.return(x._`${l.default.errors} === 0`)}}function VA({gen:Q,evaluated:W,props:$,items:Y}){if($ instanceof x.Name)Q.assign(x._`${W}.props`,$);if(Y instanceof x.Name)Q.assign(x._`${W}.items`,Y)}function iG(Q,W,$,Y){let{gen:J,schema:X,data:G,allErrors:H,opts:B,self:K}=Q,{RULES:F}=K;if(X.$ref&&(B.ignoreKeywordsWithRef||!(0,n1.schemaHasRulesButRef)(X,F))){J.block(()=>$H(Q,"$ref",F.all.$ref.definition));return}if(!B.jtd)qA(Q,W);J.block(()=>{for(let U of F.rules)q(U);q(F.post)});function q(U){if(!(0,LY.shouldUseGroup)(X,U))return;if(U.type){if(J.if((0,jW.checkDataType)(U.type,G,B.strictNumbers)),nG(Q,U),W.length===1&&W[0]===U.type&&$)J.else(),(0,jW.reportTypeError)(Q);J.endIf()}else nG(Q,U);if(!H)J.if(x._`${l.default.errors} === ${Y||0}`)}}function nG(Q,W){let{gen:$,schema:Y,opts:{useDefaults:J}}=Q;if(J)(0,tw.assignDefaults)(Q,W.type);$.block(()=>{for(let X of W.rules)if((0,LY.shouldUseRule)(Y,X))$H(Q,X.keyword,X.definition,W.type)})}function qA(Q,W){if(Q.schemaEnv.meta||!Q.opts.strictTypes)return;if(LA(Q,W),!Q.opts.allowUnionTypes)UA(Q,W);DA(Q,Q.dataTypes)}function LA(Q,W){if(!W.length)return;if(!Q.dataTypes.length){Q.dataTypes=W;return}W.forEach(($)=>{if(!WH(Q.dataTypes,$))UY(Q,`type "${$}" not allowed by context "${Q.dataTypes.join(",")}"`)}),AA(Q,W)}function UA(Q,W){if(W.length>1&&!(W.length===2&&W.includes("null")))UY(Q,"use allowUnionTypes to allow union type keyword")}function DA(Q,W){let $=Q.self.RULES.all;for(let Y in $){let J=$[Y];if(typeof J=="object"&&(0,LY.shouldUseRule)(Q.schema,J)){let{type:X}=J.definition;if(X.length&&!X.some((G)=>wA(W,G)))UY(Q,`missing type "${X.join(",")}" for keyword "${Y}"`)}}}function wA(Q,W){return Q.includes(W)||W==="number"&&Q.includes("integer")}function WH(Q,W){return Q.includes(W)||W==="integer"&&Q.includes("number")}function AA(Q,W){let $=[];for(let Y of Q.dataTypes)if(WH(W,Y))$.push(Y);else if(W.includes("integer")&&Y==="number")$.push("integer");Q.dataTypes=$}function UY(Q,W){let $=Q.schemaEnv.baseId+Q.errSchemaPath;W+=` at "${$}" (strictTypes)`,(0,n1.checkStrictMode)(Q,W,Q.opts.strictTypes)}class DY{constructor(Q,W,$){if((0,k9.validateKeywordUsage)(Q,W,$),this.gen=Q.gen,this.allErrors=Q.allErrors,this.keyword=$,this.data=Q.data,this.schema=Q.schema[$],this.$data=W.$data&&Q.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,n1.schemaRefOrVal)(Q,this.schema,$,this.$data),this.schemaType=W.schemaType,this.parentSchema=Q.schema,this.params={},this.it=Q,this.def=W,this.$data)this.schemaCode=Q.gen.const("vSchema",YH(this.$data,Q));else if(this.schemaCode=this.schemaValue,!(0,k9.validSchemaType)(this.schema,W.schemaType,W.allowUndefined))throw Error(`${$} value must be ${JSON.stringify(W.schemaType)}`);if("code"in W?W.trackErrors:W.errors!==!1)this.errsCount=Q.gen.const("_errs",l.default.errors)}result(Q,W,$){this.failResult((0,x.not)(Q),W,$)}failResult(Q,W,$){if(this.gen.if(Q),$)$();else this.error();if(W){if(this.gen.else(),W(),this.allErrors)this.gen.endIf()}else if(this.allErrors)this.gen.endIf();else this.gen.else()}pass(Q,W){this.failResult((0,x.not)(Q),void 0,W)}fail(Q){if(Q===void 0){if(this.error(),!this.allErrors)this.gen.if(!1);return}if(this.gen.if(Q),this.error(),this.allErrors)this.gen.endIf();else this.gen.else()}fail$data(Q){if(!this.$data)return this.fail(Q);let{schemaCode:W}=this;this.fail(x._`${W} !== undefined && (${(0,x.or)(this.invalid$data(),Q)})`)}error(Q,W,$){if(W){this.setParams(W),this._error(Q,$),this.setParams({});return}this._error(Q,$)}_error(Q,W){(Q?v9.reportExtraError:v9.reportError)(this,this.def.error,W)}$dataError(){(0,v9.reportError)(this,this.def.$dataError||v9.keyword$DataError)}reset(){if(this.errsCount===void 0)throw Error('add "trackErrors" to keyword definition');(0,v9.resetErrorsCount)(this.gen,this.errsCount)}ok(Q){if(!this.allErrors)this.gen.if(Q)}setParams(Q,W){if(W)Object.assign(this.params,Q);else this.params=Q}block$data(Q,W,$=x.nil){this.gen.block(()=>{this.check$data(Q,$),W()})}check$data(Q=x.nil,W=x.nil){if(!this.$data)return;let{gen:$,schemaCode:Y,schemaType:J,def:X}=this;if($.if((0,x.or)(x._`${Y} === undefined`,W)),Q!==x.nil)$.assign(Q,!0);if(J.length||X.validateSchema){if($.elseIf(this.invalid$data()),this.$dataError(),Q!==x.nil)$.assign(Q,!1)}$.else()}invalid$data(){let{gen:Q,schemaCode:W,schemaType:$,def:Y,it:J}=this;return(0,x.or)(X(),G());function X(){if($.length){if(!(W instanceof x.Name))throw Error("ajv implementation error");let H=Array.isArray($)?$:[$];return x._`${(0,jW.checkDataTypes)(H,W,J.opts.strictNumbers,jW.DataType.Wrong)}`}return x.nil}function G(){if(Y.validateSchema){let H=Q.scopeValue("validate$data",{ref:Y.validateSchema});return x._`!${H}(${W})`}return x.nil}}subschema(Q,W){let $=(0,qY.getSubschema)(this.it,Q);(0,qY.extendSubschemaData)($,this.it,Q),(0,qY.extendSubschemaMode)($,Q);let Y={...this.it,...$,items:void 0,props:void 0};return JA(Y,W),Y}mergeEvaluated(Q,W){let{it:$,gen:Y}=this;if(!$.opts.unevaluated)return;if($.props!==!0&&Q.props!==void 0)$.props=n1.mergeEvaluated.props(Y,Q.props,$.props,W);if($.items!==!0&&Q.items!==void 0)$.items=n1.mergeEvaluated.items(Y,Q.items,$.items,W)}mergeValidEvaluated(Q,W){let{it:$,gen:Y}=this;if($.opts.unevaluated&&($.props!==!0||$.items!==!0))return Y.if(W,()=>this.mergeEvaluated(Q,x.Name)),!0}}O6.KeywordCxt=DY;function $H(Q,W,$,Y){let J=new DY(Q,$,W);if("code"in $)$.code(J,Y);else if(J.$data&&$.validate)(0,k9.funcKeywordCode)(J,$);else if("macro"in $)(0,k9.macroKeywordCode)(J,$);else if($.compile||$.validate)(0,k9.funcKeywordCode)(J,$)}var OA=/^\/(?:[^~]|~0|~1)*$/,NA=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function YH(Q,{dataLevel:W,dataNames:$,dataPathArr:Y}){let J,X;if(Q==="")return l.default.rootData;if(Q[0]==="/"){if(!OA.test(Q))throw Error(`Invalid JSON-pointer: ${Q}`);J=Q,X=l.default.rootData}else{let K=NA.exec(Q);if(!K)throw Error(`Invalid JSON-pointer: ${Q}`);let F=+K[1];if(J=K[2],J==="#"){if(F>=W)throw Error(B("property/index",F));return Y[W-F]}if(F>W)throw Error(B("data",F));if(X=$[W-F],!J)return X}let G=X,H=J.split("/");for(let K of H)if(K)X=x._`${X}${(0,x.getProperty)((0,n1.unescapeJsonPointer)(K))}`,G=x._`${G} && ${X}`;return G;function B(K,F){return`Cannot access ${K} ${F} levels up, current level is ${W}`}}O6.getData=YH});var zW=C((wY)=>{Object.defineProperty(wY,"__esModule",{value:!0});class JH extends Error{constructor(Q){super("validation failed");this.errors=Q,this.ajv=this.validation=!0}}wY.default=JH});var _9=C((OY)=>{Object.defineProperty(OY,"__esModule",{value:!0});var AY=C9();class XH extends Error{constructor(Q,W,$,Y){super(Y||`can't resolve reference ${$} from id ${W}`);this.missingRef=(0,AY.resolveUrl)(Q,W,$),this.missingSchema=(0,AY.normalizeId)((0,AY.getFullPath)(Q,this.missingRef))}}OY.default=XH});var EW=C((F1)=>{Object.defineProperty(F1,"__esModule",{value:!0});F1.resolveSchema=F1.getCompilingSchema=F1.resolveRef=F1.compileSchema=F1.SchemaEnv=void 0;var P1=p(),MA=zW(),u6=i1(),E1=C9(),GH=W0(),jA=T9();class x9{constructor(Q){var W;this.refs={},this.dynamicAnchors={};let $;if(typeof Q.schema=="object")$=Q.schema;this.schema=Q.schema,this.schemaId=Q.schemaId,this.root=Q.root||this,this.baseId=(W=Q.baseId)!==null&&W!==void 0?W:(0,E1.normalizeId)($===null||$===void 0?void 0:$[Q.schemaId||"$id"]),this.schemaPath=Q.schemaPath,this.localRefs=Q.localRefs,this.meta=Q.meta,this.$async=$===null||$===void 0?void 0:$.$async,this.refs={}}}F1.SchemaEnv=x9;function MY(Q){let W=HH.call(this,Q);if(W)return W;let $=(0,E1.getFullPath)(this.opts.uriResolver,Q.root.baseId),{es5:Y,lines:J}=this.opts.code,{ownProperties:X}=this.opts,G=new P1.CodeGen(this.scope,{es5:Y,lines:J,ownProperties:X}),H;if(Q.$async)H=G.scopeValue("Error",{ref:MA.default,code:P1._`require("ajv/dist/runtime/validation_error").default`});let B=G.scopeName("validate");Q.validateName=B;let K={gen:G,allErrors:this.opts.allErrors,data:u6.default.data,parentData:u6.default.parentData,parentDataProperty:u6.default.parentDataProperty,dataNames:[u6.default.data],dataPathArr:[P1.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:G.scopeValue("schema",this.opts.code.source===!0?{ref:Q.schema,code:(0,P1.stringify)(Q.schema)}:{ref:Q.schema}),validateName:B,ValidationError:H,schema:Q.schema,schemaEnv:Q,rootId:$,baseId:Q.baseId||$,schemaPath:P1.nil,errSchemaPath:Q.schemaPath||(this.opts.jtd?"":"#"),errorPath:P1._`""`,opts:this.opts,self:this},F;try{this._compilations.add(Q),(0,jA.validateFunctionCode)(K),G.optimize(this.opts.code.optimize);let q=G.toString();if(F=`${G.scopeRefs(u6.default.scope)}return ${q}`,this.opts.code.process)F=this.opts.code.process(F,Q);let L=Function(`${u6.default.self}`,`${u6.default.scope}`,F)(this,this.scope.get());if(this.scope.value(B,{ref:L}),L.errors=null,L.schema=Q.schema,L.schemaEnv=Q,Q.$async)L.$async=!0;if(this.opts.code.source===!0)L.source={validateName:B,validateCode:q,scopeValues:G._values};if(this.opts.unevaluated){let{props:D,items:w}=K;if(L.evaluated={props:D instanceof P1.Name?void 0:D,items:w instanceof P1.Name?void 0:w,dynamicProps:D instanceof P1.Name,dynamicItems:w instanceof P1.Name},L.source)L.source.evaluated=(0,P1.stringify)(L.evaluated)}return Q.validate=L,Q}catch(q){if(delete Q.validate,delete Q.validateName,F)this.logger.error("Error compiling schema, function code:",F);throw q}finally{this._compilations.delete(Q)}}F1.compileSchema=MY;function zA(Q,W,$){var Y;$=(0,E1.resolveUrl)(this.opts.uriResolver,W,$);let J=Q.refs[$];if(J)return J;let X=RA.call(this,Q,$);if(X===void 0){let G=(Y=Q.localRefs)===null||Y===void 0?void 0:Y[$],{schemaId:H}=this.opts;if(G)X=new x9({schema:G,schemaId:H,root:Q,baseId:W})}if(X===void 0)return;return Q.refs[$]=PA.call(this,X)}F1.resolveRef=zA;function PA(Q){if((0,E1.inlineRef)(Q.schema,this.opts.inlineRefs))return Q.schema;return Q.validate?Q:MY.call(this,Q)}function HH(Q){for(let W of this._compilations)if(EA(W,Q))return W}F1.getCompilingSchema=HH;function EA(Q,W){return Q.schema===W.schema&&Q.root===W.root&&Q.baseId===W.baseId}function RA(Q,W){let $;while(typeof($=this.refs[W])=="string")W=$;return $||this.schemas[W]||PW.call(this,Q,W)}function PW(Q,W){let $=this.opts.uriResolver.parse(W),Y=(0,E1._getFullPath)(this.opts.uriResolver,$),J=(0,E1.getFullPath)(this.opts.uriResolver,Q.baseId,void 0);if(Object.keys(Q.schema).length>0&&Y===J)return NY.call(this,$,Q);let X=(0,E1.normalizeId)(Y),G=this.refs[X]||this.schemas[X];if(typeof G=="string"){let H=PW.call(this,Q,G);if(typeof(H===null||H===void 0?void 0:H.schema)!=="object")return;return NY.call(this,$,H)}if(typeof(G===null||G===void 0?void 0:G.schema)!=="object")return;if(!G.validate)MY.call(this,G);if(X===(0,E1.normalizeId)(W)){let{schema:H}=G,{schemaId:B}=this.opts,K=H[B];if(K)J=(0,E1.resolveUrl)(this.opts.uriResolver,J,K);return new x9({schema:H,schemaId:B,root:Q,baseId:J})}return NY.call(this,$,G)}F1.resolveSchema=PW;var IA=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function NY(Q,{baseId:W,schema:$,root:Y}){var J;if(((J=Q.fragment)===null||J===void 0?void 0:J[0])!=="/")return;for(let H of Q.fragment.slice(1).split("/")){if(typeof $==="boolean")return;let B=$[(0,GH.unescapeFragment)(H)];if(B===void 0)return;$=B;let K=typeof $==="object"&&$[this.opts.schemaId];if(!IA.has(H)&&K)W=(0,E1.resolveUrl)(this.opts.uriResolver,W,K)}let X;if(typeof $!="boolean"&&$.$ref&&!(0,GH.schemaHasRulesButRef)($,this.RULES)){let H=(0,E1.resolveUrl)(this.opts.uriResolver,W,$.$ref);X=PW.call(this,Y,H)}let{schemaId:G}=this.opts;if(X=X||new x9({schema:$,schemaId:G,root:Y,baseId:W}),X.schema!==X.root.schema)return X;return}});var BH=C((s2,bA)=>{bA.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var zY=C((e2,qH)=>{var SA=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),FH=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function jY(Q){let W="",$=0,Y=0;for(Y=0;Y<Q.length;Y++){if($=Q[Y].charCodeAt(0),$===48)continue;if(!($>=48&&$<=57||$>=65&&$<=70||$>=97&&$<=102))return"";W+=Q[Y];break}for(Y+=1;Y<Q.length;Y++){if($=Q[Y].charCodeAt(0),!($>=48&&$<=57||$>=65&&$<=70||$>=97&&$<=102))return"";W+=Q[Y]}return W}var ZA=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function KH(Q){return Q.length=0,!0}function CA(Q,W,$){if(Q.length){let Y=jY(Q);if(Y!=="")W.push(Y);else return $.error=!0,!1;Q.length=0}return!0}function vA(Q){let W=0,$={error:!1,address:"",zone:""},Y=[],J=[],X=!1,G=!1,H=CA;for(let B=0;B<Q.length;B++){let K=Q[B];if(K==="["||K==="]")continue;if(K===":"){if(X===!0)G=!0;if(!H(J,Y,$))break;if(++W>7){$.error=!0;break}if(B>0&&Q[B-1]===":")X=!0;Y.push(":");continue}else if(K==="%"){if(!H(J,Y,$))break;H=KH}else{J.push(K);continue}}if(J.length)if(H===KH)$.zone=J.join("");else if(G)Y.push(J.join(""));else Y.push(jY(J));return $.address=Y.join(""),$}function VH(Q){if(kA(Q,":")<2)return{host:Q,isIPV6:!1};let W=vA(Q);if(!W.error){let{address:$,address:Y}=W;if(W.zone)$+="%"+W.zone,Y+="%25"+W.zone;return{host:$,isIPV6:!0,escapedHost:Y}}else return{host:Q,isIPV6:!1}}function kA(Q,W){let $=0;for(let Y=0;Y<Q.length;Y++)if(Q[Y]===W)$++;return $}function TA(Q){let W=Q,$=[],Y=-1,J=0;while(J=W.length){if(J===1)if(W===".")break;else if(W==="/"){$.push("/");break}else{$.push(W);break}else if(J===2){if(W[0]==="."){if(W[1]===".")break;else if(W[1]==="/"){W=W.slice(2);continue}}else if(W[0]==="/"){if(W[1]==="."||W[1]==="/"){$.push("/");break}}}else if(J===3){if(W==="/.."){if($.length!==0)$.pop();$.push("/");break}}if(W[0]==="."){if(W[1]==="."){if(W[2]==="/"){W=W.slice(3);continue}}else if(W[1]==="/"){W=W.slice(2);continue}}else if(W[0]==="/"){if(W[1]==="."){if(W[2]==="/"){W=W.slice(2);continue}else if(W[2]==="."){if(W[3]==="/"){if(W=W.slice(3),$.length!==0)$.pop();continue}}}}if((Y=W.indexOf("/",1))===-1){$.push(W);break}else $.push(W.slice(0,Y)),W=W.slice(Y)}return $.join("")}function _A(Q,W){let $=W!==!0?escape:unescape;if(Q.scheme!==void 0)Q.scheme=$(Q.scheme);if(Q.userinfo!==void 0)Q.userinfo=$(Q.userinfo);if(Q.host!==void 0)Q.host=$(Q.host);if(Q.path!==void 0)Q.path=$(Q.path);if(Q.query!==void 0)Q.query=$(Q.query);if(Q.fragment!==void 0)Q.fragment=$(Q.fragment);return Q}function xA(Q){let W=[];if(Q.userinfo!==void 0)W.push(Q.userinfo),W.push("@");if(Q.host!==void 0){let $=unescape(Q.host);if(!FH($)){let Y=VH($);if(Y.isIPV6===!0)$=`[${Y.escapedHost}]`;else $=Q.host}W.push($)}if(typeof Q.port==="number"||typeof Q.port==="string")W.push(":"),W.push(String(Q.port));return W.length?W.join(""):void 0}qH.exports={nonSimpleDomain:ZA,recomposeAuthority:xA,normalizeComponentEncoding:_A,removeDotSegments:TA,isIPv4:FH,isUUID:SA,normalizeIPv6:VH,stringArrayToHexStripped:jY}});var AH=C((QI,wH)=>{var{isUUID:yA}=zY(),gA=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,hA=["http","https","ws","wss","urn","urn:uuid"];function fA(Q){return hA.indexOf(Q)!==-1}function PY(Q){if(Q.secure===!0)return!0;else if(Q.secure===!1)return!1;else if(Q.scheme)return Q.scheme.length===3&&(Q.scheme[0]==="w"||Q.scheme[0]==="W")&&(Q.scheme[1]==="s"||Q.scheme[1]==="S")&&(Q.scheme[2]==="s"||Q.scheme[2]==="S");else return!1}function LH(Q){if(!Q.host)Q.error=Q.error||"HTTP URIs must have a host.";return Q}function UH(Q){let W=String(Q.scheme).toLowerCase()==="https";if(Q.port===(W?443:80)||Q.port==="")Q.port=void 0;if(!Q.path)Q.path="/";return Q}function uA(Q){return Q.secure=PY(Q),Q.resourceName=(Q.path||"/")+(Q.query?"?"+Q.query:""),Q.path=void 0,Q.query=void 0,Q}function lA(Q){if(Q.port===(PY(Q)?443:80)||Q.port==="")Q.port=void 0;if(typeof Q.secure==="boolean")Q.scheme=Q.secure?"wss":"ws",Q.secure=void 0;if(Q.resourceName){let[W,$]=Q.resourceName.split("?");Q.path=W&&W!=="/"?W:void 0,Q.query=$,Q.resourceName=void 0}return Q.fragment=void 0,Q}function mA(Q,W){if(!Q.path)return Q.error="URN can not be parsed",Q;let $=Q.path.match(gA);if($){let Y=W.scheme||Q.scheme||"urn";Q.nid=$[1].toLowerCase(),Q.nss=$[2];let J=`${Y}:${W.nid||Q.nid}`,X=EY(J);if(Q.path=void 0,X)Q=X.parse(Q,W)}else Q.error=Q.error||"URN can not be parsed.";return Q}function cA(Q,W){if(Q.nid===void 0)throw Error("URN without nid cannot be serialized");let $=W.scheme||Q.scheme||"urn",Y=Q.nid.toLowerCase(),J=`${$}:${W.nid||Y}`,X=EY(J);if(X)Q=X.serialize(Q,W);let G=Q,H=Q.nss;return G.path=`${Y||W.nid}:${H}`,W.skipEscape=!0,G}function pA(Q,W){let $=Q;if($.uuid=$.nss,$.nss=void 0,!W.tolerant&&(!$.uuid||!yA($.uuid)))$.error=$.error||"UUID is not valid.";return $}function dA(Q){let W=Q;return W.nss=(Q.uuid||"").toLowerCase(),W}var DH={scheme:"http",domainHost:!0,parse:LH,serialize:UH},iA={scheme:"https",domainHost:DH.domainHost,parse:LH,serialize:UH},RW={scheme:"ws",domainHost:!0,parse:uA,serialize:lA},nA={scheme:"wss",domainHost:RW.domainHost,parse:RW.parse,serialize:RW.serialize},oA={scheme:"urn",parse:mA,serialize:cA,skipNormalize:!0},rA={scheme:"urn:uuid",parse:pA,serialize:dA,skipNormalize:!0},IW={http:DH,https:iA,ws:RW,wss:nA,urn:oA,"urn:uuid":rA};Object.setPrototypeOf(IW,null);function EY(Q){return Q&&(IW[Q]||IW[Q.toLowerCase()])||void 0}wH.exports={wsIsSecure:PY,SCHEMES:IW,isValidSchemeName:fA,getSchemeHandler:EY}});var MH=C((WI,SW)=>{var{normalizeIPv6:aA,removeDotSegments:y9,recomposeAuthority:tA,normalizeComponentEncoding:bW,isIPv4:sA,nonSimpleDomain:eA}=zY(),{SCHEMES:QO,getSchemeHandler:OH}=AH();function WO(Q,W){if(typeof Q==="string")Q=_1(o1(Q,W),W);else if(typeof Q==="object")Q=o1(_1(Q,W),W);return Q}function $O(Q,W,$){let Y=$?Object.assign({scheme:"null"},$):{scheme:"null"},J=NH(o1(Q,Y),o1(W,Y),Y,!0);return Y.skipEscape=!0,_1(J,Y)}function NH(Q,W,$,Y){let J={};if(!Y)Q=o1(_1(Q,$),$),W=o1(_1(W,$),$);if($=$||{},!$.tolerant&&W.scheme)J.scheme=W.scheme,J.userinfo=W.userinfo,J.host=W.host,J.port=W.port,J.path=y9(W.path||""),J.query=W.query;else{if(W.userinfo!==void 0||W.host!==void 0||W.port!==void 0)J.userinfo=W.userinfo,J.host=W.host,J.port=W.port,J.path=y9(W.path||""),J.query=W.query;else{if(!W.path)if(J.path=Q.path,W.query!==void 0)J.query=W.query;else J.query=Q.query;else{if(W.path[0]==="/")J.path=y9(W.path);else{if((Q.userinfo!==void 0||Q.host!==void 0||Q.port!==void 0)&&!Q.path)J.path="/"+W.path;else if(!Q.path)J.path=W.path;else J.path=Q.path.slice(0,Q.path.lastIndexOf("/")+1)+W.path;J.path=y9(J.path)}J.query=W.query}J.userinfo=Q.userinfo,J.host=Q.host,J.port=Q.port}J.scheme=Q.scheme}return J.fragment=W.fragment,J}function YO(Q,W,$){if(typeof Q==="string")Q=unescape(Q),Q=_1(bW(o1(Q,$),!0),{...$,skipEscape:!0});else if(typeof Q==="object")Q=_1(bW(Q,!0),{...$,skipEscape:!0});if(typeof W==="string")W=unescape(W),W=_1(bW(o1(W,$),!0),{...$,skipEscape:!0});else if(typeof W==="object")W=_1(bW(W,!0),{...$,skipEscape:!0});return Q.toLowerCase()===W.toLowerCase()}function _1(Q,W){let $={host:Q.host,scheme:Q.scheme,userinfo:Q.userinfo,port:Q.port,path:Q.path,query:Q.query,nid:Q.nid,nss:Q.nss,uuid:Q.uuid,fragment:Q.fragment,reference:Q.reference,resourceName:Q.resourceName,secure:Q.secure,error:""},Y=Object.assign({},W),J=[],X=OH(Y.scheme||$.scheme);if(X&&X.serialize)X.serialize($,Y);if($.path!==void 0)if(!Y.skipEscape){if($.path=escape($.path),$.scheme!==void 0)$.path=$.path.split("%3A").join(":")}else $.path=unescape($.path);if(Y.reference!=="suffix"&&$.scheme)J.push($.scheme,":");let G=tA($);if(G!==void 0){if(Y.reference!=="suffix")J.push("//");if(J.push(G),$.path&&$.path[0]!=="/")J.push("/")}if($.path!==void 0){let H=$.path;if(!Y.absolutePath&&(!X||!X.absolutePath))H=y9(H);if(G===void 0&&H[0]==="/"&&H[1]==="/")H="/%2F"+H.slice(2);J.push(H)}if($.query!==void 0)J.push("?",$.query);if($.fragment!==void 0)J.push("#",$.fragment);return J.join("")}var JO=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function o1(Q,W){let $=Object.assign({},W),Y={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},J=!1;if($.reference==="suffix")if($.scheme)Q=$.scheme+":"+Q;else Q="//"+Q;let X=Q.match(JO);if(X){if(Y.scheme=X[1],Y.userinfo=X[3],Y.host=X[4],Y.port=parseInt(X[5],10),Y.path=X[6]||"",Y.query=X[7],Y.fragment=X[8],isNaN(Y.port))Y.port=X[5];if(Y.host)if(sA(Y.host)===!1){let B=aA(Y.host);Y.host=B.host.toLowerCase(),J=B.isIPV6}else J=!0;if(Y.scheme===void 0&&Y.userinfo===void 0&&Y.host===void 0&&Y.port===void 0&&Y.query===void 0&&!Y.path)Y.reference="same-document";else if(Y.scheme===void 0)Y.reference="relative";else if(Y.fragment===void 0)Y.reference="absolute";else Y.reference="uri";if($.reference&&$.reference!=="suffix"&&$.reference!==Y.reference)Y.error=Y.error||"URI is not a "+$.reference+" reference.";let G=OH($.scheme||Y.scheme);if(!$.unicodeSupport&&(!G||!G.unicodeSupport)){if(Y.host&&($.domainHost||G&&G.domainHost)&&J===!1&&eA(Y.host))try{Y.host=URL.domainToASCII(Y.host.toLowerCase())}catch(H){Y.error=Y.error||"Host's domain name can not be converted to ASCII: "+H}}if(!G||G&&!G.skipNormalize){if(Q.indexOf("%")!==-1){if(Y.scheme!==void 0)Y.scheme=unescape(Y.scheme);if(Y.host!==void 0)Y.host=unescape(Y.host)}if(Y.path)Y.path=escape(unescape(Y.path));if(Y.fragment)Y.fragment=encodeURI(decodeURIComponent(Y.fragment))}if(G&&G.parse)G.parse(Y,$)}else Y.error=Y.error||"URI can not be parsed.";return Y}var RY={SCHEMES:QO,normalize:WO,resolve:$O,resolveComponent:NH,equal:YO,serialize:_1,parse:o1};SW.exports=RY;SW.exports.default=RY;SW.exports.fastUri=RY});var zH=C((IY)=>{Object.defineProperty(IY,"__esModule",{value:!0});var jH=MH();jH.code='require("ajv/dist/runtime/uri").default';IY.default=jH});var CH=C((T0)=>{Object.defineProperty(T0,"__esModule",{value:!0});T0.CodeGen=T0.Name=T0.nil=T0.stringify=T0.str=T0._=T0.KeywordCxt=void 0;var XO=T9();Object.defineProperty(T0,"KeywordCxt",{enumerable:!0,get:function(){return XO.KeywordCxt}});var T8=p();Object.defineProperty(T0,"_",{enumerable:!0,get:function(){return T8._}});Object.defineProperty(T0,"str",{enumerable:!0,get:function(){return T8.str}});Object.defineProperty(T0,"stringify",{enumerable:!0,get:function(){return T8.stringify}});Object.defineProperty(T0,"nil",{enumerable:!0,get:function(){return T8.nil}});Object.defineProperty(T0,"Name",{enumerable:!0,get:function(){return T8.Name}});Object.defineProperty(T0,"CodeGen",{enumerable:!0,get:function(){return T8.CodeGen}});var GO=zW(),bH=_9(),HO=$Y(),g9=EW(),BO=p(),h9=C9(),ZW=Z9(),SY=W0(),PH=BH(),KO=zH(),SH=(Q,W)=>new RegExp(Q,W);SH.code="new RegExp";var FO=["removeAdditional","useDefaults","coerceTypes"],VO=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),qO={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},LO={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},EH=200;function UO(Q){var W,$,Y,J,X,G,H,B,K,F,q,U,L,D,w,A,O,j,z,S,Z,O0,I0,b1,s6;let B0=Q.strict,m0=(W=Q.code)===null||W===void 0?void 0:W.optimize,e0=m0===!0||m0===void 0?1:m0||0,u1=(Y=($=Q.code)===null||$===void 0?void 0:$.regExp)!==null&&Y!==void 0?Y:SH,BQ=(J=Q.uriResolver)!==null&&J!==void 0?J:KO.default;return{strictSchema:(G=(X=Q.strictSchema)!==null&&X!==void 0?X:B0)!==null&&G!==void 0?G:!0,strictNumbers:(B=(H=Q.strictNumbers)!==null&&H!==void 0?H:B0)!==null&&B!==void 0?B:!0,strictTypes:(F=(K=Q.strictTypes)!==null&&K!==void 0?K:B0)!==null&&F!==void 0?F:"log",strictTuples:(U=(q=Q.strictTuples)!==null&&q!==void 0?q:B0)!==null&&U!==void 0?U:"log",strictRequired:(D=(L=Q.strictRequired)!==null&&L!==void 0?L:B0)!==null&&D!==void 0?D:!1,code:Q.code?{...Q.code,optimize:e0,regExp:u1}:{optimize:e0,regExp:u1},loopRequired:(w=Q.loopRequired)!==null&&w!==void 0?w:EH,loopEnum:(A=Q.loopEnum)!==null&&A!==void 0?A:EH,meta:(O=Q.meta)!==null&&O!==void 0?O:!0,messages:(j=Q.messages)!==null&&j!==void 0?j:!0,inlineRefs:(z=Q.inlineRefs)!==null&&z!==void 0?z:!0,schemaId:(S=Q.schemaId)!==null&&S!==void 0?S:"$id",addUsedSchema:(Z=Q.addUsedSchema)!==null&&Z!==void 0?Z:!0,validateSchema:(O0=Q.validateSchema)!==null&&O0!==void 0?O0:!0,validateFormats:(I0=Q.validateFormats)!==null&&I0!==void 0?I0:!0,unicodeRegExp:(b1=Q.unicodeRegExp)!==null&&b1!==void 0?b1:!0,int32range:(s6=Q.int32range)!==null&&s6!==void 0?s6:!0,uriResolver:BQ}}class CW{constructor(Q={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Q=this.opts={...Q,...UO(Q)};let{es5:W,lines:$}=this.opts.code;this.scope=new BO.ValueScope({scope:{},prefixes:VO,es5:W,lines:$}),this.logger=MO(Q.logger);let Y=Q.validateFormats;if(Q.validateFormats=!1,this.RULES=(0,HO.getRules)(),RH.call(this,qO,Q,"NOT SUPPORTED"),RH.call(this,LO,Q,"DEPRECATED","warn"),this._metaOpts=OO.call(this),Q.formats)wO.call(this);if(this._addVocabularies(),this._addDefaultMetaSchema(),Q.keywords)AO.call(this,Q.keywords);if(typeof Q.meta=="object")this.addMetaSchema(Q.meta);DO.call(this),Q.validateFormats=Y}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:Q,meta:W,schemaId:$}=this.opts,Y=PH;if($==="id")Y={...PH},Y.id=Y.$id,delete Y.$id;if(W&&Q)this.addMetaSchema(Y,Y[$],!1)}defaultMeta(){let{meta:Q,schemaId:W}=this.opts;return this.opts.defaultMeta=typeof Q=="object"?Q[W]||Q:void 0}validate(Q,W){let $;if(typeof Q=="string"){if($=this.getSchema(Q),!$)throw Error(`no schema with key or ref "${Q}"`)}else $=this.compile(Q);let Y=$(W);if(!("$async"in $))this.errors=$.errors;return Y}compile(Q,W){let $=this._addSchema(Q,W);return $.validate||this._compileSchemaEnv($)}compileAsync(Q,W){if(typeof this.opts.loadSchema!="function")throw Error("options.loadSchema should be a function");let{loadSchema:$}=this.opts;return Y.call(this,Q,W);async function Y(K,F){await J.call(this,K.$schema);let q=this._addSchema(K,F);return q.validate||X.call(this,q)}async function J(K){if(K&&!this.getSchema(K))await Y.call(this,{$ref:K},!0)}async function X(K){try{return this._compileSchemaEnv(K)}catch(F){if(!(F instanceof bH.default))throw F;return G.call(this,F),await H.call(this,F.missingSchema),X.call(this,K)}}function G({missingSchema:K,missingRef:F}){if(this.refs[K])throw Error(`AnySchema ${K} is loaded but ${F} cannot be resolved`)}async function H(K){let F=await B.call(this,K);if(!this.refs[K])await J.call(this,F.$schema);if(!this.refs[K])this.addSchema(F,K,W)}async function B(K){let F=this._loading[K];if(F)return F;try{return await(this._loading[K]=$(K))}finally{delete this._loading[K]}}}addSchema(Q,W,$,Y=this.opts.validateSchema){if(Array.isArray(Q)){for(let X of Q)this.addSchema(X,void 0,$,Y);return this}let J;if(typeof Q==="object"){let{schemaId:X}=this.opts;if(J=Q[X],J!==void 0&&typeof J!="string")throw Error(`schema ${X} must be string`)}return W=(0,h9.normalizeId)(W||J),this._checkUnique(W),this.schemas[W]=this._addSchema(Q,$,W,Y,!0),this}addMetaSchema(Q,W,$=this.opts.validateSchema){return this.addSchema(Q,W,!0,$),this}validateSchema(Q,W){if(typeof Q=="boolean")return!0;let $;if($=Q.$schema,$!==void 0&&typeof $!="string")throw Error("$schema must be a string");if($=$||this.opts.defaultMeta||this.defaultMeta(),!$)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let Y=this.validate($,Q);if(!Y&&W){let J="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(J);else throw Error(J)}return Y}getSchema(Q){let W;while(typeof(W=IH.call(this,Q))=="string")Q=W;if(W===void 0){let{schemaId:$}=this.opts,Y=new g9.SchemaEnv({schema:{},schemaId:$});if(W=g9.resolveSchema.call(this,Y,Q),!W)return;this.refs[Q]=W}return W.validate||this._compileSchemaEnv(W)}removeSchema(Q){if(Q instanceof RegExp)return this._removeAllSchemas(this.schemas,Q),this._removeAllSchemas(this.refs,Q),this;switch(typeof Q){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let W=IH.call(this,Q);if(typeof W=="object")this._cache.delete(W.schema);return delete this.schemas[Q],delete this.refs[Q],this}case"object":{let W=Q;this._cache.delete(W);let $=Q[this.opts.schemaId];if($)$=(0,h9.normalizeId)($),delete this.schemas[$],delete this.refs[$];return this}default:throw Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Q){for(let W of Q)this.addKeyword(W);return this}addKeyword(Q,W){let $;if(typeof Q=="string"){if($=Q,typeof W=="object")this.logger.warn("these parameters are deprecated, see docs for addKeyword"),W.keyword=$}else if(typeof Q=="object"&&W===void 0){if(W=Q,$=W.keyword,Array.isArray($)&&!$.length)throw Error("addKeywords: keyword must be string or non-empty array")}else throw Error("invalid addKeywords parameters");if(zO.call(this,$,W),!W)return(0,SY.eachItem)($,(J)=>bY.call(this,J)),this;EO.call(this,W);let Y={...W,type:(0,ZW.getJSONTypes)(W.type),schemaType:(0,ZW.getJSONTypes)(W.schemaType)};return(0,SY.eachItem)($,Y.type.length===0?(J)=>bY.call(this,J,Y):(J)=>Y.type.forEach((X)=>bY.call(this,J,Y,X))),this}getKeyword(Q){let W=this.RULES.all[Q];return typeof W=="object"?W.definition:!!W}removeKeyword(Q){let{RULES:W}=this;delete W.keywords[Q],delete W.all[Q];for(let $ of W.rules){let Y=$.rules.findIndex((J)=>J.keyword===Q);if(Y>=0)$.rules.splice(Y,1)}return this}addFormat(Q,W){if(typeof W=="string")W=new RegExp(W);return this.formats[Q]=W,this}errorsText(Q=this.errors,{separator:W=", ",dataVar:$="data"}={}){if(!Q||Q.length===0)return"No errors";return Q.map((Y)=>`${$}${Y.instancePath} ${Y.message}`).reduce((Y,J)=>Y+W+J)}$dataMetaSchema(Q,W){let $=this.RULES.all;Q=JSON.parse(JSON.stringify(Q));for(let Y of W){let J=Y.split("/").slice(1),X=Q;for(let G of J)X=X[G];for(let G in $){let H=$[G];if(typeof H!="object")continue;let{$data:B}=H.definition,K=X[G];if(B&&K)X[G]=ZH(K)}}return Q}_removeAllSchemas(Q,W){for(let $ in Q){let Y=Q[$];if(!W||W.test($)){if(typeof Y=="string")delete Q[$];else if(Y&&!Y.meta)this._cache.delete(Y.schema),delete Q[$]}}}_addSchema(Q,W,$,Y=this.opts.validateSchema,J=this.opts.addUsedSchema){let X,{schemaId:G}=this.opts;if(typeof Q=="object")X=Q[G];else if(this.opts.jtd)throw Error("schema must be object");else if(typeof Q!="boolean")throw Error("schema must be object or boolean");let H=this._cache.get(Q);if(H!==void 0)return H;$=(0,h9.normalizeId)(X||$);let B=h9.getSchemaRefs.call(this,Q,$);if(H=new g9.SchemaEnv({schema:Q,schemaId:G,meta:W,baseId:$,localRefs:B}),this._cache.set(H.schema,H),J&&!$.startsWith("#")){if($)this._checkUnique($);this.refs[$]=H}if(Y)this.validateSchema(Q,!0);return H}_checkUnique(Q){if(this.schemas[Q]||this.refs[Q])throw Error(`schema with key or id "${Q}" already exists`)}_compileSchemaEnv(Q){if(Q.meta)this._compileMetaSchema(Q);else g9.compileSchema.call(this,Q);if(!Q.validate)throw Error("ajv implementation error");return Q.validate}_compileMetaSchema(Q){let W=this.opts;this.opts=this._metaOpts;try{g9.compileSchema.call(this,Q)}finally{this.opts=W}}}CW.ValidationError=GO.default;CW.MissingRefError=bH.default;T0.default=CW;function RH(Q,W,$,Y="error"){for(let J in Q){let X=J;if(X in W)this.logger[Y](`${$}: option ${J}. ${Q[X]}`)}}function IH(Q){return Q=(0,h9.normalizeId)(Q),this.schemas[Q]||this.refs[Q]}function DO(){let Q=this.opts.schemas;if(!Q)return;if(Array.isArray(Q))this.addSchema(Q);else for(let W in Q)this.addSchema(Q[W],W)}function wO(){for(let Q in this.opts.formats){let W=this.opts.formats[Q];if(W)this.addFormat(Q,W)}}function AO(Q){if(Array.isArray(Q)){this.addVocabulary(Q);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let W in Q){let $=Q[W];if(!$.keyword)$.keyword=W;this.addKeyword($)}}function OO(){let Q={...this.opts};for(let W of FO)delete Q[W];return Q}var NO={log(){},warn(){},error(){}};function MO(Q){if(Q===!1)return NO;if(Q===void 0)return console;if(Q.log&&Q.warn&&Q.error)return Q;throw Error("logger must implement log, warn and error methods")}var jO=/^[a-z_$][a-z0-9_$:-]*$/i;function zO(Q,W){let{RULES:$}=this;if((0,SY.eachItem)(Q,(Y)=>{if($.keywords[Y])throw Error(`Keyword ${Y} is already defined`);if(!jO.test(Y))throw Error(`Keyword ${Y} has invalid name`)}),!W)return;if(W.$data&&!(("code"in W)||("validate"in W)))throw Error('$data keyword must have "code" or "validate" function')}function bY(Q,W,$){var Y;let J=W===null||W===void 0?void 0:W.post;if($&&J)throw Error('keyword with "post" flag cannot have "type"');let{RULES:X}=this,G=J?X.post:X.rules.find(({type:B})=>B===$);if(!G)G={type:$,rules:[]},X.rules.push(G);if(X.keywords[Q]=!0,!W)return;let H={keyword:Q,definition:{...W,type:(0,ZW.getJSONTypes)(W.type),schemaType:(0,ZW.getJSONTypes)(W.schemaType)}};if(W.before)PO.call(this,G,H,W.before);else G.rules.push(H);X.all[Q]=H,(Y=W.implements)===null||Y===void 0||Y.forEach((B)=>this.addKeyword(B))}function PO(Q,W,$){let Y=Q.rules.findIndex((J)=>J.keyword===$);if(Y>=0)Q.rules.splice(Y,0,W);else Q.rules.push(W),this.logger.warn(`rule ${$} is not defined`)}function EO(Q){let{metaSchema:W}=Q;if(W===void 0)return;if(Q.$data&&this.opts.$data)W=ZH(W);Q.validateSchema=this.compile(W,!0)}var RO={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function ZH(Q){return{anyOf:[Q,RO]}}});var vH=C((ZY)=>{Object.defineProperty(ZY,"__esModule",{value:!0});var IO={keyword:"id",code(){throw Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};ZY.default=IO});var xH=C((l6)=>{Object.defineProperty(l6,"__esModule",{value:!0});l6.callRef=l6.getValidate=void 0;var bO=_9(),kH=K1(),s0=p(),_8=i1(),TH=EW(),vW=W0(),SO={keyword:"$ref",schemaType:"string",code(Q){let{gen:W,schema:$,it:Y}=Q,{baseId:J,schemaEnv:X,validateName:G,opts:H,self:B}=Y,{root:K}=X;if(($==="#"||$==="#/")&&J===K.baseId)return q();let F=TH.resolveRef.call(B,K,J,$);if(F===void 0)throw new bO.default(Y.opts.uriResolver,J,$);if(F instanceof TH.SchemaEnv)return U(F);return L(F);function q(){if(X===K)return kW(Q,G,X,X.$async);let D=W.scopeValue("root",{ref:K});return kW(Q,s0._`${D}.validate`,K,K.$async)}function U(D){let w=_H(Q,D);kW(Q,w,D,D.$async)}function L(D){let w=W.scopeValue("schema",H.code.source===!0?{ref:D,code:(0,s0.stringify)(D)}:{ref:D}),A=W.name("valid"),O=Q.subschema({schema:D,dataTypes:[],schemaPath:s0.nil,topSchemaRef:w,errSchemaPath:$},A);Q.mergeEvaluated(O),Q.ok(A)}}};function _H(Q,W){let{gen:$}=Q;return W.validate?$.scopeValue("validate",{ref:W.validate}):s0._`${$.scopeValue("wrapper",{ref:W})}.validate`}l6.getValidate=_H;function kW(Q,W,$,Y){let{gen:J,it:X}=Q,{allErrors:G,schemaEnv:H,opts:B}=X,K=B.passContext?_8.default.this:s0.nil;if(Y)F();else q();function F(){if(!H.$async)throw Error("async schema referenced by sync schema");let D=J.let("valid");J.try(()=>{if(J.code(s0._`await ${(0,kH.callValidateCode)(Q,W,K)}`),L(W),!G)J.assign(D,!0)},(w)=>{if(J.if(s0._`!(${w} instanceof ${X.ValidationError})`,()=>J.throw(w)),U(w),!G)J.assign(D,!1)}),Q.ok(D)}function q(){Q.result((0,kH.callValidateCode)(Q,W,K),()=>L(W),()=>U(W))}function U(D){let w=s0._`${D}.errors`;J.assign(_8.default.vErrors,s0._`${_8.default.vErrors} === null ? ${w} : ${_8.default.vErrors}.concat(${w})`),J.assign(_8.default.errors,s0._`${_8.default.vErrors}.length`)}function L(D){var w;if(!X.opts.unevaluated)return;let A=(w=$===null||$===void 0?void 0:$.validate)===null||w===void 0?void 0:w.evaluated;if(X.props!==!0)if(A&&!A.dynamicProps){if(A.props!==void 0)X.props=vW.mergeEvaluated.props(J,A.props,X.props)}else{let O=J.var("props",s0._`${D}.evaluated.props`);X.props=vW.mergeEvaluated.props(J,O,X.props,s0.Name)}if(X.items!==!0)if(A&&!A.dynamicItems){if(A.items!==void 0)X.items=vW.mergeEvaluated.items(J,A.items,X.items)}else{let O=J.var("items",s0._`${D}.evaluated.items`);X.items=vW.mergeEvaluated.items(J,O,X.items,s0.Name)}}}l6.callRef=kW;l6.default=SO});var yH=C((CY)=>{Object.defineProperty(CY,"__esModule",{value:!0});var ZO=vH(),CO=xH(),vO=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",ZO.default,CO.default];CY.default=vO});var gH=C((vY)=>{Object.defineProperty(vY,"__esModule",{value:!0});var TW=p(),N6=TW.operators,_W={maximum:{okStr:"<=",ok:N6.LTE,fail:N6.GT},minimum:{okStr:">=",ok:N6.GTE,fail:N6.LT},exclusiveMaximum:{okStr:"<",ok:N6.LT,fail:N6.GTE},exclusiveMinimum:{okStr:">",ok:N6.GT,fail:N6.LTE}},kO={message:({keyword:Q,schemaCode:W})=>TW.str`must be ${_W[Q].okStr} ${W}`,params:({keyword:Q,schemaCode:W})=>TW._`{comparison: ${_W[Q].okStr}, limit: ${W}}`},TO={keyword:Object.keys(_W),type:"number",schemaType:"number",$data:!0,error:kO,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q;Q.fail$data(TW._`${$} ${_W[W].fail} ${Y} || isNaN(${$})`)}};vY.default=TO});var hH=C((kY)=>{Object.defineProperty(kY,"__esModule",{value:!0});var f9=p(),_O={message:({schemaCode:Q})=>f9.str`must be multiple of ${Q}`,params:({schemaCode:Q})=>f9._`{multipleOf: ${Q}}`},xO={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:_O,code(Q){let{gen:W,data:$,schemaCode:Y,it:J}=Q,X=J.opts.multipleOfPrecision,G=W.let("res"),H=X?f9._`Math.abs(Math.round(${G}) - ${G}) > 1e-${X}`:f9._`${G} !== parseInt(${G})`;Q.fail$data(f9._`(${Y} === 0 || (${G} = ${$}/${Y}, ${H}))`)}};kY.default=xO});var uH=C((TY)=>{Object.defineProperty(TY,"__esModule",{value:!0});function fH(Q){let W=Q.length,$=0,Y=0,J;while(Y<W)if($++,J=Q.charCodeAt(Y++),J>=55296&&J<=56319&&Y<W){if(J=Q.charCodeAt(Y),(J&64512)===56320)Y++}return $}TY.default=fH;fH.code='require("ajv/dist/runtime/ucs2length").default'});var lH=C((_Y)=>{Object.defineProperty(_Y,"__esModule",{value:!0});var m6=p(),yO=W0(),gO=uH(),hO={message({keyword:Q,schemaCode:W}){let $=Q==="maxLength"?"more":"fewer";return m6.str`must NOT have ${$} than ${W} characters`},params:({schemaCode:Q})=>m6._`{limit: ${Q}}`},fO={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:hO,code(Q){let{keyword:W,data:$,schemaCode:Y,it:J}=Q,X=W==="maxLength"?m6.operators.GT:m6.operators.LT,G=J.opts.unicode===!1?m6._`${$}.length`:m6._`${(0,yO.useFunc)(Q.gen,gO.default)}(${$})`;Q.fail$data(m6._`${G} ${X} ${Y}`)}};_Y.default=fO});var mH=C((xY)=>{Object.defineProperty(xY,"__esModule",{value:!0});var uO=K1(),xW=p(),lO={message:({schemaCode:Q})=>xW.str`must match pattern "${Q}"`,params:({schemaCode:Q})=>xW._`{pattern: ${Q}}`},mO={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:lO,code(Q){let{data:W,$data:$,schema:Y,schemaCode:J,it:X}=Q,G=X.opts.unicodeRegExp?"u":"",H=$?xW._`(new RegExp(${J}, ${G}))`:(0,uO.usePattern)(Q,Y);Q.fail$data(xW._`!${H}.test(${W})`)}};xY.default=mO});var cH=C((yY)=>{Object.defineProperty(yY,"__esModule",{value:!0});var u9=p(),cO={message({keyword:Q,schemaCode:W}){let $=Q==="maxProperties"?"more":"fewer";return u9.str`must NOT have ${$} than ${W} properties`},params:({schemaCode:Q})=>u9._`{limit: ${Q}}`},pO={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:cO,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q,J=W==="maxProperties"?u9.operators.GT:u9.operators.LT;Q.fail$data(u9._`Object.keys(${$}).length ${J} ${Y}`)}};yY.default=pO});var pH=C((gY)=>{Object.defineProperty(gY,"__esModule",{value:!0});var l9=K1(),m9=p(),dO=W0(),iO={message:({params:{missingProperty:Q}})=>m9.str`must have required property '${Q}'`,params:({params:{missingProperty:Q}})=>m9._`{missingProperty: ${Q}}`},nO={keyword:"required",type:"object",schemaType:"array",$data:!0,error:iO,code(Q){let{gen:W,schema:$,schemaCode:Y,data:J,$data:X,it:G}=Q,{opts:H}=G;if(!X&&$.length===0)return;let B=$.length>=H.loopRequired;if(G.allErrors)K();else F();if(H.strictRequired){let L=Q.parentSchema.properties,{definedProperties:D}=Q.it;for(let w of $)if((L===null||L===void 0?void 0:L[w])===void 0&&!D.has(w)){let A=G.schemaEnv.baseId+G.errSchemaPath,O=`required property "${w}" is not defined at "${A}" (strictRequired)`;(0,dO.checkStrictMode)(G,O,G.opts.strictRequired)}}function K(){if(B||X)Q.block$data(m9.nil,q);else for(let L of $)(0,l9.checkReportMissingProp)(Q,L)}function F(){let L=W.let("missing");if(B||X){let D=W.let("valid",!0);Q.block$data(D,()=>U(L,D)),Q.ok(D)}else W.if((0,l9.checkMissingProp)(Q,$,L)),(0,l9.reportMissingProp)(Q,L),W.else()}function q(){W.forOf("prop",Y,(L)=>{Q.setParams({missingProperty:L}),W.if((0,l9.noPropertyInData)(W,J,L,H.ownProperties),()=>Q.error())})}function U(L,D){Q.setParams({missingProperty:L}),W.forOf(L,Y,()=>{W.assign(D,(0,l9.propertyInData)(W,J,L,H.ownProperties)),W.if((0,m9.not)(D),()=>{Q.error(),W.break()})},m9.nil)}}};gY.default=nO});var dH=C((hY)=>{Object.defineProperty(hY,"__esModule",{value:!0});var c9=p(),oO={message({keyword:Q,schemaCode:W}){let $=Q==="maxItems"?"more":"fewer";return c9.str`must NOT have ${$} than ${W} items`},params:({schemaCode:Q})=>c9._`{limit: ${Q}}`},rO={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:oO,code(Q){let{keyword:W,data:$,schemaCode:Y}=Q,J=W==="maxItems"?c9.operators.GT:c9.operators.LT;Q.fail$data(c9._`${$}.length ${J} ${Y}`)}};hY.default=rO});var yW=C((fY)=>{Object.defineProperty(fY,"__esModule",{value:!0});var iH=FY();iH.code='require("ajv/dist/runtime/equal").default';fY.default=iH});var nH=C((lY)=>{Object.defineProperty(lY,"__esModule",{value:!0});var uY=Z9(),_0=p(),aO=W0(),tO=yW(),sO={message:({params:{i:Q,j:W}})=>_0.str`must NOT have duplicate items (items ## ${W} and ${Q} are identical)`,params:({params:{i:Q,j:W}})=>_0._`{i: ${Q}, j: ${W}}`},eO={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:sO,code(Q){let{gen:W,data:$,$data:Y,schema:J,parentSchema:X,schemaCode:G,it:H}=Q;if(!Y&&!J)return;let B=W.let("valid"),K=X.items?(0,uY.getSchemaTypes)(X.items):[];Q.block$data(B,F,_0._`${G} === false`),Q.ok(B);function F(){let D=W.let("i",_0._`${$}.length`),w=W.let("j");Q.setParams({i:D,j:w}),W.assign(B,!0),W.if(_0._`${D} > 1`,()=>(q()?U:L)(D,w))}function q(){return K.length>0&&!K.some((D)=>D==="object"||D==="array")}function U(D,w){let A=W.name("item"),O=(0,uY.checkDataTypes)(K,A,H.opts.strictNumbers,uY.DataType.Wrong),j=W.const("indices",_0._`{}`);W.for(_0._`;${D}--;`,()=>{if(W.let(A,_0._`${$}[${D}]`),W.if(O,_0._`continue`),K.length>1)W.if(_0._`typeof ${A} == "string"`,_0._`${A} += "_"`);W.if(_0._`typeof ${j}[${A}] == "number"`,()=>{W.assign(w,_0._`${j}[${A}]`),Q.error(),W.assign(B,!1).break()}).code(_0._`${j}[${A}] = ${D}`)})}function L(D,w){let A=(0,aO.useFunc)(W,tO.default),O=W.name("outer");W.label(O).for(_0._`;${D}--;`,()=>W.for(_0._`${w} = ${D}; ${w}--;`,()=>W.if(_0._`${A}(${$}[${D}], ${$}[${w}])`,()=>{Q.error(),W.assign(B,!1).break(O)})))}}};lY.default=eO});var oH=C((cY)=>{Object.defineProperty(cY,"__esModule",{value:!0});var mY=p(),QN=W0(),WN=yW(),$N={message:"must be equal to constant",params:({schemaCode:Q})=>mY._`{allowedValue: ${Q}}`},YN={keyword:"const",$data:!0,error:$N,code(Q){let{gen:W,data:$,$data:Y,schemaCode:J,schema:X}=Q;if(Y||X&&typeof X=="object")Q.fail$data(mY._`!${(0,QN.useFunc)(W,WN.default)}(${$}, ${J})`);else Q.fail(mY._`${X} !== ${$}`)}};cY.default=YN});var rH=C((pY)=>{Object.defineProperty(pY,"__esModule",{value:!0});var p9=p(),JN=W0(),XN=yW(),GN={message:"must be equal to one of the allowed values",params:({schemaCode:Q})=>p9._`{allowedValues: ${Q}}`},HN={keyword:"enum",schemaType:"array",$data:!0,error:GN,code(Q){let{gen:W,data:$,$data:Y,schema:J,schemaCode:X,it:G}=Q;if(!Y&&J.length===0)throw Error("enum must have non-empty array");let H=J.length>=G.opts.loopEnum,B,K=()=>B!==null&&B!==void 0?B:B=(0,JN.useFunc)(W,XN.default),F;if(H||Y)F=W.let("valid"),Q.block$data(F,q);else{if(!Array.isArray(J))throw Error("ajv implementation error");let L=W.const("vSchema",X);F=(0,p9.or)(...J.map((D,w)=>U(L,w)))}Q.pass(F);function q(){W.assign(F,!1),W.forOf("v",X,(L)=>W.if(p9._`${K()}(${$}, ${L})`,()=>W.assign(F,!0).break()))}function U(L,D){let w=J[D];return typeof w==="object"&&w!==null?p9._`${K()}(${$}, ${L}[${D}])`:p9._`${$} === ${w}`}}};pY.default=HN});var aH=C((dY)=>{Object.defineProperty(dY,"__esModule",{value:!0});var BN=gH(),KN=hH(),FN=lH(),VN=mH(),qN=cH(),LN=pH(),UN=dH(),DN=nH(),wN=oH(),AN=rH(),ON=[BN.default,KN.default,FN.default,VN.default,qN.default,LN.default,UN.default,DN.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},wN.default,AN.default];dY.default=ON});var nY=C((d9)=>{Object.defineProperty(d9,"__esModule",{value:!0});d9.validateAdditionalItems=void 0;var c6=p(),iY=W0(),NN={message:({params:{len:Q}})=>c6.str`must NOT have more than ${Q} items`,params:({params:{len:Q}})=>c6._`{limit: ${Q}}`},MN={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:NN,code(Q){let{parentSchema:W,it:$}=Q,{items:Y}=W;if(!Array.isArray(Y)){(0,iY.checkStrictMode)($,'"additionalItems" is ignored when "items" is not an array of schemas');return}tH(Q,Y)}};function tH(Q,W){let{gen:$,schema:Y,data:J,keyword:X,it:G}=Q;G.items=!0;let H=$.const("len",c6._`${J}.length`);if(Y===!1)Q.setParams({len:W.length}),Q.pass(c6._`${H} <= ${W.length}`);else if(typeof Y=="object"&&!(0,iY.alwaysValidSchema)(G,Y)){let K=$.var("valid",c6._`${H} <= ${W.length}`);$.if((0,c6.not)(K),()=>B(K)),Q.ok(K)}function B(K){$.forRange("i",W.length,H,(F)=>{if(Q.subschema({keyword:X,dataProp:F,dataPropType:iY.Type.Num},K),!G.allErrors)$.if((0,c6.not)(K),()=>$.break())})}}d9.validateAdditionalItems=tH;d9.default=MN});var oY=C((i9)=>{Object.defineProperty(i9,"__esModule",{value:!0});i9.validateTuple=void 0;var sH=p(),gW=W0(),jN=K1(),zN={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(Q){let{schema:W,it:$}=Q;if(Array.isArray(W))return eH(Q,"additionalItems",W);if($.items=!0,(0,gW.alwaysValidSchema)($,W))return;Q.ok((0,jN.validateArray)(Q))}};function eH(Q,W,$=Q.schema){let{gen:Y,parentSchema:J,data:X,keyword:G,it:H}=Q;if(F(J),H.opts.unevaluated&&$.length&&H.items!==!0)H.items=gW.mergeEvaluated.items(Y,$.length,H.items);let B=Y.name("valid"),K=Y.const("len",sH._`${X}.length`);$.forEach((q,U)=>{if((0,gW.alwaysValidSchema)(H,q))return;Y.if(sH._`${K} > ${U}`,()=>Q.subschema({keyword:G,schemaProp:U,dataProp:U},B)),Q.ok(B)});function F(q){let{opts:U,errSchemaPath:L}=H,D=$.length,w=D===q.minItems&&(D===q.maxItems||q[W]===!1);if(U.strictTuples&&!w){let A=`"${G}" is ${D}-tuple, but minItems or maxItems/${W} are not specified or different at path "${L}"`;(0,gW.checkStrictMode)(H,A,U.strictTuples)}}}i9.validateTuple=eH;i9.default=zN});var QB=C((rY)=>{Object.defineProperty(rY,"__esModule",{value:!0});var PN=oY(),EN={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:(Q)=>(0,PN.validateTuple)(Q,"items")};rY.default=EN});var $B=C((aY)=>{Object.defineProperty(aY,"__esModule",{value:!0});var WB=p(),RN=W0(),IN=K1(),bN=nY(),SN={message:({params:{len:Q}})=>WB.str`must NOT have more than ${Q} items`,params:({params:{len:Q}})=>WB._`{limit: ${Q}}`},ZN={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:SN,code(Q){let{schema:W,parentSchema:$,it:Y}=Q,{prefixItems:J}=$;if(Y.items=!0,(0,RN.alwaysValidSchema)(Y,W))return;if(J)(0,bN.validateAdditionalItems)(Q,J);else Q.ok((0,IN.validateArray)(Q))}};aY.default=ZN});var YB=C((tY)=>{Object.defineProperty(tY,"__esModule",{value:!0});var V1=p(),hW=W0(),CN={message:({params:{min:Q,max:W}})=>W===void 0?V1.str`must contain at least ${Q} valid item(s)`:V1.str`must contain at least ${Q} and no more than ${W} valid item(s)`,params:({params:{min:Q,max:W}})=>W===void 0?V1._`{minContains: ${Q}}`:V1._`{minContains: ${Q}, maxContains: ${W}}`},vN={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:CN,code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,it:X}=Q,G,H,{minContains:B,maxContains:K}=Y;if(X.opts.next)G=B===void 0?1:B,H=K;else G=1;let F=W.const("len",V1._`${J}.length`);if(Q.setParams({min:G,max:H}),H===void 0&&G===0){(0,hW.checkStrictMode)(X,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(H!==void 0&&G>H){(0,hW.checkStrictMode)(X,'"minContains" > "maxContains" is always invalid'),Q.fail();return}if((0,hW.alwaysValidSchema)(X,$)){let w=V1._`${F} >= ${G}`;if(H!==void 0)w=V1._`${w} && ${F} <= ${H}`;Q.pass(w);return}X.items=!0;let q=W.name("valid");if(H===void 0&&G===1)L(q,()=>W.if(q,()=>W.break()));else if(G===0){if(W.let(q,!0),H!==void 0)W.if(V1._`${J}.length > 0`,U)}else W.let(q,!1),U();Q.result(q,()=>Q.reset());function U(){let w=W.name("_valid"),A=W.let("count",0);L(w,()=>W.if(w,()=>D(A)))}function L(w,A){W.forRange("i",0,F,(O)=>{Q.subschema({keyword:"contains",dataProp:O,dataPropType:hW.Type.Num,compositeRule:!0},w),A()})}function D(w){if(W.code(V1._`${w}++`),H===void 0)W.if(V1._`${w} >= ${G}`,()=>W.assign(q,!0).break());else if(W.if(V1._`${w} > ${H}`,()=>W.assign(q,!1).break()),G===1)W.assign(q,!0);else W.if(V1._`${w} >= ${G}`,()=>W.assign(q,!0))}}};tY.default=vN});var GB=C((x1)=>{Object.defineProperty(x1,"__esModule",{value:!0});x1.validateSchemaDeps=x1.validatePropertyDeps=x1.error=void 0;var sY=p(),kN=W0(),n9=K1();x1.error={message:({params:{property:Q,depsCount:W,deps:$}})=>{let Y=W===1?"property":"properties";return sY.str`must have ${Y} ${$} when property ${Q} is present`},params:({params:{property:Q,depsCount:W,deps:$,missingProperty:Y}})=>sY._`{property: ${Q},
    missingProperty: ${Y},
    depsCount: ${W},
    deps: ${$}}`};var TN={keyword:"dependencies",type:"object",schemaType:"object",error:x1.error,code(Q){let[W,$]=_N(Q);JB(Q,W),XB(Q,$)}};function _N({schema:Q}){let W={},$={};for(let Y in Q){if(Y==="__proto__")continue;let J=Array.isArray(Q[Y])?W:$;J[Y]=Q[Y]}return[W,$]}function JB(Q,W=Q.schema){let{gen:$,data:Y,it:J}=Q;if(Object.keys(W).length===0)return;let X=$.let("missing");for(let G in W){let H=W[G];if(H.length===0)continue;let B=(0,n9.propertyInData)($,Y,G,J.opts.ownProperties);if(Q.setParams({property:G,depsCount:H.length,deps:H.join(", ")}),J.allErrors)$.if(B,()=>{for(let K of H)(0,n9.checkReportMissingProp)(Q,K)});else $.if(sY._`${B} && (${(0,n9.checkMissingProp)(Q,H,X)})`),(0,n9.reportMissingProp)(Q,X),$.else()}}x1.validatePropertyDeps=JB;function XB(Q,W=Q.schema){let{gen:$,data:Y,keyword:J,it:X}=Q,G=$.name("valid");for(let H in W){if((0,kN.alwaysValidSchema)(X,W[H]))continue;$.if((0,n9.propertyInData)($,Y,H,X.opts.ownProperties),()=>{let B=Q.subschema({keyword:J,schemaProp:H},G);Q.mergeValidEvaluated(B,G)},()=>$.var(G,!0)),Q.ok(G)}}x1.validateSchemaDeps=XB;x1.default=TN});var BB=C((eY)=>{Object.defineProperty(eY,"__esModule",{value:!0});var HB=p(),xN=W0(),yN={message:"property name must be valid",params:({params:Q})=>HB._`{propertyName: ${Q.propertyName}}`},gN={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:yN,code(Q){let{gen:W,schema:$,data:Y,it:J}=Q;if((0,xN.alwaysValidSchema)(J,$))return;let X=W.name("valid");W.forIn("key",Y,(G)=>{Q.setParams({propertyName:G}),Q.subschema({keyword:"propertyNames",data:G,dataTypes:["string"],propertyName:G,compositeRule:!0},X),W.if((0,HB.not)(X),()=>{if(Q.error(!0),!J.allErrors)W.break()})}),Q.ok(X)}};eY.default=gN});var W7=C((Q7)=>{Object.defineProperty(Q7,"__esModule",{value:!0});var fW=K1(),R1=p(),hN=i1(),uW=W0(),fN={message:"must NOT have additional properties",params:({params:Q})=>R1._`{additionalProperty: ${Q.additionalProperty}}`},uN={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:fN,code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,errsCount:X,it:G}=Q;if(!X)throw Error("ajv implementation error");let{allErrors:H,opts:B}=G;if(G.props=!0,B.removeAdditional!=="all"&&(0,uW.alwaysValidSchema)(G,$))return;let K=(0,fW.allSchemaProperties)(Y.properties),F=(0,fW.allSchemaProperties)(Y.patternProperties);q(),Q.ok(R1._`${X} === ${hN.default.errors}`);function q(){W.forIn("key",J,(A)=>{if(!K.length&&!F.length)D(A);else W.if(U(A),()=>D(A))})}function U(A){let O;if(K.length>8){let j=(0,uW.schemaRefOrVal)(G,Y.properties,"properties");O=(0,fW.isOwnProperty)(W,j,A)}else if(K.length)O=(0,R1.or)(...K.map((j)=>R1._`${A} === ${j}`));else O=R1.nil;if(F.length)O=(0,R1.or)(O,...F.map((j)=>R1._`${(0,fW.usePattern)(Q,j)}.test(${A})`));return(0,R1.not)(O)}function L(A){W.code(R1._`delete ${J}[${A}]`)}function D(A){if(B.removeAdditional==="all"||B.removeAdditional&&$===!1){L(A);return}if($===!1){if(Q.setParams({additionalProperty:A}),Q.error(),!H)W.break();return}if(typeof $=="object"&&!(0,uW.alwaysValidSchema)(G,$)){let O=W.name("valid");if(B.removeAdditional==="failing")w(A,O,!1),W.if((0,R1.not)(O),()=>{Q.reset(),L(A)});else if(w(A,O),!H)W.if((0,R1.not)(O),()=>W.break())}}function w(A,O,j){let z={keyword:"additionalProperties",dataProp:A,dataPropType:uW.Type.Str};if(j===!1)Object.assign(z,{compositeRule:!0,createErrors:!1,allErrors:!1});Q.subschema(z,O)}}};Q7.default=uN});var VB=C((Y7)=>{Object.defineProperty(Y7,"__esModule",{value:!0});var lN=T9(),KB=K1(),$7=W0(),FB=W7(),mN={keyword:"properties",type:"object",schemaType:"object",code(Q){let{gen:W,schema:$,parentSchema:Y,data:J,it:X}=Q;if(X.opts.removeAdditional==="all"&&Y.additionalProperties===void 0)FB.default.code(new lN.KeywordCxt(X,FB.default,"additionalProperties"));let G=(0,KB.allSchemaProperties)($);for(let q of G)X.definedProperties.add(q);if(X.opts.unevaluated&&G.length&&X.props!==!0)X.props=$7.mergeEvaluated.props(W,(0,$7.toHash)(G),X.props);let H=G.filter((q)=>!(0,$7.alwaysValidSchema)(X,$[q]));if(H.length===0)return;let B=W.name("valid");for(let q of H){if(K(q))F(q);else{if(W.if((0,KB.propertyInData)(W,J,q,X.opts.ownProperties)),F(q),!X.allErrors)W.else().var(B,!0);W.endIf()}Q.it.definedProperties.add(q),Q.ok(B)}function K(q){return X.opts.useDefaults&&!X.compositeRule&&$[q].default!==void 0}function F(q){Q.subschema({keyword:"properties",schemaProp:q,dataProp:q},B)}}};Y7.default=mN});var DB=C((J7)=>{Object.defineProperty(J7,"__esModule",{value:!0});var qB=K1(),lW=p(),LB=W0(),UB=W0(),cN={keyword:"patternProperties",type:"object",schemaType:"object",code(Q){let{gen:W,schema:$,data:Y,parentSchema:J,it:X}=Q,{opts:G}=X,H=(0,qB.allSchemaProperties)($),B=H.filter((w)=>(0,LB.alwaysValidSchema)(X,$[w]));if(H.length===0||B.length===H.length&&(!X.opts.unevaluated||X.props===!0))return;let K=G.strictSchema&&!G.allowMatchingProperties&&J.properties,F=W.name("valid");if(X.props!==!0&&!(X.props instanceof lW.Name))X.props=(0,UB.evaluatedPropsToName)(W,X.props);let{props:q}=X;U();function U(){for(let w of H){if(K)L(w);if(X.allErrors)D(w);else W.var(F,!0),D(w),W.if(F)}}function L(w){for(let A in K)if(new RegExp(w).test(A))(0,LB.checkStrictMode)(X,`property ${A} matches pattern ${w} (use allowMatchingProperties)`)}function D(w){W.forIn("key",Y,(A)=>{W.if(lW._`${(0,qB.usePattern)(Q,w)}.test(${A})`,()=>{let O=B.includes(w);if(!O)Q.subschema({keyword:"patternProperties",schemaProp:w,dataProp:A,dataPropType:UB.Type.Str},F);if(X.opts.unevaluated&&q!==!0)W.assign(lW._`${q}[${A}]`,!0);else if(!O&&!X.allErrors)W.if((0,lW.not)(F),()=>W.break())})})}}};J7.default=cN});var wB=C((X7)=>{Object.defineProperty(X7,"__esModule",{value:!0});var pN=W0(),dN={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(Q){let{gen:W,schema:$,it:Y}=Q;if((0,pN.alwaysValidSchema)(Y,$)){Q.fail();return}let J=W.name("valid");Q.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},J),Q.failResult(J,()=>Q.reset(),()=>Q.error())},error:{message:"must NOT be valid"}};X7.default=dN});var AB=C((G7)=>{Object.defineProperty(G7,"__esModule",{value:!0});var iN=K1(),nN={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:iN.validateUnion,error:{message:"must match a schema in anyOf"}};G7.default=nN});var OB=C((H7)=>{Object.defineProperty(H7,"__esModule",{value:!0});var mW=p(),oN=W0(),rN={message:"must match exactly one schema in oneOf",params:({params:Q})=>mW._`{passingSchemas: ${Q.passing}}`},aN={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:rN,code(Q){let{gen:W,schema:$,parentSchema:Y,it:J}=Q;if(!Array.isArray($))throw Error("ajv implementation error");if(J.opts.discriminator&&Y.discriminator)return;let X=$,G=W.let("valid",!1),H=W.let("passing",null),B=W.name("_valid");Q.setParams({passing:H}),W.block(K),Q.result(G,()=>Q.reset(),()=>Q.error(!0));function K(){X.forEach((F,q)=>{let U;if((0,oN.alwaysValidSchema)(J,F))W.var(B,!0);else U=Q.subschema({keyword:"oneOf",schemaProp:q,compositeRule:!0},B);if(q>0)W.if(mW._`${B} && ${G}`).assign(G,!1).assign(H,mW._`[${H}, ${q}]`).else();W.if(B,()=>{if(W.assign(G,!0),W.assign(H,q),U)Q.mergeEvaluated(U,mW.Name)})})}}};H7.default=aN});var NB=C((B7)=>{Object.defineProperty(B7,"__esModule",{value:!0});var tN=W0(),sN={keyword:"allOf",schemaType:"array",code(Q){let{gen:W,schema:$,it:Y}=Q;if(!Array.isArray($))throw Error("ajv implementation error");let J=W.name("valid");$.forEach((X,G)=>{if((0,tN.alwaysValidSchema)(Y,X))return;let H=Q.subschema({keyword:"allOf",schemaProp:G},J);Q.ok(J),Q.mergeEvaluated(H)})}};B7.default=sN});var zB=C((K7)=>{Object.defineProperty(K7,"__esModule",{value:!0});var cW=p(),jB=W0(),eN={message:({params:Q})=>cW.str`must match "${Q.ifClause}" schema`,params:({params:Q})=>cW._`{failingKeyword: ${Q.ifClause}}`},QM={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:eN,code(Q){let{gen:W,parentSchema:$,it:Y}=Q;if($.then===void 0&&$.else===void 0)(0,jB.checkStrictMode)(Y,'"if" without "then" and "else" is ignored');let J=MB(Y,"then"),X=MB(Y,"else");if(!J&&!X)return;let G=W.let("valid",!0),H=W.name("_valid");if(B(),Q.reset(),J&&X){let F=W.let("ifClause");Q.setParams({ifClause:F}),W.if(H,K("then",F),K("else",F))}else if(J)W.if(H,K("then"));else W.if((0,cW.not)(H),K("else"));Q.pass(G,()=>Q.error(!0));function B(){let F=Q.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},H);Q.mergeEvaluated(F)}function K(F,q){return()=>{let U=Q.subschema({keyword:F},H);if(W.assign(G,H),Q.mergeValidEvaluated(U,G),q)W.assign(q,cW._`${F}`);else Q.setParams({ifClause:F})}}}};function MB(Q,W){let $=Q.schema[W];return $!==void 0&&!(0,jB.alwaysValidSchema)(Q,$)}K7.default=QM});var PB=C((F7)=>{Object.defineProperty(F7,"__esModule",{value:!0});var WM=W0(),$M={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:Q,parentSchema:W,it:$}){if(W.if===void 0)(0,WM.checkStrictMode)($,`"${Q}" without "if" is ignored`)}};F7.default=$M});var EB=C((V7)=>{Object.defineProperty(V7,"__esModule",{value:!0});var YM=nY(),JM=QB(),XM=oY(),GM=$B(),HM=YB(),BM=GB(),KM=BB(),FM=W7(),VM=VB(),qM=DB(),LM=wB(),UM=AB(),DM=OB(),wM=NB(),AM=zB(),OM=PB();function NM(Q=!1){let W=[LM.default,UM.default,DM.default,wM.default,AM.default,OM.default,KM.default,FM.default,BM.default,VM.default,qM.default];if(Q)W.push(JM.default,GM.default);else W.push(YM.default,XM.default);return W.push(HM.default),W}V7.default=NM});var RB=C((q7)=>{Object.defineProperty(q7,"__esModule",{value:!0});var P0=p(),MM={message:({schemaCode:Q})=>P0.str`must match format "${Q}"`,params:({schemaCode:Q})=>P0._`{format: ${Q}}`},jM={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:MM,code(Q,W){let{gen:$,data:Y,$data:J,schema:X,schemaCode:G,it:H}=Q,{opts:B,errSchemaPath:K,schemaEnv:F,self:q}=H;if(!B.validateFormats)return;if(J)U();else L();function U(){let D=$.scopeValue("formats",{ref:q.formats,code:B.code.formats}),w=$.const("fDef",P0._`${D}[${G}]`),A=$.let("fType"),O=$.let("format");$.if(P0._`typeof ${w} == "object" && !(${w} instanceof RegExp)`,()=>$.assign(A,P0._`${w}.type || "string"`).assign(O,P0._`${w}.validate`),()=>$.assign(A,P0._`"string"`).assign(O,w)),Q.fail$data((0,P0.or)(j(),z()));function j(){if(B.strictSchema===!1)return P0.nil;return P0._`${G} && !${O}`}function z(){let S=F.$async?P0._`(${w}.async ? await ${O}(${Y}) : ${O}(${Y}))`:P0._`${O}(${Y})`,Z=P0._`(typeof ${O} == "function" ? ${S} : ${O}.test(${Y}))`;return P0._`${O} && ${O} !== true && ${A} === ${W} && !${Z}`}}function L(){let D=q.formats[X];if(!D){j();return}if(D===!0)return;let[w,A,O]=z(D);if(w===W)Q.pass(S());function j(){if(B.strictSchema===!1){q.logger.warn(Z());return}throw Error(Z());function Z(){return`unknown format "${X}" ignored in schema at path "${K}"`}}function z(Z){let O0=Z instanceof RegExp?(0,P0.regexpCode)(Z):B.code.formats?P0._`${B.code.formats}${(0,P0.getProperty)(X)}`:void 0,I0=$.scopeValue("formats",{key:X,ref:Z,code:O0});if(typeof Z=="object"&&!(Z instanceof RegExp))return[Z.type||"string",Z.validate,P0._`${I0}.validate`];return["string",Z,I0]}function S(){if(typeof D=="object"&&!(D instanceof RegExp)&&D.async){if(!F.$async)throw Error("async format in sync schema");return P0._`await ${O}(${Y})`}return typeof A=="function"?P0._`${O}(${Y})`:P0._`${O}.test(${Y})`}}}};q7.default=jM});var IB=C((L7)=>{Object.defineProperty(L7,"__esModule",{value:!0});var zM=RB(),PM=[zM.default];L7.default=PM});var bB=C((x8)=>{Object.defineProperty(x8,"__esModule",{value:!0});x8.contentVocabulary=x8.metadataVocabulary=void 0;x8.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];x8.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var ZB=C((U7)=>{Object.defineProperty(U7,"__esModule",{value:!0});var EM=yH(),RM=aH(),IM=EB(),bM=IB(),SB=bB(),SM=[EM.default,RM.default,(0,IM.default)(),bM.default,SB.metadataVocabulary,SB.contentVocabulary];U7.default=SM});var vB=C((pW)=>{Object.defineProperty(pW,"__esModule",{value:!0});pW.DiscrError=void 0;var CB;(function(Q){Q.Tag="tag",Q.Mapping="mapping"})(CB||(pW.DiscrError=CB={}))});var TB=C((w7)=>{Object.defineProperty(w7,"__esModule",{value:!0});var y8=p(),D7=vB(),kB=EW(),ZM=_9(),CM=W0(),vM={message:({params:{discrError:Q,tagName:W}})=>Q===D7.DiscrError.Tag?`tag "${W}" must be string`:`value of tag "${W}" must be in oneOf`,params:({params:{discrError:Q,tag:W,tagName:$}})=>y8._`{error: ${Q}, tag: ${$}, tagValue: ${W}}`},kM={keyword:"discriminator",type:"object",schemaType:"object",error:vM,code(Q){let{gen:W,data:$,schema:Y,parentSchema:J,it:X}=Q,{oneOf:G}=J;if(!X.opts.discriminator)throw Error("discriminator: requires discriminator option");let H=Y.propertyName;if(typeof H!="string")throw Error("discriminator: requires propertyName");if(Y.mapping)throw Error("discriminator: mapping is not supported");if(!G)throw Error("discriminator: requires oneOf keyword");let B=W.let("valid",!1),K=W.const("tag",y8._`${$}${(0,y8.getProperty)(H)}`);W.if(y8._`typeof ${K} == "string"`,()=>F(),()=>Q.error(!1,{discrError:D7.DiscrError.Tag,tag:K,tagName:H})),Q.ok(B);function F(){let L=U();W.if(!1);for(let D in L)W.elseIf(y8._`${K} === ${D}`),W.assign(B,q(L[D]));W.else(),Q.error(!1,{discrError:D7.DiscrError.Mapping,tag:K,tagName:H}),W.endIf()}function q(L){let D=W.name("valid"),w=Q.subschema({keyword:"oneOf",schemaProp:L},D);return Q.mergeEvaluated(w,y8.Name),D}function U(){var L;let D={},w=O(J),A=!0;for(let S=0;S<G.length;S++){let Z=G[S];if((Z===null||Z===void 0?void 0:Z.$ref)&&!(0,CM.schemaHasRulesButRef)(Z,X.self.RULES)){let I0=Z.$ref;if(Z=kB.resolveRef.call(X.self,X.schemaEnv.root,X.baseId,I0),Z instanceof kB.SchemaEnv)Z=Z.schema;if(Z===void 0)throw new ZM.default(X.opts.uriResolver,X.baseId,I0)}let O0=(L=Z===null||Z===void 0?void 0:Z.properties)===null||L===void 0?void 0:L[H];if(typeof O0!="object")throw Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${H}"`);A=A&&(w||O(Z)),j(O0,S)}if(!A)throw Error(`discriminator: "${H}" must be required`);return D;function O({required:S}){return Array.isArray(S)&&S.includes(H)}function j(S,Z){if(S.const)z(S.const,Z);else if(S.enum)for(let O0 of S.enum)z(O0,Z);else throw Error(`discriminator: "properties/${H}" must have "const" or "enum"`)}function z(S,Z){if(typeof S!="string"||S in D)throw Error(`discriminator: "${H}" values must be unique strings`);D[S]=Z}}}};w7.default=kM});var _B=C((cI,TM)=>{TM.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var O7=C((L0,A7)=>{Object.defineProperty(L0,"__esModule",{value:!0});L0.MissingRefError=L0.ValidationError=L0.CodeGen=L0.Name=L0.nil=L0.stringify=L0.str=L0._=L0.KeywordCxt=L0.Ajv=void 0;var _M=CH(),xM=ZB(),yM=TB(),xB=_B(),gM=["/properties"],dW="http://json-schema.org/draft-07/schema";class o9 extends _M.default{_addVocabularies(){if(super._addVocabularies(),xM.default.forEach((Q)=>this.addVocabulary(Q)),this.opts.discriminator)this.addKeyword(yM.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let Q=this.opts.$data?this.$dataMetaSchema(xB,gM):xB;this.addMetaSchema(Q,dW,!1),this.refs["http://json-schema.org/schema"]=dW}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(dW)?dW:void 0)}}L0.Ajv=o9;A7.exports=L0=o9;A7.exports.Ajv=o9;Object.defineProperty(L0,"__esModule",{value:!0});L0.default=o9;var hM=T9();Object.defineProperty(L0,"KeywordCxt",{enumerable:!0,get:function(){return hM.KeywordCxt}});var g8=p();Object.defineProperty(L0,"_",{enumerable:!0,get:function(){return g8._}});Object.defineProperty(L0,"str",{enumerable:!0,get:function(){return g8.str}});Object.defineProperty(L0,"stringify",{enumerable:!0,get:function(){return g8.stringify}});Object.defineProperty(L0,"nil",{enumerable:!0,get:function(){return g8.nil}});Object.defineProperty(L0,"Name",{enumerable:!0,get:function(){return g8.Name}});Object.defineProperty(L0,"CodeGen",{enumerable:!0,get:function(){return g8.CodeGen}});var fM=zW();Object.defineProperty(L0,"ValidationError",{enumerable:!0,get:function(){return fM.default}});var uM=_9();Object.defineProperty(L0,"MissingRefError",{enumerable:!0,get:function(){return uM.default}})});var cB=C((g1)=>{Object.defineProperty(g1,"__esModule",{value:!0});g1.formatNames=g1.fastFormats=g1.fullFormats=void 0;function y1(Q,W){return{validate:Q,compare:W}}g1.fullFormats={date:y1(fB,z7),time:y1(M7(!0),P7),"date-time":y1(yB(!0),lB),"iso-time":y1(M7(),uB),"iso-date-time":y1(yB(),mB),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:iM,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:eM,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:nM,int32:{type:"number",validate:aM},int64:{type:"number",validate:tM},float:{type:"number",validate:hB},double:{type:"number",validate:hB},password:!0,binary:!0};g1.fastFormats={...g1.fullFormats,date:y1(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,z7),time:y1(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,P7),"date-time":y1(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,lB),"iso-time":y1(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,uB),"iso-date-time":y1(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,mB),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};g1.formatNames=Object.keys(g1.fullFormats);function lM(Q){return Q%4===0&&(Q%100!==0||Q%400===0)}var mM=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,cM=[0,31,28,31,30,31,30,31,31,30,31,30,31];function fB(Q){let W=mM.exec(Q);if(!W)return!1;let $=+W[1],Y=+W[2],J=+W[3];return Y>=1&&Y<=12&&J>=1&&J<=(Y===2&&lM($)?29:cM[Y])}function z7(Q,W){if(!(Q&&W))return;if(Q>W)return 1;if(Q<W)return-1;return 0}var N7=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function M7(Q){return function($){let Y=N7.exec($);if(!Y)return!1;let J=+Y[1],X=+Y[2],G=+Y[3],H=Y[4],B=Y[5]==="-"?-1:1,K=+(Y[6]||0),F=+(Y[7]||0);if(K>23||F>59||Q&&!H)return!1;if(J<=23&&X<=59&&G<60)return!0;let q=X-F*B,U=J-K*B-(q<0?1:0);return(U===23||U===-1)&&(q===59||q===-1)&&G<61}}function P7(Q,W){if(!(Q&&W))return;let $=new Date("2020-01-01T"+Q).valueOf(),Y=new Date("2020-01-01T"+W).valueOf();if(!($&&Y))return;return $-Y}function uB(Q,W){if(!(Q&&W))return;let $=N7.exec(Q),Y=N7.exec(W);if(!($&&Y))return;if(Q=$[1]+$[2]+$[3],W=Y[1]+Y[2]+Y[3],Q>W)return 1;if(Q<W)return-1;return 0}var j7=/t|\s/i;function yB(Q){let W=M7(Q);return function(Y){let J=Y.split(j7);return J.length===2&&fB(J[0])&&W(J[1])}}function lB(Q,W){if(!(Q&&W))return;let $=new Date(Q).valueOf(),Y=new Date(W).valueOf();if(!($&&Y))return;return $-Y}function mB(Q,W){if(!(Q&&W))return;let[$,Y]=Q.split(j7),[J,X]=W.split(j7),G=z7($,J);if(G===void 0)return;return G||P7(Y,X)}var pM=/\/|:/,dM=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function iM(Q){return pM.test(Q)&&dM.test(Q)}var gB=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function nM(Q){return gB.lastIndex=0,gB.test(Q)}var oM=-2147483648,rM=2147483647;function aM(Q){return Number.isInteger(Q)&&Q<=rM&&Q>=oM}function tM(Q){return Number.isInteger(Q)}function hB(){return!0}var sM=/[^\\]\\Z/;function eM(Q){if(sM.test(Q))return!1;try{return new RegExp(Q),!0}catch(W){return!1}}});var pB=C((h8)=>{Object.defineProperty(h8,"__esModule",{value:!0});h8.formatLimitDefinition=void 0;var Qj=O7(),I1=p(),M6=I1.operators,iW={formatMaximum:{okStr:"<=",ok:M6.LTE,fail:M6.GT},formatMinimum:{okStr:">=",ok:M6.GTE,fail:M6.LT},formatExclusiveMaximum:{okStr:"<",ok:M6.LT,fail:M6.GTE},formatExclusiveMinimum:{okStr:">",ok:M6.GT,fail:M6.LTE}},Wj={message:({keyword:Q,schemaCode:W})=>I1.str`should be ${iW[Q].okStr} ${W}`,params:({keyword:Q,schemaCode:W})=>I1._`{comparison: ${iW[Q].okStr}, limit: ${W}}`};h8.formatLimitDefinition={keyword:Object.keys(iW),type:"string",schemaType:"string",$data:!0,error:Wj,code(Q){let{gen:W,data:$,schemaCode:Y,keyword:J,it:X}=Q,{opts:G,self:H}=X;if(!G.validateFormats)return;let B=new Qj.KeywordCxt(X,H.RULES.all.format.definition,"format");if(B.$data)K();else F();function K(){let U=W.scopeValue("formats",{ref:H.formats,code:G.code.formats}),L=W.const("fmt",I1._`${U}[${B.schemaCode}]`);Q.fail$data((0,I1.or)(I1._`typeof ${L} != "object"`,I1._`${L} instanceof RegExp`,I1._`typeof ${L}.compare != "function"`,q(L)))}function F(){let U=B.schema,L=H.formats[U];if(!L||L===!0)return;if(typeof L!="object"||L instanceof RegExp||typeof L.compare!="function")throw Error(`"${J}": format "${U}" does not define "compare" function`);let D=W.scopeValue("formats",{key:U,ref:L,code:G.code.formats?I1._`${G.code.formats}${(0,I1.getProperty)(U)}`:void 0});Q.fail$data(q(D))}function q(U){return I1._`${U}.compare(${$}, ${Y}) ${iW[J].fail} 0`}},dependencies:["format"]};var $j=(Q)=>{return Q.addKeyword(h8.formatLimitDefinition),Q};h8.default=$j});var oB=C((r9,nB)=>{Object.defineProperty(r9,"__esModule",{value:!0});var f8=cB(),Yj=pB(),E7=p(),dB=new E7.Name("fullFormats"),Jj=new E7.Name("fastFormats"),R7=(Q,W={keywords:!0})=>{if(Array.isArray(W))return iB(Q,W,f8.fullFormats,dB),Q;let[$,Y]=W.mode==="fast"?[f8.fastFormats,Jj]:[f8.fullFormats,dB],J=W.formats||f8.formatNames;if(iB(Q,J,$,Y),W.keywords)(0,Yj.default)(Q);return Q};R7.get=(Q,W="full")=>{let Y=(W==="fast"?f8.fastFormats:f8.fullFormats)[Q];if(!Y)throw Error(`Unknown format "${Q}"`);return Y};function iB(Q,W,$,Y){var J,X;(J=(X=Q.opts.code).formats)!==null&&J!==void 0||(X.formats=E7._`require("ajv-formats/dist/formats").${Y}`);for(let G of W)Q.addFormat(G,$[G])}nB.exports=r9=R7;Object.defineProperty(r9,"__esModule",{value:!0});r9.default=R7});var WJ={name:"blockbench-mcp",version:"1.4.2",description:"Blockbench MCP server plugin",keywords:["Blockbench","MCP"],license:"GPL-3.0-only",author:"Jason J. Gardner",type:"module",main:"dist/mcp.js",scripts:{test:'echo "Error: no test specified" && exit 1',dev:"bun run ./build --sourcemap","dev:watch":"bun run dev --watch",build:"bun run ./build --minify",inspect:"bunx @modelcontextprotocol/inspector"},dependencies:{zod:"^3.25.76","@modelcontextprotocol/sdk":"^1.25.3"},devDependencies:{"blockbench-types":"^5.0.6",typescript:"^5.9.3","@types/bun":"^1.3.8",tinycolor2:"^1.6.0"}};var Q8=WJ.version,J0="stable",y="experimental";var V={};X4(V,{void:()=>WV,util:()=>o,unknown:()=>eF,union:()=>JV,undefined:()=>aF,tuple:()=>HV,transformer:()=>AV,symbol:()=>rF,string:()=>FJ,strictObject:()=>YV,setErrorMap:()=>MF,set:()=>FV,record:()=>BV,quotelessJson:()=>OF,promise:()=>wV,preprocess:()=>MV,pipeline:()=>jV,ostring:()=>zV,optional:()=>OV,onumber:()=>PV,oboolean:()=>EV,objectUtil:()=>G4,object:()=>K4,number:()=>VJ,nullable:()=>NV,null:()=>tF,never:()=>QV,nativeEnum:()=>DV,nan:()=>iF,map:()=>KV,makeIssue:()=>r8,literal:()=>LV,lazy:()=>qV,late:()=>pF,isValid:()=>s1,isDirty:()=>VQ,isAsync:()=>$8,isAborted:()=>FQ,intersection:()=>GV,instanceof:()=>dF,getParsedType:()=>S1,getErrorMap:()=>W8,function:()=>VV,enum:()=>UV,effect:()=>AV,discriminatedUnion:()=>XV,defaultErrorMap:()=>l1,datetimeRegex:()=>HJ,date:()=>oF,custom:()=>KJ,coerce:()=>RV,boolean:()=>qJ,bigint:()=>nF,array:()=>$V,any:()=>sF,addIssueToContext:()=>b,ZodVoid:()=>t8,ZodUnknown:()=>e1,ZodUnion:()=>B8,ZodUndefined:()=>G8,ZodType:()=>d,ZodTuple:()=>C1,ZodTransformer:()=>A1,ZodSymbol:()=>a8,ZodString:()=>U1,ZodSet:()=>S6,ZodSchema:()=>d,ZodRecord:()=>s8,ZodReadonly:()=>D8,ZodPromise:()=>Z6,ZodPipeline:()=>W9,ZodParsedType:()=>I,ZodOptional:()=>Q1,ZodObject:()=>N0,ZodNumber:()=>Q6,ZodNullable:()=>c1,ZodNull:()=>H8,ZodNever:()=>Z1,ZodNativeEnum:()=>q8,ZodNaN:()=>Q9,ZodMap:()=>e8,ZodLiteral:()=>V8,ZodLazy:()=>F8,ZodIssueCode:()=>P,ZodIntersection:()=>K8,ZodFunction:()=>J8,ZodFirstPartyTypeKind:()=>E,ZodError:()=>n0,ZodEnum:()=>$6,ZodEffects:()=>A1,ZodDiscriminatedUnion:()=>qQ,ZodDefault:()=>L8,ZodDate:()=>I6,ZodCatch:()=>U8,ZodBranded:()=>LQ,ZodBoolean:()=>X8,ZodBigInt:()=>W6,ZodArray:()=>D1,ZodAny:()=>b6,Schema:()=>d,ParseStatus:()=>S0,OK:()=>y0,NEVER:()=>IV,INVALID:()=>h,EMPTY_PATH:()=>jF,DIRTY:()=>R6,BRAND:()=>cF});var o;(function(Q){Q.assertEqual=(J)=>{};function W(J){}Q.assertIs=W;function $(J){throw Error()}Q.assertNever=$,Q.arrayToEnum=(J)=>{let X={};for(let G of J)X[G]=G;return X},Q.getValidEnumValues=(J)=>{let X=Q.objectKeys(J).filter((H)=>typeof J[J[H]]!=="number"),G={};for(let H of X)G[H]=J[H];return Q.objectValues(G)},Q.objectValues=(J)=>{return Q.objectKeys(J).map(function(X){return J[X]})},Q.objectKeys=typeof Object.keys==="function"?(J)=>Object.keys(J):(J)=>{let X=[];for(let G in J)if(Object.prototype.hasOwnProperty.call(J,G))X.push(G);return X},Q.find=(J,X)=>{for(let G of J)if(X(G))return G;return},Q.isInteger=typeof Number.isInteger==="function"?(J)=>Number.isInteger(J):(J)=>typeof J==="number"&&Number.isFinite(J)&&Math.floor(J)===J;function Y(J,X=" | "){return J.map((G)=>typeof G==="string"?`'${G}'`:G).join(X)}Q.joinValues=Y,Q.jsonStringifyReplacer=(J,X)=>{if(typeof X==="bigint")return X.toString();return X}})(o||(o={}));var G4;(function(Q){Q.mergeShapes=(W,$)=>{return{...W,...$}}})(G4||(G4={}));var I=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),S1=(Q)=>{switch(typeof Q){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(Q)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":if(Array.isArray(Q))return I.array;if(Q===null)return I.null;if(Q.then&&typeof Q.then==="function"&&Q.catch&&typeof Q.catch==="function")return I.promise;if(typeof Map<"u"&&Q instanceof Map)return I.map;if(typeof Set<"u"&&Q instanceof Set)return I.set;if(typeof Date<"u"&&Q instanceof Date)return I.date;return I.object;default:return I.unknown}};var P=o.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),OF=(Q)=>{return JSON.stringify(Q,null,2).replace(/"([^"]+)":/g,"$1:")};class n0 extends Error{get errors(){return this.issues}constructor(Q){super();this.issues=[],this.addIssue=($)=>{this.issues=[...this.issues,$]},this.addIssues=($=[])=>{this.issues=[...this.issues,...$]};let W=new.target.prototype;if(Object.setPrototypeOf)Object.setPrototypeOf(this,W);else this.__proto__=W;this.name="ZodError",this.issues=Q}format(Q){let W=Q||function(J){return J.message},$={_errors:[]},Y=(J)=>{for(let X of J.issues)if(X.code==="invalid_union")X.unionErrors.map(Y);else if(X.code==="invalid_return_type")Y(X.returnTypeError);else if(X.code==="invalid_arguments")Y(X.argumentsError);else if(X.path.length===0)$._errors.push(W(X));else{let G=$,H=0;while(H<X.path.length){let B=X.path[H];if(H!==X.path.length-1)G[B]=G[B]||{_errors:[]};else G[B]=G[B]||{_errors:[]},G[B]._errors.push(W(X));G=G[B],H++}}};return Y(this),$}static assert(Q){if(!(Q instanceof n0))throw Error(`Not a ZodError: ${Q}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,o.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(Q=(W)=>W.message){let W={},$=[];for(let Y of this.issues)if(Y.path.length>0){let J=Y.path[0];W[J]=W[J]||[],W[J].push(Q(Y))}else $.push(Q(Y));return{formErrors:$,fieldErrors:W}}get formErrors(){return this.flatten()}}n0.create=(Q)=>{return new n0(Q)};var NF=(Q,W)=>{let $;switch(Q.code){case P.invalid_type:if(Q.received===I.undefined)$="Required";else $=`Expected ${Q.expected}, received ${Q.received}`;break;case P.invalid_literal:$=`Invalid literal value, expected ${JSON.stringify(Q.expected,o.jsonStringifyReplacer)}`;break;case P.unrecognized_keys:$=`Unrecognized key(s) in object: ${o.joinValues(Q.keys,", ")}`;break;case P.invalid_union:$="Invalid input";break;case P.invalid_union_discriminator:$=`Invalid discriminator value. Expected ${o.joinValues(Q.options)}`;break;case P.invalid_enum_value:$=`Invalid enum value. Expected ${o.joinValues(Q.options)}, received '${Q.received}'`;break;case P.invalid_arguments:$="Invalid function arguments";break;case P.invalid_return_type:$="Invalid function return type";break;case P.invalid_date:$="Invalid date";break;case P.invalid_string:if(typeof Q.validation==="object")if("includes"in Q.validation){if($=`Invalid input: must include "${Q.validation.includes}"`,typeof Q.validation.position==="number")$=`${$} at one or more positions greater than or equal to ${Q.validation.position}`}else if("startsWith"in Q.validation)$=`Invalid input: must start with "${Q.validation.startsWith}"`;else if("endsWith"in Q.validation)$=`Invalid input: must end with "${Q.validation.endsWith}"`;else o.assertNever(Q.validation);else if(Q.validation!=="regex")$=`Invalid ${Q.validation}`;else $="Invalid";break;case P.too_small:if(Q.type==="array")$=`Array must contain ${Q.exact?"exactly":Q.inclusive?"at least":"more than"} ${Q.minimum} element(s)`;else if(Q.type==="string")$=`String must contain ${Q.exact?"exactly":Q.inclusive?"at least":"over"} ${Q.minimum} character(s)`;else if(Q.type==="number")$=`Number must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${Q.minimum}`;else if(Q.type==="bigint")$=`Number must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${Q.minimum}`;else if(Q.type==="date")$=`Date must be ${Q.exact?"exactly equal to ":Q.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(Q.minimum))}`;else $="Invalid input";break;case P.too_big:if(Q.type==="array")$=`Array must contain ${Q.exact?"exactly":Q.inclusive?"at most":"less than"} ${Q.maximum} element(s)`;else if(Q.type==="string")$=`String must contain ${Q.exact?"exactly":Q.inclusive?"at most":"under"} ${Q.maximum} character(s)`;else if(Q.type==="number")$=`Number must be ${Q.exact?"exactly":Q.inclusive?"less than or equal to":"less than"} ${Q.maximum}`;else if(Q.type==="bigint")$=`BigInt must be ${Q.exact?"exactly":Q.inclusive?"less than or equal to":"less than"} ${Q.maximum}`;else if(Q.type==="date")$=`Date must be ${Q.exact?"exactly":Q.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(Q.maximum))}`;else $="Invalid input";break;case P.custom:$="Invalid input";break;case P.invalid_intersection_types:$="Intersection results could not be merged";break;case P.not_multiple_of:$=`Number must be a multiple of ${Q.multipleOf}`;break;case P.not_finite:$="Number must be finite";break;default:$=W.defaultError,o.assertNever(Q)}return{message:$}},l1=NF;var $J=l1;function MF(Q){$J=Q}function W8(){return $J}var r8=(Q)=>{let{data:W,path:$,errorMaps:Y,issueData:J}=Q,X=[...$,...J.path||[]],G={...J,path:X};if(J.message!==void 0)return{...J,path:X,message:J.message};let H="",B=Y.filter((K)=>!!K).slice().reverse();for(let K of B)H=K(G,{data:W,defaultError:H}).message;return{...J,path:X,message:H}},jF=[];function b(Q,W){let $=W8(),Y=r8({issueData:W,data:Q.data,path:Q.path,errorMaps:[Q.common.contextualErrorMap,Q.schemaErrorMap,$,$===l1?void 0:l1].filter((J)=>!!J)});Q.common.issues.push(Y)}class S0{constructor(){this.value="valid"}dirty(){if(this.value==="valid")this.value="dirty"}abort(){if(this.value!=="aborted")this.value="aborted"}static mergeArray(Q,W){let $=[];for(let Y of W){if(Y.status==="aborted")return h;if(Y.status==="dirty")Q.dirty();$.push(Y.value)}return{status:Q.value,value:$}}static async mergeObjectAsync(Q,W){let $=[];for(let Y of W){let J=await Y.key,X=await Y.value;$.push({key:J,value:X})}return S0.mergeObjectSync(Q,$)}static mergeObjectSync(Q,W){let $={};for(let Y of W){let{key:J,value:X}=Y;if(J.status==="aborted")return h;if(X.status==="aborted")return h;if(J.status==="dirty")Q.dirty();if(X.status==="dirty")Q.dirty();if(J.value!=="__proto__"&&(typeof X.value<"u"||Y.alwaysSet))$[J.value]=X.value}return{status:Q.value,value:$}}}var h=Object.freeze({status:"aborted"}),R6=(Q)=>({status:"dirty",value:Q}),y0=(Q)=>({status:"valid",value:Q}),FQ=(Q)=>Q.status==="aborted",VQ=(Q)=>Q.status==="dirty",s1=(Q)=>Q.status==="valid",$8=(Q)=>typeof Promise<"u"&&Q instanceof Promise;var k;(function(Q){Q.errToObj=(W)=>typeof W==="string"?{message:W}:W||{},Q.toString=(W)=>typeof W==="string"?W:W?.message})(k||(k={}));class w1{constructor(Q,W,$,Y){this._cachedPath=[],this.parent=Q,this.data=W,this._path=$,this._key=Y}get path(){if(!this._cachedPath.length)if(Array.isArray(this._key))this._cachedPath.push(...this._path,...this._key);else this._cachedPath.push(...this._path,this._key);return this._cachedPath}}var YJ=(Q,W)=>{if(s1(W))return{success:!0,data:W.value};else{if(!Q.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let $=new n0(Q.common.issues);return this._error=$,this._error}}}};function m(Q){if(!Q)return{};let{errorMap:W,invalid_type_error:$,required_error:Y,description:J}=Q;if(W&&($||Y))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);if(W)return{errorMap:W,description:J};return{errorMap:(G,H)=>{let{message:B}=Q;if(G.code==="invalid_enum_value")return{message:B??H.defaultError};if(typeof H.data>"u")return{message:B??Y??H.defaultError};if(G.code!=="invalid_type")return{message:H.defaultError};return{message:B??$??H.defaultError}},description:J}}class d{get description(){return this._def.description}_getType(Q){return S1(Q.data)}_getOrReturnCtx(Q,W){return W||{common:Q.parent.common,data:Q.data,parsedType:S1(Q.data),schemaErrorMap:this._def.errorMap,path:Q.path,parent:Q.parent}}_processInputParams(Q){return{status:new S0,ctx:{common:Q.parent.common,data:Q.data,parsedType:S1(Q.data),schemaErrorMap:this._def.errorMap,path:Q.path,parent:Q.parent}}}_parseSync(Q){let W=this._parse(Q);if($8(W))throw Error("Synchronous parse encountered promise.");return W}_parseAsync(Q){let W=this._parse(Q);return Promise.resolve(W)}parse(Q,W){let $=this.safeParse(Q,W);if($.success)return $.data;throw $.error}safeParse(Q,W){let $={common:{issues:[],async:W?.async??!1,contextualErrorMap:W?.errorMap},path:W?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:S1(Q)},Y=this._parseSync({data:Q,path:$.path,parent:$});return YJ($,Y)}"~validate"(Q){let W={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:S1(Q)};if(!this["~standard"].async)try{let $=this._parseSync({data:Q,path:[],parent:W});return s1($)?{value:$.value}:{issues:W.common.issues}}catch($){if($?.message?.toLowerCase()?.includes("encountered"))this["~standard"].async=!0;W.common={issues:[],async:!0}}return this._parseAsync({data:Q,path:[],parent:W}).then(($)=>s1($)?{value:$.value}:{issues:W.common.issues})}async parseAsync(Q,W){let $=await this.safeParseAsync(Q,W);if($.success)return $.data;throw $.error}async safeParseAsync(Q,W){let $={common:{issues:[],contextualErrorMap:W?.errorMap,async:!0},path:W?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:Q,parsedType:S1(Q)},Y=this._parse({data:Q,path:$.path,parent:$}),J=await($8(Y)?Y:Promise.resolve(Y));return YJ($,J)}refine(Q,W){let $=(Y)=>{if(typeof W==="string"||typeof W>"u")return{message:W};else if(typeof W==="function")return W(Y);else return W};return this._refinement((Y,J)=>{let X=Q(Y),G=()=>J.addIssue({code:P.custom,...$(Y)});if(typeof Promise<"u"&&X instanceof Promise)return X.then((H)=>{if(!H)return G(),!1;else return!0});if(!X)return G(),!1;else return!0})}refinement(Q,W){return this._refinement(($,Y)=>{if(!Q($))return Y.addIssue(typeof W==="function"?W($,Y):W),!1;else return!0})}_refinement(Q){return new A1({schema:this,typeName:E.ZodEffects,effect:{type:"refinement",refinement:Q}})}superRefine(Q){return this._refinement(Q)}constructor(Q){this.spa=this.safeParseAsync,this._def=Q,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:(W)=>this["~validate"](W)}}optional(){return Q1.create(this,this._def)}nullable(){return c1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return D1.create(this)}promise(){return Z6.create(this,this._def)}or(Q){return B8.create([this,Q],this._def)}and(Q){return K8.create(this,Q,this._def)}transform(Q){return new A1({...m(this._def),schema:this,typeName:E.ZodEffects,effect:{type:"transform",transform:Q}})}default(Q){let W=typeof Q==="function"?Q:()=>Q;return new L8({...m(this._def),innerType:this,defaultValue:W,typeName:E.ZodDefault})}brand(){return new LQ({typeName:E.ZodBranded,type:this,...m(this._def)})}catch(Q){let W=typeof Q==="function"?Q:()=>Q;return new U8({...m(this._def),innerType:this,catchValue:W,typeName:E.ZodCatch})}describe(Q){return new this.constructor({...this._def,description:Q})}pipe(Q){return W9.create(this,Q)}readonly(){return D8.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var zF=/^c[^\s-]{8,}$/i,PF=/^[0-9a-z]+$/,EF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,RF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,IF=/^[a-z0-9_-]{21}$/i,bF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,SF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ZF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,CF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",H4,vF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,kF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,TF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_F=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,xF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,XJ="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",gF=new RegExp(`^${XJ}$`);function GJ(Q){let W="[0-5]\\d";if(Q.precision)W=`${W}\\.\\d{${Q.precision}}`;else if(Q.precision==null)W=`${W}(\\.\\d+)?`;let $=Q.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${W})${$}`}function hF(Q){return new RegExp(`^${GJ(Q)}$`)}function HJ(Q){let W=`${XJ}T${GJ(Q)}`,$=[];if($.push(Q.local?"Z?":"Z"),Q.offset)$.push("([+-]\\d{2}:?\\d{2})");return W=`${W}(${$.join("|")})`,new RegExp(`^${W}$`)}function fF(Q,W){if((W==="v4"||!W)&&vF.test(Q))return!0;if((W==="v6"||!W)&&TF.test(Q))return!0;return!1}function uF(Q,W){if(!bF.test(Q))return!1;try{let[$]=Q.split(".");if(!$)return!1;let Y=$.replace(/-/g,"+").replace(/_/g,"/").padEnd($.length+(4-$.length%4)%4,"="),J=JSON.parse(atob(Y));if(typeof J!=="object"||J===null)return!1;if("typ"in J&&J?.typ!=="JWT")return!1;if(!J.alg)return!1;if(W&&J.alg!==W)return!1;return!0}catch{return!1}}function lF(Q,W){if((W==="v4"||!W)&&kF.test(Q))return!0;if((W==="v6"||!W)&&_F.test(Q))return!0;return!1}class U1 extends d{_parse(Q){if(this._def.coerce)Q.data=String(Q.data);if(this._getType(Q)!==I.string){let J=this._getOrReturnCtx(Q);return b(J,{code:P.invalid_type,expected:I.string,received:J.parsedType}),h}let $=new S0,Y=void 0;for(let J of this._def.checks)if(J.kind==="min"){if(Q.data.length<J.value)Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.too_small,minimum:J.value,type:"string",inclusive:!0,exact:!1,message:J.message}),$.dirty()}else if(J.kind==="max"){if(Q.data.length>J.value)Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.too_big,maximum:J.value,type:"string",inclusive:!0,exact:!1,message:J.message}),$.dirty()}else if(J.kind==="length"){let X=Q.data.length>J.value,G=Q.data.length<J.value;if(X||G){if(Y=this._getOrReturnCtx(Q,Y),X)b(Y,{code:P.too_big,maximum:J.value,type:"string",inclusive:!0,exact:!0,message:J.message});else if(G)b(Y,{code:P.too_small,minimum:J.value,type:"string",inclusive:!0,exact:!0,message:J.message});$.dirty()}}else if(J.kind==="email"){if(!ZF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"email",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="emoji"){if(!H4)H4=new RegExp(CF,"u");if(!H4.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"emoji",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="uuid"){if(!RF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"uuid",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="nanoid"){if(!IF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"nanoid",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cuid"){if(!zF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"cuid",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cuid2"){if(!PF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"cuid2",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="ulid"){if(!EF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"ulid",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="url")try{new URL(Q.data)}catch{Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"url",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="regex"){if(J.regex.lastIndex=0,!J.regex.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"regex",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="trim")Q.data=Q.data.trim();else if(J.kind==="includes"){if(!Q.data.includes(J.value,J.position))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:{includes:J.value,position:J.position},message:J.message}),$.dirty()}else if(J.kind==="toLowerCase")Q.data=Q.data.toLowerCase();else if(J.kind==="toUpperCase")Q.data=Q.data.toUpperCase();else if(J.kind==="startsWith"){if(!Q.data.startsWith(J.value))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:{startsWith:J.value},message:J.message}),$.dirty()}else if(J.kind==="endsWith"){if(!Q.data.endsWith(J.value))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:{endsWith:J.value},message:J.message}),$.dirty()}else if(J.kind==="datetime"){if(!HJ(J).test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:"datetime",message:J.message}),$.dirty()}else if(J.kind==="date"){if(!gF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:"date",message:J.message}),$.dirty()}else if(J.kind==="time"){if(!hF(J).test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.invalid_string,validation:"time",message:J.message}),$.dirty()}else if(J.kind==="duration"){if(!SF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"duration",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="ip"){if(!fF(Q.data,J.version))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"ip",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="jwt"){if(!uF(Q.data,J.alg))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"jwt",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="cidr"){if(!lF(Q.data,J.version))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"cidr",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="base64"){if(!xF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"base64",code:P.invalid_string,message:J.message}),$.dirty()}else if(J.kind==="base64url"){if(!yF.test(Q.data))Y=this._getOrReturnCtx(Q,Y),b(Y,{validation:"base64url",code:P.invalid_string,message:J.message}),$.dirty()}else o.assertNever(J);return{status:$.value,value:Q.data}}_regex(Q,W,$){return this.refinement((Y)=>Q.test(Y),{validation:W,code:P.invalid_string,...k.errToObj($)})}_addCheck(Q){return new U1({...this._def,checks:[...this._def.checks,Q]})}email(Q){return this._addCheck({kind:"email",...k.errToObj(Q)})}url(Q){return this._addCheck({kind:"url",...k.errToObj(Q)})}emoji(Q){return this._addCheck({kind:"emoji",...k.errToObj(Q)})}uuid(Q){return this._addCheck({kind:"uuid",...k.errToObj(Q)})}nanoid(Q){return this._addCheck({kind:"nanoid",...k.errToObj(Q)})}cuid(Q){return this._addCheck({kind:"cuid",...k.errToObj(Q)})}cuid2(Q){return this._addCheck({kind:"cuid2",...k.errToObj(Q)})}ulid(Q){return this._addCheck({kind:"ulid",...k.errToObj(Q)})}base64(Q){return this._addCheck({kind:"base64",...k.errToObj(Q)})}base64url(Q){return this._addCheck({kind:"base64url",...k.errToObj(Q)})}jwt(Q){return this._addCheck({kind:"jwt",...k.errToObj(Q)})}ip(Q){return this._addCheck({kind:"ip",...k.errToObj(Q)})}cidr(Q){return this._addCheck({kind:"cidr",...k.errToObj(Q)})}datetime(Q){if(typeof Q==="string")return this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:Q});return this._addCheck({kind:"datetime",precision:typeof Q?.precision>"u"?null:Q?.precision,offset:Q?.offset??!1,local:Q?.local??!1,...k.errToObj(Q?.message)})}date(Q){return this._addCheck({kind:"date",message:Q})}time(Q){if(typeof Q==="string")return this._addCheck({kind:"time",precision:null,message:Q});return this._addCheck({kind:"time",precision:typeof Q?.precision>"u"?null:Q?.precision,...k.errToObj(Q?.message)})}duration(Q){return this._addCheck({kind:"duration",...k.errToObj(Q)})}regex(Q,W){return this._addCheck({kind:"regex",regex:Q,...k.errToObj(W)})}includes(Q,W){return this._addCheck({kind:"includes",value:Q,position:W?.position,...k.errToObj(W?.message)})}startsWith(Q,W){return this._addCheck({kind:"startsWith",value:Q,...k.errToObj(W)})}endsWith(Q,W){return this._addCheck({kind:"endsWith",value:Q,...k.errToObj(W)})}min(Q,W){return this._addCheck({kind:"min",value:Q,...k.errToObj(W)})}max(Q,W){return this._addCheck({kind:"max",value:Q,...k.errToObj(W)})}length(Q,W){return this._addCheck({kind:"length",value:Q,...k.errToObj(W)})}nonempty(Q){return this.min(1,k.errToObj(Q))}trim(){return new U1({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new U1({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new U1({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((Q)=>Q.kind==="datetime")}get isDate(){return!!this._def.checks.find((Q)=>Q.kind==="date")}get isTime(){return!!this._def.checks.find((Q)=>Q.kind==="time")}get isDuration(){return!!this._def.checks.find((Q)=>Q.kind==="duration")}get isEmail(){return!!this._def.checks.find((Q)=>Q.kind==="email")}get isURL(){return!!this._def.checks.find((Q)=>Q.kind==="url")}get isEmoji(){return!!this._def.checks.find((Q)=>Q.kind==="emoji")}get isUUID(){return!!this._def.checks.find((Q)=>Q.kind==="uuid")}get isNANOID(){return!!this._def.checks.find((Q)=>Q.kind==="nanoid")}get isCUID(){return!!this._def.checks.find((Q)=>Q.kind==="cuid")}get isCUID2(){return!!this._def.checks.find((Q)=>Q.kind==="cuid2")}get isULID(){return!!this._def.checks.find((Q)=>Q.kind==="ulid")}get isIP(){return!!this._def.checks.find((Q)=>Q.kind==="ip")}get isCIDR(){return!!this._def.checks.find((Q)=>Q.kind==="cidr")}get isBase64(){return!!this._def.checks.find((Q)=>Q.kind==="base64")}get isBase64url(){return!!this._def.checks.find((Q)=>Q.kind==="base64url")}get minLength(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxLength(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}}U1.create=(Q)=>{return new U1({checks:[],typeName:E.ZodString,coerce:Q?.coerce??!1,...m(Q)})};function mF(Q,W){let $=(Q.toString().split(".")[1]||"").length,Y=(W.toString().split(".")[1]||"").length,J=$>Y?$:Y,X=Number.parseInt(Q.toFixed(J).replace(".","")),G=Number.parseInt(W.toFixed(J).replace(".",""));return X%G/10**J}class Q6 extends d{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(Q){if(this._def.coerce)Q.data=Number(Q.data);if(this._getType(Q)!==I.number){let J=this._getOrReturnCtx(Q);return b(J,{code:P.invalid_type,expected:I.number,received:J.parsedType}),h}let $=void 0,Y=new S0;for(let J of this._def.checks)if(J.kind==="int"){if(!o.isInteger(Q.data))$=this._getOrReturnCtx(Q,$),b($,{code:P.invalid_type,expected:"integer",received:"float",message:J.message}),Y.dirty()}else if(J.kind==="min"){if(J.inclusive?Q.data<J.value:Q.data<=J.value)$=this._getOrReturnCtx(Q,$),b($,{code:P.too_small,minimum:J.value,type:"number",inclusive:J.inclusive,exact:!1,message:J.message}),Y.dirty()}else if(J.kind==="max"){if(J.inclusive?Q.data>J.value:Q.data>=J.value)$=this._getOrReturnCtx(Q,$),b($,{code:P.too_big,maximum:J.value,type:"number",inclusive:J.inclusive,exact:!1,message:J.message}),Y.dirty()}else if(J.kind==="multipleOf"){if(mF(Q.data,J.value)!==0)$=this._getOrReturnCtx(Q,$),b($,{code:P.not_multiple_of,multipleOf:J.value,message:J.message}),Y.dirty()}else if(J.kind==="finite"){if(!Number.isFinite(Q.data))$=this._getOrReturnCtx(Q,$),b($,{code:P.not_finite,message:J.message}),Y.dirty()}else o.assertNever(J);return{status:Y.value,value:Q.data}}gte(Q,W){return this.setLimit("min",Q,!0,k.toString(W))}gt(Q,W){return this.setLimit("min",Q,!1,k.toString(W))}lte(Q,W){return this.setLimit("max",Q,!0,k.toString(W))}lt(Q,W){return this.setLimit("max",Q,!1,k.toString(W))}setLimit(Q,W,$,Y){return new Q6({...this._def,checks:[...this._def.checks,{kind:Q,value:W,inclusive:$,message:k.toString(Y)}]})}_addCheck(Q){return new Q6({...this._def,checks:[...this._def.checks,Q]})}int(Q){return this._addCheck({kind:"int",message:k.toString(Q)})}positive(Q){return this._addCheck({kind:"min",value:0,inclusive:!1,message:k.toString(Q)})}negative(Q){return this._addCheck({kind:"max",value:0,inclusive:!1,message:k.toString(Q)})}nonpositive(Q){return this._addCheck({kind:"max",value:0,inclusive:!0,message:k.toString(Q)})}nonnegative(Q){return this._addCheck({kind:"min",value:0,inclusive:!0,message:k.toString(Q)})}multipleOf(Q,W){return this._addCheck({kind:"multipleOf",value:Q,message:k.toString(W)})}finite(Q){return this._addCheck({kind:"finite",message:k.toString(Q)})}safe(Q){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:k.toString(Q)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:k.toString(Q)})}get minValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}get isInt(){return!!this._def.checks.find((Q)=>Q.kind==="int"||Q.kind==="multipleOf"&&o.isInteger(Q.value))}get isFinite(){let Q=null,W=null;for(let $ of this._def.checks)if($.kind==="finite"||$.kind==="int"||$.kind==="multipleOf")return!0;else if($.kind==="min"){if(W===null||$.value>W)W=$.value}else if($.kind==="max"){if(Q===null||$.value<Q)Q=$.value}return Number.isFinite(W)&&Number.isFinite(Q)}}Q6.create=(Q)=>{return new Q6({checks:[],typeName:E.ZodNumber,coerce:Q?.coerce||!1,...m(Q)})};class W6 extends d{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte}_parse(Q){if(this._def.coerce)try{Q.data=BigInt(Q.data)}catch{return this._getInvalidInput(Q)}if(this._getType(Q)!==I.bigint)return this._getInvalidInput(Q);let $=void 0,Y=new S0;for(let J of this._def.checks)if(J.kind==="min"){if(J.inclusive?Q.data<J.value:Q.data<=J.value)$=this._getOrReturnCtx(Q,$),b($,{code:P.too_small,type:"bigint",minimum:J.value,inclusive:J.inclusive,message:J.message}),Y.dirty()}else if(J.kind==="max"){if(J.inclusive?Q.data>J.value:Q.data>=J.value)$=this._getOrReturnCtx(Q,$),b($,{code:P.too_big,type:"bigint",maximum:J.value,inclusive:J.inclusive,message:J.message}),Y.dirty()}else if(J.kind==="multipleOf"){if(Q.data%J.value!==BigInt(0))$=this._getOrReturnCtx(Q,$),b($,{code:P.not_multiple_of,multipleOf:J.value,message:J.message}),Y.dirty()}else o.assertNever(J);return{status:Y.value,value:Q.data}}_getInvalidInput(Q){let W=this._getOrReturnCtx(Q);return b(W,{code:P.invalid_type,expected:I.bigint,received:W.parsedType}),h}gte(Q,W){return this.setLimit("min",Q,!0,k.toString(W))}gt(Q,W){return this.setLimit("min",Q,!1,k.toString(W))}lte(Q,W){return this.setLimit("max",Q,!0,k.toString(W))}lt(Q,W){return this.setLimit("max",Q,!1,k.toString(W))}setLimit(Q,W,$,Y){return new W6({...this._def,checks:[...this._def.checks,{kind:Q,value:W,inclusive:$,message:k.toString(Y)}]})}_addCheck(Q){return new W6({...this._def,checks:[...this._def.checks,Q]})}positive(Q){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:k.toString(Q)})}negative(Q){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:k.toString(Q)})}nonpositive(Q){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:k.toString(Q)})}nonnegative(Q){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:k.toString(Q)})}multipleOf(Q,W){return this._addCheck({kind:"multipleOf",value:Q,message:k.toString(W)})}get minValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q}get maxValue(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q}}W6.create=(Q)=>{return new W6({checks:[],typeName:E.ZodBigInt,coerce:Q?.coerce??!1,...m(Q)})};class X8 extends d{_parse(Q){if(this._def.coerce)Q.data=Boolean(Q.data);if(this._getType(Q)!==I.boolean){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.boolean,received:$.parsedType}),h}return y0(Q.data)}}X8.create=(Q)=>{return new X8({typeName:E.ZodBoolean,coerce:Q?.coerce||!1,...m(Q)})};class I6 extends d{_parse(Q){if(this._def.coerce)Q.data=new Date(Q.data);if(this._getType(Q)!==I.date){let J=this._getOrReturnCtx(Q);return b(J,{code:P.invalid_type,expected:I.date,received:J.parsedType}),h}if(Number.isNaN(Q.data.getTime())){let J=this._getOrReturnCtx(Q);return b(J,{code:P.invalid_date}),h}let $=new S0,Y=void 0;for(let J of this._def.checks)if(J.kind==="min"){if(Q.data.getTime()<J.value)Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.too_small,message:J.message,inclusive:!0,exact:!1,minimum:J.value,type:"date"}),$.dirty()}else if(J.kind==="max"){if(Q.data.getTime()>J.value)Y=this._getOrReturnCtx(Q,Y),b(Y,{code:P.too_big,message:J.message,inclusive:!0,exact:!1,maximum:J.value,type:"date"}),$.dirty()}else o.assertNever(J);return{status:$.value,value:new Date(Q.data.getTime())}}_addCheck(Q){return new I6({...this._def,checks:[...this._def.checks,Q]})}min(Q,W){return this._addCheck({kind:"min",value:Q.getTime(),message:k.toString(W)})}max(Q,W){return this._addCheck({kind:"max",value:Q.getTime(),message:k.toString(W)})}get minDate(){let Q=null;for(let W of this._def.checks)if(W.kind==="min"){if(Q===null||W.value>Q)Q=W.value}return Q!=null?new Date(Q):null}get maxDate(){let Q=null;for(let W of this._def.checks)if(W.kind==="max"){if(Q===null||W.value<Q)Q=W.value}return Q!=null?new Date(Q):null}}I6.create=(Q)=>{return new I6({checks:[],coerce:Q?.coerce||!1,typeName:E.ZodDate,...m(Q)})};class a8 extends d{_parse(Q){if(this._getType(Q)!==I.symbol){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.symbol,received:$.parsedType}),h}return y0(Q.data)}}a8.create=(Q)=>{return new a8({typeName:E.ZodSymbol,...m(Q)})};class G8 extends d{_parse(Q){if(this._getType(Q)!==I.undefined){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.undefined,received:$.parsedType}),h}return y0(Q.data)}}G8.create=(Q)=>{return new G8({typeName:E.ZodUndefined,...m(Q)})};class H8 extends d{_parse(Q){if(this._getType(Q)!==I.null){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.null,received:$.parsedType}),h}return y0(Q.data)}}H8.create=(Q)=>{return new H8({typeName:E.ZodNull,...m(Q)})};class b6 extends d{constructor(){super(...arguments);this._any=!0}_parse(Q){return y0(Q.data)}}b6.create=(Q)=>{return new b6({typeName:E.ZodAny,...m(Q)})};class e1 extends d{constructor(){super(...arguments);this._unknown=!0}_parse(Q){return y0(Q.data)}}e1.create=(Q)=>{return new e1({typeName:E.ZodUnknown,...m(Q)})};class Z1 extends d{_parse(Q){let W=this._getOrReturnCtx(Q);return b(W,{code:P.invalid_type,expected:I.never,received:W.parsedType}),h}}Z1.create=(Q)=>{return new Z1({typeName:E.ZodNever,...m(Q)})};class t8 extends d{_parse(Q){if(this._getType(Q)!==I.undefined){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.void,received:$.parsedType}),h}return y0(Q.data)}}t8.create=(Q)=>{return new t8({typeName:E.ZodVoid,...m(Q)})};class D1 extends d{_parse(Q){let{ctx:W,status:$}=this._processInputParams(Q),Y=this._def;if(W.parsedType!==I.array)return b(W,{code:P.invalid_type,expected:I.array,received:W.parsedType}),h;if(Y.exactLength!==null){let X=W.data.length>Y.exactLength.value,G=W.data.length<Y.exactLength.value;if(X||G)b(W,{code:X?P.too_big:P.too_small,minimum:G?Y.exactLength.value:void 0,maximum:X?Y.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:Y.exactLength.message}),$.dirty()}if(Y.minLength!==null){if(W.data.length<Y.minLength.value)b(W,{code:P.too_small,minimum:Y.minLength.value,type:"array",inclusive:!0,exact:!1,message:Y.minLength.message}),$.dirty()}if(Y.maxLength!==null){if(W.data.length>Y.maxLength.value)b(W,{code:P.too_big,maximum:Y.maxLength.value,type:"array",inclusive:!0,exact:!1,message:Y.maxLength.message}),$.dirty()}if(W.common.async)return Promise.all([...W.data].map((X,G)=>{return Y.type._parseAsync(new w1(W,X,W.path,G))})).then((X)=>{return S0.mergeArray($,X)});let J=[...W.data].map((X,G)=>{return Y.type._parseSync(new w1(W,X,W.path,G))});return S0.mergeArray($,J)}get element(){return this._def.type}min(Q,W){return new D1({...this._def,minLength:{value:Q,message:k.toString(W)}})}max(Q,W){return new D1({...this._def,maxLength:{value:Q,message:k.toString(W)}})}length(Q,W){return new D1({...this._def,exactLength:{value:Q,message:k.toString(W)}})}nonempty(Q){return this.min(1,Q)}}D1.create=(Q,W)=>{return new D1({type:Q,minLength:null,maxLength:null,exactLength:null,typeName:E.ZodArray,...m(W)})};function Y8(Q){if(Q instanceof N0){let W={};for(let $ in Q.shape){let Y=Q.shape[$];W[$]=Q1.create(Y8(Y))}return new N0({...Q._def,shape:()=>W})}else if(Q instanceof D1)return new D1({...Q._def,type:Y8(Q.element)});else if(Q instanceof Q1)return Q1.create(Y8(Q.unwrap()));else if(Q instanceof c1)return c1.create(Y8(Q.unwrap()));else if(Q instanceof C1)return C1.create(Q.items.map((W)=>Y8(W)));else return Q}class N0 extends d{constructor(){super(...arguments);this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let Q=this._def.shape(),W=o.objectKeys(Q);return this._cached={shape:Q,keys:W},this._cached}_parse(Q){if(this._getType(Q)!==I.object){let B=this._getOrReturnCtx(Q);return b(B,{code:P.invalid_type,expected:I.object,received:B.parsedType}),h}let{status:$,ctx:Y}=this._processInputParams(Q),{shape:J,keys:X}=this._getCached(),G=[];if(!(this._def.catchall instanceof Z1&&this._def.unknownKeys==="strip")){for(let B in Y.data)if(!X.includes(B))G.push(B)}let H=[];for(let B of X){let K=J[B],F=Y.data[B];H.push({key:{status:"valid",value:B},value:K._parse(new w1(Y,F,Y.path,B)),alwaysSet:B in Y.data})}if(this._def.catchall instanceof Z1){let B=this._def.unknownKeys;if(B==="passthrough")for(let K of G)H.push({key:{status:"valid",value:K},value:{status:"valid",value:Y.data[K]}});else if(B==="strict"){if(G.length>0)b(Y,{code:P.unrecognized_keys,keys:G}),$.dirty()}else if(B==="strip");else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let B=this._def.catchall;for(let K of G){let F=Y.data[K];H.push({key:{status:"valid",value:K},value:B._parse(new w1(Y,F,Y.path,K)),alwaysSet:K in Y.data})}}if(Y.common.async)return Promise.resolve().then(async()=>{let B=[];for(let K of H){let F=await K.key,q=await K.value;B.push({key:F,value:q,alwaysSet:K.alwaysSet})}return B}).then((B)=>{return S0.mergeObjectSync($,B)});else return S0.mergeObjectSync($,H)}get shape(){return this._def.shape()}strict(Q){return k.errToObj,new N0({...this._def,unknownKeys:"strict",...Q!==void 0?{errorMap:(W,$)=>{let Y=this._def.errorMap?.(W,$).message??$.defaultError;if(W.code==="unrecognized_keys")return{message:k.errToObj(Q).message??Y};return{message:Y}}}:{}})}strip(){return new N0({...this._def,unknownKeys:"strip"})}passthrough(){return new N0({...this._def,unknownKeys:"passthrough"})}extend(Q){return new N0({...this._def,shape:()=>({...this._def.shape(),...Q})})}merge(Q){return new N0({unknownKeys:Q._def.unknownKeys,catchall:Q._def.catchall,shape:()=>({...this._def.shape(),...Q._def.shape()}),typeName:E.ZodObject})}setKey(Q,W){return this.augment({[Q]:W})}catchall(Q){return new N0({...this._def,catchall:Q})}pick(Q){let W={};for(let $ of o.objectKeys(Q))if(Q[$]&&this.shape[$])W[$]=this.shape[$];return new N0({...this._def,shape:()=>W})}omit(Q){let W={};for(let $ of o.objectKeys(this.shape))if(!Q[$])W[$]=this.shape[$];return new N0({...this._def,shape:()=>W})}deepPartial(){return Y8(this)}partial(Q){let W={};for(let $ of o.objectKeys(this.shape)){let Y=this.shape[$];if(Q&&!Q[$])W[$]=Y;else W[$]=Y.optional()}return new N0({...this._def,shape:()=>W})}required(Q){let W={};for(let $ of o.objectKeys(this.shape))if(Q&&!Q[$])W[$]=this.shape[$];else{let J=this.shape[$];while(J instanceof Q1)J=J._def.innerType;W[$]=J}return new N0({...this._def,shape:()=>W})}keyof(){return BJ(o.objectKeys(this.shape))}}N0.create=(Q,W)=>{return new N0({shape:()=>Q,unknownKeys:"strip",catchall:Z1.create(),typeName:E.ZodObject,...m(W)})};N0.strictCreate=(Q,W)=>{return new N0({shape:()=>Q,unknownKeys:"strict",catchall:Z1.create(),typeName:E.ZodObject,...m(W)})};N0.lazycreate=(Q,W)=>{return new N0({shape:Q,unknownKeys:"strip",catchall:Z1.create(),typeName:E.ZodObject,...m(W)})};class B8 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=this._def.options;function Y(J){for(let G of J)if(G.result.status==="valid")return G.result;for(let G of J)if(G.result.status==="dirty")return W.common.issues.push(...G.ctx.common.issues),G.result;let X=J.map((G)=>new n0(G.ctx.common.issues));return b(W,{code:P.invalid_union,unionErrors:X}),h}if(W.common.async)return Promise.all($.map(async(J)=>{let X={...W,common:{...W.common,issues:[]},parent:null};return{result:await J._parseAsync({data:W.data,path:W.path,parent:X}),ctx:X}})).then(Y);else{let J=void 0,X=[];for(let H of $){let B={...W,common:{...W.common,issues:[]},parent:null},K=H._parseSync({data:W.data,path:W.path,parent:B});if(K.status==="valid")return K;else if(K.status==="dirty"&&!J)J={result:K,ctx:B};if(B.common.issues.length)X.push(B.common.issues)}if(J)return W.common.issues.push(...J.ctx.common.issues),J.result;let G=X.map((H)=>new n0(H));return b(W,{code:P.invalid_union,unionErrors:G}),h}}get options(){return this._def.options}}B8.create=(Q,W)=>{return new B8({options:Q,typeName:E.ZodUnion,...m(W)})};var m1=(Q)=>{if(Q instanceof F8)return m1(Q.schema);else if(Q instanceof A1)return m1(Q.innerType());else if(Q instanceof V8)return[Q.value];else if(Q instanceof $6)return Q.options;else if(Q instanceof q8)return o.objectValues(Q.enum);else if(Q instanceof L8)return m1(Q._def.innerType);else if(Q instanceof G8)return[void 0];else if(Q instanceof H8)return[null];else if(Q instanceof Q1)return[void 0,...m1(Q.unwrap())];else if(Q instanceof c1)return[null,...m1(Q.unwrap())];else if(Q instanceof LQ)return m1(Q.unwrap());else if(Q instanceof D8)return m1(Q.unwrap());else if(Q instanceof U8)return m1(Q._def.innerType);else return[]};class qQ extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.object)return b(W,{code:P.invalid_type,expected:I.object,received:W.parsedType}),h;let $=this.discriminator,Y=W.data[$],J=this.optionsMap.get(Y);if(!J)return b(W,{code:P.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[$]}),h;if(W.common.async)return J._parseAsync({data:W.data,path:W.path,parent:W});else return J._parseSync({data:W.data,path:W.path,parent:W})}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(Q,W,$){let Y=new Map;for(let J of W){let X=m1(J.shape[Q]);if(!X.length)throw Error(`A discriminator value for key \`${Q}\` could not be extracted from all schema options`);for(let G of X){if(Y.has(G))throw Error(`Discriminator property ${String(Q)} has duplicate value ${String(G)}`);Y.set(G,J)}}return new qQ({typeName:E.ZodDiscriminatedUnion,discriminator:Q,options:W,optionsMap:Y,...m($)})}}function B4(Q,W){let $=S1(Q),Y=S1(W);if(Q===W)return{valid:!0,data:Q};else if($===I.object&&Y===I.object){let J=o.objectKeys(W),X=o.objectKeys(Q).filter((H)=>J.indexOf(H)!==-1),G={...Q,...W};for(let H of X){let B=B4(Q[H],W[H]);if(!B.valid)return{valid:!1};G[H]=B.data}return{valid:!0,data:G}}else if($===I.array&&Y===I.array){if(Q.length!==W.length)return{valid:!1};let J=[];for(let X=0;X<Q.length;X++){let G=Q[X],H=W[X],B=B4(G,H);if(!B.valid)return{valid:!1};J.push(B.data)}return{valid:!0,data:J}}else if($===I.date&&Y===I.date&&+Q===+W)return{valid:!0,data:Q};else return{valid:!1}}class K8 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q),Y=(J,X)=>{if(FQ(J)||FQ(X))return h;let G=B4(J.value,X.value);if(!G.valid)return b($,{code:P.invalid_intersection_types}),h;if(VQ(J)||VQ(X))W.dirty();return{status:W.value,value:G.data}};if($.common.async)return Promise.all([this._def.left._parseAsync({data:$.data,path:$.path,parent:$}),this._def.right._parseAsync({data:$.data,path:$.path,parent:$})]).then(([J,X])=>Y(J,X));else return Y(this._def.left._parseSync({data:$.data,path:$.path,parent:$}),this._def.right._parseSync({data:$.data,path:$.path,parent:$}))}}K8.create=(Q,W,$)=>{return new K8({left:Q,right:W,typeName:E.ZodIntersection,...m($)})};class C1 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.array)return b($,{code:P.invalid_type,expected:I.array,received:$.parsedType}),h;if($.data.length<this._def.items.length)return b($,{code:P.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h;if(!this._def.rest&&$.data.length>this._def.items.length)b($,{code:P.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),W.dirty();let J=[...$.data].map((X,G)=>{let H=this._def.items[G]||this._def.rest;if(!H)return null;return H._parse(new w1($,X,$.path,G))}).filter((X)=>!!X);if($.common.async)return Promise.all(J).then((X)=>{return S0.mergeArray(W,X)});else return S0.mergeArray(W,J)}get items(){return this._def.items}rest(Q){return new C1({...this._def,rest:Q})}}C1.create=(Q,W)=>{if(!Array.isArray(Q))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new C1({items:Q,typeName:E.ZodTuple,rest:null,...m(W)})};class s8 extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.object)return b($,{code:P.invalid_type,expected:I.object,received:$.parsedType}),h;let Y=[],J=this._def.keyType,X=this._def.valueType;for(let G in $.data)Y.push({key:J._parse(new w1($,G,$.path,G)),value:X._parse(new w1($,$.data[G],$.path,G)),alwaysSet:G in $.data});if($.common.async)return S0.mergeObjectAsync(W,Y);else return S0.mergeObjectSync(W,Y)}get element(){return this._def.valueType}static create(Q,W,$){if(W instanceof d)return new s8({keyType:Q,valueType:W,typeName:E.ZodRecord,...m($)});return new s8({keyType:U1.create(),valueType:Q,typeName:E.ZodRecord,...m(W)})}}class e8 extends d{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.map)return b($,{code:P.invalid_type,expected:I.map,received:$.parsedType}),h;let Y=this._def.keyType,J=this._def.valueType,X=[...$.data.entries()].map(([G,H],B)=>{return{key:Y._parse(new w1($,G,$.path,[B,"key"])),value:J._parse(new w1($,H,$.path,[B,"value"]))}});if($.common.async){let G=new Map;return Promise.resolve().then(async()=>{for(let H of X){let B=await H.key,K=await H.value;if(B.status==="aborted"||K.status==="aborted")return h;if(B.status==="dirty"||K.status==="dirty")W.dirty();G.set(B.value,K.value)}return{status:W.value,value:G}})}else{let G=new Map;for(let H of X){let{key:B,value:K}=H;if(B.status==="aborted"||K.status==="aborted")return h;if(B.status==="dirty"||K.status==="dirty")W.dirty();G.set(B.value,K.value)}return{status:W.value,value:G}}}}e8.create=(Q,W,$)=>{return new e8({valueType:W,keyType:Q,typeName:E.ZodMap,...m($)})};class S6 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.parsedType!==I.set)return b($,{code:P.invalid_type,expected:I.set,received:$.parsedType}),h;let Y=this._def;if(Y.minSize!==null){if($.data.size<Y.minSize.value)b($,{code:P.too_small,minimum:Y.minSize.value,type:"set",inclusive:!0,exact:!1,message:Y.minSize.message}),W.dirty()}if(Y.maxSize!==null){if($.data.size>Y.maxSize.value)b($,{code:P.too_big,maximum:Y.maxSize.value,type:"set",inclusive:!0,exact:!1,message:Y.maxSize.message}),W.dirty()}let J=this._def.valueType;function X(H){let B=new Set;for(let K of H){if(K.status==="aborted")return h;if(K.status==="dirty")W.dirty();B.add(K.value)}return{status:W.value,value:B}}let G=[...$.data.values()].map((H,B)=>J._parse(new w1($,H,$.path,B)));if($.common.async)return Promise.all(G).then((H)=>X(H));else return X(G)}min(Q,W){return new S6({...this._def,minSize:{value:Q,message:k.toString(W)}})}max(Q,W){return new S6({...this._def,maxSize:{value:Q,message:k.toString(W)}})}size(Q,W){return this.min(Q,W).max(Q,W)}nonempty(Q){return this.min(1,Q)}}S6.create=(Q,W)=>{return new S6({valueType:Q,minSize:null,maxSize:null,typeName:E.ZodSet,...m(W)})};class J8 extends d{constructor(){super(...arguments);this.validate=this.implement}_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.function)return b(W,{code:P.invalid_type,expected:I.function,received:W.parsedType}),h;function $(G,H){return r8({data:G,path:W.path,errorMaps:[W.common.contextualErrorMap,W.schemaErrorMap,W8(),l1].filter((B)=>!!B),issueData:{code:P.invalid_arguments,argumentsError:H}})}function Y(G,H){return r8({data:G,path:W.path,errorMaps:[W.common.contextualErrorMap,W.schemaErrorMap,W8(),l1].filter((B)=>!!B),issueData:{code:P.invalid_return_type,returnTypeError:H}})}let J={errorMap:W.common.contextualErrorMap},X=W.data;if(this._def.returns instanceof Z6){let G=this;return y0(async function(...H){let B=new n0([]),K=await G._def.args.parseAsync(H,J).catch((U)=>{throw B.addIssue($(H,U)),B}),F=await Reflect.apply(X,this,K);return await G._def.returns._def.type.parseAsync(F,J).catch((U)=>{throw B.addIssue(Y(F,U)),B})})}else{let G=this;return y0(function(...H){let B=G._def.args.safeParse(H,J);if(!B.success)throw new n0([$(H,B.error)]);let K=Reflect.apply(X,this,B.data),F=G._def.returns.safeParse(K,J);if(!F.success)throw new n0([Y(K,F.error)]);return F.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...Q){return new J8({...this._def,args:C1.create(Q).rest(e1.create())})}returns(Q){return new J8({...this._def,returns:Q})}implement(Q){return this.parse(Q)}strictImplement(Q){return this.parse(Q)}static create(Q,W,$){return new J8({args:Q?Q:C1.create([]).rest(e1.create()),returns:W||e1.create(),typeName:E.ZodFunction,...m($)})}}class F8 extends d{get schema(){return this._def.getter()}_parse(Q){let{ctx:W}=this._processInputParams(Q);return this._def.getter()._parse({data:W.data,path:W.path,parent:W})}}F8.create=(Q,W)=>{return new F8({getter:Q,typeName:E.ZodLazy,...m(W)})};class V8 extends d{_parse(Q){if(Q.data!==this._def.value){let W=this._getOrReturnCtx(Q);return b(W,{received:W.data,code:P.invalid_literal,expected:this._def.value}),h}return{status:"valid",value:Q.data}}get value(){return this._def.value}}V8.create=(Q,W)=>{return new V8({value:Q,typeName:E.ZodLiteral,...m(W)})};function BJ(Q,W){return new $6({values:Q,typeName:E.ZodEnum,...m(W)})}class $6 extends d{_parse(Q){if(typeof Q.data!=="string"){let W=this._getOrReturnCtx(Q),$=this._def.values;return b(W,{expected:o.joinValues($),received:W.parsedType,code:P.invalid_type}),h}if(!this._cache)this._cache=new Set(this._def.values);if(!this._cache.has(Q.data)){let W=this._getOrReturnCtx(Q),$=this._def.values;return b(W,{received:W.data,code:P.invalid_enum_value,options:$}),h}return y0(Q.data)}get options(){return this._def.values}get enum(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}get Values(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}get Enum(){let Q={};for(let W of this._def.values)Q[W]=W;return Q}extract(Q,W=this._def){return $6.create(Q,{...this._def,...W})}exclude(Q,W=this._def){return $6.create(this.options.filter(($)=>!Q.includes($)),{...this._def,...W})}}$6.create=BJ;class q8 extends d{_parse(Q){let W=o.getValidEnumValues(this._def.values),$=this._getOrReturnCtx(Q);if($.parsedType!==I.string&&$.parsedType!==I.number){let Y=o.objectValues(W);return b($,{expected:o.joinValues(Y),received:$.parsedType,code:P.invalid_type}),h}if(!this._cache)this._cache=new Set(o.getValidEnumValues(this._def.values));if(!this._cache.has(Q.data)){let Y=o.objectValues(W);return b($,{received:$.data,code:P.invalid_enum_value,options:Y}),h}return y0(Q.data)}get enum(){return this._def.values}}q8.create=(Q,W)=>{return new q8({values:Q,typeName:E.ZodNativeEnum,...m(W)})};class Z6 extends d{unwrap(){return this._def.type}_parse(Q){let{ctx:W}=this._processInputParams(Q);if(W.parsedType!==I.promise&&W.common.async===!1)return b(W,{code:P.invalid_type,expected:I.promise,received:W.parsedType}),h;let $=W.parsedType===I.promise?W.data:Promise.resolve(W.data);return y0($.then((Y)=>{return this._def.type.parseAsync(Y,{path:W.path,errorMap:W.common.contextualErrorMap})}))}}Z6.create=(Q,W)=>{return new Z6({type:Q,typeName:E.ZodPromise,...m(W)})};class A1 extends d{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===E.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q),Y=this._def.effect||null,J={addIssue:(X)=>{if(b($,X),X.fatal)W.abort();else W.dirty()},get path(){return $.path}};if(J.addIssue=J.addIssue.bind(J),Y.type==="preprocess"){let X=Y.transform($.data,J);if($.common.async)return Promise.resolve(X).then(async(G)=>{if(W.value==="aborted")return h;let H=await this._def.schema._parseAsync({data:G,path:$.path,parent:$});if(H.status==="aborted")return h;if(H.status==="dirty")return R6(H.value);if(W.value==="dirty")return R6(H.value);return H});else{if(W.value==="aborted")return h;let G=this._def.schema._parseSync({data:X,path:$.path,parent:$});if(G.status==="aborted")return h;if(G.status==="dirty")return R6(G.value);if(W.value==="dirty")return R6(G.value);return G}}if(Y.type==="refinement"){let X=(G)=>{let H=Y.refinement(G,J);if($.common.async)return Promise.resolve(H);if(H instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return G};if($.common.async===!1){let G=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(G.status==="aborted")return h;if(G.status==="dirty")W.dirty();return X(G.value),{status:W.value,value:G.value}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((G)=>{if(G.status==="aborted")return h;if(G.status==="dirty")W.dirty();return X(G.value).then(()=>{return{status:W.value,value:G.value}})})}if(Y.type==="transform")if($.common.async===!1){let X=this._def.schema._parseSync({data:$.data,path:$.path,parent:$});if(!s1(X))return h;let G=Y.transform(X.value,J);if(G instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:W.value,value:G}}else return this._def.schema._parseAsync({data:$.data,path:$.path,parent:$}).then((X)=>{if(!s1(X))return h;return Promise.resolve(Y.transform(X.value,J)).then((G)=>({status:W.value,value:G}))});o.assertNever(Y)}}A1.create=(Q,W,$)=>{return new A1({schema:Q,typeName:E.ZodEffects,effect:W,...m($)})};A1.createWithPreprocess=(Q,W,$)=>{return new A1({schema:W,effect:{type:"preprocess",transform:Q},typeName:E.ZodEffects,...m($)})};class Q1 extends d{_parse(Q){if(this._getType(Q)===I.undefined)return y0(void 0);return this._def.innerType._parse(Q)}unwrap(){return this._def.innerType}}Q1.create=(Q,W)=>{return new Q1({innerType:Q,typeName:E.ZodOptional,...m(W)})};class c1 extends d{_parse(Q){if(this._getType(Q)===I.null)return y0(null);return this._def.innerType._parse(Q)}unwrap(){return this._def.innerType}}c1.create=(Q,W)=>{return new c1({innerType:Q,typeName:E.ZodNullable,...m(W)})};class L8 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=W.data;if(W.parsedType===I.undefined)$=this._def.defaultValue();return this._def.innerType._parse({data:$,path:W.path,parent:W})}removeDefault(){return this._def.innerType}}L8.create=(Q,W)=>{return new L8({innerType:Q,typeName:E.ZodDefault,defaultValue:typeof W.default==="function"?W.default:()=>W.default,...m(W)})};class U8 extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$={...W,common:{...W.common,issues:[]}},Y=this._def.innerType._parse({data:$.data,path:$.path,parent:{...$}});if($8(Y))return Y.then((J)=>{return{status:"valid",value:J.status==="valid"?J.value:this._def.catchValue({get error(){return new n0($.common.issues)},input:$.data})}});else return{status:"valid",value:Y.status==="valid"?Y.value:this._def.catchValue({get error(){return new n0($.common.issues)},input:$.data})}}removeCatch(){return this._def.innerType}}U8.create=(Q,W)=>{return new U8({innerType:Q,typeName:E.ZodCatch,catchValue:typeof W.catch==="function"?W.catch:()=>W.catch,...m(W)})};class Q9 extends d{_parse(Q){if(this._getType(Q)!==I.nan){let $=this._getOrReturnCtx(Q);return b($,{code:P.invalid_type,expected:I.nan,received:$.parsedType}),h}return{status:"valid",value:Q.data}}}Q9.create=(Q)=>{return new Q9({typeName:E.ZodNaN,...m(Q)})};var cF=Symbol("zod_brand");class LQ extends d{_parse(Q){let{ctx:W}=this._processInputParams(Q),$=W.data;return this._def.type._parse({data:$,path:W.path,parent:W})}unwrap(){return this._def.type}}class W9 extends d{_parse(Q){let{status:W,ctx:$}=this._processInputParams(Q);if($.common.async)return(async()=>{let J=await this._def.in._parseAsync({data:$.data,path:$.path,parent:$});if(J.status==="aborted")return h;if(J.status==="dirty")return W.dirty(),R6(J.value);else return this._def.out._parseAsync({data:J.value,path:$.path,parent:$})})();else{let Y=this._def.in._parseSync({data:$.data,path:$.path,parent:$});if(Y.status==="aborted")return h;if(Y.status==="dirty")return W.dirty(),{status:"dirty",value:Y.value};else return this._def.out._parseSync({data:Y.value,path:$.path,parent:$})}}static create(Q,W){return new W9({in:Q,out:W,typeName:E.ZodPipeline})}}class D8 extends d{_parse(Q){let W=this._def.innerType._parse(Q),$=(Y)=>{if(s1(Y))Y.value=Object.freeze(Y.value);return Y};return $8(W)?W.then((Y)=>$(Y)):$(W)}unwrap(){return this._def.innerType}}D8.create=(Q,W)=>{return new D8({innerType:Q,typeName:E.ZodReadonly,...m(W)})};function JJ(Q,W){let $=typeof Q==="function"?Q(W):typeof Q==="string"?{message:Q}:Q;return typeof $==="string"?{message:$}:$}function KJ(Q,W={},$){if(Q)return b6.create().superRefine((Y,J)=>{let X=Q(Y);if(X instanceof Promise)return X.then((G)=>{if(!G){let H=JJ(W,Y),B=H.fatal??$??!0;J.addIssue({code:"custom",...H,fatal:B})}});if(!X){let G=JJ(W,Y),H=G.fatal??$??!0;J.addIssue({code:"custom",...G,fatal:H})}return});return b6.create()}var pF={object:N0.lazycreate},E;(function(Q){Q.ZodString="ZodString",Q.ZodNumber="ZodNumber",Q.ZodNaN="ZodNaN",Q.ZodBigInt="ZodBigInt",Q.ZodBoolean="ZodBoolean",Q.ZodDate="ZodDate",Q.ZodSymbol="ZodSymbol",Q.ZodUndefined="ZodUndefined",Q.ZodNull="ZodNull",Q.ZodAny="ZodAny",Q.ZodUnknown="ZodUnknown",Q.ZodNever="ZodNever",Q.ZodVoid="ZodVoid",Q.ZodArray="ZodArray",Q.ZodObject="ZodObject",Q.ZodUnion="ZodUnion",Q.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Q.ZodIntersection="ZodIntersection",Q.ZodTuple="ZodTuple",Q.ZodRecord="ZodRecord",Q.ZodMap="ZodMap",Q.ZodSet="ZodSet",Q.ZodFunction="ZodFunction",Q.ZodLazy="ZodLazy",Q.ZodLiteral="ZodLiteral",Q.ZodEnum="ZodEnum",Q.ZodEffects="ZodEffects",Q.ZodNativeEnum="ZodNativeEnum",Q.ZodOptional="ZodOptional",Q.ZodNullable="ZodNullable",Q.ZodDefault="ZodDefault",Q.ZodCatch="ZodCatch",Q.ZodPromise="ZodPromise",Q.ZodBranded="ZodBranded",Q.ZodPipeline="ZodPipeline",Q.ZodReadonly="ZodReadonly"})(E||(E={}));var dF=(Q,W={message:`Input not instance of ${Q.name}`})=>KJ(($)=>$ instanceof Q,W),FJ=U1.create,VJ=Q6.create,iF=Q9.create,nF=W6.create,qJ=X8.create,oF=I6.create,rF=a8.create,aF=G8.create,tF=H8.create,sF=b6.create,eF=e1.create,QV=Z1.create,WV=t8.create,$V=D1.create,K4=N0.create,YV=N0.strictCreate,JV=B8.create,XV=qQ.create,GV=K8.create,HV=C1.create,BV=s8.create,KV=e8.create,FV=S6.create,VV=J8.create,qV=F8.create,LV=V8.create,UV=$6.create,DV=q8.create,wV=Z6.create,AV=A1.create,OV=Q1.create,NV=c1.create,MV=A1.createWithPreprocess,jV=W9.create,zV=()=>FJ().optional(),PV=()=>VJ().optional(),EV=()=>qJ().optional(),RV={string:(Q)=>U1.create({...Q,coerce:!0}),number:(Q)=>Q6.create({...Q,coerce:!0}),boolean:(Q)=>X8.create({...Q,coerce:!0}),bigint:(Q)=>W6.create({...Q,coerce:!0}),date:(Q)=>I6.create({...Q,coerce:!0})};var IV=h;var bV=Object.freeze({status:"aborted"});function M(Q,W,$){function Y(H,B){var K;Object.defineProperty(H,"_zod",{value:H._zod??{},enumerable:!1}),(K=H._zod).traits??(K.traits=new Set),H._zod.traits.add(Q),W(H,B);for(let F in G.prototype)if(!(F in H))Object.defineProperty(H,F,{value:G.prototype[F].bind(H)});H._zod.constr=G,H._zod.def=B}let J=$?.Parent??Object;class X extends J{}Object.defineProperty(X,"name",{value:Q});function G(H){var B;let K=$?.Parent?new X:this;Y(K,H),(B=K._zod).deferred??(B.deferred=[]);for(let F of K._zod.deferred)F();return K}return Object.defineProperty(G,"init",{value:Y}),Object.defineProperty(G,Symbol.hasInstance,{value:(H)=>{if($?.Parent&&H instanceof $.Parent)return!0;return H?._zod?.traits?.has(Q)}}),Object.defineProperty(G,"name",{value:Q}),G}var SV=Symbol("zod_brand");class Y6 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}var UQ={};function W1(Q){if(Q)Object.assign(UQ,Q);return UQ}var r={};X4(r,{unwrapMessage:()=>$9,stringifyPrimitive:()=>AQ,required:()=>dV,randomString:()=>yV,propertyKeyTypes:()=>D4,promiseAllObject:()=>xV,primitiveTypes:()=>LJ,prefixIssues:()=>v1,pick:()=>uV,partial:()=>pV,optionalKeys:()=>w4,omit:()=>lV,numKeys:()=>gV,nullish:()=>X9,normalizeParams:()=>f,merge:()=>cV,jsonStringifyReplacer:()=>V4,joinValues:()=>DQ,issue:()=>O4,isPlainObject:()=>A8,isObject:()=>w8,getSizableOrigin:()=>DJ,getParsedType:()=>hV,getLengthableOrigin:()=>H9,getEnumValues:()=>Y9,getElementAtPath:()=>_V,floatSafeRemainder:()=>q4,finalizeIssue:()=>O1,extend:()=>mV,escapeRegex:()=>J6,esc:()=>C6,defineLazy:()=>K0,createTransparentProxy:()=>fV,clone:()=>$1,cleanRegex:()=>G9,cleanEnum:()=>iV,captureStackTrace:()=>wQ,cached:()=>J9,assignProp:()=>L4,assertNotEqual:()=>CV,assertNever:()=>kV,assertIs:()=>vV,assertEqual:()=>ZV,assert:()=>TV,allowsEval:()=>U4,aborted:()=>v6,NUMBER_FORMAT_RANGES:()=>A4,Class:()=>wJ,BIGINT_FORMAT_RANGES:()=>UJ});function ZV(Q){return Q}function CV(Q){return Q}function vV(Q){}function kV(Q){throw Error()}function TV(Q){}function Y9(Q){let W=Object.values(Q).filter((Y)=>typeof Y==="number");return Object.entries(Q).filter(([Y,J])=>W.indexOf(+Y)===-1).map(([Y,J])=>J)}function DQ(Q,W="|"){return Q.map(($)=>AQ($)).join(W)}function V4(Q,W){if(typeof W==="bigint")return W.toString();return W}function J9(Q){return{get value(){{let $=Q();return Object.defineProperty(this,"value",{value:$}),$}throw Error("cached value already set")}}}function X9(Q){return Q===null||Q===void 0}function G9(Q){let W=Q.startsWith("^")?1:0,$=Q.endsWith("$")?Q.length-1:Q.length;return Q.slice(W,$)}function q4(Q,W){let $=(Q.toString().split(".")[1]||"").length,Y=(W.toString().split(".")[1]||"").length,J=$>Y?$:Y,X=Number.parseInt(Q.toFixed(J).replace(".","")),G=Number.parseInt(W.toFixed(J).replace(".",""));return X%G/10**J}function K0(Q,W,$){Object.defineProperty(Q,W,{get(){{let J=$();return Q[W]=J,J}throw Error("cached value already set")},set(J){Object.defineProperty(Q,W,{value:J})},configurable:!0})}function L4(Q,W,$){Object.defineProperty(Q,W,{value:$,writable:!0,enumerable:!0,configurable:!0})}function _V(Q,W){if(!W)return Q;return W.reduce(($,Y)=>$?.[Y],Q)}function xV(Q){let W=Object.keys(Q),$=W.map((Y)=>Q[Y]);return Promise.all($).then((Y)=>{let J={};for(let X=0;X<W.length;X++)J[W[X]]=Y[X];return J})}function yV(Q=10){let $="";for(let Y=0;Y<Q;Y++)$+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return $}function C6(Q){return JSON.stringify(Q)}var wQ=Error.captureStackTrace?Error.captureStackTrace:(...Q)=>{};function w8(Q){return typeof Q==="object"&&Q!==null&&!Array.isArray(Q)}var U4=J9(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(Q){return!1}});function A8(Q){if(w8(Q)===!1)return!1;let W=Q.constructor;if(W===void 0)return!0;let $=W.prototype;if(w8($)===!1)return!1;if(Object.prototype.hasOwnProperty.call($,"isPrototypeOf")===!1)return!1;return!0}function gV(Q){let W=0;for(let $ in Q)if(Object.prototype.hasOwnProperty.call(Q,$))W++;return W}var hV=(Q)=>{let W=typeof Q;switch(W){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(Q)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(Q))return"array";if(Q===null)return"null";if(Q.then&&typeof Q.then==="function"&&Q.catch&&typeof Q.catch==="function")return"promise";if(typeof Map<"u"&&Q instanceof Map)return"map";if(typeof Set<"u"&&Q instanceof Set)return"set";if(typeof Date<"u"&&Q instanceof Date)return"date";if(typeof File<"u"&&Q instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${W}`)}},D4=new Set(["string","number","symbol"]),LJ=new Set(["string","number","bigint","boolean","symbol","undefined"]);function J6(Q){return Q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $1(Q,W,$){let Y=new Q._zod.constr(W??Q._zod.def);if(!W||$?.parent)Y._zod.parent=Q;return Y}function f(Q){let W=Q;if(!W)return{};if(typeof W==="string")return{error:()=>W};if(W?.message!==void 0){if(W?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");W.error=W.message}if(delete W.message,typeof W.error==="string")return{...W,error:()=>W.error};return W}function fV(Q){let W;return new Proxy({},{get($,Y,J){return W??(W=Q()),Reflect.get(W,Y,J)},set($,Y,J,X){return W??(W=Q()),Reflect.set(W,Y,J,X)},has($,Y){return W??(W=Q()),Reflect.has(W,Y)},deleteProperty($,Y){return W??(W=Q()),Reflect.deleteProperty(W,Y)},ownKeys($){return W??(W=Q()),Reflect.ownKeys(W)},getOwnPropertyDescriptor($,Y){return W??(W=Q()),Reflect.getOwnPropertyDescriptor(W,Y)},defineProperty($,Y,J){return W??(W=Q()),Reflect.defineProperty(W,Y,J)}})}function AQ(Q){if(typeof Q==="bigint")return Q.toString()+"n";if(typeof Q==="string")return`"${Q}"`;return`${Q}`}function w4(Q){return Object.keys(Q).filter((W)=>{return Q[W]._zod.optin==="optional"&&Q[W]._zod.optout==="optional"})}var A4={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-340282346638528860000000000000000000000,340282346638528860000000000000000000000],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},UJ={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function uV(Q,W){let $={},Y=Q._zod.def;for(let J in W){if(!(J in Y.shape))throw Error(`Unrecognized key: "${J}"`);if(!W[J])continue;$[J]=Y.shape[J]}return $1(Q,{...Q._zod.def,shape:$,checks:[]})}function lV(Q,W){let $={...Q._zod.def.shape},Y=Q._zod.def;for(let J in W){if(!(J in Y.shape))throw Error(`Unrecognized key: "${J}"`);if(!W[J])continue;delete $[J]}return $1(Q,{...Q._zod.def,shape:$,checks:[]})}function mV(Q,W){if(!A8(W))throw Error("Invalid input to extend: expected a plain object");let $={...Q._zod.def,get shape(){let Y={...Q._zod.def.shape,...W};return L4(this,"shape",Y),Y},checks:[]};return $1(Q,$)}function cV(Q,W){return $1(Q,{...Q._zod.def,get shape(){let $={...Q._zod.def.shape,...W._zod.def.shape};return L4(this,"shape",$),$},catchall:W._zod.def.catchall,checks:[]})}function pV(Q,W,$){let Y=W._zod.def.shape,J={...Y};if($)for(let X in $){if(!(X in Y))throw Error(`Unrecognized key: "${X}"`);if(!$[X])continue;J[X]=Q?new Q({type:"optional",innerType:Y[X]}):Y[X]}else for(let X in Y)J[X]=Q?new Q({type:"optional",innerType:Y[X]}):Y[X];return $1(W,{...W._zod.def,shape:J,checks:[]})}function dV(Q,W,$){let Y=W._zod.def.shape,J={...Y};if($)for(let X in $){if(!(X in J))throw Error(`Unrecognized key: "${X}"`);if(!$[X])continue;J[X]=new Q({type:"nonoptional",innerType:Y[X]})}else for(let X in Y)J[X]=new Q({type:"nonoptional",innerType:Y[X]});return $1(W,{...W._zod.def,shape:J,checks:[]})}function v6(Q,W=0){for(let $=W;$<Q.issues.length;$++)if(Q.issues[$]?.continue!==!0)return!0;return!1}function v1(Q,W){return W.map(($)=>{var Y;return(Y=$).path??(Y.path=[]),$.path.unshift(Q),$})}function $9(Q){return typeof Q==="string"?Q:Q?.message}function O1(Q,W,$){let Y={...Q,path:Q.path??[]};if(!Q.message){let J=$9(Q.inst?._zod.def?.error?.(Q))??$9(W?.error?.(Q))??$9($.customError?.(Q))??$9($.localeError?.(Q))??"Invalid input";Y.message=J}if(delete Y.inst,delete Y.continue,!W?.reportInput)delete Y.input;return Y}function DJ(Q){if(Q instanceof Set)return"set";if(Q instanceof Map)return"map";if(Q instanceof File)return"file";return"unknown"}function H9(Q){if(Array.isArray(Q))return"array";if(typeof Q==="string")return"string";return"unknown"}function O4(...Q){let[W,$,Y]=Q;if(typeof W==="string")return{message:W,code:"custom",input:$,inst:Y};return{...W}}function iV(Q){return Object.entries(Q).filter(([W,$])=>{return Number.isNaN(Number.parseInt(W,10))}).map((W)=>W[1])}class wJ{constructor(...Q){}}var AJ=(Q,W)=>{Q.name="$ZodError",Object.defineProperty(Q,"_zod",{value:Q._zod,enumerable:!1}),Object.defineProperty(Q,"issues",{value:W,enumerable:!1}),Object.defineProperty(Q,"message",{get(){return JSON.stringify(W,V4,2)},enumerable:!0}),Object.defineProperty(Q,"toString",{value:()=>Q.message,enumerable:!1})},OQ=M("$ZodError",AJ),B9=M("$ZodError",AJ,{Parent:Error});function N4(Q,W=($)=>$.message){let $={},Y=[];for(let J of Q.issues)if(J.path.length>0)$[J.path[0]]=$[J.path[0]]||[],$[J.path[0]].push(W(J));else Y.push(W(J));return{formErrors:Y,fieldErrors:$}}function M4(Q,W){let $=W||function(X){return X.message},Y={_errors:[]},J=(X)=>{for(let G of X.issues)if(G.code==="invalid_union"&&G.errors.length)G.errors.map((H)=>J({issues:H}));else if(G.code==="invalid_key")J({issues:G.issues});else if(G.code==="invalid_element")J({issues:G.issues});else if(G.path.length===0)Y._errors.push($(G));else{let H=Y,B=0;while(B<G.path.length){let K=G.path[B];if(B!==G.path.length-1)H[K]=H[K]||{_errors:[]};else H[K]=H[K]||{_errors:[]},H[K]._errors.push($(G));H=H[K],B++}}};return J(Q),Y}var j4=(Q)=>(W,$,Y,J)=>{let X=Y?Object.assign(Y,{async:!1}):{async:!1},G=W._zod.run({value:$,issues:[]},X);if(G instanceof Promise)throw new Y6;if(G.issues.length){let H=new(J?.Err??Q)(G.issues.map((B)=>O1(B,X,W1())));throw wQ(H,J?.callee),H}return G.value},z4=j4(B9),P4=(Q)=>async(W,$,Y,J)=>{let X=Y?Object.assign(Y,{async:!0}):{async:!0},G=W._zod.run({value:$,issues:[]},X);if(G instanceof Promise)G=await G;if(G.issues.length){let H=new(J?.Err??Q)(G.issues.map((B)=>O1(B,X,W1())));throw wQ(H,J?.callee),H}return G.value},E4=P4(B9),R4=(Q)=>(W,$,Y)=>{let J=Y?{...Y,async:!1}:{async:!1},X=W._zod.run({value:$,issues:[]},J);if(X instanceof Promise)throw new Y6;return X.issues.length?{success:!1,error:new(Q??OQ)(X.issues.map((G)=>O1(G,J,W1())))}:{success:!0,data:X.value}},k6=R4(B9),I4=(Q)=>async(W,$,Y)=>{let J=Y?Object.assign(Y,{async:!0}):{async:!0},X=W._zod.run({value:$,issues:[]},J);if(X instanceof Promise)X=await X;return X.issues.length?{success:!1,error:new Q(X.issues.map((G)=>O1(G,J,W1())))}:{success:!0,data:X.value}},T6=I4(B9);var OJ=/^[cC][^\s-]{8,}$/,NJ=/^[0-9a-z]+$/,MJ=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,jJ=/^[0-9a-vA-V]{20}$/,zJ=/^[A-Za-z0-9]{27}$/,PJ=/^[a-zA-Z0-9_-]{21}$/,EJ=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var RJ=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,b4=(Q)=>{if(!Q)return/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${Q}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`)};var IJ=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function bJ(){return new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}var SJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ZJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,CJ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,vJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,kJ=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,S4=/^[A-Za-z0-9_-]*$/,TJ=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/;var _J=/^\+(?:[0-9]){6,14}[0-9]$/,xJ="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",yJ=new RegExp(`^${xJ}$`);function gJ(Q){return typeof Q.precision==="number"?Q.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":Q.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${Q.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function hJ(Q){return new RegExp(`^${gJ(Q)}$`)}function fJ(Q){let W=gJ({precision:Q.precision}),$=["Z"];if(Q.local)$.push("");if(Q.offset)$.push("([+-]\\d{2}:\\d{2})");let Y=`${W}(?:${$.join("|")})`;return new RegExp(`^${xJ}T(?:${Y})$`)}var uJ=(Q)=>{let W=Q?`[\\s\\S]{${Q?.minimum??0},${Q?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${W}$`)};var lJ=/^\d+$/,mJ=/^-?\d+(?:\.\d+)?/i,cJ=/true|false/i,pJ=/null/i;var dJ=/^[^A-Z]*$/,iJ=/^[^a-z]*$/;var Z0=M("$ZodCheck",(Q,W)=>{var $;Q._zod??(Q._zod={}),Q._zod.def=W,($=Q._zod).onattach??($.onattach=[])}),nJ={number:"number",bigint:"bigint",object:"date"},Z4=M("$ZodCheckLessThan",(Q,W)=>{Z0.init(Q,W);let $=nJ[typeof W.value];Q._zod.onattach.push((Y)=>{let J=Y._zod.bag,X=(W.inclusive?J.maximum:J.exclusiveMaximum)??Number.POSITIVE_INFINITY;if(W.value<X)if(W.inclusive)J.maximum=W.value;else J.exclusiveMaximum=W.value}),Q._zod.check=(Y)=>{if(W.inclusive?Y.value<=W.value:Y.value<W.value)return;Y.issues.push({origin:$,code:"too_big",maximum:W.value,input:Y.value,inclusive:W.inclusive,inst:Q,continue:!W.abort})}}),C4=M("$ZodCheckGreaterThan",(Q,W)=>{Z0.init(Q,W);let $=nJ[typeof W.value];Q._zod.onattach.push((Y)=>{let J=Y._zod.bag,X=(W.inclusive?J.minimum:J.exclusiveMinimum)??Number.NEGATIVE_INFINITY;if(W.value>X)if(W.inclusive)J.minimum=W.value;else J.exclusiveMinimum=W.value}),Q._zod.check=(Y)=>{if(W.inclusive?Y.value>=W.value:Y.value>W.value)return;Y.issues.push({origin:$,code:"too_small",minimum:W.value,input:Y.value,inclusive:W.inclusive,inst:Q,continue:!W.abort})}}),oJ=M("$ZodCheckMultipleOf",(Q,W)=>{Z0.init(Q,W),Q._zod.onattach.push(($)=>{var Y;(Y=$._zod.bag).multipleOf??(Y.multipleOf=W.value)}),Q._zod.check=($)=>{if(typeof $.value!==typeof W.value)throw Error("Cannot mix number and bigint in multiple_of check.");if(typeof $.value==="bigint"?$.value%W.value===BigInt(0):q4($.value,W.value)===0)return;$.issues.push({origin:typeof $.value,code:"not_multiple_of",divisor:W.value,input:$.value,inst:Q,continue:!W.abort})}}),rJ=M("$ZodCheckNumberFormat",(Q,W)=>{Z0.init(Q,W),W.format=W.format||"float64";let $=W.format?.includes("int"),Y=$?"int":"number",[J,X]=A4[W.format];Q._zod.onattach.push((G)=>{let H=G._zod.bag;if(H.format=W.format,H.minimum=J,H.maximum=X,$)H.pattern=lJ}),Q._zod.check=(G)=>{let H=G.value;if($){if(!Number.isInteger(H)){G.issues.push({expected:Y,format:W.format,code:"invalid_type",input:H,inst:Q});return}if(!Number.isSafeInteger(H)){if(H>0)G.issues.push({input:H,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Q,origin:Y,continue:!W.abort});else G.issues.push({input:H,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Q,origin:Y,continue:!W.abort});return}}if(H<J)G.issues.push({origin:"number",input:H,code:"too_small",minimum:J,inclusive:!0,inst:Q,continue:!W.abort});if(H>X)G.issues.push({origin:"number",input:H,code:"too_big",maximum:X,inst:Q})}});var aJ=M("$ZodCheckMaxLength",(Q,W)=>{var $;Z0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!X9(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag.maximum??Number.POSITIVE_INFINITY;if(W.maximum<J)Y._zod.bag.maximum=W.maximum}),Q._zod.check=(Y)=>{let J=Y.value;if(J.length<=W.maximum)return;let G=H9(J);Y.issues.push({origin:G,code:"too_big",maximum:W.maximum,inclusive:!0,input:J,inst:Q,continue:!W.abort})}}),tJ=M("$ZodCheckMinLength",(Q,W)=>{var $;Z0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!X9(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag.minimum??Number.NEGATIVE_INFINITY;if(W.minimum>J)Y._zod.bag.minimum=W.minimum}),Q._zod.check=(Y)=>{let J=Y.value;if(J.length>=W.minimum)return;let G=H9(J);Y.issues.push({origin:G,code:"too_small",minimum:W.minimum,inclusive:!0,input:J,inst:Q,continue:!W.abort})}}),sJ=M("$ZodCheckLengthEquals",(Q,W)=>{var $;Z0.init(Q,W),($=Q._zod.def).when??($.when=(Y)=>{let J=Y.value;return!X9(J)&&J.length!==void 0}),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.minimum=W.length,J.maximum=W.length,J.length=W.length}),Q._zod.check=(Y)=>{let J=Y.value,X=J.length;if(X===W.length)return;let G=H9(J),H=X>W.length;Y.issues.push({origin:G,...H?{code:"too_big",maximum:W.length}:{code:"too_small",minimum:W.length},inclusive:!0,exact:!0,input:Y.value,inst:Q,continue:!W.abort})}}),K9=M("$ZodCheckStringFormat",(Q,W)=>{var $,Y;if(Z0.init(Q,W),Q._zod.onattach.push((J)=>{let X=J._zod.bag;if(X.format=W.format,W.pattern)X.patterns??(X.patterns=new Set),X.patterns.add(W.pattern)}),W.pattern)($=Q._zod).check??($.check=(J)=>{if(W.pattern.lastIndex=0,W.pattern.test(J.value))return;J.issues.push({origin:"string",code:"invalid_format",format:W.format,input:J.value,...W.pattern?{pattern:W.pattern.toString()}:{},inst:Q,continue:!W.abort})});else(Y=Q._zod).check??(Y.check=()=>{})}),eJ=M("$ZodCheckRegex",(Q,W)=>{K9.init(Q,W),Q._zod.check=($)=>{if(W.pattern.lastIndex=0,W.pattern.test($.value))return;$.issues.push({origin:"string",code:"invalid_format",format:"regex",input:$.value,pattern:W.pattern.toString(),inst:Q,continue:!W.abort})}}),QX=M("$ZodCheckLowerCase",(Q,W)=>{W.pattern??(W.pattern=dJ),K9.init(Q,W)}),WX=M("$ZodCheckUpperCase",(Q,W)=>{W.pattern??(W.pattern=iJ),K9.init(Q,W)}),$X=M("$ZodCheckIncludes",(Q,W)=>{Z0.init(Q,W);let $=J6(W.includes),Y=new RegExp(typeof W.position==="number"?`^.{${W.position}}${$}`:$);W.pattern=Y,Q._zod.onattach.push((J)=>{let X=J._zod.bag;X.patterns??(X.patterns=new Set),X.patterns.add(Y)}),Q._zod.check=(J)=>{if(J.value.includes(W.includes,W.position))return;J.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:W.includes,input:J.value,inst:Q,continue:!W.abort})}}),YX=M("$ZodCheckStartsWith",(Q,W)=>{Z0.init(Q,W);let $=new RegExp(`^${J6(W.prefix)}.*`);W.pattern??(W.pattern=$),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add($)}),Q._zod.check=(Y)=>{if(Y.value.startsWith(W.prefix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:W.prefix,input:Y.value,inst:Q,continue:!W.abort})}}),JX=M("$ZodCheckEndsWith",(Q,W)=>{Z0.init(Q,W);let $=new RegExp(`.*${J6(W.suffix)}$`);W.pattern??(W.pattern=$),Q._zod.onattach.push((Y)=>{let J=Y._zod.bag;J.patterns??(J.patterns=new Set),J.patterns.add($)}),Q._zod.check=(Y)=>{if(Y.value.endsWith(W.suffix))return;Y.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:W.suffix,input:Y.value,inst:Q,continue:!W.abort})}});var XX=M("$ZodCheckOverwrite",(Q,W)=>{Z0.init(Q,W),Q._zod.check=($)=>{$.value=W.tx($.value)}});class v4{constructor(Q=[]){if(this.content=[],this.indent=0,this)this.args=Q}indented(Q){this.indent+=1,Q(this),this.indent-=1}write(Q){if(typeof Q==="function"){Q(this,{execution:"sync"}),Q(this,{execution:"async"});return}let $=Q.split(`
`).filter((X)=>X),Y=Math.min(...$.map((X)=>X.length-X.trimStart().length)),J=$.map((X)=>X.slice(Y)).map((X)=>" ".repeat(this.indent*2)+X);for(let X of J)this.content.push(X)}compile(){let Q=Function,W=this?.args,Y=[...(this?.content??[""]).map((J)=>`  ${J}`)];return new Q(...W,Y.join(`
`))}}var HX={major:4,minor:0,patch:0};var X0=M("$ZodType",(Q,W)=>{var $;Q??(Q={}),Q._zod.def=W,Q._zod.bag=Q._zod.bag||{},Q._zod.version=HX;let Y=[...Q._zod.def.checks??[]];if(Q._zod.traits.has("$ZodCheck"))Y.unshift(Q);for(let J of Y)for(let X of J._zod.onattach)X(Q);if(Y.length===0)($=Q._zod).deferred??($.deferred=[]),Q._zod.deferred?.push(()=>{Q._zod.run=Q._zod.parse});else{let J=(X,G,H)=>{let B=v6(X),K;for(let F of G){if(F._zod.def.when){if(!F._zod.def.when(X))continue}else if(B)continue;let q=X.issues.length,U=F._zod.check(X);if(U instanceof Promise&&H?.async===!1)throw new Y6;if(K||U instanceof Promise)K=(K??Promise.resolve()).then(async()=>{if(await U,X.issues.length===q)return;if(!B)B=v6(X,q)});else{if(X.issues.length===q)continue;if(!B)B=v6(X,q)}}if(K)return K.then(()=>{return X});return X};Q._zod.run=(X,G)=>{let H=Q._zod.parse(X,G);if(H instanceof Promise){if(G.async===!1)throw new Y6;return H.then((B)=>J(B,Y,G))}return J(H,Y,G)}}Q["~standard"]={validate:(J)=>{try{let X=k6(Q,J);return X.success?{value:X.data}:{issues:X.error?.issues}}catch(X){return T6(Q,J).then((G)=>G.success?{value:G.data}:{issues:G.error?.issues})}},vendor:"zod",version:1}}),F9=M("$ZodString",(Q,W)=>{X0.init(Q,W),Q._zod.pattern=[...Q?._zod.bag?.patterns??[]].pop()??uJ(Q._zod.bag),Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=String($.value)}catch(J){}if(typeof $.value==="string")return $;return $.issues.push({expected:"string",code:"invalid_type",input:$.value,inst:Q}),$}}),F0=M("$ZodStringFormat",(Q,W)=>{K9.init(Q,W),F9.init(Q,W)}),T4=M("$ZodGUID",(Q,W)=>{W.pattern??(W.pattern=RJ),F0.init(Q,W)}),_4=M("$ZodUUID",(Q,W)=>{if(W.version){let Y={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[W.version];if(Y===void 0)throw Error(`Invalid UUID version: "${W.version}"`);W.pattern??(W.pattern=b4(Y))}else W.pattern??(W.pattern=b4());F0.init(Q,W)}),x4=M("$ZodEmail",(Q,W)=>{W.pattern??(W.pattern=IJ),F0.init(Q,W)}),y4=M("$ZodURL",(Q,W)=>{F0.init(Q,W),Q._zod.check=($)=>{try{let Y=$.value,J=new URL(Y),X=J.href;if(W.hostname){if(W.hostname.lastIndex=0,!W.hostname.test(J.hostname))$.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:TJ.source,input:$.value,inst:Q,continue:!W.abort})}if(W.protocol){if(W.protocol.lastIndex=0,!W.protocol.test(J.protocol.endsWith(":")?J.protocol.slice(0,-1):J.protocol))$.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:W.protocol.source,input:$.value,inst:Q,continue:!W.abort})}if(!Y.endsWith("/")&&X.endsWith("/"))$.value=X.slice(0,-1);else $.value=X;return}catch(Y){$.issues.push({code:"invalid_format",format:"url",input:$.value,inst:Q,continue:!W.abort})}}}),g4=M("$ZodEmoji",(Q,W)=>{W.pattern??(W.pattern=bJ()),F0.init(Q,W)}),h4=M("$ZodNanoID",(Q,W)=>{W.pattern??(W.pattern=PJ),F0.init(Q,W)}),f4=M("$ZodCUID",(Q,W)=>{W.pattern??(W.pattern=OJ),F0.init(Q,W)}),u4=M("$ZodCUID2",(Q,W)=>{W.pattern??(W.pattern=NJ),F0.init(Q,W)}),l4=M("$ZodULID",(Q,W)=>{W.pattern??(W.pattern=MJ),F0.init(Q,W)}),m4=M("$ZodXID",(Q,W)=>{W.pattern??(W.pattern=jJ),F0.init(Q,W)}),c4=M("$ZodKSUID",(Q,W)=>{W.pattern??(W.pattern=zJ),F0.init(Q,W)}),AX=M("$ZodISODateTime",(Q,W)=>{W.pattern??(W.pattern=fJ(W)),F0.init(Q,W)}),OX=M("$ZodISODate",(Q,W)=>{W.pattern??(W.pattern=yJ),F0.init(Q,W)}),NX=M("$ZodISOTime",(Q,W)=>{W.pattern??(W.pattern=hJ(W)),F0.init(Q,W)}),MX=M("$ZodISODuration",(Q,W)=>{W.pattern??(W.pattern=EJ),F0.init(Q,W)}),p4=M("$ZodIPv4",(Q,W)=>{W.pattern??(W.pattern=SJ),F0.init(Q,W),Q._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv4"})}),d4=M("$ZodIPv6",(Q,W)=>{W.pattern??(W.pattern=ZJ),F0.init(Q,W),Q._zod.onattach.push(($)=>{let Y=$._zod.bag;Y.format="ipv6"}),Q._zod.check=($)=>{try{new URL(`http://[${$.value}]`)}catch{$.issues.push({code:"invalid_format",format:"ipv6",input:$.value,inst:Q,continue:!W.abort})}}}),i4=M("$ZodCIDRv4",(Q,W)=>{W.pattern??(W.pattern=CJ),F0.init(Q,W)}),n4=M("$ZodCIDRv6",(Q,W)=>{W.pattern??(W.pattern=vJ),F0.init(Q,W),Q._zod.check=($)=>{let[Y,J]=$.value.split("/");try{if(!J)throw Error();let X=Number(J);if(`${X}`!==J)throw Error();if(X<0||X>128)throw Error();new URL(`http://[${Y}]`)}catch{$.issues.push({code:"invalid_format",format:"cidrv6",input:$.value,inst:Q,continue:!W.abort})}}});function jX(Q){if(Q==="")return!0;if(Q.length%4!==0)return!1;try{return atob(Q),!0}catch{return!1}}var o4=M("$ZodBase64",(Q,W)=>{W.pattern??(W.pattern=kJ),F0.init(Q,W),Q._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64"}),Q._zod.check=($)=>{if(jX($.value))return;$.issues.push({code:"invalid_format",format:"base64",input:$.value,inst:Q,continue:!W.abort})}});function oV(Q){if(!S4.test(Q))return!1;let W=Q.replace(/[-_]/g,(Y)=>Y==="-"?"+":"/"),$=W.padEnd(Math.ceil(W.length/4)*4,"=");return jX($)}var r4=M("$ZodBase64URL",(Q,W)=>{W.pattern??(W.pattern=S4),F0.init(Q,W),Q._zod.onattach.push(($)=>{$._zod.bag.contentEncoding="base64url"}),Q._zod.check=($)=>{if(oV($.value))return;$.issues.push({code:"invalid_format",format:"base64url",input:$.value,inst:Q,continue:!W.abort})}}),a4=M("$ZodE164",(Q,W)=>{W.pattern??(W.pattern=_J),F0.init(Q,W)});function rV(Q,W=null){try{let $=Q.split(".");if($.length!==3)return!1;let[Y]=$;if(!Y)return!1;let J=JSON.parse(atob(Y));if("typ"in J&&J?.typ!=="JWT")return!1;if(!J.alg)return!1;if(W&&(!("alg"in J)||J.alg!==W))return!1;return!0}catch{return!1}}var t4=M("$ZodJWT",(Q,W)=>{F0.init(Q,W),Q._zod.check=($)=>{if(rV($.value,W.alg))return;$.issues.push({code:"invalid_format",format:"jwt",input:$.value,inst:Q,continue:!W.abort})}});var jQ=M("$ZodNumber",(Q,W)=>{X0.init(Q,W),Q._zod.pattern=Q._zod.bag.pattern??mJ,Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=Number($.value)}catch(G){}let J=$.value;if(typeof J==="number"&&!Number.isNaN(J)&&Number.isFinite(J))return $;let X=typeof J==="number"?Number.isNaN(J)?"NaN":!Number.isFinite(J)?"Infinity":void 0:void 0;return $.issues.push({expected:"number",code:"invalid_type",input:J,inst:Q,...X?{received:X}:{}}),$}}),s4=M("$ZodNumber",(Q,W)=>{rJ.init(Q,W),jQ.init(Q,W)}),e4=M("$ZodBoolean",(Q,W)=>{X0.init(Q,W),Q._zod.pattern=cJ,Q._zod.parse=($,Y)=>{if(W.coerce)try{$.value=Boolean($.value)}catch(X){}let J=$.value;if(typeof J==="boolean")return $;return $.issues.push({expected:"boolean",code:"invalid_type",input:J,inst:Q}),$}});var Q5=M("$ZodNull",(Q,W)=>{X0.init(Q,W),Q._zod.pattern=pJ,Q._zod.values=new Set([null]),Q._zod.parse=($,Y)=>{let J=$.value;if(J===null)return $;return $.issues.push({expected:"null",code:"invalid_type",input:J,inst:Q}),$}});var W5=M("$ZodUnknown",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($)=>$}),$5=M("$ZodNever",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($,Y)=>{return $.issues.push({expected:"never",code:"invalid_type",input:$.value,inst:Q}),$}});function BX(Q,W,$){if(Q.issues.length)W.issues.push(...v1($,Q.issues));W.value[$]=Q.value}var Y5=M("$ZodArray",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value;if(!Array.isArray(J))return $.issues.push({expected:"array",code:"invalid_type",input:J,inst:Q}),$;$.value=Array(J.length);let X=[];for(let G=0;G<J.length;G++){let H=J[G],B=W.element._zod.run({value:H,issues:[]},Y);if(B instanceof Promise)X.push(B.then((K)=>BX(K,$,G)));else BX(B,$,G)}if(X.length)return Promise.all(X).then(()=>$);return $}});function MQ(Q,W,$){if(Q.issues.length)W.issues.push(...v1($,Q.issues));W.value[$]=Q.value}function KX(Q,W,$,Y){if(Q.issues.length)if(Y[$]===void 0)if($ in Y)W.value[$]=void 0;else W.value[$]=Q.value;else W.issues.push(...v1($,Q.issues));else if(Q.value===void 0){if($ in Y)W.value[$]=void 0}else W.value[$]=Q.value}var zQ=M("$ZodObject",(Q,W)=>{X0.init(Q,W);let $=J9(()=>{let q=Object.keys(W.shape);for(let L of q)if(!(W.shape[L]instanceof X0))throw Error(`Invalid element at key "${L}": expected a Zod schema`);let U=w4(W.shape);return{shape:W.shape,keys:q,keySet:new Set(q),numKeys:q.length,optionalKeys:new Set(U)}});K0(Q._zod,"propValues",()=>{let q=W.shape,U={};for(let L in q){let D=q[L]._zod;if(D.values){U[L]??(U[L]=new Set);for(let w of D.values)U[L].add(w)}}return U});let Y=(q)=>{let U=new v4(["shape","payload","ctx"]),L=$.value,D=(j)=>{let z=C6(j);return`shape[${z}]._zod.run({ value: input[${z}], issues: [] }, ctx)`};U.write("const input = payload.value;");let w=Object.create(null),A=0;for(let j of L.keys)w[j]=`key_${A++}`;U.write("const newResult = {}");for(let j of L.keys)if(L.optionalKeys.has(j)){let z=w[j];U.write(`const ${z} = ${D(j)};`);let S=C6(j);U.write(`
        if (${z}.issues.length) {
          if (input[${S}] === undefined) {
            if (${S} in input) {
              newResult[${S}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${z}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${S}, ...iss.path] : [${S}],
              }))
            );
          }
        } else if (${z}.value === undefined) {
          if (${S} in input) newResult[${S}] = undefined;
        } else {
          newResult[${S}] = ${z}.value;
        }
        `)}else{let z=w[j];U.write(`const ${z} = ${D(j)};`),U.write(`
          if (${z}.issues.length) payload.issues = payload.issues.concat(${z}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${C6(j)}, ...iss.path] : [${C6(j)}]
          })));`),U.write(`newResult[${C6(j)}] = ${z}.value`)}U.write("payload.value = newResult;"),U.write("return payload;");let O=U.compile();return(j,z)=>O(q,j,z)},J,X=w8,G=!UQ.jitless,B=G&&U4.value,K=W.catchall,F;Q._zod.parse=(q,U)=>{F??(F=$.value);let L=q.value;if(!X(L))return q.issues.push({expected:"object",code:"invalid_type",input:L,inst:Q}),q;let D=[];if(G&&B&&U?.async===!1&&U.jitless!==!0){if(!J)J=Y(W.shape);q=J(q,U)}else{q.value={};let z=F.shape;for(let S of F.keys){let Z=z[S],O0=Z._zod.run({value:L[S],issues:[]},U),I0=Z._zod.optin==="optional"&&Z._zod.optout==="optional";if(O0 instanceof Promise)D.push(O0.then((b1)=>I0?KX(b1,q,S,L):MQ(b1,q,S)));else if(I0)KX(O0,q,S,L);else MQ(O0,q,S)}}if(!K)return D.length?Promise.all(D).then(()=>q):q;let w=[],A=F.keySet,O=K._zod,j=O.def.type;for(let z of Object.keys(L)){if(A.has(z))continue;if(j==="never"){w.push(z);continue}let S=O.run({value:L[z],issues:[]},U);if(S instanceof Promise)D.push(S.then((Z)=>MQ(Z,q,z)));else MQ(S,q,z)}if(w.length)q.issues.push({code:"unrecognized_keys",keys:w,input:L,inst:Q});if(!D.length)return q;return Promise.all(D).then(()=>{return q})}});function FX(Q,W,$,Y){for(let J of Q)if(J.issues.length===0)return W.value=J.value,W;return W.issues.push({code:"invalid_union",input:W.value,inst:$,errors:Q.map((J)=>J.issues.map((X)=>O1(X,Y,W1())))}),W}var PQ=M("$ZodUnion",(Q,W)=>{X0.init(Q,W),K0(Q._zod,"optin",()=>W.options.some(($)=>$._zod.optin==="optional")?"optional":void 0),K0(Q._zod,"optout",()=>W.options.some(($)=>$._zod.optout==="optional")?"optional":void 0),K0(Q._zod,"values",()=>{if(W.options.every(($)=>$._zod.values))return new Set(W.options.flatMap(($)=>Array.from($._zod.values)));return}),K0(Q._zod,"pattern",()=>{if(W.options.every(($)=>$._zod.pattern)){let $=W.options.map((Y)=>Y._zod.pattern);return new RegExp(`^(${$.map((Y)=>G9(Y.source)).join("|")})$`)}return}),Q._zod.parse=($,Y)=>{let J=!1,X=[];for(let G of W.options){let H=G._zod.run({value:$.value,issues:[]},Y);if(H instanceof Promise)X.push(H),J=!0;else{if(H.issues.length===0)return H;X.push(H)}}if(!J)return FX(X,$,Q,Y);return Promise.all(X).then((G)=>{return FX(G,$,Q,Y)})}}),J5=M("$ZodDiscriminatedUnion",(Q,W)=>{PQ.init(Q,W);let $=Q._zod.parse;K0(Q._zod,"propValues",()=>{let J={};for(let X of W.options){let G=X._zod.propValues;if(!G||Object.keys(G).length===0)throw Error(`Invalid discriminated union option at index "${W.options.indexOf(X)}"`);for(let[H,B]of Object.entries(G)){if(!J[H])J[H]=new Set;for(let K of B)J[H].add(K)}}return J});let Y=J9(()=>{let J=W.options,X=new Map;for(let G of J){let H=G._zod.propValues[W.discriminator];if(!H||H.size===0)throw Error(`Invalid discriminated union option at index "${W.options.indexOf(G)}"`);for(let B of H){if(X.has(B))throw Error(`Duplicate discriminator value "${String(B)}"`);X.set(B,G)}}return X});Q._zod.parse=(J,X)=>{let G=J.value;if(!w8(G))return J.issues.push({code:"invalid_type",expected:"object",input:G,inst:Q}),J;let H=Y.value.get(G?.[W.discriminator]);if(H)return H._zod.run(J,X);if(W.unionFallback)return $(J,X);return J.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:G,path:[W.discriminator],inst:Q}),J}}),X5=M("$ZodIntersection",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value,X=W.left._zod.run({value:J,issues:[]},Y),G=W.right._zod.run({value:J,issues:[]},Y);if(X instanceof Promise||G instanceof Promise)return Promise.all([X,G]).then(([B,K])=>{return VX($,B,K)});return VX($,X,G)}});function k4(Q,W){if(Q===W)return{valid:!0,data:Q};if(Q instanceof Date&&W instanceof Date&&+Q===+W)return{valid:!0,data:Q};if(A8(Q)&&A8(W)){let $=Object.keys(W),Y=Object.keys(Q).filter((X)=>$.indexOf(X)!==-1),J={...Q,...W};for(let X of Y){let G=k4(Q[X],W[X]);if(!G.valid)return{valid:!1,mergeErrorPath:[X,...G.mergeErrorPath]};J[X]=G.data}return{valid:!0,data:J}}if(Array.isArray(Q)&&Array.isArray(W)){if(Q.length!==W.length)return{valid:!1,mergeErrorPath:[]};let $=[];for(let Y=0;Y<Q.length;Y++){let J=Q[Y],X=W[Y],G=k4(J,X);if(!G.valid)return{valid:!1,mergeErrorPath:[Y,...G.mergeErrorPath]};$.push(G.data)}return{valid:!0,data:$}}return{valid:!1,mergeErrorPath:[]}}function VX(Q,W,$){if(W.issues.length)Q.issues.push(...W.issues);if($.issues.length)Q.issues.push(...$.issues);if(v6(Q))return Q;let Y=k4(W.value,$.value);if(!Y.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(Y.mergeErrorPath)}`);return Q.value=Y.data,Q}var G5=M("$ZodRecord",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($,Y)=>{let J=$.value;if(!A8(J))return $.issues.push({expected:"record",code:"invalid_type",input:J,inst:Q}),$;let X=[];if(W.keyType._zod.values){let G=W.keyType._zod.values;$.value={};for(let B of G)if(typeof B==="string"||typeof B==="number"||typeof B==="symbol"){let K=W.valueType._zod.run({value:J[B],issues:[]},Y);if(K instanceof Promise)X.push(K.then((F)=>{if(F.issues.length)$.issues.push(...v1(B,F.issues));$.value[B]=F.value}));else{if(K.issues.length)$.issues.push(...v1(B,K.issues));$.value[B]=K.value}}let H;for(let B in J)if(!G.has(B))H=H??[],H.push(B);if(H&&H.length>0)$.issues.push({code:"unrecognized_keys",input:J,inst:Q,keys:H})}else{$.value={};for(let G of Reflect.ownKeys(J)){if(G==="__proto__")continue;let H=W.keyType._zod.run({value:G,issues:[]},Y);if(H instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(H.issues.length){$.issues.push({origin:"record",code:"invalid_key",issues:H.issues.map((K)=>O1(K,Y,W1())),input:G,path:[G],inst:Q}),$.value[H.value]=H.value;continue}let B=W.valueType._zod.run({value:J[G],issues:[]},Y);if(B instanceof Promise)X.push(B.then((K)=>{if(K.issues.length)$.issues.push(...v1(G,K.issues));$.value[H.value]=K.value}));else{if(B.issues.length)$.issues.push(...v1(G,B.issues));$.value[H.value]=B.value}}}if(X.length)return Promise.all(X).then(()=>$);return $}});var H5=M("$ZodEnum",(Q,W)=>{X0.init(Q,W);let $=Y9(W.entries);Q._zod.values=new Set($),Q._zod.pattern=new RegExp(`^(${$.filter((Y)=>D4.has(typeof Y)).map((Y)=>typeof Y==="string"?J6(Y):Y.toString()).join("|")})$`),Q._zod.parse=(Y,J)=>{let X=Y.value;if(Q._zod.values.has(X))return Y;return Y.issues.push({code:"invalid_value",values:$,input:X,inst:Q}),Y}}),B5=M("$ZodLiteral",(Q,W)=>{X0.init(Q,W),Q._zod.values=new Set(W.values),Q._zod.pattern=new RegExp(`^(${W.values.map(($)=>typeof $==="string"?J6($):$?$.toString():String($)).join("|")})$`),Q._zod.parse=($,Y)=>{let J=$.value;if(Q._zod.values.has(J))return $;return $.issues.push({code:"invalid_value",values:W.values,input:J,inst:Q}),$}});var K5=M("$ZodTransform",(Q,W)=>{X0.init(Q,W),Q._zod.parse=($,Y)=>{let J=W.transform($.value,$);if(Y.async)return(J instanceof Promise?J:Promise.resolve(J)).then((G)=>{return $.value=G,$});if(J instanceof Promise)throw new Y6;return $.value=J,$}}),F5=M("$ZodOptional",(Q,W)=>{X0.init(Q,W),Q._zod.optin="optional",Q._zod.optout="optional",K0(Q._zod,"values",()=>{return W.innerType._zod.values?new Set([...W.innerType._zod.values,void 0]):void 0}),K0(Q._zod,"pattern",()=>{let $=W.innerType._zod.pattern;return $?new RegExp(`^(${G9($.source)})?$`):void 0}),Q._zod.parse=($,Y)=>{if(W.innerType._zod.optin==="optional")return W.innerType._zod.run($,Y);if($.value===void 0)return $;return W.innerType._zod.run($,Y)}}),V5=M("$ZodNullable",(Q,W)=>{X0.init(Q,W),K0(Q._zod,"optin",()=>W.innerType._zod.optin),K0(Q._zod,"optout",()=>W.innerType._zod.optout),K0(Q._zod,"pattern",()=>{let $=W.innerType._zod.pattern;return $?new RegExp(`^(${G9($.source)}|null)$`):void 0}),K0(Q._zod,"values",()=>{return W.innerType._zod.values?new Set([...W.innerType._zod.values,null]):void 0}),Q._zod.parse=($,Y)=>{if($.value===null)return $;return W.innerType._zod.run($,Y)}}),q5=M("$ZodDefault",(Q,W)=>{X0.init(Q,W),Q._zod.optin="optional",K0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{if($.value===void 0)return $.value=W.defaultValue,$;let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>qX(X,W));return qX(J,W)}});function qX(Q,W){if(Q.value===void 0)Q.value=W.defaultValue;return Q}var L5=M("$ZodPrefault",(Q,W)=>{X0.init(Q,W),Q._zod.optin="optional",K0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{if($.value===void 0)$.value=W.defaultValue;return W.innerType._zod.run($,Y)}}),U5=M("$ZodNonOptional",(Q,W)=>{X0.init(Q,W),K0(Q._zod,"values",()=>{let $=W.innerType._zod.values;return $?new Set([...$].filter((Y)=>Y!==void 0)):void 0}),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>LX(X,Q));return LX(J,Q)}});function LX(Q,W){if(!Q.issues.length&&Q.value===void 0)Q.issues.push({code:"invalid_type",expected:"nonoptional",input:Q.value,inst:W});return Q}var D5=M("$ZodCatch",(Q,W)=>{X0.init(Q,W),Q._zod.optin="optional",K0(Q._zod,"optout",()=>W.innerType._zod.optout),K0(Q._zod,"values",()=>W.innerType._zod.values),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>{if($.value=X.value,X.issues.length)$.value=W.catchValue({...$,error:{issues:X.issues.map((G)=>O1(G,Y,W1()))},input:$.value}),$.issues=[];return $});if($.value=J.value,J.issues.length)$.value=W.catchValue({...$,error:{issues:J.issues.map((X)=>O1(X,Y,W1()))},input:$.value}),$.issues=[];return $}});var w5=M("$ZodPipe",(Q,W)=>{X0.init(Q,W),K0(Q._zod,"values",()=>W.in._zod.values),K0(Q._zod,"optin",()=>W.in._zod.optin),K0(Q._zod,"optout",()=>W.out._zod.optout),Q._zod.parse=($,Y)=>{let J=W.in._zod.run($,Y);if(J instanceof Promise)return J.then((X)=>UX(X,W,Y));return UX(J,W,Y)}});function UX(Q,W,$){if(v6(Q))return Q;return W.out._zod.run({value:Q.value,issues:Q.issues},$)}var A5=M("$ZodReadonly",(Q,W)=>{X0.init(Q,W),K0(Q._zod,"propValues",()=>W.innerType._zod.propValues),K0(Q._zod,"values",()=>W.innerType._zod.values),K0(Q._zod,"optin",()=>W.innerType._zod.optin),K0(Q._zod,"optout",()=>W.innerType._zod.optout),Q._zod.parse=($,Y)=>{let J=W.innerType._zod.run($,Y);if(J instanceof Promise)return J.then(DX);return DX(J)}});function DX(Q){return Q.value=Object.freeze(Q.value),Q}var O5=M("$ZodCustom",(Q,W)=>{Z0.init(Q,W),X0.init(Q,W),Q._zod.parse=($,Y)=>{return $},Q._zod.check=($)=>{let Y=$.value,J=W.fn(Y);if(J instanceof Promise)return J.then((X)=>wX(X,$,Y,Q));wX(J,$,Y,Q);return}});function wX(Q,W,$,Y){if(!Q){let J={code:"custom",input:$,inst:Y,path:[...Y._zod.def.path??[]],continue:!Y._zod.def.abort};if(Y._zod.def.params)J.params=Y._zod.def.params;W.issues.push(O4(J))}}var aV=(Q)=>{let W=typeof Q;switch(W){case"number":return Number.isNaN(Q)?"NaN":"number";case"object":{if(Array.isArray(Q))return"array";if(Q===null)return"null";if(Object.getPrototypeOf(Q)!==Object.prototype&&Q.constructor)return Q.constructor.name}}return W},tV=()=>{let Q={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function W(Y){return Q[Y]??null}let $={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return(Y)=>{switch(Y.code){case"invalid_type":return`Invalid input: expected ${Y.expected}, received ${aV(Y.input)}`;case"invalid_value":if(Y.values.length===1)return`Invalid input: expected ${AQ(Y.values[0])}`;return`Invalid option: expected one of ${DQ(Y.values,"|")}`;case"too_big":{let J=Y.inclusive?"<=":"<",X=W(Y.origin);if(X)return`Too big: expected ${Y.origin??"value"} to have ${J}${Y.maximum.toString()} ${X.unit??"elements"}`;return`Too big: expected ${Y.origin??"value"} to be ${J}${Y.maximum.toString()}`}case"too_small":{let J=Y.inclusive?">=":">",X=W(Y.origin);if(X)return`Too small: expected ${Y.origin} to have ${J}${Y.minimum.toString()} ${X.unit}`;return`Too small: expected ${Y.origin} to be ${J}${Y.minimum.toString()}`}case"invalid_format":{let J=Y;if(J.format==="starts_with")return`Invalid string: must start with "${J.prefix}"`;if(J.format==="ends_with")return`Invalid string: must end with "${J.suffix}"`;if(J.format==="includes")return`Invalid string: must include "${J.includes}"`;if(J.format==="regex")return`Invalid string: must match pattern ${J.pattern}`;return`Invalid ${$[J.format]??Y.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${Y.divisor}`;case"unrecognized_keys":return`Unrecognized key${Y.keys.length>1?"s":""}: ${DQ(Y.keys,", ")}`;case"invalid_key":return`Invalid key in ${Y.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${Y.origin}`;default:return"Invalid input"}}};function N5(){return{localeError:tV()}}var sV=Symbol("ZodOutput"),eV=Symbol("ZodInput");class EQ{constructor(){this._map=new Map,this._idmap=new Map}add(Q,...W){let $=W[0];if(this._map.set(Q,$),$&&typeof $==="object"&&"id"in $){if(this._idmap.has($.id))throw Error(`ID ${$.id} already exists in the registry`);this._idmap.set($.id,Q)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(Q){let W=this._map.get(Q);if(W&&typeof W==="object"&&"id"in W)this._idmap.delete(W.id);return this._map.delete(Q),this}get(Q){let W=Q._zod.parent;if(W){let $={...this.get(W)??{}};return delete $.id,{...$,...this._map.get(Q)}}return this._map.get(Q)}has(Q){return this._map.has(Q)}}function zX(){return new EQ}var X6=zX();function M5(Q,W){return new Q({type:"string",...f(W)})}function j5(Q,W){return new Q({type:"string",format:"email",check:"string_format",abort:!1,...f(W)})}function RQ(Q,W){return new Q({type:"string",format:"guid",check:"string_format",abort:!1,...f(W)})}function z5(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,...f(W)})}function P5(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...f(W)})}function E5(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...f(W)})}function R5(Q,W){return new Q({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...f(W)})}function I5(Q,W){return new Q({type:"string",format:"url",check:"string_format",abort:!1,...f(W)})}function b5(Q,W){return new Q({type:"string",format:"emoji",check:"string_format",abort:!1,...f(W)})}function S5(Q,W){return new Q({type:"string",format:"nanoid",check:"string_format",abort:!1,...f(W)})}function Z5(Q,W){return new Q({type:"string",format:"cuid",check:"string_format",abort:!1,...f(W)})}function C5(Q,W){return new Q({type:"string",format:"cuid2",check:"string_format",abort:!1,...f(W)})}function v5(Q,W){return new Q({type:"string",format:"ulid",check:"string_format",abort:!1,...f(W)})}function k5(Q,W){return new Q({type:"string",format:"xid",check:"string_format",abort:!1,...f(W)})}function T5(Q,W){return new Q({type:"string",format:"ksuid",check:"string_format",abort:!1,...f(W)})}function _5(Q,W){return new Q({type:"string",format:"ipv4",check:"string_format",abort:!1,...f(W)})}function x5(Q,W){return new Q({type:"string",format:"ipv6",check:"string_format",abort:!1,...f(W)})}function y5(Q,W){return new Q({type:"string",format:"cidrv4",check:"string_format",abort:!1,...f(W)})}function g5(Q,W){return new Q({type:"string",format:"cidrv6",check:"string_format",abort:!1,...f(W)})}function h5(Q,W){return new Q({type:"string",format:"base64",check:"string_format",abort:!1,...f(W)})}function f5(Q,W){return new Q({type:"string",format:"base64url",check:"string_format",abort:!1,...f(W)})}function u5(Q,W){return new Q({type:"string",format:"e164",check:"string_format",abort:!1,...f(W)})}function l5(Q,W){return new Q({type:"string",format:"jwt",check:"string_format",abort:!1,...f(W)})}function PX(Q,W){return new Q({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...f(W)})}function EX(Q,W){return new Q({type:"string",format:"date",check:"string_format",...f(W)})}function RX(Q,W){return new Q({type:"string",format:"time",check:"string_format",precision:null,...f(W)})}function IX(Q,W){return new Q({type:"string",format:"duration",check:"string_format",...f(W)})}function m5(Q,W){return new Q({type:"number",checks:[],...f(W)})}function c5(Q,W){return new Q({type:"number",check:"number_format",abort:!1,format:"safeint",...f(W)})}function p5(Q,W){return new Q({type:"boolean",...f(W)})}function d5(Q,W){return new Q({type:"null",...f(W)})}function i5(Q){return new Q({type:"unknown"})}function n5(Q,W){return new Q({type:"never",...f(W)})}function IQ(Q,W){return new Z4({check:"less_than",...f(W),value:Q,inclusive:!1})}function V9(Q,W){return new Z4({check:"less_than",...f(W),value:Q,inclusive:!0})}function bQ(Q,W){return new C4({check:"greater_than",...f(W),value:Q,inclusive:!1})}function q9(Q,W){return new C4({check:"greater_than",...f(W),value:Q,inclusive:!0})}function SQ(Q,W){return new oJ({check:"multiple_of",...f(W),value:Q})}function ZQ(Q,W){return new aJ({check:"max_length",...f(W),maximum:Q})}function O8(Q,W){return new tJ({check:"min_length",...f(W),minimum:Q})}function CQ(Q,W){return new sJ({check:"length_equals",...f(W),length:Q})}function o5(Q,W){return new eJ({check:"string_format",format:"regex",...f(W),pattern:Q})}function r5(Q){return new QX({check:"string_format",format:"lowercase",...f(Q)})}function a5(Q){return new WX({check:"string_format",format:"uppercase",...f(Q)})}function t5(Q,W){return new $X({check:"string_format",format:"includes",...f(W),includes:Q})}function s5(Q,W){return new YX({check:"string_format",format:"starts_with",...f(W),prefix:Q})}function e5(Q,W){return new JX({check:"string_format",format:"ends_with",...f(W),suffix:Q})}function _6(Q){return new XX({check:"overwrite",tx:Q})}function Q$(Q){return _6((W)=>W.normalize(Q))}function W$(){return _6((Q)=>Q.trim())}function $$(){return _6((Q)=>Q.toLowerCase())}function Y$(){return _6((Q)=>Q.toUpperCase())}function bX(Q,W,$){return new Q({type:"array",element:W,...f($)})}function J$(Q,W,$){let Y=f($);return Y.abort??(Y.abort=!0),new Q({type:"custom",check:"custom",fn:W,...Y})}function X$(Q,W,$){return new Q({type:"custom",check:"custom",fn:W,...f($)})}class G${constructor(Q){this.counter=0,this.metadataRegistry=Q?.metadata??X6,this.target=Q?.target??"draft-2020-12",this.unrepresentable=Q?.unrepresentable??"throw",this.override=Q?.override??(()=>{}),this.io=Q?.io??"output",this.seen=new Map}process(Q,W={path:[],schemaPath:[]}){var $;let Y=Q._zod.def,J={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},X=this.seen.get(Q);if(X){if(X.count++,W.schemaPath.includes(Q))X.cycle=W.path;return X.schema}let G={schema:{},count:1,cycle:void 0,path:W.path};this.seen.set(Q,G);let H=Q._zod.toJSONSchema?.();if(H)G.schema=H;else{let F={...W,schemaPath:[...W.schemaPath,Q],path:W.path},q=Q._zod.parent;if(q)G.ref=q,this.process(q,F),this.seen.get(q).isParent=!0;else{let U=G.schema;switch(Y.type){case"string":{let L=U;L.type="string";let{minimum:D,maximum:w,format:A,patterns:O,contentEncoding:j}=Q._zod.bag;if(typeof D==="number")L.minLength=D;if(typeof w==="number")L.maxLength=w;if(A){if(L.format=J[A]??A,L.format==="")delete L.format}if(j)L.contentEncoding=j;if(O&&O.size>0){let z=[...O];if(z.length===1)L.pattern=z[0].source;else if(z.length>1)G.schema.allOf=[...z.map((S)=>({...this.target==="draft-7"?{type:"string"}:{},pattern:S.source}))]}break}case"number":{let L=U,{minimum:D,maximum:w,format:A,multipleOf:O,exclusiveMaximum:j,exclusiveMinimum:z}=Q._zod.bag;if(typeof A==="string"&&A.includes("int"))L.type="integer";else L.type="number";if(typeof z==="number")L.exclusiveMinimum=z;if(typeof D==="number"){if(L.minimum=D,typeof z==="number")if(z>=D)delete L.minimum;else delete L.exclusiveMinimum}if(typeof j==="number")L.exclusiveMaximum=j;if(typeof w==="number"){if(L.maximum=w,typeof j==="number")if(j<=w)delete L.maximum;else delete L.exclusiveMaximum}if(typeof O==="number")L.multipleOf=O;break}case"boolean":{let L=U;L.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw Error("Symbols cannot be represented in JSON Schema");break}case"null":{U.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw Error("Void cannot be represented in JSON Schema");break}case"never":{U.not={};break}case"date":{if(this.unrepresentable==="throw")throw Error("Date cannot be represented in JSON Schema");break}case"array":{let L=U,{minimum:D,maximum:w}=Q._zod.bag;if(typeof D==="number")L.minItems=D;if(typeof w==="number")L.maxItems=w;L.type="array",L.items=this.process(Y.element,{...F,path:[...F.path,"items"]});break}case"object":{let L=U;L.type="object",L.properties={};let D=Y.shape;for(let O in D)L.properties[O]=this.process(D[O],{...F,path:[...F.path,"properties",O]});let w=new Set(Object.keys(D)),A=new Set([...w].filter((O)=>{let j=Y.shape[O]._zod;if(this.io==="input")return j.optin===void 0;else return j.optout===void 0}));if(A.size>0)L.required=Array.from(A);if(Y.catchall?._zod.def.type==="never")L.additionalProperties=!1;else if(!Y.catchall){if(this.io==="output")L.additionalProperties=!1}else if(Y.catchall)L.additionalProperties=this.process(Y.catchall,{...F,path:[...F.path,"additionalProperties"]});break}case"union":{let L=U;L.anyOf=Y.options.map((D,w)=>this.process(D,{...F,path:[...F.path,"anyOf",w]}));break}case"intersection":{let L=U,D=this.process(Y.left,{...F,path:[...F.path,"allOf",0]}),w=this.process(Y.right,{...F,path:[...F.path,"allOf",1]}),A=(j)=>("allOf"in j)&&Object.keys(j).length===1,O=[...A(D)?D.allOf:[D],...A(w)?w.allOf:[w]];L.allOf=O;break}case"tuple":{let L=U;L.type="array";let D=Y.items.map((O,j)=>this.process(O,{...F,path:[...F.path,"prefixItems",j]}));if(this.target==="draft-2020-12")L.prefixItems=D;else L.items=D;if(Y.rest){let O=this.process(Y.rest,{...F,path:[...F.path,"items"]});if(this.target==="draft-2020-12")L.items=O;else L.additionalItems=O}if(Y.rest)L.items=this.process(Y.rest,{...F,path:[...F.path,"items"]});let{minimum:w,maximum:A}=Q._zod.bag;if(typeof w==="number")L.minItems=w;if(typeof A==="number")L.maxItems=A;break}case"record":{let L=U;L.type="object",L.propertyNames=this.process(Y.keyType,{...F,path:[...F.path,"propertyNames"]}),L.additionalProperties=this.process(Y.valueType,{...F,path:[...F.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw Error("Set cannot be represented in JSON Schema");break}case"enum":{let L=U,D=Y9(Y.entries);if(D.every((w)=>typeof w==="number"))L.type="number";if(D.every((w)=>typeof w==="string"))L.type="string";L.enum=D;break}case"literal":{let L=U,D=[];for(let w of Y.values)if(w===void 0){if(this.unrepresentable==="throw")throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof w==="bigint")if(this.unrepresentable==="throw")throw Error("BigInt literals cannot be represented in JSON Schema");else D.push(Number(w));else D.push(w);if(D.length===0);else if(D.length===1){let w=D[0];L.type=w===null?"null":typeof w,L.const=w}else{if(D.every((w)=>typeof w==="number"))L.type="number";if(D.every((w)=>typeof w==="string"))L.type="string";if(D.every((w)=>typeof w==="boolean"))L.type="string";if(D.every((w)=>w===null))L.type="null";L.enum=D}break}case"file":{let L=U,D={type:"string",format:"binary",contentEncoding:"binary"},{minimum:w,maximum:A,mime:O}=Q._zod.bag;if(w!==void 0)D.minLength=w;if(A!==void 0)D.maxLength=A;if(O)if(O.length===1)D.contentMediaType=O[0],Object.assign(L,D);else L.anyOf=O.map((j)=>{return{...D,contentMediaType:j}});else Object.assign(L,D);break}case"transform":{if(this.unrepresentable==="throw")throw Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let L=this.process(Y.innerType,F);U.anyOf=[L,{type:"null"}];break}case"nonoptional":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"success":{let L=U;L.type="boolean";break}case"default":{this.process(Y.innerType,F),G.ref=Y.innerType,U.default=JSON.parse(JSON.stringify(Y.defaultValue));break}case"prefault":{if(this.process(Y.innerType,F),G.ref=Y.innerType,this.io==="input")U._prefault=JSON.parse(JSON.stringify(Y.defaultValue));break}case"catch":{this.process(Y.innerType,F),G.ref=Y.innerType;let L;try{L=Y.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}U.default=L;break}case"nan":{if(this.unrepresentable==="throw")throw Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let L=U,D=Q._zod.pattern;if(!D)throw Error("Pattern not found in template literal");L.type="string",L.pattern=D.source;break}case"pipe":{let L=this.io==="input"?Y.in._zod.def.type==="transform"?Y.out:Y.in:Y.out;this.process(L,F),G.ref=L;break}case"readonly":{this.process(Y.innerType,F),G.ref=Y.innerType,U.readOnly=!0;break}case"promise":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"optional":{this.process(Y.innerType,F),G.ref=Y.innerType;break}case"lazy":{let L=Q._zod.innerType;this.process(L,F),G.ref=L;break}case"custom":{if(this.unrepresentable==="throw")throw Error("Custom types cannot be represented in JSON Schema");break}default:}}}let B=this.metadataRegistry.get(Q);if(B)Object.assign(G.schema,B);if(this.io==="input"&&R0(Q))delete G.schema.examples,delete G.schema.default;if(this.io==="input"&&G.schema._prefault)($=G.schema).default??($.default=G.schema._prefault);return delete G.schema._prefault,this.seen.get(Q).schema}emit(Q,W){let $={cycles:W?.cycles??"ref",reused:W?.reused??"inline",external:W?.external??void 0},Y=this.seen.get(Q);if(!Y)throw Error("Unprocessed schema. This is a bug in Zod.");let J=(K)=>{let F=this.target==="draft-2020-12"?"$defs":"definitions";if($.external){let D=$.external.registry.get(K[0])?.id,w=$.external.uri??((O)=>O);if(D)return{ref:w(D)};let A=K[1].defId??K[1].schema.id??`schema${this.counter++}`;return K[1].defId=A,{defId:A,ref:`${w("__shared")}#/${F}/${A}`}}if(K[1]===Y)return{ref:"#"};let U=`${"#"}/${F}/`,L=K[1].schema.id??`__schema${this.counter++}`;return{defId:L,ref:U+L}},X=(K)=>{if(K[1].schema.$ref)return;let F=K[1],{ref:q,defId:U}=J(K);if(F.def={...F.schema},U)F.defId=U;let L=F.schema;for(let D in L)delete L[D];L.$ref=q};if($.cycles==="throw")for(let K of this.seen.entries()){let F=K[1];if(F.cycle)throw Error(`Cycle detected: #/${F.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let K of this.seen.entries()){let F=K[1];if(Q===K[0]){X(K);continue}if($.external){let U=$.external.registry.get(K[0])?.id;if(Q!==K[0]&&U){X(K);continue}}if(this.metadataRegistry.get(K[0])?.id){X(K);continue}if(F.cycle){X(K);continue}if(F.count>1){if($.reused==="ref"){X(K);continue}}}let G=(K,F)=>{let q=this.seen.get(K),U=q.def??q.schema,L={...U};if(q.ref===null)return;let D=q.ref;if(q.ref=null,D){G(D,F);let w=this.seen.get(D).schema;if(w.$ref&&F.target==="draft-7")U.allOf=U.allOf??[],U.allOf.push(w);else Object.assign(U,w),Object.assign(U,L)}if(!q.isParent)this.override({zodSchema:K,jsonSchema:U,path:q.path??[]})};for(let K of[...this.seen.entries()].reverse())G(K[0],{target:this.target});let H={};if(this.target==="draft-2020-12")H.$schema="https://json-schema.org/draft/2020-12/schema";else if(this.target==="draft-7")H.$schema="http://json-schema.org/draft-07/schema#";else console.warn(`Invalid target: ${this.target}`);if($.external?.uri){let K=$.external.registry.get(Q)?.id;if(!K)throw Error("Schema is missing an `id` property");H.$id=$.external.uri(K)}Object.assign(H,Y.def);let B=$.external?.defs??{};for(let K of this.seen.entries()){let F=K[1];if(F.def&&F.defId)B[F.defId]=F.def}if($.external);else if(Object.keys(B).length>0)if(this.target==="draft-2020-12")H.$defs=B;else H.definitions=B;try{return JSON.parse(JSON.stringify(H))}catch(K){throw Error("Error converting schema to JSON.")}}}function H$(Q,W){if(Q instanceof EQ){let Y=new G$(W),J={};for(let H of Q._idmap.entries()){let[B,K]=H;Y.process(K)}let X={},G={registry:Q,uri:W?.uri,defs:J};for(let H of Q._idmap.entries()){let[B,K]=H;X[B]=Y.emit(K,{...W,external:G})}if(Object.keys(J).length>0){let H=Y.target==="draft-2020-12"?"$defs":"definitions";X.__shared={[H]:J}}return{schemas:X}}let $=new G$(W);return $.process(Q),$.emit(Q,W)}function R0(Q,W){let $=W??{seen:new Set};if($.seen.has(Q))return!1;$.seen.add(Q);let J=Q._zod.def;switch(J.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return R0(J.element,$);case"object":{for(let X in J.shape)if(R0(J.shape[X],$))return!0;return!1}case"union":{for(let X of J.options)if(R0(X,$))return!0;return!1}case"intersection":return R0(J.left,$)||R0(J.right,$);case"tuple":{for(let X of J.items)if(R0(X,$))return!0;if(J.rest&&R0(J.rest,$))return!0;return!1}case"record":return R0(J.keyType,$)||R0(J.valueType,$);case"map":return R0(J.keyType,$)||R0(J.valueType,$);case"set":return R0(J.valueType,$);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return R0(J.innerType,$);case"lazy":return R0(J.getter(),$);case"default":return R0(J.innerType,$);case"prefault":return R0(J.innerType,$);case"custom":return!1;case"transform":return!0;case"pipe":return R0(J.in,$)||R0(J.out,$);case"success":return!1;case"catch":return!1;default:}throw Error(`Unknown schema type: ${J.type}`)}var _q=M("ZodMiniType",(Q,W)=>{if(!Q._zod)throw Error("Uninitialized schema in ZodMiniType.");X0.init(Q,W),Q.def=W,Q.parse=($,Y)=>z4(Q,$,Y,{callee:Q.parse}),Q.safeParse=($,Y)=>k6(Q,$,Y),Q.parseAsync=async($,Y)=>E4(Q,$,Y,{callee:Q.parseAsync}),Q.safeParseAsync=async($,Y)=>T6(Q,$,Y),Q.check=(...$)=>{return Q.clone({...W,checks:[...W.checks??[],...$.map((Y)=>typeof Y==="function"?{_zod:{check:Y,def:{check:"custom"},onattach:[]}}:Y)]})},Q.clone=($,Y)=>$1(Q,$,Y),Q.brand=()=>Q,Q.register=($,Y)=>{return $.add(Q,Y),Q}});var xq=M("ZodMiniObject",(Q,W)=>{zQ.init(Q,W),_q.init(Q,W),r.defineLazy(Q,"shape",()=>W.shape)});function B$(Q,W){let $={type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},...r.normalizeParams(W)};return new xq($)}function G1(Q){return!!Q._zod}function y6(Q){let W=Object.values(Q);if(W.length===0)return B$({});let $=W.every(G1),Y=W.every((J)=>!G1(J));if($)return B$(Q);if(Y)return K4(Q);throw Error("Mixed Zod versions detected in object shape.")}function G6(Q,W){if(G1(Q))return k6(Q,W);return Q.safeParse(W)}async function vQ(Q,W){if(G1(Q))return await T6(Q,W);return await Q.safeParseAsync(W)}function H6(Q){if(!Q)return;let W;if(G1(Q))W=Q._zod?.def?.shape;else W=Q.shape;if(!W)return;if(typeof W==="function")try{return W()}catch{return}return W}function N8(Q){if(!Q)return;if(typeof Q==="object"){let W=Q,$=Q;if(!W._def&&!$._zod){let Y=Object.values(Q);if(Y.length>0&&Y.every((J)=>typeof J==="object"&&J!==null&&(J._def!==void 0||J._zod!==void 0||typeof J.parse==="function")))return y6(Q)}}if(G1(Q)){let $=Q._zod?.def;if($&&($.type==="object"||$.shape!==void 0))return Q}else if(Q.shape!==void 0)return Q;return}function kQ(Q){if(Q&&typeof Q==="object"){if("message"in Q&&typeof Q.message==="string")return Q.message;if("issues"in Q&&Array.isArray(Q.issues)&&Q.issues.length>0){let W=Q.issues[0];if(W&&typeof W==="object"&&"message"in W)return String(W.message)}try{return JSON.stringify(Q)}catch{return String(Q)}}return String(Q)}function ZX(Q){return Q.description}function CX(Q){if(G1(Q))return Q._zod?.def?.type==="optional";let W=Q;if(typeof Q.isOptional==="function")return Q.isOptional();return W._def?.typeName==="ZodOptional"}function TQ(Q){if(G1(Q)){let X=Q._zod?.def;if(X){if(X.value!==void 0)return X.value;if(Array.isArray(X.values)&&X.values.length>0)return X.values[0]}}let $=Q._def;if($){if($.value!==void 0)return $.value;if(Array.isArray($.values)&&$.values.length>0)return $.values[0]}let Y=Q.value;if(Y!==void 0)return Y;return}var L9={};X4(L9,{time:()=>V$,duration:()=>q$,datetime:()=>K$,date:()=>F$,ZodISOTime:()=>TX,ZodISODuration:()=>_X,ZodISODateTime:()=>vX,ZodISODate:()=>kX});var vX=M("ZodISODateTime",(Q,W)=>{AX.init(Q,W),U0.init(Q,W)});function K$(Q){return PX(vX,Q)}var kX=M("ZodISODate",(Q,W)=>{OX.init(Q,W),U0.init(Q,W)});function F$(Q){return EX(kX,Q)}var TX=M("ZodISOTime",(Q,W)=>{NX.init(Q,W),U0.init(Q,W)});function V$(Q){return RX(TX,Q)}var _X=M("ZodISODuration",(Q,W)=>{MX.init(Q,W),U0.init(Q,W)});function q$(Q){return IX(_X,Q)}var xX=(Q,W)=>{OQ.init(Q,W),Q.name="ZodError",Object.defineProperties(Q,{format:{value:($)=>M4(Q,$)},flatten:{value:($)=>N4(Q,$)},addIssue:{value:($)=>Q.issues.push($)},addIssues:{value:($)=>Q.issues.push(...$)},isEmpty:{get(){return Q.issues.length===0}}})},XP=M("ZodError",xX),U9=M("ZodError",xX,{Parent:Error});var yX=j4(U9),gX=P4(U9),hX=R4(U9),fX=I4(U9);var j0=M("ZodType",(Q,W)=>{return X0.init(Q,W),Q.def=W,Object.defineProperty(Q,"_def",{value:W}),Q.check=(...$)=>{return Q.clone({...W,checks:[...W.checks??[],...$.map((Y)=>typeof Y==="function"?{_zod:{check:Y,def:{check:"custom"},onattach:[]}}:Y)]})},Q.clone=($,Y)=>$1(Q,$,Y),Q.brand=()=>Q,Q.register=($,Y)=>{return $.add(Q,Y),Q},Q.parse=($,Y)=>yX(Q,$,Y,{callee:Q.parse}),Q.safeParse=($,Y)=>hX(Q,$,Y),Q.parseAsync=async($,Y)=>gX(Q,$,Y,{callee:Q.parseAsync}),Q.safeParseAsync=async($,Y)=>fX(Q,$,Y),Q.spa=Q.safeParseAsync,Q.refine=($,Y)=>Q.check(kL($,Y)),Q.superRefine=($)=>Q.check(TL($)),Q.overwrite=($)=>Q.check(_6($)),Q.optional=()=>M0(Q),Q.nullable=()=>mX(Q),Q.nullish=()=>M0(mX(Q)),Q.nonoptional=($)=>RL(Q,$),Q.array=()=>a(Q),Q.or=($)=>V0([Q,$]),Q.and=($)=>xQ(Q,$),Q.transform=($)=>U$(Q,nX($)),Q.default=($)=>zL(Q,$),Q.prefault=($)=>EL(Q,$),Q.catch=($)=>bL(Q,$),Q.pipe=($)=>U$(Q,$),Q.readonly=()=>CL(Q),Q.describe=($)=>{let Y=Q.clone();return X6.add(Y,{description:$}),Y},Object.defineProperty(Q,"description",{get(){return X6.get(Q)?.description},configurable:!0}),Q.meta=(...$)=>{if($.length===0)return X6.get(Q);let Y=Q.clone();return X6.add(Y,$[0]),Y},Q.isOptional=()=>Q.safeParse(void 0).success,Q.isNullable=()=>Q.safeParse(null).success,Q}),cX=M("_ZodString",(Q,W)=>{F9.init(Q,W),j0.init(Q,W);let $=Q._zod.bag;Q.format=$.format??null,Q.minLength=$.minimum??null,Q.maxLength=$.maximum??null,Q.regex=(...Y)=>Q.check(o5(...Y)),Q.includes=(...Y)=>Q.check(t5(...Y)),Q.startsWith=(...Y)=>Q.check(s5(...Y)),Q.endsWith=(...Y)=>Q.check(e5(...Y)),Q.min=(...Y)=>Q.check(O8(...Y)),Q.max=(...Y)=>Q.check(ZQ(...Y)),Q.length=(...Y)=>Q.check(CQ(...Y)),Q.nonempty=(...Y)=>Q.check(O8(1,...Y)),Q.lowercase=(Y)=>Q.check(r5(Y)),Q.uppercase=(Y)=>Q.check(a5(Y)),Q.trim=()=>Q.check(W$()),Q.normalize=(...Y)=>Q.check(Q$(...Y)),Q.toLowerCase=()=>Q.check($$()),Q.toUpperCase=()=>Q.check(Y$())}),pq=M("ZodString",(Q,W)=>{F9.init(Q,W),cX.init(Q,W),Q.email=($)=>Q.check(j5(dq,$)),Q.url=($)=>Q.check(I5(iq,$)),Q.jwt=($)=>Q.check(l5(HL,$)),Q.emoji=($)=>Q.check(b5(nq,$)),Q.guid=($)=>Q.check(RQ(uX,$)),Q.uuid=($)=>Q.check(z5(_Q,$)),Q.uuidv4=($)=>Q.check(P5(_Q,$)),Q.uuidv6=($)=>Q.check(E5(_Q,$)),Q.uuidv7=($)=>Q.check(R5(_Q,$)),Q.nanoid=($)=>Q.check(S5(oq,$)),Q.guid=($)=>Q.check(RQ(uX,$)),Q.cuid=($)=>Q.check(Z5(rq,$)),Q.cuid2=($)=>Q.check(C5(aq,$)),Q.ulid=($)=>Q.check(v5(tq,$)),Q.base64=($)=>Q.check(h5(JL,$)),Q.base64url=($)=>Q.check(f5(XL,$)),Q.xid=($)=>Q.check(k5(sq,$)),Q.ksuid=($)=>Q.check(T5(eq,$)),Q.ipv4=($)=>Q.check(_5(QL,$)),Q.ipv6=($)=>Q.check(x5(WL,$)),Q.cidrv4=($)=>Q.check(y5($L,$)),Q.cidrv6=($)=>Q.check(g5(YL,$)),Q.e164=($)=>Q.check(u5(GL,$)),Q.datetime=($)=>Q.check(K$($)),Q.date=($)=>Q.check(F$($)),Q.time=($)=>Q.check(V$($)),Q.duration=($)=>Q.check(q$($))});function N(Q){return M5(pq,Q)}var U0=M("ZodStringFormat",(Q,W)=>{F0.init(Q,W),cX.init(Q,W)}),dq=M("ZodEmail",(Q,W)=>{x4.init(Q,W),U0.init(Q,W)});var uX=M("ZodGUID",(Q,W)=>{T4.init(Q,W),U0.init(Q,W)});var _Q=M("ZodUUID",(Q,W)=>{_4.init(Q,W),U0.init(Q,W)});var iq=M("ZodURL",(Q,W)=>{y4.init(Q,W),U0.init(Q,W)});var nq=M("ZodEmoji",(Q,W)=>{g4.init(Q,W),U0.init(Q,W)});var oq=M("ZodNanoID",(Q,W)=>{h4.init(Q,W),U0.init(Q,W)});var rq=M("ZodCUID",(Q,W)=>{f4.init(Q,W),U0.init(Q,W)});var aq=M("ZodCUID2",(Q,W)=>{u4.init(Q,W),U0.init(Q,W)});var tq=M("ZodULID",(Q,W)=>{l4.init(Q,W),U0.init(Q,W)});var sq=M("ZodXID",(Q,W)=>{m4.init(Q,W),U0.init(Q,W)});var eq=M("ZodKSUID",(Q,W)=>{c4.init(Q,W),U0.init(Q,W)});var QL=M("ZodIPv4",(Q,W)=>{p4.init(Q,W),U0.init(Q,W)});var WL=M("ZodIPv6",(Q,W)=>{d4.init(Q,W),U0.init(Q,W)});var $L=M("ZodCIDRv4",(Q,W)=>{i4.init(Q,W),U0.init(Q,W)});var YL=M("ZodCIDRv6",(Q,W)=>{n4.init(Q,W),U0.init(Q,W)});var JL=M("ZodBase64",(Q,W)=>{o4.init(Q,W),U0.init(Q,W)});var XL=M("ZodBase64URL",(Q,W)=>{r4.init(Q,W),U0.init(Q,W)});var GL=M("ZodE164",(Q,W)=>{a4.init(Q,W),U0.init(Q,W)});var HL=M("ZodJWT",(Q,W)=>{t4.init(Q,W),U0.init(Q,W)});var pX=M("ZodNumber",(Q,W)=>{jQ.init(Q,W),j0.init(Q,W),Q.gt=(Y,J)=>Q.check(bQ(Y,J)),Q.gte=(Y,J)=>Q.check(q9(Y,J)),Q.min=(Y,J)=>Q.check(q9(Y,J)),Q.lt=(Y,J)=>Q.check(IQ(Y,J)),Q.lte=(Y,J)=>Q.check(V9(Y,J)),Q.max=(Y,J)=>Q.check(V9(Y,J)),Q.int=(Y)=>Q.check(lX(Y)),Q.safe=(Y)=>Q.check(lX(Y)),Q.positive=(Y)=>Q.check(bQ(0,Y)),Q.nonnegative=(Y)=>Q.check(q9(0,Y)),Q.negative=(Y)=>Q.check(IQ(0,Y)),Q.nonpositive=(Y)=>Q.check(V9(0,Y)),Q.multipleOf=(Y,J)=>Q.check(SQ(Y,J)),Q.step=(Y,J)=>Q.check(SQ(Y,J)),Q.finite=()=>Q;let $=Q._zod.bag;Q.minValue=Math.max($.minimum??Number.NEGATIVE_INFINITY,$.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,Q.maxValue=Math.min($.maximum??Number.POSITIVE_INFINITY,$.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,Q.isInt=($.format??"").includes("int")||Number.isSafeInteger($.multipleOf??0.5),Q.isFinite=!0,Q.format=$.format??null});function Y0(Q){return m5(pX,Q)}var BL=M("ZodNumberFormat",(Q,W)=>{s4.init(Q,W),pX.init(Q,W)});function lX(Q){return c5(BL,Q)}var KL=M("ZodBoolean",(Q,W)=>{e4.init(Q,W),j0.init(Q,W)});function b0(Q){return p5(KL,Q)}var FL=M("ZodNull",(Q,W)=>{Q5.init(Q,W),j0.init(Q,W)});function D$(Q){return d5(FL,Q)}var VL=M("ZodUnknown",(Q,W)=>{W5.init(Q,W),j0.init(Q,W)});function D0(){return i5(VL)}var qL=M("ZodNever",(Q,W)=>{$5.init(Q,W),j0.init(Q,W)});function LL(Q){return n5(qL,Q)}var UL=M("ZodArray",(Q,W)=>{Y5.init(Q,W),j0.init(Q,W),Q.element=W.element,Q.min=($,Y)=>Q.check(O8($,Y)),Q.nonempty=($)=>Q.check(O8(1,$)),Q.max=($,Y)=>Q.check(ZQ($,Y)),Q.length=($,Y)=>Q.check(CQ($,Y)),Q.unwrap=()=>Q.element});function a(Q,W){return bX(UL,Q,W)}var dX=M("ZodObject",(Q,W)=>{zQ.init(Q,W),j0.init(Q,W),r.defineLazy(Q,"shape",()=>W.shape),Q.keyof=()=>o0(Object.keys(Q._zod.def.shape)),Q.catchall=($)=>Q.clone({...Q._zod.def,catchall:$}),Q.passthrough=()=>Q.clone({...Q._zod.def,catchall:D0()}),Q.loose=()=>Q.clone({...Q._zod.def,catchall:D0()}),Q.strict=()=>Q.clone({...Q._zod.def,catchall:LL()}),Q.strip=()=>Q.clone({...Q._zod.def,catchall:void 0}),Q.extend=($)=>{return r.extend(Q,$)},Q.merge=($)=>r.merge(Q,$),Q.pick=($)=>r.pick(Q,$),Q.omit=($)=>r.omit(Q,$),Q.partial=(...$)=>r.partial(oX,Q,$[0]),Q.required=(...$)=>r.required(rX,Q,$[0])});function v(Q,W){let $={type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},...r.normalizeParams(W)};return new dX($)}function c0(Q,W){return new dX({type:"object",get shape(){return r.assignProp(this,"shape",{...Q}),this.shape},catchall:D0(),...r.normalizeParams(W)})}var iX=M("ZodUnion",(Q,W)=>{PQ.init(Q,W),j0.init(Q,W),Q.options=W.options});function V0(Q,W){return new iX({type:"union",options:Q,...r.normalizeParams(W)})}var DL=M("ZodDiscriminatedUnion",(Q,W)=>{iX.init(Q,W),J5.init(Q,W)});function w$(Q,W,$){return new DL({type:"union",options:W,discriminator:Q,...r.normalizeParams($)})}var wL=M("ZodIntersection",(Q,W)=>{X5.init(Q,W),j0.init(Q,W)});function xQ(Q,W){return new wL({type:"intersection",left:Q,right:W})}var AL=M("ZodRecord",(Q,W)=>{G5.init(Q,W),j0.init(Q,W),Q.keyType=W.keyType,Q.valueType=W.valueType});function w0(Q,W,$){return new AL({type:"record",keyType:Q,valueType:W,...r.normalizeParams($)})}var L$=M("ZodEnum",(Q,W)=>{H5.init(Q,W),j0.init(Q,W),Q.enum=W.entries,Q.options=Object.values(W.entries);let $=new Set(Object.keys(W.entries));Q.extract=(Y,J)=>{let X={};for(let G of Y)if($.has(G))X[G]=W.entries[G];else throw Error(`Key ${G} not found in enum`);return new L$({...W,checks:[],...r.normalizeParams(J),entries:X})},Q.exclude=(Y,J)=>{let X={...W.entries};for(let G of Y)if($.has(G))delete X[G];else throw Error(`Key ${G} not found in enum`);return new L$({...W,checks:[],...r.normalizeParams(J),entries:X})}});function o0(Q,W){let $=Array.isArray(Q)?Object.fromEntries(Q.map((Y)=>[Y,Y])):Q;return new L$({type:"enum",entries:$,...r.normalizeParams(W)})}var OL=M("ZodLiteral",(Q,W)=>{B5.init(Q,W),j0.init(Q,W),Q.values=new Set(W.values),Object.defineProperty(Q,"value",{get(){if(W.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return W.values[0]}})});function _(Q,W){return new OL({type:"literal",values:Array.isArray(Q)?Q:[Q],...r.normalizeParams(W)})}var NL=M("ZodTransform",(Q,W)=>{K5.init(Q,W),j0.init(Q,W),Q._zod.parse=($,Y)=>{$.addIssue=(X)=>{if(typeof X==="string")$.issues.push(r.issue(X,$.value,W));else{let G=X;if(G.fatal)G.continue=!1;G.code??(G.code="custom"),G.input??(G.input=$.value),G.inst??(G.inst=Q),G.continue??(G.continue=!0),$.issues.push(r.issue(G))}};let J=W.transform($.value,$);if(J instanceof Promise)return J.then((X)=>{return $.value=X,$});return $.value=J,$}});function nX(Q){return new NL({type:"transform",transform:Q})}var oX=M("ZodOptional",(Q,W)=>{F5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function M0(Q){return new oX({type:"optional",innerType:Q})}var ML=M("ZodNullable",(Q,W)=>{V5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function mX(Q){return new ML({type:"nullable",innerType:Q})}var jL=M("ZodDefault",(Q,W)=>{q5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType,Q.removeDefault=Q.unwrap});function zL(Q,W){return new jL({type:"default",innerType:Q,get defaultValue(){return typeof W==="function"?W():W}})}var PL=M("ZodPrefault",(Q,W)=>{L5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function EL(Q,W){return new PL({type:"prefault",innerType:Q,get defaultValue(){return typeof W==="function"?W():W}})}var rX=M("ZodNonOptional",(Q,W)=>{U5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType});function RL(Q,W){return new rX({type:"nonoptional",innerType:Q,...r.normalizeParams(W)})}var IL=M("ZodCatch",(Q,W)=>{D5.init(Q,W),j0.init(Q,W),Q.unwrap=()=>Q._zod.def.innerType,Q.removeCatch=Q.unwrap});function bL(Q,W){return new IL({type:"catch",innerType:Q,catchValue:typeof W==="function"?W:()=>W})}var SL=M("ZodPipe",(Q,W)=>{w5.init(Q,W),j0.init(Q,W),Q.in=W.in,Q.out=W.out});function U$(Q,W){return new SL({type:"pipe",in:Q,out:W})}var ZL=M("ZodReadonly",(Q,W)=>{A5.init(Q,W),j0.init(Q,W)});function CL(Q){return new ZL({type:"readonly",innerType:Q})}var aX=M("ZodCustom",(Q,W)=>{O5.init(Q,W),j0.init(Q,W)});function vL(Q){let W=new Z0({check:"custom"});return W._zod.check=Q,W}function tX(Q,W){return J$(aX,Q??(()=>!0),W)}function kL(Q,W={}){return X$(aX,Q,W)}function TL(Q){let W=vL(($)=>{return $.addIssue=(Y)=>{if(typeof Y==="string")$.issues.push(r.issue(Y,$.value,W._zod.def));else{let J=Y;if(J.fatal)J.continue=!1;J.code??(J.code="custom"),J.input??(J.input=$.value),J.inst??(J.inst=W),J.continue??(J.continue=!W._zod.def.abort),$.issues.push(r.issue(J))}},Q($.value,$)});return W}function A$(Q,W){return U$(nX(Q),W)}W1(N5());var O$="2025-11-25",sX="2025-03-26",D9=[O$,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],B6="io.modelcontextprotocol/related-task",gQ="2.0",C0=tX((Q)=>Q!==null&&(typeof Q==="object"||typeof Q==="function")),eX=V0([N(),Y0().int()]),Q3=N(),NP=c0({ttl:V0([Y0(),D$()]).optional(),pollInterval:Y0().optional()}),_L=v({ttl:Y0().optional()}),xL=v({taskId:N()}),N$=c0({progressToken:eX.optional(),[B6]:xL.optional()}),Y1=v({_meta:N$.optional()}),w9=Y1.extend({task:_L.optional()}),W3=(Q)=>w9.safeParse(Q).success,v0=v({method:N(),params:Y1.loose().optional()}),H1=v({_meta:N$.optional()}),B1=v({method:N(),params:H1.loose().optional()}),k0=c0({_meta:N$.optional()}),hQ=V0([N(),Y0().int()]),$3=v({jsonrpc:_(gQ),id:hQ,...v0.shape}).strict(),K6=(Q)=>$3.safeParse(Q).success,Y3=v({jsonrpc:_(gQ),...B1.shape}).strict(),J3=(Q)=>Y3.safeParse(Q).success,M$=v({jsonrpc:_(gQ),id:hQ,result:k0}).strict(),p1=(Q)=>M$.safeParse(Q).success;var g;(function(Q){Q[Q.ConnectionClosed=-32000]="ConnectionClosed",Q[Q.RequestTimeout=-32001]="RequestTimeout",Q[Q.ParseError=-32700]="ParseError",Q[Q.InvalidRequest=-32600]="InvalidRequest",Q[Q.MethodNotFound=-32601]="MethodNotFound",Q[Q.InvalidParams=-32602]="InvalidParams",Q[Q.InternalError=-32603]="InternalError",Q[Q.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(g||(g={}));var j$=v({jsonrpc:_(gQ),id:hQ.optional(),error:v({code:Y0().int(),message:N(),data:D0().optional()})}).strict();var j8=(Q)=>j$.safeParse(Q).success;var z$=V0([$3,Y3,M$,j$]),MP=V0([M$,j$]),fQ=k0.strict(),yL=H1.extend({requestId:hQ.optional(),reason:N().optional()}),uQ=B1.extend({method:_("notifications/cancelled"),params:yL}),gL=v({src:N(),mimeType:N().optional(),sizes:a(N()).optional(),theme:o0(["light","dark"]).optional()}),A9=v({icons:a(gL).optional()}),M8=v({name:N(),title:N().optional()}),X3=M8.extend({...M8.shape,...A9.shape,version:N(),websiteUrl:N().optional(),description:N().optional()}),hL=xQ(v({applyDefaults:b0().optional()}),w0(N(),D0())),fL=A$((Q)=>{if(Q&&typeof Q==="object"&&!Array.isArray(Q)){if(Object.keys(Q).length===0)return{form:{}}}return Q},xQ(v({form:hL.optional(),url:C0.optional()}),w0(N(),D0()).optional())),uL=c0({list:C0.optional(),cancel:C0.optional(),requests:c0({sampling:c0({createMessage:C0.optional()}).optional(),elicitation:c0({create:C0.optional()}).optional()}).optional()}),lL=c0({list:C0.optional(),cancel:C0.optional(),requests:c0({tools:c0({call:C0.optional()}).optional()}).optional()}),mL=v({experimental:w0(N(),C0).optional(),sampling:v({context:C0.optional(),tools:C0.optional()}).optional(),elicitation:fL.optional(),roots:v({listChanged:b0().optional()}).optional(),tasks:uL.optional()}),cL=Y1.extend({protocolVersion:N(),capabilities:mL,clientInfo:X3}),lQ=v0.extend({method:_("initialize"),params:cL}),P$=(Q)=>lQ.safeParse(Q).success,pL=v({experimental:w0(N(),C0).optional(),logging:C0.optional(),completions:C0.optional(),prompts:v({listChanged:b0().optional()}).optional(),resources:v({subscribe:b0().optional(),listChanged:b0().optional()}).optional(),tools:v({listChanged:b0().optional()}).optional(),tasks:lL.optional()}),dL=k0.extend({protocolVersion:N(),capabilities:pL,serverInfo:X3,instructions:N().optional()}),E$=B1.extend({method:_("notifications/initialized"),params:H1.optional()});var mQ=v0.extend({method:_("ping"),params:Y1.optional()}),iL=v({progress:Y0(),total:M0(Y0()),message:M0(N())}),nL=v({...H1.shape,...iL.shape,progressToken:eX}),cQ=B1.extend({method:_("notifications/progress"),params:nL}),oL=Y1.extend({cursor:Q3.optional()}),O9=v0.extend({params:oL.optional()}),N9=k0.extend({nextCursor:Q3.optional()}),rL=o0(["working","input_required","completed","failed","cancelled"]),M9=v({taskId:N(),status:rL,ttl:V0([Y0(),D$()]),createdAt:N(),lastUpdatedAt:N(),pollInterval:M0(Y0()),statusMessage:M0(N())}),z8=k0.extend({task:M9}),aL=H1.merge(M9),j9=B1.extend({method:_("notifications/tasks/status"),params:aL}),pQ=v0.extend({method:_("tasks/get"),params:Y1.extend({taskId:N()})}),dQ=k0.merge(M9),iQ=v0.extend({method:_("tasks/result"),params:Y1.extend({taskId:N()})}),jP=k0.loose(),nQ=O9.extend({method:_("tasks/list")}),oQ=N9.extend({tasks:a(M9)}),rQ=v0.extend({method:_("tasks/cancel"),params:Y1.extend({taskId:N()})}),G3=k0.merge(M9),H3=v({uri:N(),mimeType:M0(N()),_meta:w0(N(),D0()).optional()}),B3=H3.extend({text:N()}),R$=N().refine((Q)=>{try{return atob(Q),!0}catch{return!1}},{message:"Invalid Base64 string"}),K3=H3.extend({blob:R$}),z9=o0(["user","assistant"]),P8=v({audience:a(z9).optional(),priority:Y0().min(0).max(1).optional(),lastModified:L9.datetime({offset:!0}).optional()}),F3=v({...M8.shape,...A9.shape,uri:N(),description:M0(N()),mimeType:M0(N()),annotations:P8.optional(),_meta:M0(c0({}))}),tL=v({...M8.shape,...A9.shape,uriTemplate:N(),description:M0(N()),mimeType:M0(N()),annotations:P8.optional(),_meta:M0(c0({}))}),aQ=O9.extend({method:_("resources/list")}),sL=N9.extend({resources:a(F3)}),tQ=O9.extend({method:_("resources/templates/list")}),eL=N9.extend({resourceTemplates:a(tL)}),I$=Y1.extend({uri:N()}),QU=I$,sQ=v0.extend({method:_("resources/read"),params:QU}),WU=k0.extend({contents:a(V0([B3,K3]))}),$U=B1.extend({method:_("notifications/resources/list_changed"),params:H1.optional()}),YU=I$,JU=v0.extend({method:_("resources/subscribe"),params:YU}),XU=I$,GU=v0.extend({method:_("resources/unsubscribe"),params:XU}),HU=H1.extend({uri:N()}),BU=B1.extend({method:_("notifications/resources/updated"),params:HU}),KU=v({name:N(),description:M0(N()),required:M0(b0())}),FU=v({...M8.shape,...A9.shape,description:M0(N()),arguments:M0(a(KU)),_meta:M0(c0({}))}),eQ=O9.extend({method:_("prompts/list")}),VU=N9.extend({prompts:a(FU)}),qU=Y1.extend({name:N(),arguments:w0(N(),N()).optional()}),QW=v0.extend({method:_("prompts/get"),params:qU}),b$=v({type:_("text"),text:N(),annotations:P8.optional(),_meta:w0(N(),D0()).optional()}),S$=v({type:_("image"),data:R$,mimeType:N(),annotations:P8.optional(),_meta:w0(N(),D0()).optional()}),Z$=v({type:_("audio"),data:R$,mimeType:N(),annotations:P8.optional(),_meta:w0(N(),D0()).optional()}),LU=v({type:_("tool_use"),name:N(),id:N(),input:w0(N(),D0()),_meta:w0(N(),D0()).optional()}),UU=v({type:_("resource"),resource:V0([B3,K3]),annotations:P8.optional(),_meta:w0(N(),D0()).optional()}),DU=F3.extend({type:_("resource_link")}),C$=V0([b$,S$,Z$,DU,UU]),wU=v({role:z9,content:C$}),AU=k0.extend({description:N().optional(),messages:a(wU)}),OU=B1.extend({method:_("notifications/prompts/list_changed"),params:H1.optional()}),NU=v({title:N().optional(),readOnlyHint:b0().optional(),destructiveHint:b0().optional(),idempotentHint:b0().optional(),openWorldHint:b0().optional()}),MU=v({taskSupport:o0(["required","optional","forbidden"]).optional()}),V3=v({...M8.shape,...A9.shape,description:N().optional(),inputSchema:v({type:_("object"),properties:w0(N(),C0).optional(),required:a(N()).optional()}).catchall(D0()),outputSchema:v({type:_("object"),properties:w0(N(),C0).optional(),required:a(N()).optional()}).catchall(D0()).optional(),annotations:NU.optional(),execution:MU.optional(),_meta:w0(N(),D0()).optional()}),WW=O9.extend({method:_("tools/list")}),jU=N9.extend({tools:a(V3)}),$W=k0.extend({content:a(C$).default([]),structuredContent:w0(N(),D0()).optional(),isError:b0().optional()}),zP=$W.or(k0.extend({toolResult:D0()})),zU=w9.extend({name:N(),arguments:w0(N(),D0()).optional()}),E8=v0.extend({method:_("tools/call"),params:zU}),PU=B1.extend({method:_("notifications/tools/list_changed"),params:H1.optional()}),PP=v({autoRefresh:b0().default(!0),debounceMs:Y0().int().nonnegative().default(300)}),P9=o0(["debug","info","notice","warning","error","critical","alert","emergency"]),EU=Y1.extend({level:P9}),v$=v0.extend({method:_("logging/setLevel"),params:EU}),RU=H1.extend({level:P9,logger:N().optional(),data:D0()}),IU=B1.extend({method:_("notifications/message"),params:RU}),bU=v({name:N().optional()}),SU=v({hints:a(bU).optional(),costPriority:Y0().min(0).max(1).optional(),speedPriority:Y0().min(0).max(1).optional(),intelligencePriority:Y0().min(0).max(1).optional()}),ZU=v({mode:o0(["auto","required","none"]).optional()}),CU=v({type:_("tool_result"),toolUseId:N().describe("The unique identifier for the corresponding tool call."),content:a(C$).default([]),structuredContent:v({}).loose().optional(),isError:b0().optional(),_meta:w0(N(),D0()).optional()}),vU=w$("type",[b$,S$,Z$]),yQ=w$("type",[b$,S$,Z$,LU,CU]),kU=v({role:z9,content:V0([yQ,a(yQ)]),_meta:w0(N(),D0()).optional()}),TU=w9.extend({messages:a(kU),modelPreferences:SU.optional(),systemPrompt:N().optional(),includeContext:o0(["none","thisServer","allServers"]).optional(),temperature:Y0().optional(),maxTokens:Y0().int(),stopSequences:a(N()).optional(),metadata:C0.optional(),tools:a(V3).optional(),toolChoice:ZU.optional()}),_U=v0.extend({method:_("sampling/createMessage"),params:TU}),k$=k0.extend({model:N(),stopReason:M0(o0(["endTurn","stopSequence","maxTokens"]).or(N())),role:z9,content:vU}),T$=k0.extend({model:N(),stopReason:M0(o0(["endTurn","stopSequence","maxTokens","toolUse"]).or(N())),role:z9,content:V0([yQ,a(yQ)])}),xU=v({type:_("boolean"),title:N().optional(),description:N().optional(),default:b0().optional()}),yU=v({type:_("string"),title:N().optional(),description:N().optional(),minLength:Y0().optional(),maxLength:Y0().optional(),format:o0(["email","uri","date","date-time"]).optional(),default:N().optional()}),gU=v({type:o0(["number","integer"]),title:N().optional(),description:N().optional(),minimum:Y0().optional(),maximum:Y0().optional(),default:Y0().optional()}),hU=v({type:_("string"),title:N().optional(),description:N().optional(),enum:a(N()),default:N().optional()}),fU=v({type:_("string"),title:N().optional(),description:N().optional(),oneOf:a(v({const:N(),title:N()})),default:N().optional()}),uU=v({type:_("string"),title:N().optional(),description:N().optional(),enum:a(N()),enumNames:a(N()).optional(),default:N().optional()}),lU=V0([hU,fU]),mU=v({type:_("array"),title:N().optional(),description:N().optional(),minItems:Y0().optional(),maxItems:Y0().optional(),items:v({type:_("string"),enum:a(N())}),default:a(N()).optional()}),cU=v({type:_("array"),title:N().optional(),description:N().optional(),minItems:Y0().optional(),maxItems:Y0().optional(),items:v({anyOf:a(v({const:N(),title:N()}))}),default:a(N()).optional()}),pU=V0([mU,cU]),dU=V0([uU,lU,pU]),iU=V0([dU,xU,yU,gU]),nU=w9.extend({mode:_("form").optional(),message:N(),requestedSchema:v({type:_("object"),properties:w0(N(),iU),required:a(N()).optional()})}),oU=w9.extend({mode:_("url"),message:N(),elicitationId:N(),url:N().url()}),rU=V0([nU,oU]),aU=v0.extend({method:_("elicitation/create"),params:rU}),tU=H1.extend({elicitationId:N()}),sU=B1.extend({method:_("notifications/elicitation/complete"),params:tU}),YW=k0.extend({action:o0(["accept","decline","cancel"]),content:A$((Q)=>Q===null?void 0:Q,w0(N(),V0([N(),Y0(),b0(),a(N())])).optional())}),eU=v({type:_("ref/resource"),uri:N()});var QD=v({type:_("ref/prompt"),name:N()}),WD=Y1.extend({ref:V0([QD,eU]),argument:v({name:N(),value:N()}),context:v({arguments:w0(N(),N()).optional()}).optional()}),JW=v0.extend({method:_("completion/complete"),params:WD});function q3(Q){if(Q.params.ref.type!=="ref/prompt")throw TypeError(`Expected CompleteRequestPrompt, but got ${Q.params.ref.type}`)}function L3(Q){if(Q.params.ref.type!=="ref/resource")throw TypeError(`Expected CompleteRequestResourceTemplate, but got ${Q.params.ref.type}`)}var $D=k0.extend({completion:c0({values:a(N()).max(100),total:M0(Y0().int()),hasMore:M0(b0())})}),YD=v({uri:N().startsWith("file://"),name:N().optional(),_meta:w0(N(),D0()).optional()}),JD=v0.extend({method:_("roots/list"),params:Y1.optional()}),_$=k0.extend({roots:a(YD)}),XD=B1.extend({method:_("notifications/roots/list_changed"),params:H1.optional()}),EP=V0([mQ,lQ,JW,v$,QW,eQ,aQ,tQ,sQ,JU,GU,E8,WW,pQ,iQ,nQ,rQ]),RP=V0([uQ,cQ,E$,XD,j9]),IP=V0([fQ,k$,T$,YW,_$,dQ,oQ,z8]),bP=V0([mQ,_U,aU,JD,pQ,iQ,nQ,rQ]),SP=V0([uQ,cQ,IU,BU,$U,PU,OU,j9,sU]),ZP=V0([fQ,dL,$D,AU,VU,sL,eL,WU,$W,jU,dQ,oQ,z8]);class T extends Error{constructor(Q,W,$){super(`MCP error ${Q}: ${W}`);this.code=Q,this.data=$,this.name="McpError"}static fromError(Q,W,$){if(Q===g.UrlElicitationRequired&&$){let Y=$;if(Y.elicitations)return new U3(Y.elicitations,W)}return new T(Q,W,$)}}class U3 extends T{constructor(Q,W=`URL elicitation${Q.length>1?"s":""} required`){super(g.UrlElicitationRequired,W,{elicitations:Q})}get elicitations(){return this.data?.elicitations??[]}}function F6(Q){return Q==="completed"||Q==="failed"||Q==="cancelled"}var w3=Symbol("Let zodToJsonSchema decide on which parser to use");var D3={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},A3=(Q)=>typeof Q==="string"?{...D3,name:Q}:{...D3,...Q};var O3=(Q)=>{let W=A3(Q),$=W.name!==void 0?[...W.basePath,W.definitionPath,W.name]:W.basePath;return{...W,flags:{hasReferencedOpenAiAnyType:!1},currentPath:$,propertyPath:void 0,seen:new Map(Object.entries(W.definitions).map(([Y,J])=>[J._def,{def:J._def,path:[...W.basePath,W.definitionPath,Y],jsonSchema:void 0}]))}};function x$(Q,W,$,Y){if(!Y?.errorMessages)return;if($)Q.errorMessage={...Q.errorMessage,[W]:$}}function t(Q,W,$,Y,J){Q[W]=$,x$(Q,W,Y,J)}var XW=(Q,W)=>{let $=0;for(;$<Q.length&&$<W.length;$++)if(Q[$]!==W[$])break;return[(Q.length-$).toString(),...W.slice($)].join("/")};function A0(Q){if(Q.target!=="openAi")return{};let W=[...Q.basePath,Q.definitionPath,Q.openAiAnyTypeName];return Q.flags.hasReferencedOpenAiAnyType=!0,{$ref:Q.$refStrategy==="relative"?XW(W,Q.currentPath):W.join("/")}}function N3(Q,W){let $={type:"array"};if(Q.type?._def&&Q.type?._def?.typeName!==E.ZodAny)$.items=u(Q.type._def,{...W,currentPath:[...W.currentPath,"items"]});if(Q.minLength)t($,"minItems",Q.minLength.value,Q.minLength.message,W);if(Q.maxLength)t($,"maxItems",Q.maxLength.value,Q.maxLength.message,W);if(Q.exactLength)t($,"minItems",Q.exactLength.value,Q.exactLength.message,W),t($,"maxItems",Q.exactLength.value,Q.exactLength.message,W);return $}function M3(Q,W){let $={type:"integer",format:"int64"};if(!Q.checks)return $;for(let Y of Q.checks)switch(Y.kind){case"min":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"minimum",Y.value,Y.message,W);else t($,"exclusiveMinimum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMinimum=!0;t($,"minimum",Y.value,Y.message,W)}break;case"max":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"maximum",Y.value,Y.message,W);else t($,"exclusiveMaximum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMaximum=!0;t($,"maximum",Y.value,Y.message,W)}break;case"multipleOf":t($,"multipleOf",Y.value,Y.message,W);break}return $}function j3(){return{type:"boolean"}}function GW(Q,W){return u(Q.type._def,W)}var z3=(Q,W)=>{return u(Q.innerType._def,W)};function y$(Q,W,$){let Y=$??W.dateStrategy;if(Array.isArray(Y))return{anyOf:Y.map((J,X)=>y$(Q,W,J))};switch(Y){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return GD(Q,W)}}var GD=(Q,W)=>{let $={type:"integer",format:"unix-time"};if(W.target==="openApi3")return $;for(let Y of Q.checks)switch(Y.kind){case"min":t($,"minimum",Y.value,Y.message,W);break;case"max":t($,"maximum",Y.value,Y.message,W);break}return $};function P3(Q,W){return{...u(Q.innerType._def,W),default:Q.defaultValue()}}function E3(Q,W){return W.effectStrategy==="input"?u(Q.schema._def,W):A0(W)}function R3(Q){return{type:"string",enum:Array.from(Q.values)}}var HD=(Q)=>{if("type"in Q&&Q.type==="string")return!1;return"allOf"in Q};function I3(Q,W){let $=[u(Q.left._def,{...W,currentPath:[...W.currentPath,"allOf","0"]}),u(Q.right._def,{...W,currentPath:[...W.currentPath,"allOf","1"]})].filter((X)=>!!X),Y=W.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,J=[];return $.forEach((X)=>{if(HD(X)){if(J.push(...X.allOf),X.unevaluatedProperties===void 0)Y=void 0}else{let G=X;if("additionalProperties"in X&&X.additionalProperties===!1){let{additionalProperties:H,...B}=X;G=B}else Y=void 0;J.push(G)}}),J.length?{allOf:J,...Y}:void 0}function b3(Q,W){let $=typeof Q.value;if($!=="bigint"&&$!=="number"&&$!=="boolean"&&$!=="string")return{type:Array.isArray(Q.value)?"array":"object"};if(W.target==="openApi3")return{type:$==="bigint"?"integer":$,enum:[Q.value]};return{type:$==="bigint"?"integer":$,const:Q.value}}var g$=void 0,N1={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>{if(g$===void 0)g$=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u");return g$},uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function HW(Q,W){let $={type:"string"};if(Q.checks)for(let Y of Q.checks)switch(Y.kind){case"min":t($,"minLength",typeof $.minLength==="number"?Math.max($.minLength,Y.value):Y.value,Y.message,W);break;case"max":t($,"maxLength",typeof $.maxLength==="number"?Math.min($.maxLength,Y.value):Y.value,Y.message,W);break;case"email":switch(W.emailStrategy){case"format:email":M1($,"email",Y.message,W);break;case"format:idn-email":M1($,"idn-email",Y.message,W);break;case"pattern:zod":p0($,N1.email,Y.message,W);break}break;case"url":M1($,"uri",Y.message,W);break;case"uuid":M1($,"uuid",Y.message,W);break;case"regex":p0($,Y.regex,Y.message,W);break;case"cuid":p0($,N1.cuid,Y.message,W);break;case"cuid2":p0($,N1.cuid2,Y.message,W);break;case"startsWith":p0($,RegExp(`^${h$(Y.value,W)}`),Y.message,W);break;case"endsWith":p0($,RegExp(`${h$(Y.value,W)}$`),Y.message,W);break;case"datetime":M1($,"date-time",Y.message,W);break;case"date":M1($,"date",Y.message,W);break;case"time":M1($,"time",Y.message,W);break;case"duration":M1($,"duration",Y.message,W);break;case"length":t($,"minLength",typeof $.minLength==="number"?Math.max($.minLength,Y.value):Y.value,Y.message,W),t($,"maxLength",typeof $.maxLength==="number"?Math.min($.maxLength,Y.value):Y.value,Y.message,W);break;case"includes":{p0($,RegExp(h$(Y.value,W)),Y.message,W);break}case"ip":{if(Y.version!=="v6")M1($,"ipv4",Y.message,W);if(Y.version!=="v4")M1($,"ipv6",Y.message,W);break}case"base64url":p0($,N1.base64url,Y.message,W);break;case"jwt":p0($,N1.jwt,Y.message,W);break;case"cidr":{if(Y.version!=="v6")p0($,N1.ipv4Cidr,Y.message,W);if(Y.version!=="v4")p0($,N1.ipv6Cidr,Y.message,W);break}case"emoji":p0($,N1.emoji(),Y.message,W);break;case"ulid":{p0($,N1.ulid,Y.message,W);break}case"base64":{switch(W.base64Strategy){case"format:binary":{M1($,"binary",Y.message,W);break}case"contentEncoding:base64":{t($,"contentEncoding","base64",Y.message,W);break}case"pattern:zod":{p0($,N1.base64,Y.message,W);break}}break}case"nanoid":p0($,N1.nanoid,Y.message,W);case"toLowerCase":case"toUpperCase":case"trim":break;default:((J)=>{})(Y)}return $}function h$(Q,W){return W.patternStrategy==="escape"?KD(Q):Q}var BD=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function KD(Q){let W="";for(let $=0;$<Q.length;$++){if(!BD.has(Q[$]))W+="\\";W+=Q[$]}return W}function M1(Q,W,$,Y){if(Q.format||Q.anyOf?.some((J)=>J.format)){if(!Q.anyOf)Q.anyOf=[];if(Q.format){if(Q.anyOf.push({format:Q.format,...Q.errorMessage&&Y.errorMessages&&{errorMessage:{format:Q.errorMessage.format}}}),delete Q.format,Q.errorMessage){if(delete Q.errorMessage.format,Object.keys(Q.errorMessage).length===0)delete Q.errorMessage}}Q.anyOf.push({format:W,...$&&Y.errorMessages&&{errorMessage:{format:$}}})}else t(Q,"format",W,$,Y)}function p0(Q,W,$,Y){if(Q.pattern||Q.allOf?.some((J)=>J.pattern)){if(!Q.allOf)Q.allOf=[];if(Q.pattern){if(Q.allOf.push({pattern:Q.pattern,...Q.errorMessage&&Y.errorMessages&&{errorMessage:{pattern:Q.errorMessage.pattern}}}),delete Q.pattern,Q.errorMessage){if(delete Q.errorMessage.pattern,Object.keys(Q.errorMessage).length===0)delete Q.errorMessage}}Q.allOf.push({pattern:S3(W,Y),...$&&Y.errorMessages&&{errorMessage:{pattern:$}}})}else t(Q,"pattern",S3(W,Y),$,Y)}function S3(Q,W){if(!W.applyRegexFlags||!Q.flags)return Q.source;let $={i:Q.flags.includes("i"),m:Q.flags.includes("m"),s:Q.flags.includes("s")},Y=$.i?Q.source.toLowerCase():Q.source,J="",X=!1,G=!1,H=!1;for(let B=0;B<Y.length;B++){if(X){J+=Y[B],X=!1;continue}if($.i){if(G){if(Y[B].match(/[a-z]/)){if(H)J+=Y[B],J+=`${Y[B-2]}-${Y[B]}`.toUpperCase(),H=!1;else if(Y[B+1]==="-"&&Y[B+2]?.match(/[a-z]/))J+=Y[B],H=!0;else J+=`${Y[B]}${Y[B].toUpperCase()}`;continue}}else if(Y[B].match(/[a-z]/)){J+=`[${Y[B]}${Y[B].toUpperCase()}]`;continue}}if($.m){if(Y[B]==="^"){J+=`(^|(?<=[\r
]))`;continue}else if(Y[B]==="$"){J+=`($|(?=[\r
]))`;continue}}if($.s&&Y[B]==="."){J+=G?`${Y[B]}\r
`:`[${Y[B]}\r
]`;continue}if(J+=Y[B],Y[B]==="\\")X=!0;else if(G&&Y[B]==="]")G=!1;else if(!G&&Y[B]==="[")G=!0}try{new RegExp(J)}catch{return console.warn(`Could not convert regex pattern at ${W.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),Q.source}return J}function BW(Q,W){if(W.target==="openAi")console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead.");if(W.target==="openApi3"&&Q.keyType?._def.typeName===E.ZodEnum)return{type:"object",required:Q.keyType._def.values,properties:Q.keyType._def.values.reduce((Y,J)=>({...Y,[J]:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"properties",J]})??A0(W)}),{}),additionalProperties:W.rejectedAdditionalProperties};let $={type:"object",additionalProperties:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"additionalProperties"]})??W.allowedAdditionalProperties};if(W.target==="openApi3")return $;if(Q.keyType?._def.typeName===E.ZodString&&Q.keyType._def.checks?.length){let{type:Y,...J}=HW(Q.keyType._def,W);return{...$,propertyNames:J}}else if(Q.keyType?._def.typeName===E.ZodEnum)return{...$,propertyNames:{enum:Q.keyType._def.values}};else if(Q.keyType?._def.typeName===E.ZodBranded&&Q.keyType._def.type._def.typeName===E.ZodString&&Q.keyType._def.type._def.checks?.length){let{type:Y,...J}=GW(Q.keyType._def,W);return{...$,propertyNames:J}}return $}function Z3(Q,W){if(W.mapStrategy==="record")return BW(Q,W);let $=u(Q.keyType._def,{...W,currentPath:[...W.currentPath,"items","items","0"]})||A0(W),Y=u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"items","items","1"]})||A0(W);return{type:"array",maxItems:125,items:{type:"array",items:[$,Y],minItems:2,maxItems:2}}}function C3(Q){let W=Q.values,Y=Object.keys(Q.values).filter((X)=>{return typeof W[W[X]]!=="number"}).map((X)=>W[X]),J=Array.from(new Set(Y.map((X)=>typeof X)));return{type:J.length===1?J[0]==="string"?"string":"number":["string","number"],enum:Y}}function v3(Q){return Q.target==="openAi"?void 0:{not:A0({...Q,currentPath:[...Q.currentPath,"not"]})}}function k3(Q){return Q.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var E9={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function _3(Q,W){if(W.target==="openApi3")return T3(Q,W);let $=Q.options instanceof Map?Array.from(Q.options.values()):Q.options;if($.every((Y)=>(Y._def.typeName in E9)&&(!Y._def.checks||!Y._def.checks.length))){let Y=$.reduce((J,X)=>{let G=E9[X._def.typeName];return G&&!J.includes(G)?[...J,G]:J},[]);return{type:Y.length>1?Y:Y[0]}}else if($.every((Y)=>Y._def.typeName==="ZodLiteral"&&!Y.description)){let Y=$.reduce((J,X)=>{let G=typeof X._def.value;switch(G){case"string":case"number":case"boolean":return[...J,G];case"bigint":return[...J,"integer"];case"object":if(X._def.value===null)return[...J,"null"];case"symbol":case"undefined":case"function":default:return J}},[]);if(Y.length===$.length){let J=Y.filter((X,G,H)=>H.indexOf(X)===G);return{type:J.length>1?J:J[0],enum:$.reduce((X,G)=>{return X.includes(G._def.value)?X:[...X,G._def.value]},[])}}}else if($.every((Y)=>Y._def.typeName==="ZodEnum"))return{type:"string",enum:$.reduce((Y,J)=>[...Y,...J._def.values.filter((X)=>!Y.includes(X))],[])};return T3(Q,W)}var T3=(Q,W)=>{let $=(Q.options instanceof Map?Array.from(Q.options.values()):Q.options).map((Y,J)=>u(Y._def,{...W,currentPath:[...W.currentPath,"anyOf",`${J}`]})).filter((Y)=>!!Y&&(!W.strictUnions||typeof Y==="object"&&Object.keys(Y).length>0));return $.length?{anyOf:$}:void 0};function x3(Q,W){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(Q.innerType._def.typeName)&&(!Q.innerType._def.checks||!Q.innerType._def.checks.length)){if(W.target==="openApi3")return{type:E9[Q.innerType._def.typeName],nullable:!0};return{type:[E9[Q.innerType._def.typeName],"null"]}}if(W.target==="openApi3"){let Y=u(Q.innerType._def,{...W,currentPath:[...W.currentPath]});if(Y&&"$ref"in Y)return{allOf:[Y],nullable:!0};return Y&&{...Y,nullable:!0}}let $=u(Q.innerType._def,{...W,currentPath:[...W.currentPath,"anyOf","0"]});return $&&{anyOf:[$,{type:"null"}]}}function y3(Q,W){let $={type:"number"};if(!Q.checks)return $;for(let Y of Q.checks)switch(Y.kind){case"int":$.type="integer",x$($,"type",Y.message,W);break;case"min":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"minimum",Y.value,Y.message,W);else t($,"exclusiveMinimum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMinimum=!0;t($,"minimum",Y.value,Y.message,W)}break;case"max":if(W.target==="jsonSchema7")if(Y.inclusive)t($,"maximum",Y.value,Y.message,W);else t($,"exclusiveMaximum",Y.value,Y.message,W);else{if(!Y.inclusive)$.exclusiveMaximum=!0;t($,"maximum",Y.value,Y.message,W)}break;case"multipleOf":t($,"multipleOf",Y.value,Y.message,W);break}return $}function g3(Q,W){let $=W.target==="openAi",Y={type:"object",properties:{}},J=[],X=Q.shape();for(let H in X){let B=X[H];if(B===void 0||B._def===void 0)continue;let K=VD(B);if(K&&$){if(B._def.typeName==="ZodOptional")B=B._def.innerType;if(!B.isNullable())B=B.nullable();K=!1}let F=u(B._def,{...W,currentPath:[...W.currentPath,"properties",H],propertyPath:[...W.currentPath,"properties",H]});if(F===void 0)continue;if(Y.properties[H]=F,!K)J.push(H)}if(J.length)Y.required=J;let G=FD(Q,W);if(G!==void 0)Y.additionalProperties=G;return Y}function FD(Q,W){if(Q.catchall._def.typeName!=="ZodNever")return u(Q.catchall._def,{...W,currentPath:[...W.currentPath,"additionalProperties"]});switch(Q.unknownKeys){case"passthrough":return W.allowedAdditionalProperties;case"strict":return W.rejectedAdditionalProperties;case"strip":return W.removeAdditionalStrategy==="strict"?W.allowedAdditionalProperties:W.rejectedAdditionalProperties}}function VD(Q){try{return Q.isOptional()}catch{return!0}}var h3=(Q,W)=>{if(W.currentPath.toString()===W.propertyPath?.toString())return u(Q.innerType._def,W);let $=u(Q.innerType._def,{...W,currentPath:[...W.currentPath,"anyOf","1"]});return $?{anyOf:[{not:A0(W)},$]}:A0(W)};var f3=(Q,W)=>{if(W.pipeStrategy==="input")return u(Q.in._def,W);else if(W.pipeStrategy==="output")return u(Q.out._def,W);let $=u(Q.in._def,{...W,currentPath:[...W.currentPath,"allOf","0"]}),Y=u(Q.out._def,{...W,currentPath:[...W.currentPath,"allOf",$?"1":"0"]});return{allOf:[$,Y].filter((J)=>J!==void 0)}};function u3(Q,W){return u(Q.type._def,W)}function l3(Q,W){let Y={type:"array",uniqueItems:!0,items:u(Q.valueType._def,{...W,currentPath:[...W.currentPath,"items"]})};if(Q.minSize)t(Y,"minItems",Q.minSize.value,Q.minSize.message,W);if(Q.maxSize)t(Y,"maxItems",Q.maxSize.value,Q.maxSize.message,W);return Y}function m3(Q,W){if(Q.rest)return{type:"array",minItems:Q.items.length,items:Q.items.map(($,Y)=>u($._def,{...W,currentPath:[...W.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[]),additionalItems:u(Q.rest._def,{...W,currentPath:[...W.currentPath,"additionalItems"]})};else return{type:"array",minItems:Q.items.length,maxItems:Q.items.length,items:Q.items.map(($,Y)=>u($._def,{...W,currentPath:[...W.currentPath,"items",`${Y}`]})).reduce(($,Y)=>Y===void 0?$:[...$,Y],[])}}function c3(Q){return{not:A0(Q)}}function p3(Q){return A0(Q)}var d3=(Q,W)=>{return u(Q.innerType._def,W)};var i3=(Q,W,$)=>{switch(W){case E.ZodString:return HW(Q,$);case E.ZodNumber:return y3(Q,$);case E.ZodObject:return g3(Q,$);case E.ZodBigInt:return M3(Q,$);case E.ZodBoolean:return j3();case E.ZodDate:return y$(Q,$);case E.ZodUndefined:return c3($);case E.ZodNull:return k3($);case E.ZodArray:return N3(Q,$);case E.ZodUnion:case E.ZodDiscriminatedUnion:return _3(Q,$);case E.ZodIntersection:return I3(Q,$);case E.ZodTuple:return m3(Q,$);case E.ZodRecord:return BW(Q,$);case E.ZodLiteral:return b3(Q,$);case E.ZodEnum:return R3(Q);case E.ZodNativeEnum:return C3(Q);case E.ZodNullable:return x3(Q,$);case E.ZodOptional:return h3(Q,$);case E.ZodMap:return Z3(Q,$);case E.ZodSet:return l3(Q,$);case E.ZodLazy:return()=>Q.getter()._def;case E.ZodPromise:return u3(Q,$);case E.ZodNaN:case E.ZodNever:return v3($);case E.ZodEffects:return E3(Q,$);case E.ZodAny:return A0($);case E.ZodUnknown:return p3($);case E.ZodDefault:return P3(Q,$);case E.ZodBranded:return GW(Q,$);case E.ZodReadonly:return d3(Q,$);case E.ZodCatch:return z3(Q,$);case E.ZodPipeline:return f3(Q,$);case E.ZodFunction:case E.ZodVoid:case E.ZodSymbol:return;default:return((Y)=>{return})(W)}};function u(Q,W,$=!1){let Y=W.seen.get(Q);if(W.override){let H=W.override?.(Q,W,Y,$);if(H!==w3)return H}if(Y&&!$){let H=qD(Y,W);if(H!==void 0)return H}let J={def:Q,path:W.currentPath,jsonSchema:void 0};W.seen.set(Q,J);let X=i3(Q,Q.typeName,W),G=typeof X==="function"?u(X(),W):X;if(G)LD(Q,W,G);if(W.postProcess){let H=W.postProcess(G,Q,W);return J.jsonSchema=G,H}return J.jsonSchema=G,G}var qD=(Q,W)=>{switch(W.$refStrategy){case"root":return{$ref:Q.path.join("/")};case"relative":return{$ref:XW(W.currentPath,Q.path)};case"none":case"seen":{if(Q.path.length<W.currentPath.length&&Q.path.every(($,Y)=>W.currentPath[Y]===$))return console.warn(`Recursive reference detected at ${W.currentPath.join("/")}! Defaulting to any`),A0(W);return W.$refStrategy==="seen"?A0(W):void 0}}},LD=(Q,W,$)=>{if(Q.description){if($.description=Q.description,W.markdownDescription)$.markdownDescription=Q.description}return $};var f$=(Q,W)=>{let $=O3(W),Y=typeof W==="object"&&W.definitions?Object.entries(W.definitions).reduce((B,[K,F])=>({...B,[K]:u(F._def,{...$,currentPath:[...$.basePath,$.definitionPath,K]},!0)??A0($)}),{}):void 0,J=typeof W==="string"?W:W?.nameStrategy==="title"?void 0:W?.name,X=u(Q._def,J===void 0?$:{...$,currentPath:[...$.basePath,$.definitionPath,J]},!1)??A0($),G=typeof W==="object"&&W.name!==void 0&&W.nameStrategy==="title"?W.name:void 0;if(G!==void 0)X.title=G;if($.flags.hasReferencedOpenAiAnyType){if(!Y)Y={};if(!Y[$.openAiAnyTypeName])Y[$.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:$.$refStrategy==="relative"?"1":[...$.basePath,$.definitionPath,$.openAiAnyTypeName].join("/")}}}let H=J===void 0?Y?{...X,[$.definitionPath]:Y}:X:{$ref:[...$.$refStrategy==="relative"?[]:$.basePath,$.definitionPath,J].join("/"),[$.definitionPath]:{...Y,[J]:X}};if($.target==="jsonSchema7")H.$schema="http://json-schema.org/draft-07/schema#";else if($.target==="jsonSchema2019-09"||$.target==="openAi")H.$schema="https://json-schema.org/draft/2019-09/schema#";if($.target==="openAi"&&(("anyOf"in H)||("oneOf"in H)||("allOf"in H)||("type"in H)&&Array.isArray(H.type)))console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property.");return H};function UD(Q){if(!Q)return"draft-7";if(Q==="jsonSchema7"||Q==="draft-7")return"draft-7";if(Q==="jsonSchema2019-09"||Q==="draft-2020-12")return"draft-2020-12";return"draft-7"}function u$(Q,W){if(G1(Q))return H$(Q,{target:UD(W?.target),io:W?.pipeStrategy??"input"});return f$(Q,{strictUnions:W?.strictUnions??!0,pipeStrategy:W?.pipeStrategy??"input"})}function l$(Q){let $=H6(Q)?.method;if(!$)throw Error("Schema is missing a method literal");let Y=TQ($);if(typeof Y!=="string")throw Error("Schema method literal must be a string");return Y}function m$(Q,W){let $=G6(Q,W);if(!$.success)throw $.error;return $.data}var DD=60000;class c${constructor(Q){if(this._options=Q,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(uQ,(W)=>{this._oncancel(W)}),this.setNotificationHandler(cQ,(W)=>{this._onprogress(W)}),this.setRequestHandler(mQ,(W)=>({})),this._taskStore=Q?.taskStore,this._taskMessageQueue=Q?.taskMessageQueue,this._taskStore)this.setRequestHandler(pQ,async(W,$)=>{let Y=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!Y)throw new T(g.InvalidParams,"Failed to retrieve task: Task not found");return{...Y}}),this.setRequestHandler(iQ,async(W,$)=>{let Y=async()=>{let J=W.params.taskId;if(this._taskMessageQueue){let G;while(G=await this._taskMessageQueue.dequeue(J,$.sessionId)){if(G.type==="response"||G.type==="error"){let H=G.message,B=H.id,K=this._requestResolvers.get(B);if(K)if(this._requestResolvers.delete(B),G.type==="response")K(H);else{let F=H,q=new T(F.error.code,F.error.message,F.error.data);K(q)}else{let F=G.type==="response"?"Response":"Error";this._onerror(Error(`${F} handler missing for request ${B}`))}continue}await this._transport?.send(G.message,{relatedRequestId:$.requestId})}}let X=await this._taskStore.getTask(J,$.sessionId);if(!X)throw new T(g.InvalidParams,`Task not found: ${J}`);if(!F6(X.status))return await this._waitForTaskUpdate(J,$.signal),await Y();if(F6(X.status)){let G=await this._taskStore.getTaskResult(J,$.sessionId);return this._clearTaskQueue(J),{...G,_meta:{...G._meta,[B6]:{taskId:J}}}}return await Y()};return await Y()}),this.setRequestHandler(nQ,async(W,$)=>{try{let{tasks:Y,nextCursor:J}=await this._taskStore.listTasks(W.params?.cursor,$.sessionId);return{tasks:Y,nextCursor:J,_meta:{}}}catch(Y){throw new T(g.InvalidParams,`Failed to list tasks: ${Y instanceof Error?Y.message:String(Y)}`)}}),this.setRequestHandler(rQ,async(W,$)=>{try{let Y=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!Y)throw new T(g.InvalidParams,`Task not found: ${W.params.taskId}`);if(F6(Y.status))throw new T(g.InvalidParams,`Cannot cancel task in terminal status: ${Y.status}`);await this._taskStore.updateTaskStatus(W.params.taskId,"cancelled","Client cancelled task execution.",$.sessionId),this._clearTaskQueue(W.params.taskId);let J=await this._taskStore.getTask(W.params.taskId,$.sessionId);if(!J)throw new T(g.InvalidParams,`Task not found after cancellation: ${W.params.taskId}`);return{_meta:{},...J}}catch(Y){if(Y instanceof T)throw Y;throw new T(g.InvalidRequest,`Failed to cancel task: ${Y instanceof Error?Y.message:String(Y)}`)}})}async _oncancel(Q){if(!Q.params.requestId)return;this._requestHandlerAbortControllers.get(Q.params.requestId)?.abort(Q.params.reason)}_setupTimeout(Q,W,$,Y,J=!1){this._timeoutInfo.set(Q,{timeoutId:setTimeout(Y,W),startTime:Date.now(),timeout:W,maxTotalTimeout:$,resetTimeoutOnProgress:J,onTimeout:Y})}_resetTimeout(Q){let W=this._timeoutInfo.get(Q);if(!W)return!1;let $=Date.now()-W.startTime;if(W.maxTotalTimeout&&$>=W.maxTotalTimeout)throw this._timeoutInfo.delete(Q),T.fromError(g.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:W.maxTotalTimeout,totalElapsed:$});return clearTimeout(W.timeoutId),W.timeoutId=setTimeout(W.onTimeout,W.timeout),!0}_cleanupTimeout(Q){let W=this._timeoutInfo.get(Q);if(W)clearTimeout(W.timeoutId),this._timeoutInfo.delete(Q)}async connect(Q){this._transport=Q;let W=this.transport?.onclose;this._transport.onclose=()=>{W?.(),this._onclose()};let $=this.transport?.onerror;this._transport.onerror=(J)=>{$?.(J),this._onerror(J)};let Y=this._transport?.onmessage;this._transport.onmessage=(J,X)=>{if(Y?.(J,X),p1(J)||j8(J))this._onresponse(J);else if(K6(J))this._onrequest(J,X);else if(J3(J))this._onnotification(J);else this._onerror(Error(`Unknown message type: ${JSON.stringify(J)}`))},await this._transport.start()}_onclose(){let Q=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let W=T.fromError(g.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let $ of Q.values())$(W)}_onerror(Q){this.onerror?.(Q)}_onnotification(Q){let W=this._notificationHandlers.get(Q.method)??this.fallbackNotificationHandler;if(W===void 0)return;Promise.resolve().then(()=>W(Q)).catch(($)=>this._onerror(Error(`Uncaught error in notification handler: ${$}`)))}_onrequest(Q,W){let $=this._requestHandlers.get(Q.method)??this.fallbackRequestHandler,Y=this._transport,J=Q.params?._meta?.[B6]?.taskId;if($===void 0){let K={jsonrpc:"2.0",id:Q.id,error:{code:g.MethodNotFound,message:"Method not found"}};if(J&&this._taskMessageQueue)this._enqueueTaskMessage(J,{type:"error",message:K,timestamp:Date.now()},Y?.sessionId).catch((F)=>this._onerror(Error(`Failed to enqueue error response: ${F}`)));else Y?.send(K).catch((F)=>this._onerror(Error(`Failed to send an error response: ${F}`)));return}let X=new AbortController;this._requestHandlerAbortControllers.set(Q.id,X);let G=W3(Q.params)?Q.params.task:void 0,H=this._taskStore?this.requestTaskStore(Q,Y?.sessionId):void 0,B={signal:X.signal,sessionId:Y?.sessionId,_meta:Q.params?._meta,sendNotification:async(K)=>{let F={relatedRequestId:Q.id};if(J)F.relatedTask={taskId:J};await this.notification(K,F)},sendRequest:async(K,F,q)=>{let U={...q,relatedRequestId:Q.id};if(J&&!U.relatedTask)U.relatedTask={taskId:J};let L=U.relatedTask?.taskId??J;if(L&&H)await H.updateTaskStatus(L,"input_required");return await this.request(K,F,U)},authInfo:W?.authInfo,requestId:Q.id,requestInfo:W?.requestInfo,taskId:J,taskStore:H,taskRequestedTtl:G?.ttl,closeSSEStream:W?.closeSSEStream,closeStandaloneSSEStream:W?.closeStandaloneSSEStream};Promise.resolve().then(()=>{if(G)this.assertTaskHandlerCapability(Q.method)}).then(()=>$(Q,B)).then(async(K)=>{if(X.signal.aborted)return;let F={result:K,jsonrpc:"2.0",id:Q.id};if(J&&this._taskMessageQueue)await this._enqueueTaskMessage(J,{type:"response",message:F,timestamp:Date.now()},Y?.sessionId);else await Y?.send(F)},async(K)=>{if(X.signal.aborted)return;let F={jsonrpc:"2.0",id:Q.id,error:{code:Number.isSafeInteger(K.code)?K.code:g.InternalError,message:K.message??"Internal error",...K.data!==void 0&&{data:K.data}}};if(J&&this._taskMessageQueue)await this._enqueueTaskMessage(J,{type:"error",message:F,timestamp:Date.now()},Y?.sessionId);else await Y?.send(F)}).catch((K)=>this._onerror(Error(`Failed to send response: ${K}`))).finally(()=>{this._requestHandlerAbortControllers.delete(Q.id)})}_onprogress(Q){let{progressToken:W,...$}=Q.params,Y=Number(W),J=this._progressHandlers.get(Y);if(!J){this._onerror(Error(`Received a progress notification for an unknown token: ${JSON.stringify(Q)}`));return}let X=this._responseHandlers.get(Y),G=this._timeoutInfo.get(Y);if(G&&X&&G.resetTimeoutOnProgress)try{this._resetTimeout(Y)}catch(H){this._responseHandlers.delete(Y),this._progressHandlers.delete(Y),this._cleanupTimeout(Y),X(H);return}J($)}_onresponse(Q){let W=Number(Q.id),$=this._requestResolvers.get(W);if($){if(this._requestResolvers.delete(W),p1(Q))$(Q);else{let X=new T(Q.error.code,Q.error.message,Q.error.data);$(X)}return}let Y=this._responseHandlers.get(W);if(Y===void 0){this._onerror(Error(`Received a response for an unknown message ID: ${JSON.stringify(Q)}`));return}this._responseHandlers.delete(W),this._cleanupTimeout(W);let J=!1;if(p1(Q)&&Q.result&&typeof Q.result==="object"){let X=Q.result;if(X.task&&typeof X.task==="object"){let G=X.task;if(typeof G.taskId==="string")J=!0,this._taskProgressTokens.set(G.taskId,W)}}if(!J)this._progressHandlers.delete(W);if(p1(Q))Y(Q);else{let X=T.fromError(Q.error.code,Q.error.message,Q.error.data);Y(X)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(Q,W,$){let{task:Y}=$??{};if(!Y){try{yield{type:"result",result:await this.request(Q,W,$)}}catch(X){yield{type:"error",error:X instanceof T?X:new T(g.InternalError,String(X))}}return}let J;try{let X=await this.request(Q,z8,$);if(X.task)J=X.task.taskId,yield{type:"taskCreated",task:X.task};else throw new T(g.InternalError,"Task creation did not return a task");while(!0){let G=await this.getTask({taskId:J},$);if(yield{type:"taskStatus",task:G},F6(G.status)){if(G.status==="completed")yield{type:"result",result:await this.getTaskResult({taskId:J},W,$)};else if(G.status==="failed")yield{type:"error",error:new T(g.InternalError,`Task ${J} failed`)};else if(G.status==="cancelled")yield{type:"error",error:new T(g.InternalError,`Task ${J} was cancelled`)};return}if(G.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:J},W,$)};return}let H=G.pollInterval??this._options?.defaultTaskPollInterval??1000;await new Promise((B)=>setTimeout(B,H)),$?.signal?.throwIfAborted()}}catch(X){yield{type:"error",error:X instanceof T?X:new T(g.InternalError,String(X))}}}request(Q,W,$){let{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X,task:G,relatedTask:H}=$??{};return new Promise((B,K)=>{let F=(O)=>{K(O)};if(!this._transport){F(Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{if(this.assertCapabilityForMethod(Q.method),G)this.assertTaskCapability(Q.method)}catch(O){F(O);return}$?.signal?.throwIfAborted();let q=this._requestMessageId++,U={...Q,jsonrpc:"2.0",id:q};if($?.onprogress)this._progressHandlers.set(q,$.onprogress),U.params={...Q.params,_meta:{...Q.params?._meta||{},progressToken:q}};if(G)U.params={...U.params,task:G};if(H)U.params={...U.params,_meta:{...U.params?._meta||{},[B6]:H}};let L=(O)=>{this._responseHandlers.delete(q),this._progressHandlers.delete(q),this._cleanupTimeout(q),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:q,reason:String(O)}},{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X}).catch((z)=>this._onerror(Error(`Failed to send cancellation: ${z}`)));let j=O instanceof T?O:new T(g.RequestTimeout,String(O));K(j)};this._responseHandlers.set(q,(O)=>{if($?.signal?.aborted)return;if(O instanceof Error)return K(O);try{let j=G6(W,O.result);if(!j.success)K(j.error);else B(j.data)}catch(j){K(j)}}),$?.signal?.addEventListener("abort",()=>{L($?.signal?.reason)});let D=$?.timeout??DD,w=()=>L(T.fromError(g.RequestTimeout,"Request timed out",{timeout:D}));this._setupTimeout(q,D,$?.maxTotalTimeout,w,$?.resetTimeoutOnProgress??!1);let A=H?.taskId;if(A){let O=(j)=>{let z=this._responseHandlers.get(q);if(z)z(j);else this._onerror(Error(`Response handler missing for side-channeled request ${q}`))};this._requestResolvers.set(q,O),this._enqueueTaskMessage(A,{type:"request",message:U,timestamp:Date.now()}).catch((j)=>{this._cleanupTimeout(q),K(j)})}else this._transport.send(U,{relatedRequestId:Y,resumptionToken:J,onresumptiontoken:X}).catch((O)=>{this._cleanupTimeout(q),K(O)})})}async getTask(Q,W){return this.request({method:"tasks/get",params:Q},dQ,W)}async getTaskResult(Q,W,$){return this.request({method:"tasks/result",params:Q},W,$)}async listTasks(Q,W){return this.request({method:"tasks/list",params:Q},oQ,W)}async cancelTask(Q,W){return this.request({method:"tasks/cancel",params:Q},G3,W)}async notification(Q,W){if(!this._transport)throw Error("Not connected");this.assertNotificationCapability(Q.method);let $=W?.relatedTask?.taskId;if($){let G={...Q,jsonrpc:"2.0",params:{...Q.params,_meta:{...Q.params?._meta||{},[B6]:W.relatedTask}}};await this._enqueueTaskMessage($,{type:"notification",message:G,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(Q.method)&&!Q.params&&!W?.relatedRequestId&&!W?.relatedTask){if(this._pendingDebouncedNotifications.has(Q.method))return;this._pendingDebouncedNotifications.add(Q.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(Q.method),!this._transport)return;let G={...Q,jsonrpc:"2.0"};if(W?.relatedTask)G={...G,params:{...G.params,_meta:{...G.params?._meta||{},[B6]:W.relatedTask}}};this._transport?.send(G,W).catch((H)=>this._onerror(H))});return}let X={...Q,jsonrpc:"2.0"};if(W?.relatedTask)X={...X,params:{...X.params,_meta:{...X.params?._meta||{},[B6]:W.relatedTask}}};await this._transport.send(X,W)}setRequestHandler(Q,W){let $=l$(Q);this.assertRequestHandlerCapability($),this._requestHandlers.set($,(Y,J)=>{let X=m$(Q,Y);return Promise.resolve(W(X,J))})}removeRequestHandler(Q){this._requestHandlers.delete(Q)}assertCanSetRequestHandler(Q){if(this._requestHandlers.has(Q))throw Error(`A request handler for ${Q} already exists, which would be overridden`)}setNotificationHandler(Q,W){let $=l$(Q);this._notificationHandlers.set($,(Y)=>{let J=m$(Q,Y);return Promise.resolve(W(J))})}removeNotificationHandler(Q){this._notificationHandlers.delete(Q)}_cleanupTaskProgressHandler(Q){let W=this._taskProgressTokens.get(Q);if(W!==void 0)this._progressHandlers.delete(W),this._taskProgressTokens.delete(Q)}async _enqueueTaskMessage(Q,W,$){if(!this._taskStore||!this._taskMessageQueue)throw Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let Y=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(Q,W,$,Y)}async _clearTaskQueue(Q,W){if(this._taskMessageQueue){let $=await this._taskMessageQueue.dequeueAll(Q,W);for(let Y of $)if(Y.type==="request"&&K6(Y.message)){let J=Y.message.id,X=this._requestResolvers.get(J);if(X)X(new T(g.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(J);else this._onerror(Error(`Resolver missing for request ${J} during task ${Q} cleanup`))}}}async _waitForTaskUpdate(Q,W){let $=this._options?.defaultTaskPollInterval??1000;try{let Y=await this._taskStore?.getTask(Q);if(Y?.pollInterval)$=Y.pollInterval}catch{}return new Promise((Y,J)=>{if(W.aborted){J(new T(g.InvalidRequest,"Request cancelled"));return}let X=setTimeout(Y,$);W.addEventListener("abort",()=>{clearTimeout(X),J(new T(g.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(Q,W){let $=this._taskStore;if(!$)throw Error("No task store configured");return{createTask:async(Y)=>{if(!Q)throw Error("No request provided");return await $.createTask(Y,Q.id,{method:Q.method,params:Q.params},W)},getTask:async(Y)=>{let J=await $.getTask(Y,W);if(!J)throw new T(g.InvalidParams,"Failed to retrieve task: Task not found");return J},storeTaskResult:async(Y,J,X)=>{await $.storeTaskResult(Y,J,X,W);let G=await $.getTask(Y,W);if(G){let H=j9.parse({method:"notifications/tasks/status",params:G});if(await this.notification(H),F6(G.status))this._cleanupTaskProgressHandler(Y)}},getTaskResult:(Y)=>{return $.getTaskResult(Y,W)},updateTaskStatus:async(Y,J,X)=>{let G=await $.getTask(Y,W);if(!G)throw new T(g.InvalidParams,`Task "${Y}" not found - it may have been cleaned up`);if(F6(G.status))throw new T(g.InvalidParams,`Cannot update task "${Y}" from terminal status "${G.status}" to "${J}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await $.updateTaskStatus(Y,J,X,W);let H=await $.getTask(Y,W);if(H){let B=j9.parse({method:"notifications/tasks/status",params:H});if(await this.notification(B),F6(H.status))this._cleanupTaskProgressHandler(Y)}},listTasks:(Y)=>{return $.listTasks(Y,W)}}}}function n3(Q){return Q!==null&&typeof Q==="object"&&!Array.isArray(Q)}function o3(Q,W){let $={...Q};for(let Y in W){let J=Y,X=W[J];if(X===void 0)continue;let G=$[J];if(n3(G)&&n3(X))$[J]={...G,...X};else $[J]=X}return $}var rB=QJ(O7(),1),aB=QJ(oB(),1);function Xj(){let Q=new rB.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return aB.default(Q),Q}class I7{constructor(Q){this._ajv=Q??Xj()}getValidator(Q){let W="$id"in Q&&typeof Q.$id==="string"?this._ajv.getSchema(Q.$id)??this._ajv.compile(Q):this._ajv.compile(Q);return($)=>{if(W($))return{valid:!0,data:$,errorMessage:void 0};else return{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(W.errors)}}}}class b7{constructor(Q){this._server=Q}requestStream(Q,W,$){return this._server.requestStream(Q,W,$)}async getTask(Q,W){return this._server.getTask({taskId:Q},W)}async getTaskResult(Q,W,$){return this._server.getTaskResult({taskId:Q},W,$)}async listTasks(Q,W){return this._server.listTasks(Q?{cursor:Q}:void 0,W)}async cancelTask(Q,W){return this._server.cancelTask({taskId:Q},W)}}function tB(Q,W,$){if(!Q)throw Error(`${$} does not support task creation (required for ${W})`);switch(W){case"tools/call":if(!Q.tools?.call)throw Error(`${$} does not support task creation for tools/call (required for ${W})`);break;default:break}}function sB(Q,W,$){if(!Q)throw Error(`${$} does not support task creation (required for ${W})`);switch(W){case"sampling/createMessage":if(!Q.sampling?.createMessage)throw Error(`${$} does not support task creation for sampling/createMessage (required for ${W})`);break;case"elicitation/create":if(!Q.elicitation?.create)throw Error(`${$} does not support task creation for elicitation/create (required for ${W})`);break;default:break}}class S7 extends c${constructor(Q,W){super(W);if(this._serverInfo=Q,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(P9.options.map(($,Y)=>[$,Y])),this.isMessageIgnored=($,Y)=>{let J=this._loggingLevels.get(Y);return J?this.LOG_LEVEL_SEVERITY.get($)<this.LOG_LEVEL_SEVERITY.get(J):!1},this._capabilities=W?.capabilities??{},this._instructions=W?.instructions,this._jsonSchemaValidator=W?.jsonSchemaValidator??new I7,this.setRequestHandler(lQ,($)=>this._oninitialize($)),this.setNotificationHandler(E$,()=>this.oninitialized?.()),this._capabilities.logging)this.setRequestHandler(v$,async($,Y)=>{let J=Y.sessionId||Y.requestInfo?.headers["mcp-session-id"]||void 0,{level:X}=$.params,G=P9.safeParse(X);if(G.success)this._loggingLevels.set(J,G.data);return{}})}get experimental(){if(!this._experimental)this._experimental={tasks:new b7(this)};return this._experimental}registerCapabilities(Q){if(this.transport)throw Error("Cannot register capabilities after connecting to transport");this._capabilities=o3(this._capabilities,Q)}setRequestHandler(Q,W){let Y=H6(Q)?.method;if(!Y)throw Error("Schema is missing a method literal");let J;if(G1(Y)){let G=Y;J=G._zod?.def?.value??G.value}else{let G=Y;J=G._def?.value??G.value}if(typeof J!=="string")throw Error("Schema method literal must be a string");if(J==="tools/call"){let G=async(H,B)=>{let K=G6(E8,H);if(!K.success){let L=K.error instanceof Error?K.error.message:String(K.error);throw new T(g.InvalidParams,`Invalid tools/call request: ${L}`)}let{params:F}=K.data,q=await Promise.resolve(W(H,B));if(F.task){let L=G6(z8,q);if(!L.success){let D=L.error instanceof Error?L.error.message:String(L.error);throw new T(g.InvalidParams,`Invalid task creation result: ${D}`)}return L.data}let U=G6($W,q);if(!U.success){let L=U.error instanceof Error?U.error.message:String(U.error);throw new T(g.InvalidParams,`Invalid tools/call result: ${L}`)}return U.data};return super.setRequestHandler(Q,G)}return super.setRequestHandler(Q,W)}assertCapabilityForMethod(Q){switch(Q){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw Error(`Client does not support sampling (required for ${Q})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw Error(`Client does not support elicitation (required for ${Q})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw Error(`Client does not support listing roots (required for ${Q})`);break;case"ping":break}}assertNotificationCapability(Q){switch(Q){case"notifications/message":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Q})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw Error(`Server does not support notifying about resources (required for ${Q})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw Error(`Server does not support notifying of tool list changes (required for ${Q})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw Error(`Server does not support notifying of prompt list changes (required for ${Q})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw Error(`Client does not support URL elicitation (required for ${Q})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(Q){if(!this._capabilities)return;switch(Q){case"completion/complete":if(!this._capabilities.completions)throw Error(`Server does not support completions (required for ${Q})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Q})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw Error(`Server does not support prompts (required for ${Q})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw Error(`Server does not support resources (required for ${Q})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Server does not support tools (required for ${Q})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw Error(`Server does not support tasks capability (required for ${Q})`);break;case"ping":case"initialize":break}}assertTaskCapability(Q){sB(this._clientCapabilities?.tasks?.requests,Q,"Client")}assertTaskHandlerCapability(Q){if(!this._capabilities)return;tB(this._capabilities.tasks?.requests,Q,"Server")}async _oninitialize(Q){let W=Q.params.protocolVersion;return this._clientCapabilities=Q.params.capabilities,this._clientVersion=Q.params.clientInfo,{protocolVersion:D9.includes(W)?W:O$,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},fQ)}async createMessage(Q,W){if(Q.tools||Q.toolChoice){if(!this._clientCapabilities?.sampling?.tools)throw Error("Client does not support sampling tools capability.")}if(Q.messages.length>0){let $=Q.messages[Q.messages.length-1],Y=Array.isArray($.content)?$.content:[$.content],J=Y.some((B)=>B.type==="tool_result"),X=Q.messages.length>1?Q.messages[Q.messages.length-2]:void 0,G=X?Array.isArray(X.content)?X.content:[X.content]:[],H=G.some((B)=>B.type==="tool_use");if(J){if(Y.some((B)=>B.type!=="tool_result"))throw Error("The last message must contain only tool_result content if any is present");if(!H)throw Error("tool_result blocks are not matching any tool_use from the previous message")}if(H){let B=new Set(G.filter((F)=>F.type==="tool_use").map((F)=>F.id)),K=new Set(Y.filter((F)=>F.type==="tool_result").map((F)=>F.toolUseId));if(B.size!==K.size||![...B].every((F)=>K.has(F)))throw Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}if(Q.tools)return this.request({method:"sampling/createMessage",params:Q},T$,W);return this.request({method:"sampling/createMessage",params:Q},k$,W)}async elicitInput(Q,W){switch(Q.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support url elicitation.");let Y=Q;return this.request({method:"elicitation/create",params:Y},YW,W)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw Error("Client does not support form elicitation.");let Y=Q.mode==="form"?Q:{...Q,mode:"form"},J=await this.request({method:"elicitation/create",params:Y},YW,W);if(J.action==="accept"&&J.content&&Y.requestedSchema)try{let G=this._jsonSchemaValidator.getValidator(Y.requestedSchema)(J.content);if(!G.valid)throw new T(g.InvalidParams,`Elicitation response content does not match requested schema: ${G.errorMessage}`)}catch(X){if(X instanceof T)throw X;throw new T(g.InternalError,`Error validating elicitation response: ${X instanceof Error?X.message:String(X)}`)}return J}}}createElicitationCompletionNotifier(Q,W){if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:Q}},W)}async listRoots(Q,W){return this.request({method:"roots/list",params:Q},_$,W)}async sendLoggingMessage(Q,W){if(this._capabilities.logging){if(!this.isMessageIgnored(Q.level,W))return this.notification({method:"notifications/message",params:Q})}}async sendResourceUpdated(Q){return this.notification({method:"notifications/resources/updated",params:Q})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}var QK=Symbol.for("mcp.completable");function Z7(Q){return!!Q&&typeof Q==="object"&&QK in Q}function WK(Q){return Q[QK]?.complete}var eB;(function(Q){Q.Completable="McpCompletable"})(eB||(eB={}));class r1{static isTemplate(Q){return/\{[^}\s]+\}/.test(Q)}static validateLength(Q,W,$){if(Q.length>W)throw Error(`${$} exceeds maximum length of ${W} characters (got ${Q.length})`)}get variableNames(){return this.parts.flatMap((Q)=>typeof Q==="string"?[]:Q.names)}constructor(Q){r1.validateLength(Q,1e6,"Template"),this.template=Q,this.parts=this.parse(Q)}toString(){return this.template}parse(Q){let W=[],$="",Y=0,J=0;while(Y<Q.length)if(Q[Y]==="{"){if($)W.push($),$="";let X=Q.indexOf("}",Y);if(X===-1)throw Error("Unclosed template expression");if(J++,J>1e4)throw Error("Template contains too many expressions (max 10000)");let G=Q.slice(Y+1,X),H=this.getOperator(G),B=G.includes("*"),K=this.getNames(G),F=K[0];for(let q of K)r1.validateLength(q,1e6,"Variable name");W.push({name:F,operator:H,names:K,exploded:B}),Y=X+1}else $+=Q[Y],Y++;if($)W.push($);return W}getOperator(Q){return["+","#",".","/","?","&"].find(($)=>Q.startsWith($))||""}getNames(Q){let W=this.getOperator(Q);return Q.slice(W.length).split(",").map(($)=>$.replace("*","").trim()).filter(($)=>$.length>0)}encodeValue(Q,W){if(r1.validateLength(Q,1e6,"Variable value"),W==="+"||W==="#")return encodeURI(Q);return encodeURIComponent(Q)}expandPart(Q,W){if(Q.operator==="?"||Q.operator==="&"){let X=Q.names.map((H)=>{let B=W[H];if(B===void 0)return"";let K=Array.isArray(B)?B.map((F)=>this.encodeValue(F,Q.operator)).join(","):this.encodeValue(B.toString(),Q.operator);return`${H}=${K}`}).filter((H)=>H.length>0);if(X.length===0)return"";return(Q.operator==="?"?"?":"&")+X.join("&")}if(Q.names.length>1){let X=Q.names.map((G)=>W[G]).filter((G)=>G!==void 0);if(X.length===0)return"";return X.map((G)=>Array.isArray(G)?G[0]:G).join(",")}let $=W[Q.name];if($===void 0)return"";let J=(Array.isArray($)?$:[$]).map((X)=>this.encodeValue(X,Q.operator));switch(Q.operator){case"":return J.join(",");case"+":return J.join(",");case"#":return"#"+J.join(",");case".":return"."+J.join(".");case"/":return"/"+J.join("/");default:return J.join(",")}}expand(Q){let W="",$=!1;for(let Y of this.parts){if(typeof Y==="string"){W+=Y;continue}let J=this.expandPart(Y,Q);if(!J)continue;if((Y.operator==="?"||Y.operator==="&")&&$)W+=J.replace("?","&");else W+=J;if(Y.operator==="?"||Y.operator==="&")$=!0}return W}escapeRegExp(Q){return Q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}partToRegExp(Q){let W=[];for(let J of Q.names)r1.validateLength(J,1e6,"Variable name");if(Q.operator==="?"||Q.operator==="&"){for(let J=0;J<Q.names.length;J++){let X=Q.names[J],G=J===0?"\\"+Q.operator:"&";W.push({pattern:G+this.escapeRegExp(X)+"=([^&]+)",name:X})}return W}let $,Y=Q.name;switch(Q.operator){case"":$=Q.exploded?"([^/,]+(?:,[^/,]+)*)":"([^/,]+)";break;case"+":case"#":$="(.+)";break;case".":$="\\.([^/,]+)";break;case"/":$="/"+(Q.exploded?"([^/,]+(?:,[^/,]+)*)":"([^/,]+)");break;default:$="([^/]+)"}return W.push({pattern:$,name:Y}),W}match(Q){r1.validateLength(Q,1e6,"URI");let W="^",$=[];for(let G of this.parts)if(typeof G==="string")W+=this.escapeRegExp(G);else{let H=this.partToRegExp(G);for(let{pattern:B,name:K}of H)W+=B,$.push({name:K,exploded:G.exploded})}W+="$",r1.validateLength(W,1e6,"Generated regex pattern");let Y=new RegExp(W),J=Q.match(Y);if(!J)return null;let X={};for(let G=0;G<$.length;G++){let{name:H,exploded:B}=$[G],K=J[G+1],F=H.replace("*","");if(B&&K.includes(","))X[F]=K.split(",");else X[F]=K}return X}}var Gj=/^[A-Za-z0-9._-]{1,128}$/;function Hj(Q){let W=[];if(Q.length===0)return{isValid:!1,warnings:["Tool name cannot be empty"]};if(Q.length>128)return{isValid:!1,warnings:[`Tool name exceeds maximum length of 128 characters (current: ${Q.length})`]};if(Q.includes(" "))W.push("Tool name contains spaces, which may cause parsing issues");if(Q.includes(","))W.push("Tool name contains commas, which may cause parsing issues");if(Q.startsWith("-")||Q.endsWith("-"))W.push("Tool name starts or ends with a dash, which may cause parsing issues in some contexts");if(Q.startsWith(".")||Q.endsWith("."))W.push("Tool name starts or ends with a dot, which may cause parsing issues in some contexts");if(!Gj.test(Q)){let $=Q.split("").filter((Y)=>!/[A-Za-z0-9._-]/.test(Y)).filter((Y,J,X)=>X.indexOf(Y)===J);return W.push(`Tool name contains invalid characters: ${$.map((Y)=>`"${Y}"`).join(", ")}`,"Allowed characters are: A-Z, a-z, 0-9, underscore (_), dash (-), and dot (.)"),{isValid:!1,warnings:W}}return{isValid:!0,warnings:W}}function Bj(Q,W){if(W.length>0){console.warn(`Tool name validation warning for "${Q}":`);for(let $ of W)console.warn(`  - ${$}`);console.warn("Tool registration will proceed, but this may cause compatibility issues."),console.warn("Consider updating the tool name to conform to the MCP tool naming standard."),console.warn("See SEP: Specify Format for Tool Names (https://github.com/modelcontextprotocol/modelcontextprotocol/issues/986) for more details.")}}function C7(Q){let W=Hj(Q);return Bj(Q,W.warnings),W.isValid}class v7{constructor(Q){this._mcpServer=Q}registerToolTask(Q,W,$){let Y={taskSupport:"required",...W.execution};if(Y.taskSupport==="forbidden")throw Error(`Cannot register task-based tool '${Q}' with taskSupport 'forbidden'. Use registerTool() instead.`);return this._mcpServer._createRegisteredTool(Q,W.title,W.description,W.inputSchema,W.outputSchema,W.annotations,Y,W._meta,$)}}class T7{constructor(Q,W){this._registeredResources={},this._registeredResourceTemplates={},this._registeredTools={},this._registeredPrompts={},this._toolHandlersInitialized=!1,this._completionHandlerInitialized=!1,this._resourceHandlersInitialized=!1,this._promptHandlersInitialized=!1,this.server=new S7(Q,W)}get experimental(){if(!this._experimental)this._experimental={tasks:new v7(this)};return this._experimental}async connect(Q){return await this.server.connect(Q)}async close(){await this.server.close()}setToolRequestHandlers(){if(this._toolHandlersInitialized)return;this.server.assertCanSetRequestHandler(j6(WW)),this.server.assertCanSetRequestHandler(j6(E8)),this.server.registerCapabilities({tools:{listChanged:!0}}),this.server.setRequestHandler(WW,()=>({tools:Object.entries(this._registeredTools).filter(([,Q])=>Q.enabled).map(([Q,W])=>{let $={name:Q,title:W.title,description:W.description,inputSchema:(()=>{let Y=N8(W.inputSchema);return Y?u$(Y,{strictUnions:!0,pipeStrategy:"input"}):Kj})(),annotations:W.annotations,execution:W.execution,_meta:W._meta};if(W.outputSchema){let Y=N8(W.outputSchema);if(Y)$.outputSchema=u$(Y,{strictUnions:!0,pipeStrategy:"output"})}return $})})),this.server.setRequestHandler(E8,async(Q,W)=>{try{let $=this._registeredTools[Q.params.name];if(!$)throw new T(g.InvalidParams,`Tool ${Q.params.name} not found`);if(!$.enabled)throw new T(g.InvalidParams,`Tool ${Q.params.name} disabled`);let Y=!!Q.params.task,J=$.execution?.taskSupport,X="createTask"in $.handler;if((J==="required"||J==="optional")&&!X)throw new T(g.InternalError,`Tool ${Q.params.name} has taskSupport '${J}' but was not registered with registerToolTask`);if(J==="required"&&!Y)throw new T(g.MethodNotFound,`Tool ${Q.params.name} requires task augmentation (taskSupport: 'required')`);if(J==="optional"&&!Y&&X)return await this.handleAutomaticTaskPolling($,Q,W);let G=await this.validateToolInput($,Q.params.arguments,Q.params.name),H=await this.executeToolHandler($,G,W);if(Y)return H;return await this.validateToolOutput($,H,Q.params.name),H}catch($){if($ instanceof T){if($.code===g.UrlElicitationRequired)throw $}return this.createToolError($ instanceof Error?$.message:String($))}}),this._toolHandlersInitialized=!0}createToolError(Q){return{content:[{type:"text",text:Q}],isError:!0}}async validateToolInput(Q,W,$){if(!Q.inputSchema)return;let J=N8(Q.inputSchema)??Q.inputSchema,X=await vQ(J,W);if(!X.success){let G="error"in X?X.error:"Unknown error",H=kQ(G);throw new T(g.InvalidParams,`Input validation error: Invalid arguments for tool ${$}: ${H}`)}return X.data}async validateToolOutput(Q,W,$){if(!Q.outputSchema)return;if(!("content"in W))return;if(W.isError)return;if(!W.structuredContent)throw new T(g.InvalidParams,`Output validation error: Tool ${$} has an output schema but no structured content was provided`);let Y=N8(Q.outputSchema),J=await vQ(Y,W.structuredContent);if(!J.success){let X="error"in J?J.error:"Unknown error",G=kQ(X);throw new T(g.InvalidParams,`Output validation error: Invalid structured content for tool ${$}: ${G}`)}}async executeToolHandler(Q,W,$){let Y=Q.handler;if("createTask"in Y){if(!$.taskStore)throw Error("No task store provided.");let X={...$,taskStore:$.taskStore};if(Q.inputSchema)return await Promise.resolve(Y.createTask(W,X));else return await Promise.resolve(Y.createTask(X))}if(Q.inputSchema)return await Promise.resolve(Y(W,$));else return await Promise.resolve(Y($))}async handleAutomaticTaskPolling(Q,W,$){if(!$.taskStore)throw Error("No task store provided for task-capable tool.");let Y=await this.validateToolInput(Q,W.params.arguments,W.params.name),J=Q.handler,X={...$,taskStore:$.taskStore},G=Y?await Promise.resolve(J.createTask(Y,X)):await Promise.resolve(J.createTask(X)),H=G.task.taskId,B=G.task,K=B.pollInterval??5000;while(B.status!=="completed"&&B.status!=="failed"&&B.status!=="cancelled"){await new Promise((q)=>setTimeout(q,K));let F=await $.taskStore.getTask(H);if(!F)throw new T(g.InternalError,`Task ${H} not found during polling`);B=F}return await $.taskStore.getTaskResult(H)}setCompletionRequestHandler(){if(this._completionHandlerInitialized)return;this.server.assertCanSetRequestHandler(j6(JW)),this.server.registerCapabilities({completions:{}}),this.server.setRequestHandler(JW,async(Q)=>{switch(Q.params.ref.type){case"ref/prompt":return q3(Q),this.handlePromptCompletion(Q,Q.params.ref);case"ref/resource":return L3(Q),this.handleResourceCompletion(Q,Q.params.ref);default:throw new T(g.InvalidParams,`Invalid completion reference: ${Q.params.ref}`)}}),this._completionHandlerInitialized=!0}async handlePromptCompletion(Q,W){let $=this._registeredPrompts[W.name];if(!$)throw new T(g.InvalidParams,`Prompt ${W.name} not found`);if(!$.enabled)throw new T(g.InvalidParams,`Prompt ${W.name} disabled`);if(!$.argsSchema)return a9;let J=H6($.argsSchema)?.[Q.params.argument.name];if(!Z7(J))return a9;let X=WK(J);if(!X)return a9;let G=await X(Q.params.argument.value,Q.params.context);return YK(G)}async handleResourceCompletion(Q,W){let $=Object.values(this._registeredResourceTemplates).find((X)=>X.resourceTemplate.uriTemplate.toString()===W.uri);if(!$){if(this._registeredResources[W.uri])return a9;throw new T(g.InvalidParams,`Resource template ${Q.params.ref.uri} not found`)}let Y=$.resourceTemplate.completeCallback(Q.params.argument.name);if(!Y)return a9;let J=await Y(Q.params.argument.value,Q.params.context);return YK(J)}setResourceRequestHandlers(){if(this._resourceHandlersInitialized)return;this.server.assertCanSetRequestHandler(j6(aQ)),this.server.assertCanSetRequestHandler(j6(tQ)),this.server.assertCanSetRequestHandler(j6(sQ)),this.server.registerCapabilities({resources:{listChanged:!0}}),this.server.setRequestHandler(aQ,async(Q,W)=>{let $=Object.entries(this._registeredResources).filter(([J,X])=>X.enabled).map(([J,X])=>({uri:J,name:X.name,...X.metadata})),Y=[];for(let J of Object.values(this._registeredResourceTemplates)){if(!J.resourceTemplate.listCallback)continue;let X=await J.resourceTemplate.listCallback(W);for(let G of X.resources)Y.push({...J.metadata,...G})}return{resources:[...$,...Y]}}),this.server.setRequestHandler(tQ,async()=>{return{resourceTemplates:Object.entries(this._registeredResourceTemplates).map(([W,$])=>({name:W,uriTemplate:$.resourceTemplate.uriTemplate.toString(),...$.metadata}))}}),this.server.setRequestHandler(sQ,async(Q,W)=>{let $=new URL(Q.params.uri),Y=this._registeredResources[$.toString()];if(Y){if(!Y.enabled)throw new T(g.InvalidParams,`Resource ${$} disabled`);return Y.readCallback($,W)}for(let J of Object.values(this._registeredResourceTemplates)){let X=J.resourceTemplate.uriTemplate.match($.toString());if(X)return J.readCallback($,X,W)}throw new T(g.InvalidParams,`Resource ${$} not found`)}),this._resourceHandlersInitialized=!0}setPromptRequestHandlers(){if(this._promptHandlersInitialized)return;this.server.assertCanSetRequestHandler(j6(eQ)),this.server.assertCanSetRequestHandler(j6(QW)),this.server.registerCapabilities({prompts:{listChanged:!0}}),this.server.setRequestHandler(eQ,()=>({prompts:Object.entries(this._registeredPrompts).filter(([,Q])=>Q.enabled).map(([Q,W])=>{return{name:Q,title:W.title,description:W.description,arguments:W.argsSchema?Vj(W.argsSchema):void 0}})})),this.server.setRequestHandler(QW,async(Q,W)=>{let $=this._registeredPrompts[Q.params.name];if(!$)throw new T(g.InvalidParams,`Prompt ${Q.params.name} not found`);if(!$.enabled)throw new T(g.InvalidParams,`Prompt ${Q.params.name} disabled`);if($.argsSchema){let Y=N8($.argsSchema),J=await vQ(Y,Q.params.arguments);if(!J.success){let H="error"in J?J.error:"Unknown error",B=kQ(H);throw new T(g.InvalidParams,`Invalid arguments for prompt ${Q.params.name}: ${B}`)}let X=J.data,G=$.callback;return await Promise.resolve(G(X,W))}else{let Y=$.callback;return await Promise.resolve(Y(W))}}),this._promptHandlersInitialized=!0}resource(Q,W,...$){let Y;if(typeof $[0]==="object")Y=$.shift();let J=$[0];if(typeof W==="string"){if(this._registeredResources[W])throw Error(`Resource ${W} is already registered`);let X=this._createRegisteredResource(Q,void 0,W,Y,J);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),X}else{if(this._registeredResourceTemplates[Q])throw Error(`Resource template ${Q} is already registered`);let X=this._createRegisteredResourceTemplate(Q,void 0,W,Y,J);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),X}}registerResource(Q,W,$,Y){if(typeof W==="string"){if(this._registeredResources[W])throw Error(`Resource ${W} is already registered`);let J=this._createRegisteredResource(Q,$.title,W,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}else{if(this._registeredResourceTemplates[Q])throw Error(`Resource template ${Q} is already registered`);let J=this._createRegisteredResourceTemplate(Q,$.title,W,$,Y);return this.setResourceRequestHandlers(),this.sendResourceListChanged(),J}}_createRegisteredResource(Q,W,$,Y,J){let X={name:Q,title:W,metadata:Y,readCallback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({uri:null}),update:(G)=>{if(typeof G.uri<"u"&&G.uri!==$){if(delete this._registeredResources[$],G.uri)this._registeredResources[G.uri]=X}if(typeof G.name<"u")X.name=G.name;if(typeof G.title<"u")X.title=G.title;if(typeof G.metadata<"u")X.metadata=G.metadata;if(typeof G.callback<"u")X.readCallback=G.callback;if(typeof G.enabled<"u")X.enabled=G.enabled;this.sendResourceListChanged()}};return this._registeredResources[$]=X,X}_createRegisteredResourceTemplate(Q,W,$,Y,J){let X={resourceTemplate:$,title:W,metadata:Y,readCallback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({name:null}),update:(B)=>{if(typeof B.name<"u"&&B.name!==Q){if(delete this._registeredResourceTemplates[Q],B.name)this._registeredResourceTemplates[B.name]=X}if(typeof B.title<"u")X.title=B.title;if(typeof B.template<"u")X.resourceTemplate=B.template;if(typeof B.metadata<"u")X.metadata=B.metadata;if(typeof B.callback<"u")X.readCallback=B.callback;if(typeof B.enabled<"u")X.enabled=B.enabled;this.sendResourceListChanged()}};this._registeredResourceTemplates[Q]=X;let G=$.uriTemplate.variableNames;if(Array.isArray(G)&&G.some((B)=>!!$.completeCallback(B)))this.setCompletionRequestHandler();return X}_createRegisteredPrompt(Q,W,$,Y,J){let X={title:W,description:$,argsSchema:Y===void 0?void 0:y6(Y),callback:J,enabled:!0,disable:()=>X.update({enabled:!1}),enable:()=>X.update({enabled:!0}),remove:()=>X.update({name:null}),update:(G)=>{if(typeof G.name<"u"&&G.name!==Q){if(delete this._registeredPrompts[Q],G.name)this._registeredPrompts[G.name]=X}if(typeof G.title<"u")X.title=G.title;if(typeof G.description<"u")X.description=G.description;if(typeof G.argsSchema<"u")X.argsSchema=y6(G.argsSchema);if(typeof G.callback<"u")X.callback=G.callback;if(typeof G.enabled<"u")X.enabled=G.enabled;this.sendPromptListChanged()}};if(this._registeredPrompts[Q]=X,Y){if(Object.values(Y).some((H)=>{let B=H instanceof Q1?H._def?.innerType:H;return Z7(B)}))this.setCompletionRequestHandler()}return X}_createRegisteredTool(Q,W,$,Y,J,X,G,H,B){C7(Q);let K={title:W,description:$,inputSchema:$K(Y),outputSchema:$K(J),annotations:X,execution:G,_meta:H,handler:B,enabled:!0,disable:()=>K.update({enabled:!1}),enable:()=>K.update({enabled:!0}),remove:()=>K.update({name:null}),update:(F)=>{if(typeof F.name<"u"&&F.name!==Q){if(typeof F.name==="string")C7(F.name);if(delete this._registeredTools[Q],F.name)this._registeredTools[F.name]=K}if(typeof F.title<"u")K.title=F.title;if(typeof F.description<"u")K.description=F.description;if(typeof F.paramsSchema<"u")K.inputSchema=y6(F.paramsSchema);if(typeof F.outputSchema<"u")K.outputSchema=y6(F.outputSchema);if(typeof F.callback<"u")K.handler=F.callback;if(typeof F.annotations<"u")K.annotations=F.annotations;if(typeof F._meta<"u")K._meta=F._meta;if(typeof F.enabled<"u")K.enabled=F.enabled;this.sendToolListChanged()}};return this._registeredTools[Q]=K,this.setToolRequestHandlers(),this.sendToolListChanged(),K}tool(Q,...W){if(this._registeredTools[Q])throw Error(`Tool ${Q} is already registered`);let $,Y,J,X;if(typeof W[0]==="string")$=W.shift();if(W.length>1){let H=W[0];if(k7(H)){if(Y=W.shift(),W.length>1&&typeof W[0]==="object"&&W[0]!==null&&!k7(W[0]))X=W.shift()}else if(typeof H==="object"&&H!==null)X=W.shift()}let G=W[0];return this._createRegisteredTool(Q,void 0,$,Y,J,X,{taskSupport:"forbidden"},void 0,G)}registerTool(Q,W,$){if(this._registeredTools[Q])throw Error(`Tool ${Q} is already registered`);let{title:Y,description:J,inputSchema:X,outputSchema:G,annotations:H,_meta:B}=W;return this._createRegisteredTool(Q,Y,J,X,G,H,{taskSupport:"forbidden"},B,$)}prompt(Q,...W){if(this._registeredPrompts[Q])throw Error(`Prompt ${Q} is already registered`);let $;if(typeof W[0]==="string")$=W.shift();let Y;if(W.length>1)Y=W.shift();let J=W[0],X=this._createRegisteredPrompt(Q,void 0,$,Y,J);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),X}registerPrompt(Q,W,$){if(this._registeredPrompts[Q])throw Error(`Prompt ${Q} is already registered`);let{title:Y,description:J,argsSchema:X}=W,G=this._createRegisteredPrompt(Q,Y,J,X,$);return this.setPromptRequestHandlers(),this.sendPromptListChanged(),G}isConnected(){return this.server.transport!==void 0}async sendLoggingMessage(Q,W){return this.server.sendLoggingMessage(Q,W)}sendResourceListChanged(){if(this.isConnected())this.server.sendResourceListChanged()}sendToolListChanged(){if(this.isConnected())this.server.sendToolListChanged()}sendPromptListChanged(){if(this.isConnected())this.server.sendPromptListChanged()}}class nW{constructor(Q,W){this._callbacks=W,this._uriTemplate=typeof Q==="string"?new r1(Q):Q}get uriTemplate(){return this._uriTemplate}get listCallback(){return this._callbacks.list}completeCallback(Q){return this._callbacks.complete?.[Q]}}var Kj={type:"object",properties:{}};function JK(Q){return Q!==null&&typeof Q==="object"&&"parse"in Q&&typeof Q.parse==="function"&&"safeParse"in Q&&typeof Q.safeParse==="function"}function Fj(Q){return"_def"in Q||"_zod"in Q||JK(Q)}function k7(Q){if(typeof Q!=="object"||Q===null)return!1;if(Fj(Q))return!1;if(Object.keys(Q).length===0)return!0;return Object.values(Q).some(JK)}function $K(Q){if(!Q)return;if(k7(Q))return y6(Q);return Q}function Vj(Q){let W=H6(Q);if(!W)return[];return Object.entries(W).map(([$,Y])=>{let J=ZX(Y),X=CX(Y);return{name:$,description:J,required:!X}})}function j6(Q){let $=H6(Q)?.method;if(!$)throw Error("Schema is missing a method literal");let Y=TQ($);if(typeof Y==="string")return Y;throw Error("Schema method literal must be a string")}function YK(Q){return{completion:{values:Q.slice(0,100),total:Q.length,hasMore:Q.length>100}}}var a9={completion:{values:[],hasMore:!1}};var _7=null;function t9(){return new T7({name:"Blockbench MCP",version:Q8})}function s9(){if(!_7)_7=t9();return _7}var Mb=s9();var p6={},d6={},u8={},x7={};function XK(Q){let W=Q._def;if(W.typeName==="ZodObject")return W.shape?.()??{};if(W.typeName==="ZodEffects"&&W.schema)return XK(W.schema);return{}}function R(Q,W,$="stable",Y=!0){if(p6[Q])throw Error(`Tool with name "${Q}" already exists.`);let J=XK(W.parameters),X={title:W.annotations?.title??W.description,description:W.description,inputSchema:J,execute:W.execute,annotations:W.annotations};if(x7[Q]=X,Y){let G=s9();G.registerTool.bind(G)(Q,{title:X.title,description:X.description,inputSchema:J},async(B,K)=>{let q={reportProgress:()=>{}},U=await W.execute(B,q);if(typeof U==="string")return{content:[{type:"text",text:U}]};if(U&&typeof U==="object"&&"content"in U)return U;return{content:[{type:"text",text:JSON.stringify(U)}]}})}return p6[Q]={name:Q,description:X.title,enabled:Y,status:$},p6[Q]}function GK(){return x7}function qj(){return Object.fromEntries(Object.entries(x7).filter(([Q])=>p6[Q]?.enabled))}function HK(Q){let W=qj(),$=Q;for(let[Y,J]of Object.entries(W))$.registerTool(Y,{title:J.title,description:J.description,inputSchema:J.inputSchema},async(X,G)=>{let B={reportProgress:()=>{}},K=await J.execute(X,B);if(typeof K==="string")return{content:[{type:"text",text:K}]};if(K&&typeof K==="object"&&"content"in K)return K;return{content:[{type:"text",text:JSON.stringify(K)}]}})}var BK={};function h1(Q,W){if(u8[Q])throw Error(`Resource with name "${Q}" already exists.`);let $={name:Q,uriTemplate:W.uriTemplate,metadata:{title:W.title,description:W.description},listCallback:W.listCallback,readCallback:W.readCallback};BK[Q]=$;let Y=s9();return Y.registerResource.bind(Y)(Q,new nW(W.uriTemplate,{list:W.listCallback}),{title:W.title,description:W.description},async(X,G)=>{let H=Object.fromEntries(Object.entries(G).map(([B,K])=>{if(Array.isArray(K))return[B,K[0]??""];return[B,K]}));return W.readCallback(X,H)}),u8[Q]={name:Q,description:W.description,uriTemplate:W.uriTemplate},u8[Q]}function KK(Q){let W=Q;for(let[$,Y]of Object.entries(BK))W.registerResource($,new nW(Y.uriTemplate,{list:Y.listCallback}),Y.metadata,async(J,X)=>{let G=Object.fromEntries(Object.entries(X).map(([H,B])=>{if(Array.isArray(B))return[H,B[0]??""];return[H,B]}));return Y.readCallback(J,G)})}var y7={};function z6(Q,W,$="stable",Y=!0){if(d6[Q])throw Error(`Prompt with name "${Q}" already exists.`);if(Y&&W.generate&&W.argsSchema){let J={name:Q,title:W.title||W.description,description:W.description,argsSchema:W.argsSchema.shape,generate:async(X)=>{return await W.generate(X)}};y7[Q]=J,s9().registerPrompt(Q,{title:J.title,description:J.description,argsSchema:J.argsSchema},J.generate)}return d6[Q]={name:Q,arguments:W.argsSchema?.shape||{},description:W.description,enabled:Y,status:$},d6[Q]}function FK(){return y7}function VK(Q){let W=Q;for(let[$,Y]of Object.entries(y7))W.registerPrompt($,{title:Y.title,description:Y.description,argsSchema:Y.argsSchema},Y.generate)}function l8(Q,W="image/png"){let $=typeof Q==="string"?Q:Q.url,Y=$;if($.startsWith("data:")){let J=$.match(/^data:([^;]+);base64,(.+)$/);if(J)W=J[1]||W,Y=J[2]}return{content:[{type:"image",data:Y,mimeType:W}]}}function E0(Q){return(Project?.textures??Texture.all).find(({id:$,name:Y,uuid:J})=>$===Q||Y===Q||J===Q)||null}function u0(Q){let W=Group.all.find(($)=>$.name===Q);if(!W)throw Error(`Bone/group "${Q}" not found. Use the list_outline tool to see available groups and bones.`);return W}function i6(Q){let W=Mesh.all.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Mesh "${Q}" not found. Use the list_outline tool to see available meshes.`);return W}function J1(Q){let W=Outliner.elements.find(($)=>$.uuid===Q||$.name===Q)||Group.all.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Element "${Q}" not found. Use the list_outline tool to see available elements.`);return W}function l0(Q){let W=E0(Q);if(!W)throw Error(`Texture "${Q}" not found. Use the list_textures tool to see available textures.`);return W}function e9(Q){let W=TextureGroup.all.find(($)=>$.uuid===Q||$.name===Q);if(!W)throw Error(`Material/texture group "${Q}" not found. Use the list_materials tool to see available materials.`);return W}function QQ(Q,W){let $=Q.find((Y)=>Y.pbr_channel===W);return $?{name:$.name,uuid:$.uuid,hasTexture:!0}:{hasTexture:!1}}function a1(Q){if(Q)return i6(Q);let W=Mesh.selected[0];if(!W)throw Error("No mesh selected and no mesh_id provided. Select a mesh or provide a mesh_id. Use the list_outline tool to see available meshes.");return W}function g7(Q){let W=Project;if(!W||Q!==void 0)W=ModelProject.all.find((J)=>J.name===Q||J.uuid===Q||J.selected);if(!W)throw Error("No project found in the Blockbench editor.");if(!W.selected)W.select();let $=Preview.selected;if(!$)throw Error("No preview available for the selected project.");let Y;if(Canvas.withoutGizmos(()=>{$.render(),Y=$.canvas.toDataURL()}),!Y)throw Error("Failed to capture preview screenshot.");return l8(Y,"image/png")}async function n6(){return new Promise((Q,W)=>{let $=!1,Y=setTimeout(()=>{if(!$)$=!0,W(Error("App screenshot timed out after 5 seconds."))},5000);Screencam.fullScreen({},(J)=>{if(!$)if($=!0,clearTimeout(Y),J)Q(l8(J,"image/png"));else W(Error("Failed to capture app screenshot - no data returned."))})})}var qK=V.array(V.number()).length(2).describe("2D vector [x, y]."),$0=V.array(V.number()).length(3).describe("3D vector [x, y, z]."),m8=V.enum(["default","set_opacity","color","behind","multiply","add","screen","overlay","difference"]),LK=V.enum(["normal","multiply","screen","overlay","soft_light","hard_light","color_dodge","color_burn","darken","lighten","difference","exclusion"]),Lj=V.enum(["linear","catmullrom","bezier","step"]),c8=V.enum(["x","y","z"]),UK=V.enum(["x","y","z","all"]),oW=V.enum(["rotation","position","scale"]),DK=V.enum(["select","add","remove","toggle"]),rW=V.enum(["square","circle"]),wK=V.enum(["0","1","2"]),P6=V.enum(["north","south","east","west","up","down"]),AK=V.enum(["unset","orthographic","perspective"]),OK=V.enum(["vertex","edge","face"]),NK=V.enum(["project","unwrap","cylinder","sphere"]),MK=V.enum(["color","color_connected","face","element","selected_elements","selection"]),jK=V.enum(["rectangle","rectangle_h","ellipse","ellipse_h"]),zK=V.enum(["copy","sample","pattern"]),h7=V.enum(["none","pressure","tilt"]),f7=V.enum(["color","normal","height","mer"]),PK=V.enum(["default","emissive","additive","layered"]),EK=V.enum(["auto","front","double"]),RK=V.enum(["once","loop","hold"]),IK=V.union([V.array(V.number().min(0).max(255)).length(4).describe("RGBA [R, G, B, A]"),V.string().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/,"Hex color #RRGGBB or #RRGGBBAA"),V.string().regex(/^[a-z]{3,20}$/,"Named color")]),WQ=V.string().optional().describe("Color as hex string (e.g., #FF0000)."),$Q=V.object({start:V.number().describe("Start time in seconds."),end:V.number().describe("End time in seconds.")}),p8=V.string().describe("ID or name of the element."),t1=V.string().optional().describe("ID or name of the mesh. If not provided, uses selected mesh."),d8=V.string().describe("ID or name of the mesh."),x0=V.string().optional().describe("Texture ID or name. If not provided, uses selected texture."),u7=V.string().describe("Texture ID or name."),l7=V.string().optional().describe("Animation UUID or name. If not provided, uses current animation."),aW=V.string().optional().describe("Group/bone ID or name."),m7=V.string().describe("Name of the bone/group."),E6=V.number().min(0).max(255).optional().describe("Opacity (0-255)."),YQ=V.number().min(1).max(100).optional().describe("Brush size."),tW=V.number().min(0).max(100).optional().describe("Brush softness percentage."),f1=V.object({x:V.number().describe("X coordinate."),y:V.number().describe("Y coordinate.")}),c7=V.object({name:V.string(),origin:$0.optional().default([0,0,0]).describe("Pivot point of the cube."),from:$0.optional().default([0,0,0]).describe("Starting point of the cube."),to:$0.optional().default([1,1,1]).describe("Ending point of the cube."),rotation:$0.optional().default([0,0,0]).describe("Rotation of the cube.")}),bK=V.object({name:V.string(),position:$0.optional().default([0,0,0]).describe("Position of the mesh."),rotation:$0.optional().default([0,0,0]).describe("Rotation of the mesh."),scale:$0.optional().default([1,1,1]).describe("Scale of the mesh."),vertices:V.array($0.describe("Vertex coordinates in the mesh.")).optional().default([]).describe("Vertices of the mesh.")}),SK=V.object({time:V.number().describe("Time in seconds for the keyframe."),values:V.union([$0,V.number()]).optional().describe("Values: [x,y,z] for position/rotation, number for uniform scale."),interpolation:Lj.optional().default("linear").describe("Interpolation type for the keyframe."),bezier_handles:V.object({left_time:V.number().optional(),left_value:V.union([$0,V.number()]).optional(),right_time:V.number().optional(),right_value:V.union([$0,V.number()]).optional()}).optional().describe("Bezier handle positions for bezier interpolation.")}),ZK=V.object({size:YQ,opacity:E6,softness:tW,shape:rW.optional().describe("Brush shape."),color:WQ.describe("Brush color as hex string."),blend_mode:m8.optional().describe("Brush blend mode.")}).optional().describe("Brush settings to apply.");function CK(){R("capture_screenshot",{description:"Returns the image data of the current view.",annotations:{title:"Capture Screenshot",readOnlyHint:!0},parameters:V.object({project:V.string().optional().describe("Project name or UUID.")}),async execute({project:Q}){return g7(Q)}},J0),R("capture_app_screenshot",{description:"Returns the image data of the Blockbench app.",annotations:{title:"Capture App Screenshot",readOnlyHint:!0},parameters:V.object({}),async execute(){return n6()}},J0),R("set_camera_angle",{description:"Sets the camera angle to the specified value.",annotations:{title:"Set Camera Angle",destructiveHint:!0},parameters:V.object({position:$0.describe("Camera position."),target:$0.optional().describe("Camera target position."),rotation:$0.optional().describe("Camera rotation."),projection:AK.describe("Camera projection type.")}),async execute(Q){let W=Preview.selected;if(!W)throw Error("No preview found in the Blockbench editor.");return W.loadAnglePreset({...Q}),g7()}},y)}function vK(){R("create_animation",{description:"Creates a new animation with keyframes for bones.",annotations:{title:"Create Animation",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the animation"),loop:V.boolean().default(!1).describe("Whether the animation should loop"),animation_length:V.number().optional().describe("Length of the animation in seconds"),bones:V.record(V.array(V.object({time:V.number(),position:$0.optional(),rotation:$0.optional(),scale:V.union([$0,V.number()]).optional()}))).describe("Keyframes for each bone"),particle_effects:V.record(V.string().describe("Effect name")).optional().describe("Particle effects with timestamps as keys")}),async execute({name:Q,loop:W,animation_length:$,bones:Y,particle_effects:J}){let X={loop:W,...$&&{animation_length:$},bones:Object.fromEntries(Object.entries(Y).map(([G,H])=>{let B=H.reduce((K,F)=>{let q=F.time.toString();if(F.position)(K.position??={})[q]=F.position;if(F.rotation)(K.rotation??={})[q]=F.rotation;if(F.scale)(K.scale??={})[q]=F.scale;return K},{});return[G,B]})),...J&&{particle_effects:J}};return Animator.loadFile({content:JSON.stringify({format_version:"1.8.0",animations:{[`animation.${Q}`]:X}})}),`Created animation "${Q}" with keyframes for ${Object.keys(Y).length} bones${J?` and ${Object.keys(J).length} particle effects`:""}`}},J0),R("manage_keyframes",{description:"Creates, deletes, or edits keyframes in the animation timeline for specific bones and channels.",annotations:{title:"Manage Keyframes",destructiveHint:!0},parameters:V.object({animation_id:l7,action:V.enum(["create","delete","edit","select"]).describe("Action to perform on keyframes."),bone_name:m7.describe("Name of the bone/group to manage keyframes for."),channel:oW.describe("Animation channel to modify."),keyframes:V.array(SK).describe("Keyframe data for the action.")}),async execute({animation_id:Q,action:W,bone_name:$,channel:Y,keyframes:J}){let X=Q?Animation.all.find((B)=>B.uuid===Q||B.name===Q):Animation.selected;if(!X)throw Error("No animation found or selected.");let G=u0($),H=X.animators[G.uuid];if(!H)H=new BoneAnimator(G.uuid,X,$),X.animators[G.uuid]=H;switch(Undo.initEdit({animations:[X],keyframes:[]}),W){case"create":J.forEach((B)=>{let K=H.createKeyframe({time:B.time,channel:Y,values:B.values,interpolation:B.interpolation},B.time,Y,!1);if(B.interpolation==="bezier"&&B.bezier_handles){if(B.bezier_handles.left_time!==void 0)K.bezier_left_time=B.bezier_handles.left_time;if(B.bezier_handles.left_value)K.bezier_left_value=B.bezier_handles.left_value;if(B.bezier_handles.right_time!==void 0)K.bezier_right_time=B.bezier_handles.right_time;if(B.bezier_handles.right_value)K.bezier_right_value=B.bezier_handles.right_value}});break;case"delete":J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K)K.remove()});break;case"edit":J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K){if(B.values)K.set("values",B.values);if(B.interpolation)K.interpolation=B.interpolation;if(B.interpolation==="bezier"&&B.bezier_handles){if(B.bezier_handles.left_time!==void 0)K.bezier_left_time=B.bezier_handles.left_time;if(B.bezier_handles.left_value)K.bezier_left_value=B.bezier_handles.left_value;if(B.bezier_handles.right_time!==void 0)K.bezier_right_time=B.bezier_handles.right_time;if(B.bezier_handles.right_value)K.bezier_right_value=B.bezier_handles.right_value}}});break;case"select":Timeline.selected.empty(),J.forEach((B)=>{let K=H[Y]?.find((F)=>Math.abs(F.time-B.time)<0.001);if(K)K.select()});break}return Undo.finishEdit(`${W} keyframes`),Animator.preview(),`Successfully performed ${W} on ${J.length} keyframes for ${$}.${Y}`}},y),R("animation_graph_editor",{description:"Controls animation curves in the graph editor for fine-tuning animations.",annotations:{title:"Animation Graph Editor",destructiveHint:!0},parameters:V.object({animation_id:l7,bone_name:m7.describe("Name of the bone/group to modify curves for."),channel:oW.describe("Animation channel to modify."),axis:UK.default("all").describe("Axis to modify curves for."),action:V.enum(["smooth","linear","ease_in","ease_out","ease_in_out","stepped","custom"]).describe("Type of curve modification to apply."),keyframe_range:$Q.optional().describe("Time range to apply the curve modification. If not provided, applies to all keyframes."),custom_curve:V.object({control_point_1:V.array(V.number()).length(2).describe("First control point [time, value]."),control_point_2:V.array(V.number()).length(2).describe("Second control point [time, value].")}).optional().describe("Custom bezier curve control points (only for 'custom' action).")}),async execute({animation_id:Q,bone_name:W,channel:$,axis:Y,action:J,keyframe_range:X,custom_curve:G}){let H=Q?Animation.all.find((q)=>q.uuid===Q||q.name===Q):Animation.selected;if(!H)throw Error("No animation found or selected.");let B=u0(W),K=H.animators[B.uuid];if(!K||!K[$])throw Error(`No keyframes found for ${W}.${$}`);Undo.initEdit({animations:[H],keyframes:K[$]});let F=K[$].filter((q)=>{if(!X)return!0;return q.time>=X.start&&q.time<=X.end});return F.forEach((q,U)=>{switch(J){case"linear":q.interpolation="linear";break;case"stepped":q.interpolation="step";break;case"smooth":q.interpolation="catmullrom";break;case"ease_in":case"ease_out":case"ease_in_out":q.interpolation="bezier";let L=F[U+1];if(L){let D=L.time-q.time;if(q.bezier_left_time=0,q.bezier_right_time=D,J==="ease_in")q.bezier_right_time=D*0.6;else if(J==="ease_out")q.bezier_left_time=D*0.4;else q.bezier_left_time=D*0.3,q.bezier_right_time=D*0.7}break;case"custom":if(!G)throw Error("custom_curve is required for 'custom' action.");q.interpolation="bezier",q.bezier_left_time=G.control_point_1[0],q.bezier_left_value=[G.control_point_1[1],G.control_point_1[1],G.control_point_1[1]],q.bezier_right_time=G.control_point_2[0],q.bezier_right_value=[G.control_point_2[1],G.control_point_2[1],G.control_point_2[1]];break}}),Undo.finishEdit("Modify animation curves"),Animator.preview(),updateKeyframeSelection(),`Applied ${J} curve to ${F.length} keyframes in ${W}.${$}`}},y),R("bone_rigging",{description:"Creates and manipulates the bone structure (rig) of a model for animation.",annotations:{title:"Bone Rigging",destructiveHint:!0},parameters:V.object({action:V.enum(["create","parent","unparent","delete","rename","set_pivot","set_ik","mirror"]).describe("Action to perform on the bone structure."),bone_data:V.object({name:V.string().describe("Name of the bone."),parent:V.string().optional().describe("Parent bone name."),origin:$0.optional().describe("Pivot point of the bone."),rotation:$0.optional().describe("Initial rotation of the bone."),children:V.array(V.string()).optional().describe("Names of elements to add to this bone."),ik_enabled:V.boolean().optional().describe("Enable inverse kinematics for this bone."),ik_target:V.string().optional().describe("Target bone for IK chain."),mirror_axis:c8.optional().describe("Axis to mirror the bone across.")}).describe("Bone configuration data.")}),async execute({action:Q,bone_data:W}){Undo.initEdit({outliner:!0,elements:[],groups:[]});let $="";switch(Q){case"create":{let Y=new Group({name:W.name,origin:W.origin||[0,0,0],rotation:W.rotation||[0,0,0]}).init();if(W.parent){let J=Group.all.find((X)=>X.name===W.parent);if(J)Y.addTo(J)}if(W.children)W.children.forEach((J)=>{let X=Outliner.elements.find((G)=>G.name===J);if(X)X.addTo(Y)});if(W.ik_enabled&&W.ik_target)Y.ik_enabled=!0,Y.ik_target=W.ik_target;$=`Created bone "${Y.name}" with UUID ${Y.uuid}`;break}case"parent":{let Y=u0(W.name),J=W.parent?Group.all.find((X)=>X.name===W.parent):"root";Y.addTo(J),$=`Parented "${W.name}" to "${W.parent||"root"}"`;break}case"unparent":{u0(W.name).addTo("root"),$=`Unparented "${W.name}"`;break}case"delete":{u0(W.name).remove(),$=`Deleted bone "${W.name}"`;break}case"rename":{let Y=u0(W.name),J=W.children?.[0]||"new_name";Y.name=J,$=`Renamed bone to "${J}"`;break}case"set_pivot":{let Y=u0(W.name);if(W.origin)Y.origin=W.origin;$=`Set pivot point for "${W.name}"`;break}case"set_ik":{let Y=u0(W.name);if(Y.ik_enabled=W.ik_enabled||!1,W.ik_target)Y.ik_target=W.ik_target;$=`Updated IK settings for "${W.name}"`;break}case"mirror":{let Y=u0(W.name),J=W.mirror_axis||"x",X=Y.duplicate(),G=J==="x"?0:J==="y"?1:2;X.origin[G]*=-1,X.name=Y.name.includes("left")?Y.name.replace("left","right"):Y.name.includes("right")?Y.name.replace("right","left"):Y.name+"_mirrored",$=`Mirrored bone "${W.name}" across ${J} axis`;break}}return Undo.finishEdit(`Bone rigging: ${Q}`),Canvas.updateAll(),$}},y),R("animation_timeline",{description:"Controls the animation timeline, including playback, time scrubbing, and timeline settings.",annotations:{title:"Animation Timeline",destructiveHint:!0},parameters:V.object({action:V.enum(["play","pause","stop","set_time","set_length","set_fps","loop","select_range"]).describe("Timeline action to perform."),time:V.number().optional().describe("Time in seconds (for set_time action)."),length:V.number().optional().describe("Animation length in seconds (for set_length action)."),fps:V.number().min(1).max(120).optional().describe("Frames per second (for set_fps action)."),loop_mode:RK.optional().describe("Loop mode for the animation."),range:$Q.optional().describe("Time range for selection.")}),async execute({action:Q,time:W,length:$,fps:Y,loop_mode:J,range:X}){if(!Animation.selected)throw Error("No animation selected.");let G="";switch(Q){case"play":Timeline.start(),G="Started animation playback";break;case"pause":Timeline.pause(),G="Paused animation playback";break;case"stop":Timeline.setTime(0),Timeline.pause(),G="Stopped animation playback";break;case"set_time":if(W===void 0)throw Error("Time parameter required for set_time action.");Timeline.setTime(W),G=`Set timeline to ${W} seconds`;break;case"set_length":if($===void 0)throw Error("Length parameter required for set_length action.");Animation.selected.length=$,G=`Set animation length to ${$} seconds`;break;case"set_fps":if(Y===void 0)throw Error("FPS parameter required for set_fps action.");Animation.selected.snapping=Y,G=`Set animation FPS to ${Y}`;break;case"loop":if(J)Animation.selected.loop=J;G=`Set loop mode to ${J||Animation.selected.loop}`;break;case"select_range":if(!X)throw Error("Range parameter required for select_range action.");Timeline.keyframes.forEach((H)=>{if(H.time>=X.start&&H.time<=X.end)H.select();else H.selected=!1}),G=`Selected keyframes between ${X.start} and ${X.end} seconds`;break}return Animator.preview(),G}},y),R("batch_keyframe_operations",{description:"Performs batch operations on multiple keyframes at once.",annotations:{title:"Batch Keyframe Operations",destructiveHint:!0},parameters:V.object({selection:V.enum(["all","selected","range","pattern"]).default("selected").describe("Which keyframes to operate on."),range:$Q.optional().describe("Time range for keyframe selection."),pattern:V.object({interval:V.number().describe("Time interval between keyframes."),offset:V.number().optional().default(0).describe("Time offset for the pattern.")}).optional().describe("Pattern-based selection."),operation:V.enum(["offset","scale","reverse","mirror","smooth","bake"]).describe("Operation to perform on keyframes."),parameters:V.object({offset_time:V.number().optional().describe("Time offset to apply."),offset_values:$0.optional().describe("Value offset to apply."),scale_factor:V.number().optional().describe("Scale factor for time or values."),scale_pivot:V.number().optional().describe("Pivot point for scaling."),mirror_axis:c8.optional().describe("Axis to mirror values across."),bake_interval:V.number().optional().describe("Interval for baking keyframes.")}).optional().describe("Operation-specific parameters.")}),async execute({selection:Q,range:W,pattern:$,operation:Y,parameters:J={}}){if(!Animation.selected)throw Error("No animation selected.");let X=[];switch(Q){case"all":X=Timeline.keyframes;break;case"selected":X=Timeline.selected;break;case"range":if(!W)throw Error("Range required for range selection.");X=Timeline.keyframes.filter((G)=>G.time>=W.start&&G.time<=W.end);break;case"pattern":if(!$)throw Error("Pattern required for pattern selection.");X=Timeline.keyframes.filter((G)=>{let H=G.time-$.offset;return Math.abs(H%$.interval)<0.001});break}if(X.length===0)throw Error("No keyframes found matching selection criteria.");switch(Undo.initEdit({keyframes:X}),Y){case"offset":X.forEach((D)=>{if(J.offset_time!==void 0)D.time+=J.offset_time;if(J.offset_values){let w=D.getArray();D.set("values",[w[0]+J.offset_values[0],w[1]+J.offset_values[1],w[2]+J.offset_values[2]])}});break;case"scale":let G=J.scale_pivot||0,H=J.scale_factor||1;X.forEach((D)=>{D.time=G+(D.time-G)*H});break;case"reverse":let B=X.map((D)=>D.time),K=Math.min(...B),F=Math.max(...B);X.forEach((D)=>{D.time=F-(D.time-K)});break;case"mirror":if(!J.mirror_axis)throw Error("Mirror axis required for mirror operation.");let q=J.mirror_axis==="x"?0:J.mirror_axis==="y"?1:2;X.forEach((D)=>{let w=D.getArray();w[q]*=-1,D.set("values",w)});break;case"smooth":X.forEach((D)=>{D.interpolation="catmullrom"});break;case"bake":let U=J.bake_interval||1/Animation.selected.snapping;new Set(X.map((D)=>D.animator)).forEach((D)=>{["rotation","position","scale"].forEach((A)=>{let O=D[A];if(!O||O.length<2)return;let j=Math.min(...O.map((S)=>S.time)),z=Math.max(...O.map((S)=>S.time));for(let S=j;S<=z;S+=U)if(!O.find((Z)=>Math.abs(Z.time-S)<0.001))Timeline.time=S,D.fillValues(D.createKeyframe({time:S,channel:A,values:D.interpolate(A,!0)},S,A,!1),null,!1)})});break}return Undo.finishEdit(`Batch keyframe operation: ${Y}`),Animator.preview(),`Performed ${Y} on ${X.length} keyframes`}},y),R("animation_copy_paste",{description:"Copies and pastes animation data between bones or animations.",annotations:{title:"Animation Copy/Paste",destructiveHint:!0},parameters:V.object({action:V.enum(["copy","paste","mirror_paste"]).describe("Copy or paste action."),source:V.object({animation:V.string().optional().describe("Source animation name or UUID."),bone:V.string().describe("Source bone name."),channels:V.array(oW).optional().default(["rotation","position","scale"]).describe("Channels to copy."),time_range:$Q.optional().describe("Time range to copy. If not provided, copies all keyframes.")}).optional().describe("Source data for copy operation."),target:V.object({animation:V.string().optional().describe("Target animation name or UUID."),bone:V.string().describe("Target bone name."),time_offset:V.number().optional().default(0).describe("Time offset for pasted keyframes."),mirror_axis:c8.optional().describe("Axis to mirror across for mirror_paste.")}).optional().describe("Target data for paste operation.")}),async execute({action:Q,source:W,target:$}){if(!global.animationClipboard)global.animationClipboard=null;switch(Q){case"copy":{if(!W)throw Error("Source data required for copy operation.");let Y=W.animation?Animation.all.find((H)=>H.uuid===W.animation||H.name===W.animation):Animation.selected;if(!Y)throw Error("Source animation not found.");let J=u0(W.bone),X=Y.animators[J.uuid];if(!X)throw Error(`No animation data for bone "${W.bone}".`);let G={bone_name:W.bone,channels:{}};return W.channels.forEach((H)=>{if(!X[H])return;let B=X[H];if(W.time_range)B=B.filter((K)=>K.time>=W.time_range.start&&K.time<=W.time_range.end);G.channels[H]=B.map((K)=>({time:K.time,values:K.getArray(),interpolation:K.interpolation,bezier_left_time:K.bezier_left_time,bezier_left_value:K.bezier_left_value,bezier_right_time:K.bezier_right_time,bezier_right_value:K.bezier_right_value}))}),global.animationClipboard=G,`Copied animation data from "${W.bone}" (${Object.keys(G.channels).join(", ")})`}case"paste":case"mirror_paste":{if(!$)throw Error("Target data required for paste operation.");if(!global.animationClipboard)throw Error("No animation data in clipboard. Copy first.");let Y=$.animation?Animation.all.find((K)=>K.uuid===$.animation||K.name===$.animation):Animation.selected;if(!Y)throw Error("Target animation not found.");let J=u0($.bone),X=Y.animators[J.uuid];if(!X)X=new BoneAnimator(J.uuid,Y,$.bone),Y.animators[J.uuid]=X;Undo.initEdit({animations:[Y],keyframes:[]});let G=global.animationClipboard,H=Q==="mirror_paste"?$.mirror_axis||"x":null,B=H==="x"?0:H==="y"?1:H==="z"?2:-1;return Object.entries(G.channels).forEach(([K,F])=>{F.forEach((q)=>{let U=[...q.values];if(H&&(K==="rotation"||K==="position"))U[B]*=-1;let L=X.createKeyframe({time:q.time+($.time_offset||0),channel:K,values:U,interpolation:q.interpolation},q.time+($.time_offset||0),K,!1);if(q.interpolation==="bezier"){if(q.bezier_left_time!==void 0)L.bezier_left_time=q.bezier_left_time;if(q.bezier_left_value)L.bezier_left_value=q.bezier_left_value;if(q.bezier_right_time!==void 0)L.bezier_right_time=q.bezier_right_time;if(q.bezier_right_value)L.bezier_right_value=q.bezier_right_value}})}),Undo.finishEdit(`${Q} animation data`),Animator.preview(),`Pasted animation data to "${$.bone}"${H?` (mirrored on ${H} axis)`:""}`}}}},y)}function kK(){R("place_cube",{description:"Places a cube of the given size at the specified position. Texture and group are optional.",annotations:{title:"Place Cube",destructiveHint:!0},parameters:V.object({elements:V.array(c7).min(1).describe("Array of cubes to place."),texture:V.string().optional().describe("Texture ID or name to apply to the cube."),group:V.string().optional().describe("Group/bone to which the cube belongs."),faces:V.union([V.array(V.enum(["north","south","east","west","up","down"])).describe("Array of faces to apply the texture to."),V.boolean().optional().describe("Whether to apply the texture to all faces. Set to `true` to enable auto UV mapping."),V.array(V.object({face:V.enum(["north","south","east","west","up","down"]).describe("Face to apply the texture to."),uv:V.array(V.number()).length(4).describe("Custom UV mapping for the face.")})).describe("Array of faces with custom UV mapping.")]).optional().default(!0).describe("Faces to apply the texture to. Set to `true` to enable auto UV mapping.")}),async execute({elements:Q,texture:W,faces:$,group:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`No texture found for "${W}".`);let H=getAllGroups().find((F)=>F.name===Y||F.uuid===Y),B=$===!0||Array.isArray($)&&$.every((F)=>typeof F==="string"),K=Q.map((F,q)=>{let U=new Cube({autouv:B?1:0,name:F.name,from:F.from,to:F.to,origin:F.origin,rotation:F.rotation}).init();if(U.addTo(H),!B&&Array.isArray($))$.forEach(({face:L,uv:D})=>{U.faces[L].extend({uv:D})});else U.applyTexture(X,$!==!1?$:void 0),U.mapAutoUV();return U});return Undo.finishEdit("Agent placed cubes"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(K.map((F)=>`Added cube ${F.name} with ID ${F.uuid}`)))}},J0),R("modify_cube",{description:"Modifies the cube with the given ID. Auto UV setting: saved as an integer, where 0 means disabled, 1 means enabled, and 2 means relative auto UV (cube position affects UV)",annotations:{title:"Modify Cube",destructiveHint:!0},parameters:V.object({id:V.string().optional().describe("ID or name of the cube to modify. Defaults to selected, which could be more than one."),...c7.shape,name:V.string().optional().describe("New name of the cube."),autouv:V.enum(["0","1","2"]).optional().describe("Auto UV setting. 0 = disabled, 1 = enabled, 2 = relative auto UV."),uv_offset:V.array(V.number()).length(2).optional().describe("UV offset for the texture."),mirror_uv:V.boolean().optional().describe("Whether to mirror the UVs."),shade:V.boolean().optional().describe("Whether to apply shading to the cube."),inflate:V.number().optional().describe("Inflation amount for the cube."),color:V.number().optional().describe("Single digit to represent a color from a palette."),visibility:V.boolean().optional().describe("Whether the cube is visible or not.")}),async execute({id:Q,name:W,origin:$,from:Y,to:J,rotation:X,uv_offset:G,autouv:H,mirror_uv:B,shade:K,inflate:F,color:q,visibility:U}){let L=Outliner.root.filter((D)=>D instanceof Cube&&(D.uuid===Q||D.name===Q))??Cube.selected;if(!L.length)throw Error(`Cube with ID "${Q}" not found.`);return Undo.initEdit({elements:Array.isArray(L)?L:[L],outliner:!0,collections:[]}),L.forEach((D)=>{let w=$??D.origin,A=Y??D.from,O=J??D.to,j=X??D.rotation,z=G??D.uv_offset;D.extend({name:W??D.name,origin:w,from:A,to:O,rotation:j,uv_offset:z,autouv:H?Number(H):D.autouv,mirror_uv:Boolean(B??D.mirror_uv),inflate:F??D.inflate,color:q??D.color,visibility:U??D.visibility,shade:K??D.shade})}),Undo.finishEdit("Agent modified cubes"),Canvas.updateAll(),`Modified cubes ${L.map((D)=>D.name).join(", ")} with IDs ${L.map((D)=>D.uuid).join(", ")}`}},J0)}function TK(){R("remove_element",{description:"Removes the element with the given ID.",annotations:{title:"Remove Element",destructiveHint:!0},parameters:V.object({id:p8.describe("ID or name of the element to remove.")}),async execute({id:Q}){let W=J1(Q);return Undo.initEdit({elements:[],outliner:!0,collections:[]}),W.remove(),Undo.finishEdit("Agent removed element"),Canvas.updateAll(),`Removed element with ID ${Q}`}},y),R("add_group",{description:"Adds a new group with the given name and options.",annotations:{title:"Add Group",destructiveHint:!0},parameters:V.object({name:V.string(),origin:$0,rotation:$0,parent:V.string().optional().default("root"),visibility:V.boolean().optional().default(!0),autouv:wK.optional().default("0").describe("Auto UV setting. 0 = disabled, 1 = enabled, 2 = relative auto UV."),selected:V.boolean().optional().default(!1),shade:V.boolean().optional().default(!1)}),async execute({name:Q,origin:W,rotation:$,parent:Y,visibility:J,autouv:X,selected:G,shade:H}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let B=new Group({name:Q,origin:W,rotation:$,autouv:Number(X),visibility:Boolean(J),selected:Boolean(G),shade:Boolean(H)}).init();return B.addTo(getAllGroups().find((K)=>K.name===Y||K.uuid===Y)),Undo.finishEdit("Agent added group"),Canvas.updateAll(),`Added group ${B.name} with ID ${B.uuid}`}},J0),R("list_outline",{description:"Returns a list of all groups and their children in the Blockbench editor.",annotations:{title:"List Outline",readOnlyHint:!0},parameters:V.object({}),async execute(){let Q=Outliner.elements;return JSON.stringify(Q.map((W)=>{let{name:$,uuid:Y}=W;return{name:$,uuid:Y}}),null,2)}},J0),R("duplicate_element",{description:"Duplicates a cube, mesh or group by ID or name.  You may offset the duplicate or assign a new name.",annotations:{title:"Duplicate Element",destructiveHint:!0},parameters:V.object({id:p8.describe("ID or name of the element to duplicate."),offset:$0.optional().default([0,0,0]),newName:V.string().optional()}),async execute({id:Q,offset:W,newName:$}){let Y=J1(Q);function J(K,F){let q=new Cube({name:$||`${K.name}_copy`,from:K.from.map((U,L)=>U+W[L]),to:K.to.map((U,L)=>U+W[L]),origin:K.origin.map((U,L)=>U+W[L]),rotation:K.rotation,autouv:K.autouv,uv_offset:K.uv_offset,mirror_uv:K.mirror_uv,shade:K.shade,inflate:K.inflate,color:K.color,visibility:K.visibility}).init();return q.addTo(F),q}function X(K,F){let q=new Group({name:$||`${K.name}_copy`,origin:K.origin.map((U,L)=>U+W[L]),rotation:K.rotation,autouv:K.autouv,selected:K.selected,shade:K.shade,visibility:K.visibility}).init();return q.addTo(F),K.children.forEach((U)=>H(U,q)),q}function G(K,F){let q=new Mesh({name:$||`${K.name}_copy`,vertices:{},origin:K.origin.map((L,D)=>L+W[D]),rotation:K.rotation}).init(),U={};if(Object.entries(K.vertices).forEach(([L,D])=>{U[L]=q.addVertices([D[0]+W[0],D[1]+W[1],D[2]+W[2]])[0]}),K.faces.forEach((L)=>{q.addFaces(new MeshFace(q,{vertices:L.vertices.map((D)=>U[D]),uv:L.uv}))}),q.addTo(F),K.material)q.applyTexture(K.material);return q}function H(K,F){if(K instanceof Cube)return J(K,F);if(K instanceof Group)return X(K,F);if(K instanceof Mesh)return G(K,F);throw Error("Unsupported element type.")}Undo.initEdit({elements:[],outliner:!0,collections:[]});let B=H(Y,Y.parent??Outliner);return Undo.finishEdit("Agent duplicated element"),Canvas.updateAll(),`Duplicated "${Y.name}" as "${B.name}" (ID: ${B.uuid}).`}},y),R("rename_element",{description:"Renames a cube, mesh or group by ID or name.",annotations:{title:"Rename Element",destructiveHint:!0},parameters:V.object({id:p8.describe("ID or name of the element to rename."),new_name:V.string().describe("New name to assign.")}),async execute({id:Q,new_name:W}){let $=J1(Q);return Undo.initEdit({elements:[$],outliner:!0,collections:[]}),$.extend({name:W}),Undo.finishEdit("Agent renamed element"),Canvas.updateAll(),`Renamed element "${Q}" to "${W}".`}},y)}function _K(){R("from_geo_json",{description:"Imports a model from a GeoJSON file.",annotations:{title:"Import GeoJSON",destructiveHint:!0},parameters:V.object({geojson:V.string().describe("Path to the GeoJSON file or data URL, or the GeoJSON string itself.")}),async execute({geojson:Q}){if(!Q.startsWith("{")&&!Q.startsWith("["))Q=await fetch(Q).then((W)=>W.text());if(typeof Q!=="string")throw Error("Invalid GeoJSON input. Expected a string.");return Codecs.bedrock.parse(JSON.parse(Q),""),new Promise((W)=>{setTimeout(async()=>{W(await n6())},3000)})}},J0)}function xK(){R("place_mesh",{description:"Places a mesh at the specified position. Texture and group are optional.",annotations:{title:"Place Mesh",destructiveHint:!0},parameters:V.object({elements:V.array(bK).min(1).describe("Array of meshes to place."),texture:x0.describe("Texture ID or name to apply to the mesh."),group:aW.describe("Group/bone to which the mesh belongs.")}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`No texture found for "${W}".`);let H=getAllGroups().find((K)=>K.name===$||K.uuid===$),B=Q.map((K,F)=>{let q=new Mesh({name:K.name,vertices:{}}).init();return K.vertices.forEach((U)=>{q.addVertices(U)}),q.addTo(H),q.applyTexture(X),Y({progress:F,total:J}),q});return Undo.finishEdit("Agent placed meshes"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(B.map((K)=>`Added mesh ${K.name} with ID ${K.uuid}`)))}},y),R("extrude_mesh",{description:"Extrudes selected faces or edges of a mesh.",annotations:{title:"Extrude Mesh",destructiveHint:!0},parameters:V.object({mesh_id:t1,distance:V.number().default(1).describe("Distance to extrude."),mode:V.enum(["faces","edges","vertices"]).default("faces").describe("What to extrude: faces, edges, or vertices.")}),async execute({mesh_id:Q,distance:W,mode:$}){let Y=a1(Q),J=$==="faces"?BarItems.extrude_mesh_selection:$==="edges"?BarItems.extrude_mesh_selection:BarItems.extrude_mesh_selection;if(!J)throw Error(`Extrude tool for ${$} not found.`);return J.click({},W),`Extruded ${$} of mesh "${Y.name}" by ${W} units`}},y),R("subdivide_mesh",{description:"Subdivides selected faces of a mesh to create more geometry.",annotations:{title:"Subdivide Mesh",destructiveHint:!0},parameters:V.object({mesh_id:t1,cuts:V.number().min(1).max(10).default(1).describe("Number of subdivision cuts to make.")}),async execute({mesh_id:Q,cuts:W}){let $=a1(Q),Y=BarItems.loop_cut;if(!Y)throw Error("Loop cut tool not found.");return Y.click({},void 0,void 0,W),`Subdivided mesh "${$.name}" with ${W} cuts`}},y),R("create_sphere",{description:"Creates a sphere mesh at the specified position with the given parameters. The sphere is created as a mesh with vertices and faces using spherical coordinates.",annotations:{title:"Create Sphere",destructiveHint:!0},parameters:V.object({elements:V.array(V.object({name:V.string().describe("Name of the sphere."),position:$0.describe("Position of the sphere center."),diameter:V.number().min(1).max(64).default(16).describe("Diameter of the sphere."),sides:V.number().min(3).max(48).default(12).describe("Number of horizontal divisions (affects sphere quality)."),rotation:$0.optional().default([0,0,0]).describe("Rotation of the sphere."),align_edges:V.boolean().optional().default(!0).describe("Whether to align edges for better geometry.")})).min(1).describe("Array of spheres to create."),texture:x0.describe("Texture ID or name to apply to the sphere."),group:aW.describe("Group/bone to which the sphere belongs.")}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`No texture found for "${W}".`);let H=getAllGroups().find((K)=>K.name===$||K.uuid===$),B=Q.map((K,F)=>{let q=new Mesh({name:K.name,vertices:{},origin:K.position,rotation:K.rotation||[0,0,0]}).init(),U=K.diameter/2,L=Math.round(K.sides/2)*2,[D]=q.addVertices([0,-U,0]),[w]=q.addVertices([0,U,0]),A=[],O=K.align_edges?0.5:0;for(let j=0;j<K.sides;j++){let z=Math.sin((j+O)/K.sides*Math.PI*2),S=Math.cos((j+O)/K.sides*Math.PI*2),Z=[];for(let O0=1;O0<L/2;O0++){let I0=Math.sin(O0/L*Math.PI*2)*U,b1=z*I0,s6=Math.cos(O0/L*Math.PI*2)*U,B0=S*I0;Z.push(...q.addVertices([b1,s6,B0]))}A.push(Z)}for(let j=0;j<K.sides;j++){let z=A[j],S=A[j+1]||A[0];for(let Z=0;Z<L/2;Z++){if(Z==0){q.addFaces(new MeshFace(q,{vertices:[z[Z],S[Z],w],uv:{}}));continue}if(!z[Z]){q.addFaces(new MeshFace(q,{vertices:[S[Z-1],z[Z-1],D],uv:{}}));continue}q.addFaces(new MeshFace(q,{vertices:[z[Z],S[Z],z[Z-1],S[Z-1]],uv:{}}))}}if(q.addTo(H),X)q.applyTexture(X);return Y({progress:F,total:J}),q});return Undo.finishEdit("Agent created spheres"),Canvas.updateAll(),await Promise.resolve(JSON.stringify(B.map((K)=>`Added sphere ${K.name} with ID ${K.uuid}`)))}},J0),R("select_mesh_elements",{description:"Selects vertices, edges, or faces of a mesh for manipulation.",annotations:{title:"Select Mesh Elements",destructiveHint:!0},parameters:V.object({mesh_id:d8.describe("ID or name of the mesh to select elements from."),mode:OK.describe("Selection mode."),elements:V.array(V.union([V.string().describe("Vertex key, edge as 'vkey1-vkey2', or face key"),V.number().describe("Index of the element")])).optional().describe("Specific elements to select. If not provided, selects all."),action:DK.default("select").describe("Selection action: select (replace), add, remove, or toggle.")}),async execute({mesh_id:Q,mode:W,elements:$,action:Y}){let J=i6(Q);Undo.initEdit({elements:[J],selection:!0,collections:[]}),BarItems.selection_mode.set(W);let X=Project?.mesh_selection[J.uuid]??{vertices:[],edges:[],faces:[]};if(Y==="select")X.vertices=[],X.edges.length=0,X.faces=[];if(!$||$.length===0){if(W==="vertex")X.vertices=Object.keys(J.vertices);else if(W==="face")X.faces=Object.keys(J.faces);else if(W==="edge"){let G=[],H=new Set;for(let K in J.faces){let q=J.faces[K].getEdges();for(let[U,L]of q){let D=U<L?`${U}-${L}`:`${L}-${U}`;if(!H.has(D))H.add(D),G.push([U,L])}}let B=X.edges;B.length=0,B.push(...G)}}else $.forEach((G)=>{if(W==="vertex"){let H=String(G);if(Y==="add"||Y==="select"){if(!X.vertices.includes(H))X.vertices.push(H)}else if(Y==="remove")X.vertices=X.vertices.filter((B)=>B!==H);else if(Y==="toggle")if(X.vertices.includes(H))X.vertices=X.vertices.filter((B)=>B!==H);else X.vertices.push(H)}else if(W==="face"){let H=String(G);if(Y==="add"||Y==="select"){if(!X.faces.includes(H))X.faces.push(H)}else if(Y==="remove")X.faces=X.faces.filter((B)=>B!==H);else if(Y==="toggle")if(X.faces.includes(H))X.faces=X.faces.filter((B)=>B!==H);else X.faces.push(H)}else if(W==="edge"){let H=String(G).split("-");if(H.length===2){let B=[H[0],H[1]],K=X.edges;if(Y==="add"||Y==="select")K.push(B);else if(Y==="remove"){let F=K.filter((q)=>!(q[0]===B[0]&&q[1]===B[1])&&!(q[0]===B[1]&&q[1]===B[0]));K.length=0,K.push(...F)}else if(Y==="toggle")if(K.some((q)=>q[0]===B[0]&&q[1]===B[1]||q[0]===B[1]&&q[1]===B[0])){let q=K.filter((U)=>!(U[0]===B[0]&&U[1]===B[1])&&!(U[0]===B[1]&&U[1]===B[0]));K.length=0,K.push(...q)}else K.push(B)}}});return J.select(),Canvas.updateView({elements:[J],selection:!0}),Undo.finishEdit("Select mesh elements"),JSON.stringify({mesh:J.name,mode:W,selected:{vertices:X.vertices.length,edges:X.edges.length,faces:X.faces.length}})}},y),R("move_mesh_vertices",{description:"Moves selected vertices of a mesh by the specified offset.",annotations:{title:"Move Mesh Vertices",destructiveHint:!0},parameters:V.object({mesh_id:t1,offset:$0.describe("Offset to move vertices by [x, y, z]."),vertices:V.array(V.string()).optional().describe("Specific vertex keys to move. If not provided, moves all selected vertices.")}),async execute({mesh_id:Q,offset:W,vertices:$}){let Y=a1(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=$||Y.getSelectedVertices();return J.forEach((X)=>{if(Y.vertices[X])Y.vertices[X][0]+=W[0],Y.vertices[X][1]+=W[1],Y.vertices[X][2]+=W[2]}),Y.preview_controller.updateGeometry(Y),Undo.finishEdit("Move mesh vertices"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Moved ${J.length} vertices of mesh "${Y.name}"`}},y),R("delete_mesh_elements",{description:"Deletes selected vertices, edges, or faces from a mesh.",annotations:{title:"Delete Mesh Elements",destructiveHint:!0},parameters:V.object({mesh_id:t1,mode:V.enum(["vertices","edges","faces"]).default("faces").describe("What to delete: vertices, edges, or faces."),keep_vertices:V.boolean().default(!1).describe("When deleting faces/edges, whether to keep the vertices.")}),async execute({mesh_id:Q,mode:W,keep_vertices:$}){let Y=a1(Q),J=BarItems.delete_mesh_selection;if(!J)throw Error("Delete mesh selection tool not found.");return J.click({},$),`Deleted selected ${W} from mesh "${Y.name}"`}},y),R("merge_mesh_vertices",{description:"Merges vertices that are within a specified distance of each other.",annotations:{title:"Merge Mesh Vertices",destructiveHint:!0},parameters:V.object({mesh_id:d8,threshold:V.number().min(0).max(10).default(0.1).describe("Maximum distance between vertices to merge."),selected_only:V.boolean().default(!0).describe("Whether to only merge selected vertices.")}),async execute({mesh_id:Q,threshold:W,selected_only:$}){let Y=i6(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=$?Y.getSelectedVertices():Object.keys(Y.vertices),X=0,G={};for(let H=0;H<J.length;H++){let B=J[H];if(G[B])continue;for(let K=H+1;K<J.length;K++){let F=J[K];if(G[F])continue;let q=Y.vertices[B],U=Y.vertices[F];if(Math.sqrt((q[0]-U[0])**2+(q[1]-U[1])**2+(q[2]-U[2])**2)<=W)G[F]=B,X++}}return Object.entries(G).forEach(([H,B])=>{for(let K in Y.faces){let F=Y.faces[K],q=F.vertices.indexOf(H);if(q!==-1)F.vertices[q]=B,F.uv[B]=F.uv[H]||[0,0],delete F.uv[H]}delete Y.vertices[H]}),Y.preview_controller.updateGeometry(Y),Undo.finishEdit("Merge mesh vertices"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Merged ${X} vertices in mesh "${Y.name}"`}},y),R("create_mesh_face",{description:"Creates a new face from selected vertices.",annotations:{title:"Create Mesh Face",destructiveHint:!0},parameters:V.object({mesh_id:t1,vertices:V.array(V.string()).min(3).max(4).describe("Vertex keys to create face from. Must be 3 or 4 vertices."),texture:x0.describe("Texture ID or name to apply to the new face.")}),async execute({mesh_id:Q,vertices:W,texture:$}){let Y=a1(Q);Undo.initEdit({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}});let J=new MeshFace(Y,{vertices:W,texture:$?E0($)?.uuid:void 0}),[X]=Y.addFaces(J);return UVEditor.setAutoSize(null,!0,[X]),Y.preview_controller.updateGeometry(Y),Y.preview_controller.updateUV(Y),Undo.finishEdit("Create mesh face"),Canvas.updateView({elements:[Y],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Created face with ${W.length} vertices in mesh "${Y.name}"`}},y),R("create_cylinder",{description:"Creates one or more cylinder meshes with optional end caps.",annotations:{title:"Create Cylinder",destructiveHint:!0},parameters:V.object({elements:V.array(V.object({name:V.string(),position:$0,height:V.number().min(1).max(64).default(16),diameter:V.number().min(1).max(64).default(16),sides:V.number().min(3).max(64).default(12),rotation:$0.optional().default([0,0,0]),capped:V.boolean().optional().default(!0)})).min(1),texture:x0,group:aW}),async execute({elements:Q,texture:W,group:$},{reportProgress:Y}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let J=Q.length,X=W?E0(W):Texture.getDefault();if(!X)throw Error(`Texture "${W}" not found.`);let G=getAllGroups().find((B)=>B.name===$||B.uuid===$),H=Q.map((B,K)=>{let F=new Mesh({name:B.name,vertices:{},origin:B.position,rotation:B.rotation||[0,0,0]}).init(),q=B.diameter/2,U=B.height,L=Math.round(B.sides),D=F.addVertices([0,U/2,0])[0],w=F.addVertices([0,-U/2,0])[0],A=[],O=[];for(let j=0;j<L;j++){let z=j/L*Math.PI*2,S=Math.cos(z)*q,Z=Math.sin(z)*q;A.push(F.addVertices([S,U/2,Z])[0]),O.push(F.addVertices([S,-U/2,Z])[0])}for(let j=0;j<L;j++){let z=(j+1)%L;if(F.addFaces(new MeshFace(F,{vertices:[O[j],O[z],A[z],A[j]],uv:{}})),B.capped)F.addFaces(new MeshFace(F,{vertices:[A[j],A[z],D],uv:{}})),F.addFaces(new MeshFace(F,{vertices:[O[z],O[j],w],uv:{}}))}if(F.addTo(G),X)F.applyTexture(X);return Y({progress:K,total:J}),F});return Undo.finishEdit("Agent created cylinders"),Canvas.updateAll(),JSON.stringify(H.map((B)=>`Added cylinder ${B.name} (ID ${B.uuid})`))}},y),R("knife_tool",{description:"Uses the knife tool to cut custom edges into mesh faces.",annotations:{title:"Knife Tool",destructiveHint:!0},parameters:V.object({mesh_id:d8.describe("ID or name of the mesh to cut."),points:V.array(V.object({position:$0.describe("3D position of the cut point."),face:V.string().optional().describe("Face key to attach the point to.")})).min(2).describe("Points defining the cut path.")}),async execute({mesh_id:Q,points:W}){let $=i6(Q);Undo.initEdit({elements:[$],element_aspects:{geometry:!0,uv:!0,faces:!0}});let Y=new KnifeToolContext($);return W.forEach((J)=>{Y.points.push({position:new THREE.Vector3(...J.position),fkey:J.face,type:J.face?"face":"edge"})}),Y.apply(),Undo.finishEdit("Knife cut mesh"),Canvas.updateView({elements:[$],element_aspects:{geometry:!0,uv:!0,faces:!0}}),`Applied knife cut to mesh "${$.name}" with ${W.length} points`}},y)}function yK(){R("paint_fill_tool",{description:"Uses the fill/bucket tool to fill areas with color.",annotations:{title:"Paint Fill Tool",destructiveHint:!0},parameters:V.object({texture_id:x0,x:V.number().describe("X coordinate to start fill."),y:V.number().describe("Y coordinate to start fill."),color:WQ.describe("Fill color as hex string."),opacity:E6.describe("Fill opacity (0-255)."),tolerance:V.number().min(0).max(100).optional().describe("Color tolerance for fill."),fill_mode:MK.optional().default("color_connected").describe("Fill mode."),blend_mode:m8.optional().describe("Fill blend mode.")}),async execute({texture_id:Q,x:W,y:$,color:Y,opacity:J,tolerance:X,fill_mode:G,blend_mode:H}){let B=Q?E0(Q):Texture.getDefault();if(!B)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[B],bitmap:!0}),Y)ColorPanel.set(Y);if(J!==void 0)BarItems.slider_brush_opacity.set(J);if(G)BarItems.fill_mode.set(G);if(H)BarItems.blend_mode.set(H);return BarItems.fill_tool.select(),Painter.startPaintTool(B,W,$,{},{shiftKey:!1}),Painter.stopPaintTool(),Undo.finishEdit("Fill tool"),Canvas.updateAll(),`Filled area at (${W}, ${$}) on texture "${B.name}"`}},y),R("draw_shape_tool",{description:"Draws geometric shapes on textures.",annotations:{title:"Draw Shape Tool",destructiveHint:!0},parameters:V.object({texture_id:x0,shape:jK.describe("Shape to draw. '_h' suffix means hollow."),start:f1.extend({x:V.number().describe("Start X coordinate."),y:V.number().describe("Start Y coordinate.")}),end:f1.extend({x:V.number().describe("End X coordinate."),y:V.number().describe("End Y coordinate.")}),color:WQ.describe("Shape color as hex string."),line_width:V.number().min(1).max(50).optional().describe("Line width for hollow shapes."),opacity:E6.describe("Shape opacity (0-255)."),blend_mode:m8.optional().describe("Shape blend mode.")}),async execute({texture_id:Q,shape:W,start:$,end:Y,color:J,line_width:X,opacity:G,blend_mode:H}){let B=Q?E0(Q):Texture.getDefault();if(!B)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[B],bitmap:!0}),J)ColorPanel.set(J);if(G!==void 0)BarItems.slider_brush_opacity.set(G);if(X!==void 0)BarItems.slider_brush_size.set(X);if(H)BarItems.blend_mode.set(H);return BarItems.draw_shape_type.set(W),BarItems.draw_shape_tool.select(),Painter.startPaintTool(B,$.x,$.y,{},{shiftKey:!1}),Painter.useShapeTool(B,Y.x,Y.y,{}),Painter.stopPaintTool(),Undo.finishEdit("Draw shape"),Canvas.updateAll(),`Drew ${W} from (${$.x}, ${$.y}) to (${Y.x}, ${Y.y}) on texture "${B.name}"`}},y),R("gradient_tool",{description:"Applies gradients to textures.",annotations:{title:"Gradient Tool",destructiveHint:!0},parameters:V.object({texture_id:x0,start:f1.extend({x:V.number().describe("Gradient start X coordinate."),y:V.number().describe("Gradient start Y coordinate.")}),end:f1.extend({x:V.number().describe("Gradient end X coordinate."),y:V.number().describe("Gradient end Y coordinate.")}),start_color:V.string().describe("Start color as hex string."),end_color:V.string().describe("End color as hex string."),opacity:E6.describe("Gradient opacity (0-255)."),blend_mode:m8.optional().describe("Gradient blend mode.")}),async execute({texture_id:Q,start:W,end:$,start_color:Y,end_color:J,opacity:X,blend_mode:G}){let H=Q?E0(Q):Texture.getDefault();if(!H)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[H],bitmap:!0}),ColorPanel.set(Y),ColorPanel.set(J,!0),X!==void 0)BarItems.slider_brush_opacity.set(X);if(G)BarItems.blend_mode.set(G);return BarItems.gradient_tool.select(),Painter.startPaintTool(H,W.x,W.y,{},{shiftKey:!1}),Painter.useGradientTool(H,$.x,$.y,{}),Painter.stopPaintTool(),Undo.finishEdit("Apply gradient"),Canvas.updateAll(),`Applied gradient from (${W.x}, ${W.y}) to (${$.x}, ${$.y}) on texture "${H.name}"`}},y),R("color_picker_tool",{description:"Picks colors from textures and sets them as the active color.",annotations:{title:"Color Picker Tool",readOnlyHint:!0},parameters:V.object({texture_id:x0,x:V.number().describe("X coordinate to pick color from."),y:V.number().describe("Y coordinate to pick color from."),set_as_secondary:V.boolean().optional().default(!1).describe("Set as secondary color instead of primary."),pick_opacity:V.boolean().optional().default(!1).describe("Also pick and apply the pixel's opacity.")}),async execute({texture_id:Q,x:W,y:$,set_as_secondary:Y,pick_opacity:J}){let X=Q?E0(Q):Texture.getDefault();if(!X)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");Painter.colorPicker(X,W,$,{button:Y?2:0});let G=ColorPanel.get();if(J){let H=Painter.getPixelColor(X.ctx,W,$),B=Math.floor(H.getAlpha()*255);for(let K in BarItems){let F=BarItems[K];if(F.tool_settings&&F.tool_settings.brush_opacity>=0)F.tool_settings.brush_opacity=B}return`Picked color ${G} with opacity ${B} from (${W}, ${$}) on texture "${X.name}"`}return`Picked color ${G} from (${W}, ${$}) on texture "${X.name}"`}},y),R("copy_brush_tool",{description:"Uses the copy/clone brush to copy texture areas.",annotations:{title:"Copy Brush Tool",destructiveHint:!0},parameters:V.object({texture_id:x0,source:f1.extend({x:V.number().describe("Source X coordinate to copy from."),y:V.number().describe("Source Y coordinate to copy from.")}),target:f1.extend({x:V.number().describe("Target X coordinate to paste to."),y:V.number().describe("Target Y coordinate to paste to.")}),brush_size:YQ.describe("Copy brush size."),opacity:E6.describe("Copy opacity (0-255)."),mode:zK.optional().default("copy").describe("Copy brush mode.")}),async execute({texture_id:Q,source:W,target:$,brush_size:Y,opacity:J,mode:X}){let G=Q?E0(Q):Texture.getDefault();if(!G)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[G],bitmap:!0}),Y!==void 0)BarItems.slider_brush_size.set(Y);if(J!==void 0)BarItems.slider_brush_opacity.set(J);if(X)BarItems.copy_brush_mode.set(X);return BarItems.copy_brush.select(),Painter.startPaintTool(G,W.x,W.y,{},{ctrlOrCmd:!0}),Painter.startPaintTool(G,$.x,$.y,{},{shiftKey:!1}),Painter.stopPaintTool(),Undo.finishEdit("Copy brush"),Canvas.updateAll(),`Copied from (${W.x}, ${W.y}) to (${$.x}, ${$.y}) on texture "${G.name}"`}},y),R("eraser_tool",{description:"Erases parts of textures with customizable settings.",annotations:{title:"Eraser Tool",destructiveHint:!0},parameters:V.object({texture_id:x0,coordinates:V.array(f1.extend({x:V.number().describe("X coordinate to erase at."),y:V.number().describe("Y coordinate to erase at.")})).describe("Array of coordinates to erase at."),brush_size:YQ.describe("Eraser brush size."),opacity:E6.describe("Eraser opacity (0-255)."),softness:tW.describe("Eraser softness percentage."),shape:rW.optional().describe("Eraser shape."),connect_strokes:V.boolean().optional().default(!0).describe("Whether to connect erase strokes with lines.")}),async execute({texture_id:Q,coordinates:W,brush_size:$,opacity:Y,softness:J,shape:X,connect_strokes:G}){let H=Q?E0(Q):Texture.getDefault();if(!H)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");if(Undo.initEdit({textures:[H],bitmap:!0}),$!==void 0)BarItems.slider_brush_size.set($);if(Y!==void 0)BarItems.slider_brush_opacity.set(Y);if(J!==void 0)BarItems.slider_brush_softness.set(J);if(X!==void 0)BarItems.brush_shape.set(X);BarItems.eraser.select();for(let B=0;B<W.length;B++){let K=W[B];if(B===0||!G)Painter.startPaintTool(H,K.x,K.y,{},{shiftKey:!1});else Painter.movePaintTool(H,K.x,K.y,{})}return Painter.stopPaintTool(),Undo.finishEdit("Erase texture"),Canvas.updateAll(),`Erased ${W.length} points on texture "${H.name}"`}},y),R("paint_settings",{description:"Configures paint mode settings and preferences.",annotations:{title:"Paint Settings",destructiveHint:!0},parameters:V.object({mirror_painting:V.object({enabled:V.boolean().describe("Enable mirror painting."),axis:V.array(c8).optional().describe("Mirror axes."),texture:V.boolean().optional().describe("Enable texture mirroring."),texture_center:f1.extend({x:V.number().describe("X coordinate of texture mirror center."),y:V.number().describe("Y coordinate of texture mirror center.")}).optional().describe("Texture mirror center.")}).optional().describe("Mirror painting settings."),lock_alpha:V.boolean().optional().describe("Lock alpha channel while painting."),pixel_perfect:V.boolean().optional().describe("Enable pixel perfect drawing."),paint_side_restrict:V.boolean().optional().describe("Restrict painting to current face side."),color_erase_mode:V.boolean().optional().describe("Enable color erase mode."),brush_opacity_modifier:h7.optional().describe("Brush opacity modifier for stylus."),brush_size_modifier:h7.optional().describe("Brush size modifier for stylus."),paint_with_stylus_only:V.boolean().optional().describe("Only allow painting with stylus input."),pick_color_opacity:V.boolean().optional().describe("Pick opacity when using color picker."),pick_combined_color:V.boolean().optional().describe("Pick combined layer colors.")}),async execute({mirror_painting:Q,lock_alpha:W,pixel_perfect:$,paint_side_restrict:Y,color_erase_mode:J,brush_opacity_modifier:X,brush_size_modifier:G,paint_with_stylus_only:H,pick_color_opacity:B,pick_combined_color:K}){let F=[];if(Q!==void 0){if(BarItems.mirror_painting.set(Q.enabled),Painter.mirror_painting=Q.enabled,F.push(`Mirror painting: ${Q.enabled}`),Q.enabled&&(Q.axis||Q.texture||Q.texture_center)){let q=Painter.mirror_painting_options;if(Q.axis)Q.axis.forEach((U)=>{q[U]=!0});if(Q.texture!==void 0)q.texture=Q.texture;if(Q.texture_center)q.texture_center=[Q.texture_center.x,Q.texture_center.y];F.push("Mirror options updated")}}if(W!==void 0)Painter.lock_alpha=W,F.push(`Lock alpha: ${W}`);if($!==void 0)BarItems.pixel_perfect_drawing.set($),F.push(`Pixel perfect: ${$}`);if(J!==void 0)BarItems.color_erase_mode.set(J),Painter.erase_mode=J,F.push(`Color erase mode: ${J}`);if(Y!==void 0)F.paint_side_restrict.value=Y,F.push(`Paint side restrict: ${Y}`);if(X!==void 0)F.brush_opacity_modifier.value=X,F.push(`Brush opacity modifier: ${X}`);if(G!==void 0)F.brush_size_modifier.value=G,F.push(`Brush size modifier: ${G}`);if(H!==void 0)F.paint_with_stylus_only.value=H,F.push(`Paint with stylus only: ${H}`);if(B!==void 0)F.pick_color_opacity.value=B,F.push(`Pick color opacity: ${B}`);if(K!==void 0)F.pick_combined_color.value=K,F.push(`Pick combined color: ${K}`);return`Updated paint settings: ${F.join(", ")}`}},y),R("paint_with_brush",{description:"Paints on textures using the brush tool with customizable settings.",annotations:{title:"Paint with Brush",destructiveHint:!0},parameters:V.object({texture_id:x0,coordinates:V.array(f1.extend({x:V.number().describe("X coordinate on texture."),y:V.number().describe("Y coordinate on texture.")})).describe("Array of coordinates to paint at."),brush_settings:ZK,connect_strokes:V.boolean().optional().default(!0).describe("Whether to connect paint strokes with lines.")}),async execute({texture_id:Q,coordinates:W,brush_settings:$,connect_strokes:Y}){let J=Q?E0(Q):Texture.getDefault();if(!J)throw Error(Q?`Texture with ID "${Q}" not found.`:"No texture available.");Undo.initEdit({textures:[J],selected_texture:!0,bitmap:!0});let X=$?.color??"#000000",G=parseInt(X.slice(1,3),16),H=parseInt(X.slice(3,5),16),B=parseInt(X.slice(5,7),16),K=$?.opacity??255,F=$?.size??1,q=$?.softness??0,U=$?.shape??"square";return BarItems.slider_brush_size.value=F,BarItems.slider_brush_opacity.value=K,BarItems.slider_brush_softness.value=q,BarItems.brush_shape.value=U,ColorPanel.set(X),J.edit((L)=>{let D=L.getContext("2d");for(let w of W)if(U==="circle")Painter.editCircle(D,w.x,w.y,F,q,()=>({r:G,g:H,b:B,a:K}));else Painter.editSquare(D,w.x,w.y,F,q,()=>({r:G,g:H,b:B,a:K}))},{edit_name:"Paint with brush"}),Undo.finishEdit("Paint with brush"),Canvas.updateAll(),`Painted ${W.length} points on texture "${J.name}"`}},y),R("create_brush_preset",{description:"Creates a custom brush preset with specified settings.",annotations:{title:"Create Brush Preset",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the brush preset."),size:YQ,opacity:E6,softness:tW,shape:rW.optional().describe("Brush shape."),color:WQ.describe("Brush color as hex string."),blend_mode:m8.optional().describe("Brush blend mode."),pixel_perfect:V.boolean().optional().describe("Enable pixel perfect drawing.")}),async execute({name:Q,size:W,opacity:$,softness:Y,shape:J,color:X,blend_mode:G,pixel_perfect:H}){let B={name:Q,size:W??null,opacity:$??null,softness:Y??null,shape:J||"square",color:X||null,blend_mode:G||"default",pixel_perfect:H||!1};return StateMemory.brush_presets.push(B),StateMemory.save("brush_presets"),`Created brush preset "${Q}" with settings: ${JSON.stringify(B)}`}},y),R("load_brush_preset",{description:"Loads and applies a brush preset by name.",annotations:{title:"Load Brush Preset",destructiveHint:!0},parameters:V.object({preset_name:V.string().describe("Name of the brush preset to load.")}),async execute({preset_name:Q}){let W=StateMemory.brush_presets.find(($)=>$.name===Q);if(!W)throw Error(`Brush preset "${Q}" not found.`);return Painter.loadBrushPreset(W),`Loaded brush preset "${Q}"`}},y),R("texture_selection",{description:"Creates, modifies, or manipulates texture selections for painting.",annotations:{title:"Texture Selection",destructiveHint:!0},parameters:V.object({action:V.enum(["select_rectangle","select_ellipse","select_all","clear_selection","invert_selection","expand_selection","contract_selection","feather_selection"]).describe("Selection action to perform."),texture_id:x0,coordinates:V.object({x1:V.number().describe("Start X coordinate."),y1:V.number().describe("Start Y coordinate."),x2:V.number().describe("End X coordinate."),y2:V.number().describe("End Y coordinate.")}).optional().describe("Selection area coordinates."),radius:V.number().optional().describe("Radius for expand/contract/feather operations."),mode:V.enum(["create","add","subtract","intersect"]).optional().default("create").describe("Selection mode.")}),async execute({action:Q,texture_id:W,coordinates:$,radius:Y,mode:J}){let X=W?E0(W):Texture.getDefault();if(!X)throw Error(W?`Texture with ID "${W}" not found.`:"No texture available.");Undo.initEdit({textures:[X],bitmap:!0});let G=X.selection;switch(Q){case"select_rectangle":if(!$)throw Error("Coordinates required for rectangle selection.");G.clear(),G.start_x=$.x1,G.start_y=$.y1,G.end_x=$.x2,G.end_y=$.y2,G.is_custom=!1;break;case"select_ellipse":if(!$)throw Error("Coordinates required for ellipse selection.");G.clear(),G.is_custom=!0;let H=($.x1+$.x2)/2,B=($.y1+$.y2)/2,K=Math.abs($.x2-$.x1)/2,F=Math.abs($.y2-$.y1)/2;for(let q=Math.floor(H-K);q<=Math.ceil(H+K);q++)for(let U=Math.floor(B-F);U<=Math.ceil(B+F);U++){let L=(q-H)/K,D=(U-B)/F;if(L*L+D*D<=1)G.set(q,U,!0)}break;case"select_all":G.selectAll();break;case"clear_selection":G.clear();break;case"invert_selection":G.invert();break;case"expand_selection":if(Y===void 0)throw Error("Radius required for expand selection.");G.expand(Y);break;case"contract_selection":if(Y===void 0)throw Error("Radius required for contract selection.");G.contract(Y);break;case"feather_selection":if(Y===void 0)throw Error("Radius required for feather selection.");G.feather(Y);break}return UVEditor.vue.updateTexture(),Undo.finishEdit("Texture selection"),`Applied ${Q} to texture "${X.name}"`}},y),R("texture_layer_management",{description:"Creates, manages, and manipulates texture layers.",annotations:{title:"Texture Layer Management",destructiveHint:!0},parameters:V.object({action:V.enum(["create_layer","delete_layer","duplicate_layer","merge_down","set_opacity","set_blend_mode","move_layer","rename_layer","flatten_layers"]).describe("Layer management action."),texture_id:x0,layer_name:V.string().optional().describe("Name of the layer."),opacity:V.number().min(0).max(100).optional().describe("Layer opacity percentage."),blend_mode:LK.optional().describe("Layer blend mode."),target_index:V.number().optional().describe("Target position for moving layers.")}),async execute({action:Q,texture_id:W,layer_name:$,opacity:Y,blend_mode:J,target_index:X}){let G=W?E0(W):Texture.selected;if(!G)throw Error(W?`Texture with ID "${W}" not found.`:"No texture selected.");Undo.initEdit({textures:[G],layers:G.layers,bitmap:!0});let H="";switch(Q){case"create_layer":if(!G.layers_enabled)G.activateLayers(!0);let B=new TextureLayer({name:$||`Layer ${G.layers.length+1}`},G);B.setSize(G.width,G.height),B.addForEditing(),H=`Created layer "${B.name}"`;break;case"delete_layer":if(!TextureLayer.selected)throw Error("No layer selected.");let K=TextureLayer.selected;K.remove(),H=`Deleted layer "${K.name}"`;break;case"duplicate_layer":if(!TextureLayer.selected)throw Error("No layer selected.");let F=TextureLayer.selected,q=F.duplicate();q.name=`${F.name} copy`,H=`Duplicated layer "${q.name}"`;break;case"merge_down":if(!TextureLayer.selected)throw Error("No layer selected.");TextureLayer.selected.mergeDown(!0),H="Merged layer down";break;case"set_opacity":if(!TextureLayer.selected)throw Error("No layer selected.");if(Y===void 0)throw Error("Opacity value required.");TextureLayer.selected.opacity=Y/100,G.updateChangesAfterEdit(),H=`Set layer opacity to ${Y}%`;break;case"set_blend_mode":if(!TextureLayer.selected)throw Error("No layer selected.");if(!J)throw Error("Blend mode required.");TextureLayer.selected.blend_mode=J,G.updateChangesAfterEdit(),H=`Set layer blend mode to ${J}`;break;case"move_layer":if(!TextureLayer.selected)throw Error("No layer selected.");if(X===void 0)throw Error("Target index required.");let U=TextureLayer.selected;G.layers.remove(U),G.layers.splice(X,0,U),H=`Moved layer to position ${X}`;break;case"rename_layer":if(!TextureLayer.selected)throw Error("No layer selected.");if(!$)throw Error("New layer name required.");let L=TextureLayer.selected.name;TextureLayer.selected.name=$,H=`Renamed layer from "${L}" to "${$}"`;break;case"flatten_layers":if(!G.layers_enabled)throw Error("Texture has no layers to flatten.");G.flattenLayers(),H="Flattened all layers";break}return G.updateChangesAfterEdit(),Undo.finishEdit(`Layer management: ${Q}`),updateInterfacePanels(),H}},y)}function gK(){R("create_project",{description:"Creates a new project with the given name and project type.",annotations:{title:"Create Project",destructiveHint:!0,openWorldHint:!0},parameters:V.object({name:V.string(),format:V.enum(Object.keys(Formats)).default("bedrock_block")}),async execute({name:Q,format:W}){if(!newProject(Formats[W]))throw Error("Failed to create project.");return Project.name=Q,`Created project with name "${Q}" (UUID: ${Project?.uuid}) and format "${W}".`}},J0)}function hK(){R("create_texture",{description:"Creates a new texture with the given name and size.",annotations:{title:"Create Texture",destructiveHint:!0,openWorldHint:!0},parameters:V.object({name:V.string(),width:V.number().min(16).max(4096).default(16),height:V.number().min(16).max(4096).default(16),data:V.string().optional().describe("Path to the image file or data URL."),group:V.string().optional(),fill_color:IK.optional().describe("RGBA color to fill the texture, as tuple or HEX string."),layer_name:V.string().optional().describe("Name of the texture layer. Required if fill_color is set."),pbr_channel:f7.optional().describe("PBR channel to use for the texture. Color, normal, height, or Metalness/Emissive/Roughness (MER) map."),render_mode:PK.optional().default("default").describe("Render mode for the texture. Default, emissive, additive, or layered."),render_sides:EK.optional().default("auto").describe("Render sides for the texture. Auto, front, or double.")}).refine((Q)=>!(Q.data&&Q.fill_color),{message:"The 'data' and 'fill_color' properties cannot both be defined.",path:["data","fill_color"]}).refine((Q)=>!(Q.fill_color&&!Q.layer_name),{message:"The 'layer_name' property is required when 'fill_color' is set.",path:["layer_name","fill_color"]}).refine(({pbr_channel:Q,group:W})=>Q&&W||!Q,{message:"The 'group' property is required when 'pbr_channel' is set.",path:["group","pbr_channel"]}),async execute({name:Q,width:W,height:$,data:Y,pbr_channel:J,fill_color:X,group:G,layer_name:H}){Undo.initEdit({textures:[],collections:[]});let B=new Texture({name:Q,width:W,height:$,group:G,pbr_channel:J,internal:!0});if(Y){if(Y.startsWith("data:image/"))B.source=Y,B.width=W,B.height=$;else B=B.fromFile({name:Y.split(/[\/\\]/).pop()||Y,path:Y.replace(/^file:\/\//,"")});B.load(),B.fillParticle(),B.layers_enabled=!1}else{let{ctx:K}=B.getActiveCanvas();if(X){let F=Array.isArray(X)?tinycolor({r:Number(X[0]),g:Number(X[1]),b:Number(X[2]),a:Number(X[3]??255)}):tinycolor(X);K.fillStyle=F.toRgbString().toLowerCase(),K.fillRect(0,0,B.width,B.height)}else K.clearRect(0,0,B.width,B.height);B.updateSource(K.canvas.toDataURL("image/png",1)),B.updateLayerChanges(!0)}return B.add(),Undo.finishEdit("Agent created texture"),Canvas.updateAll(),l8({url:B.getDataURL()})}},y),R("apply_texture",{description:"Applies the given texture to the element with the specified ID.",annotations:{title:"Apply Texture",destructiveHint:!0},parameters:V.object({id:p8.describe("ID or name of the element to apply the texture to."),texture:u7.describe("ID or name of the texture to apply."),applyTo:V.enum(["all","blank","none"]).describe("Apply texture to element or group.").optional().default("blank")}),async execute({applyTo:Q,id:W,texture:$}){let Y=J1(W),J=$?l0($):Texture.getDefault();if(!J)throw Error("No default texture available. Use the create_texture tool to create one first.");return Undo.initEdit({elements:[],outliner:!0,collections:[]}),J.select(),Texture.selected?.apply(Q==="none"?!1:Q==="all"?!0:"blank"),J.updateChangesAfterEdit(),Undo.finishEdit("Agent applied texture"),Canvas.updateAll(),`Applied texture ${J.name} to element with ID ${W}`}},J0),R("add_texture_group",{description:"Adds a new texture group with the given name.",annotations:{title:"Add Texture Group",destructiveHint:!0},parameters:V.object({name:V.string(),textures:V.array(V.string()).optional().describe("Array of texture IDs or names to add to the group."),is_material:V.boolean().optional().default(!0).describe("Whether the texture group is a PBR material or not.")}),async execute({name:Q,textures:W,is_material:$}){Undo.initEdit({elements:[],outliner:!0,collections:[],textures:[]});let Y=new TextureGroup({name:Q,is_material:$}).add();if(W){let J=W.map((X)=>E0(X)).filter(Boolean);if(J.length===0)throw Error(`No textures found for "${W}".`);J.forEach((X)=>{X?.extend({group:Y.uuid})})}return Undo.finishEdit("Agent added texture group"),Canvas.updateAll(),`Added texture group ${Y.name} with ID ${Y.uuid}`}},y),R("list_textures",{description:"Returns a list of all textures in the Blockbench editor.",annotations:{title:"List Textures",readOnlyHint:!0},parameters:V.object({}),async execute(){let Q=Project?.textures??Texture.all;return JSON.stringify(Q.map((W)=>({name:W.name,uuid:W.uuid,id:W.id,group:W.group})))}},J0),R("get_texture",{description:"Returns the image data of the given texture or default texture.",annotations:{title:"Get Texture",readOnlyHint:!0},parameters:V.object({texture:x0}),async execute({texture:Q}){if(!Q){let $=Texture.getDefault();if(!$)throw Error("No default texture available. Use the create_texture tool to create one first, or specify a texture ID.");return l8({url:$.getDataURL()})}let W=l0(Q);return l8({url:W.getDataURL()})}},J0),R("create_pbr_material",{description:"Creates a new PBR material (texture group with is_material=true) and optionally assigns textures to PBR channels. Use this for Minecraft Bedrock resource packs or any format supporting PBR.",annotations:{title:"Create PBR Material",destructiveHint:!0},parameters:V.object({name:V.string().describe("Name of the material."),color_texture:V.string().optional().describe("Texture ID/name for the color (albedo) channel."),normal_texture:V.string().optional().describe("Texture ID/name for the normal map channel."),height_texture:V.string().optional().describe("Texture ID/name for the height/displacement map channel."),mer_texture:V.string().optional().describe("Texture ID/name for the MER (Metalness/Emissive/Roughness) channel."),color_value:V.array(V.number().min(0).max(255)).length(4).optional().describe("Uniform RGBA color [R,G,B,A] when no color texture is provided."),mer_value:V.array(V.number().min(0).max(255)).length(3).optional().describe("Uniform MER values [Metalness, Emissive, Roughness] (0-255) when no MER texture is provided."),subsurface_value:V.number().min(0).max(255).optional().describe("Subsurface scattering value (0-255) for Bedrock 1.21.30+ materials.")}),async execute({name:Q,color_texture:W,normal_texture:$,height_texture:Y,mer_texture:J,color_value:X,mer_value:G,subsurface_value:H}){let B=[];if(W){let F=l0(W);B.push(F)}if($){let F=l0($);B.push(F)}if(Y){let F=l0(Y);B.push(F)}if(J){let F=l0(J);B.push(F)}Undo.initEdit({texture_groups:[],textures:B});let K=new TextureGroup({name:Q,is_material:!0});if(X)K.material_config.color_value=X;if(G)K.material_config.mer_value=G;if(H!==void 0)K.material_config.subsurface_value=H;if(K.material_config.saved=!1,K.add(),W)l0(W).extend({group:K.uuid,pbr_channel:"color"});if($)l0($).extend({group:K.uuid,pbr_channel:"normal"});if(Y)l0(Y).extend({group:K.uuid,pbr_channel:"height"});if(J)l0(J).extend({group:K.uuid,pbr_channel:"mer"});return K.updateMaterial(),Undo.finishEdit("Agent created PBR material"),Canvas.updateAll(),JSON.stringify({success:!0,material:{name:K.name,uuid:K.uuid,is_material:!0,channels:{color:W?!0:!!X,normal:!!$,height:!!Y,mer:J?!0:!!G}}})}},y),R("configure_material",{description:"Configures an existing PBR material's properties including channel assignments, uniform values, and subsurface scattering.",annotations:{title:"Configure Material",destructiveHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID to configure."),color_texture:V.string().optional().describe("Texture ID/name for the color channel, or 'none' to use uniform color."),normal_texture:V.string().optional().describe("Texture ID/name for the normal map, or 'none' to remove."),height_texture:V.string().optional().describe("Texture ID/name for the height map, or 'none' to remove."),mer_texture:V.string().optional().describe("Texture ID/name for MER channel, or 'none' to use uniform values."),color_value:V.array(V.number().min(0).max(255)).length(4).optional().describe("Uniform RGBA color [R,G,B,A] when no color texture."),mer_value:V.array(V.number().min(0).max(255)).length(3).optional().describe("Uniform MER values [Metalness, Emissive, Roughness] (0-255)."),subsurface_value:V.number().min(0).max(255).optional().describe("Subsurface scattering value (0-255).")}),async execute({material:Q,color_texture:W,normal_texture:$,height_texture:Y,mer_texture:J,color_value:X,mer_value:G,subsurface_value:H}){let B=e9(Q),K=B.getTextures();if(Undo.initEdit({texture_groups:[B],textures:K}),W==="none")K.filter((F)=>F.pbr_channel==="color").forEach((F)=>F.group="");else if(W)K.filter((q)=>q.pbr_channel==="color").forEach((q)=>q.pbr_channel="color"),l0(W).extend({group:B.uuid,pbr_channel:"color"});if($==="none")K.filter((F)=>F.pbr_channel==="normal").forEach((F)=>F.group="");else if($)l0($).extend({group:B.uuid,pbr_channel:"normal"});if(Y==="none")K.filter((F)=>F.pbr_channel==="height").forEach((F)=>F.group="");else if(Y)l0(Y).extend({group:B.uuid,pbr_channel:"height"});if(J==="none")K.filter((F)=>F.pbr_channel==="mer").forEach((F)=>F.group="");else if(J)l0(J).extend({group:B.uuid,pbr_channel:"mer"});if(X)B.material_config.color_value=X;if(G)B.material_config.mer_value=G;if(H!==void 0)B.material_config.subsurface_value=H;return B.material_config.saved=!1,B.updateMaterial(),Undo.finishEdit("Agent configured material"),Canvas.updateAll(),`Configured material "${B.name}"`}},y),R("list_materials",{description:"Lists all PBR materials (texture groups with is_material=true) and their assigned textures per channel.",annotations:{title:"List Materials",readOnlyHint:!0},parameters:V.object({}),async execute(){let W=TextureGroup.all.filter(($)=>$.is_material).map(($)=>{let Y=$.getTextures();return{name:$.name,uuid:$.uuid,channels:{color:QQ(Y,"color"),normal:QQ(Y,"normal"),height:QQ(Y,"height"),mer:QQ(Y,"mer")},config:{color_value:$.material_config.color_value,mer_value:$.material_config.mer_value,subsurface_value:$.material_config.subsurface_value,saved:$.material_config.saved}}});return JSON.stringify(W,null,2)}},J0),R("get_material_info",{description:"Gets detailed information about a PBR material including the compiled texture_set.json preview for Bedrock export.",annotations:{title:"Get Material Info",readOnlyHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID.")}),async execute({material:Q}){let W=e9(Q),$=W.getTextures(),Y=null;try{Y=W.material_config.compileForBedrock()}catch{}let J={name:W.name,uuid:W.uuid,is_material:W.is_material,textures:$.map((X)=>({name:X.name,uuid:X.uuid,pbr_channel:X.pbr_channel,width:X.width,height:X.height,render_mode:X.render_mode,render_sides:X.render_sides})),config:{color_value:W.material_config.color_value,mer_value:W.material_config.mer_value,subsurface_value:W.material_config.subsurface_value,saved:W.material_config.saved,file_path:W.material_config.getFilePath()},texture_set_json:Y};return JSON.stringify(J,null,2)}},J0),R("import_texture_set",{description:"Imports a Minecraft Bedrock texture_set.json file and creates a PBR material with the associated textures.",annotations:{title:"Import Texture Set",destructiveHint:!0,openWorldHint:!0},parameters:V.object({path:V.string().describe("Path to the .texture_set.json file to import.")}),async execute({path:Q}){if(!Q.endsWith(".texture_set.json"))throw Error("Path must end with '.texture_set.json'. Example: 'path/to/mytexture.texture_set.json'");if(!requireNativeModule("fs").existsSync(Q))throw Error(`File not found: ${Q}`);return importTextureSet({path:Q,name:Q.split(/[\/\\]/).pop()}),`Imported texture set from "${Q}". Check the textures panel for the new material.`}},y),R("assign_texture_channel",{description:"Assigns a texture to a specific PBR channel within a material.",annotations:{title:"Assign Texture Channel",destructiveHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID."),texture:u7.describe("Texture name or UUID to assign."),channel:f7.describe("PBR channel to assign the texture to.")}),async execute({material:Q,texture:W,channel:$}){let Y=e9(Q),J=l0(W);return Undo.initEdit({texture_groups:[Y],textures:[J]}),Y.getTextures().filter((G)=>G.pbr_channel===$&&G.uuid!==J.uuid).forEach((G)=>{G.pbr_channel="color"}),J.extend({group:Y.uuid,pbr_channel:$}),Y.material_config.saved=!1,Y.updateMaterial(),Undo.finishEdit("Agent assigned texture channel"),Canvas.updateAll(),`Assigned texture "${J.name}" to ${$} channel of material "${Y.name}"`}},y),R("save_material_config",{description:"Saves the material's texture_set.json file to disk (Bedrock format). Requires the color texture to have a valid file path.",annotations:{title:"Save Material Config",destructiveHint:!0,openWorldHint:!0},parameters:V.object({material:V.string().describe("Material name or UUID to save.")}),async execute({material:Q}){let W=e9(Q),$=W.material_config.getFilePath();if(!$)throw Error("Cannot save: Material needs a color texture with a valid file path. Save the color texture first, then try again.");return W.material_config.save(),`Saved material config to "${$}"`}},y)}function fK(){R("trigger_action",{description:"Triggers an action in the Blockbench editor.",annotations:{title:"Trigger Action",destructiveHint:!0,openWorldHint:!0},parameters:V.object({action:V.enum(Object.keys(BarItems)).describe("Action to trigger."),confirmDialog:V.boolean().optional().default(!0).describe("Whether or not to automatically confirm any dialogs that appear as a result of the action."),confirmEvent:V.string().optional().describe("Stringified form of event arguments.")}),async execute({action:Q,confirmEvent:W,confirmDialog:$}){Undo.initEdit({elements:[],outliner:!0,collections:[]});let Y=W?JSON.parse(W):{};if(!(Q in BarItems))throw Error(`Action "${Q}" not found.`);let J=BarItems[Q];if(J&&J instanceof Action){let{event:G,...H}=Y;J.trigger(new Event(G||"click",{...H}))}if($)Dialog.open?.confirm();Undo.finishEdit("Agent triggered action");let X;try{X=await n6()}catch(G){X=`Action "${Q}" executed, but failed to capture app screenshot: ${G}`}return X}},y),R("risky_eval",{description:"Evaluates the given expression and logs it to the console. Do not pass `console` commands as they will not work.",annotations:{title:"Eval",destructiveHint:!0,openWorldHint:!0},parameters:V.object({code:V.string().refine((Q)=>!/console\.|\/\/|\/\*/.test(Q),{message:"Code must not include 'console.', '//' or '/* */' comments."}).describe("JavaScript code to evaluate. Do not pass `console` commands or comments.")}),async execute({code}){try{Undo.initEdit({elements:[],outliner:!0,collections:[]});let result=await eval(code.trim());if(result!==void 0)return JSON.stringify(result);return"(Code executed successfully, but no result was returned.)"}catch(Q){return`Error executing code: ${Q}`}finally{Undo.finishEdit("Agent executed code")}}},J0),R("emulate_clicks",{description:"Emulates clicks on the given interface elements.",annotations:{title:"Emulate Clicks",destructiveHint:!0,openWorldHint:!0},parameters:V.object({position:V.object({x:V.number(),y:V.number(),button:V.enum(["left","right"]).optional().default("left").describe("Mouse button to use.")}),drag:V.object({to:V.object({x:V.number(),y:V.number()}),duration:V.number().optional().default(100).describe("Duration of the drag in milliseconds.")}).optional().describe("Drag options. If set, will perform a drag from position to 'to'.")}),async execute({position:Q,drag:W}){let{x:$,y:Y,button:J}=Q,X=new MouseEvent("click",{clientX:$,clientY:Y,button:J==="left"?0:2});if(document.dispatchEvent(X),W){let{to:G,duration:H}=W,B=new MouseEvent("mousedown",{clientX:$,clientY:Y,button:J==="left"?0:2}),K=new MouseEvent("mouseup",{clientX:G.x,clientY:G.y,button:J==="left"?0:2});document.dispatchEvent(B),await new Promise((F)=>setTimeout(F,H)),document.dispatchEvent(K)}return await n6()}},y),R("fill_dialog",{description:"Fills the dialog with the given values.",annotations:{title:"Fill Dialog",destructiveHint:!0,openWorldHint:!0},parameters:V.object({values:V.string().describe("Stringified form of values to fill the dialog with."),confirm:V.boolean().optional().default(!0).describe("Whether to confirm or cancel the dialog after filling it. True to confirm, false to cancel.")}),async execute({values:Q,confirm:W}){if(!Dialog.stack.length)throw Error("No dialogs found in the Blockbench editor.");if(!Dialog.open)Dialog.stack[Dialog.stack.length-1]?.focus();let $=JSON.parse(Q),Y=Object.keys(Dialog.open?.getFormResult()??{}),J=Object.entries($).reduce((X,[G,H])=>{if(Y.includes(G))X[G]=H;return X});if(Dialog.open?.setFormValues(J,!0),W)Dialog.open?.confirm();else Dialog.open?.cancel();return JSON.stringify({result:`Current dialog stack is now ${Dialog.stack.length} deep.`,dialogs:Dialog.stack.map((X)=>({id:X.id,values:X.getFormResult()}))})}},y)}function uK(){R("set_mesh_uv",{description:"Sets UV coordinates for mesh faces or vertices.",annotations:{title:"Set Mesh UV",destructiveHint:!0},parameters:V.object({mesh_id:d8,face_key:V.string().describe("Face key to set UV for."),uv_mapping:V.record(V.string(),qK).describe("UV coordinates for each vertex of the face.")}),async execute({mesh_id:Q,face_key:W,uv_mapping:$}){let Y=i6(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=Y.faces[W];if(!J)throw Error(`Face with key "${W}" not found in mesh.`);return Object.entries($).forEach(([X,G])=>{if(J.vertices.includes(X))J.uv[X]=G}),Y.preview_controller.updateUV(Y),UVEditor.loadData(),Undo.finishEdit("Set mesh UV"),`Set UV mapping for face "${W}" of mesh "${Y.name}"`}},y),R("auto_uv_mesh",{description:"Automatically generates UV mapping for selected mesh faces.",annotations:{title:"Auto UV Mesh",destructiveHint:!0},parameters:V.object({mesh_id:t1,mode:NK.default("project").describe("UV mapping mode: project from view, unwrap, cylinder, or sphere mapping."),faces:V.array(V.string()).optional().describe("Specific face keys to UV map. If not provided, maps all selected faces.")}),async execute({mesh_id:Q,mode:W,faces:$}){let Y=a1(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=$||UVEditor.getSelectedFaces(Y);if(W==="project")BarItems.uv_project_from_view.click();else J.forEach((X)=>{let G=Y.faces[X];if(!G)return;if(W==="unwrap")UVEditor.setAutoSize(null,!0,[X]);else if(W==="cylinder")G.getSortedVertices().forEach((B,K)=>{let F=Y.vertices[B],U=(Math.atan2(F[0],F[2])+Math.PI)/(2*Math.PI)*Project.texture_width,L=(F[1]+8)/16*Project.texture_height;G.uv[B]=[U,L]});else if(W==="sphere")G.getSortedVertices().forEach((B)=>{let K=Y.vertices[B],F=Math.sqrt(K[0]**2+K[1]**2+K[2]**2),q=Math.acos(K[1]/F),L=(Math.atan2(K[0],K[2])+Math.PI)/(2*Math.PI)*Project.texture_width,D=q/Math.PI*Project.texture_height;G.uv[B]=[L,D]})});return Y.preview_controller.updateUV(Y),UVEditor.loadData(),Undo.finishEdit("Auto UV mesh"),`Applied ${W} UV mapping to ${J.length} faces of mesh "${Y.name}"`}},y),R("rotate_mesh_uv",{description:"Rotates UV coordinates of selected mesh faces.",annotations:{title:"Rotate Mesh UV",destructiveHint:!0},parameters:V.object({mesh_id:t1,angle:V.enum(["-90","90","180"]).default("90").describe("Rotation angle in degrees."),faces:V.array(V.string()).optional().describe("Specific face keys to rotate UV for. If not provided, rotates all selected faces.")}),async execute({mesh_id:Q,angle:W,faces:$}){let Y=a1(Q);Undo.initEdit({elements:[Y],uv_only:!0});let J=parseInt(W);return UVEditor.rotate(J),Undo.finishEdit("Rotate mesh UV"),`Rotated UV by ${W} degrees for mesh "${Y.name}"`}},y)}function sW(Q){let W=J1(Q);if(!(W instanceof Cube))throw Error(`Element "${Q}" is not a cube. Material instances are only supported on cube faces.`);return W}function lK(){R("get_face_material_instances",{description:"Gets the material instance names for cube faces. Material instances are used in Bedrock Block format to map faces to materials defined in the minecraft:material_instances component.",annotations:{title:"Get Face Material Instances",readOnlyHint:!0},parameters:V.object({cube_id:V.string().optional().describe("ID or name of the cube. If not provided, uses the first selected cube."),faces:V.array(P6).optional().describe("Specific faces to get material instances for. If not provided, returns all faces.")}),async execute({cube_id:Q,faces:W}){let $;if(Q)$=sW(Q);else{if(!Cube.selected.length)throw Error("No cube specified and no cube selected. Provide a cube_id or select a cube.");$=Cube.selected[0]}let Y=W||P6.options,J={};for(let X of Y){let G=$.faces[X];if(G)J[X]={material_name:G.material_name||"",texture:G.texture?G.getTexture()?.name||G.texture.toString():null}}return JSON.stringify({cube:{name:$.name,uuid:$.uuid},faces:J},null,2)}},J0),R("set_face_material_instance",{description:"Sets the material instance name for one or more cube faces. Material instances are strings that map to materials defined in the minecraft:material_instances component for Bedrock Block format.",annotations:{title:"Set Face Material Instance",destructiveHint:!0},parameters:V.object({cube_id:V.string().optional().describe("ID or name of the cube. If not provided, applies to all selected cubes."),material_name:V.string().describe("The material instance name to assign. Use empty string to clear the material instance."),faces:V.array(P6).optional().default(["north","south","east","west","up","down"]).describe("Faces to set the material instance on. Defaults to all faces.")}),async execute({cube_id:Q,material_name:W,faces:$}){let Y;if(Q)Y=[sW(Q)];else{if(!Cube.selected.length)throw Error("No cube specified and no cubes selected. Provide a cube_id or select cubes.");Y=Cube.selected}Undo.initEdit({elements:Y,uv_only:!0});let J=0;for(let X of Y)for(let G of $){let H=X.faces[G];if(H)H.extend({material_name:W}),J++}return Undo.finishEdit("Set material instances"),Canvas.updateAll(),`Set material instance "${W}" on ${J} face(s) across ${Y.length} cube(s).`}},y),R("list_material_instances",{description:"Lists all unique material instance names used in the project. Returns the material instance names along with which cubes and faces use them.",annotations:{title:"List Material Instances",readOnlyHint:!0},parameters:V.object({}),async execute(){let Q={};for(let $ of Cube.all)for(let Y of P6.options){let J=$.faces[Y];if(J&&J.material_name){if(!Q[J.material_name])Q[J.material_name]=[];Q[J.material_name].push({cube_name:$.name,cube_uuid:$.uuid,face:Y})}}let W=Object.entries(Q).map(([$,Y])=>({name:$,usage_count:Y.length,usages:Y}));return JSON.stringify({total_unique_instances:W.length,material_instances:W},null,2)}},J0),R("bulk_set_material_instances",{description:"Sets material instance names on multiple cubes at once. Useful for assigning different material instances to different faces across the project.",annotations:{title:"Bulk Set Material Instances",destructiveHint:!0},parameters:V.object({assignments:V.array(V.object({cube_id:V.string().describe("ID or name of the cube."),faces:V.array(P6).describe("Faces to set the material instance on."),material_name:V.string().describe("Material instance name to assign.")})).min(1).describe("Array of material instance assignments.")}),async execute({assignments:Q}){let W={},$=[];for(let J of Q)if(!W[J.cube_id]){let X=sW(J.cube_id);W[J.cube_id]=X,$.push(X)}Undo.initEdit({elements:$,uv_only:!0});let Y=0;for(let J of Q){let X=W[J.cube_id];for(let G of J.faces){let H=X.faces[G];if(H)H.extend({material_name:J.material_name}),Y++}}return Undo.finishEdit("Bulk set material instances"),Canvas.updateAll(),`Applied ${Q.length} material instance assignment(s) affecting ${Y} face(s) on ${$.length} cube(s).`}},y),R("clear_material_instances",{description:"Clears (removes) material instance names from cube faces. Useful for resetting material assignments.",annotations:{title:"Clear Material Instances",destructiveHint:!0},parameters:V.object({cube_id:V.string().optional().describe("ID or name of the cube. If not provided, clears from all selected cubes."),faces:V.array(P6).optional().describe("Specific faces to clear. If not provided, clears all faces."),all_cubes:V.boolean().optional().default(!1).describe("If true, clears material instances from all cubes in the project.")}),async execute({cube_id:Q,faces:W,all_cubes:$}){let Y;if($)Y=Cube.all;else if(Q)Y=[sW(Q)];else{if(!Cube.selected.length)throw Error("No cube specified and no cubes selected. Provide a cube_id, select cubes, or set all_cubes=true.");Y=Cube.selected}if(Y.length===0)return"No cubes to process.";Undo.initEdit({elements:Y,uv_only:!0});let J=W||P6.options,X=0;for(let G of Y)for(let H of J){let B=G.faces[H];if(B&&B.material_name)B.extend({material_name:""}),X++}return Undo.finishEdit("Clear material instances"),Canvas.updateAll(),`Cleared material instances from ${X} face(s) across ${Y.length} cube(s).`}},y)}var Uj=["hytale_character","hytale_prop"],mK=["flat","standard","fullbright","reflective"],cK=["+X","-X","+Y","-Y","+Z","-Z"];function o6(){if(typeof Plugins>"u")return!1;return Plugins.installed?.some?.((Q)=>Q.id==="hytale_plugin"&&!Q.disabled)??!1}function z0(){if(typeof Format>"u"||!Format?.id)return!1;return Uj.includes(Format.id)}function i8(){if(!z0())return null;if(Format.id==="hytale_character")return"character";if(Format.id==="hytale_prop")return"prop";return null}function n8(){let Q=i8();if(Q==="character")return 64;if(Q==="prop")return 32;return 16}function JQ(){if(!o6())return[];if(typeof Collection>"u")return[];return(Collection.all??[]).filter((Q)=>Q.export_codec==="blockymodel")}function XQ(){if(typeof Group>"u")return[];return(Group.all??[]).filter((Q)=>Q.is_piece===!0)}function r6(Q){return Q.shading_mode??"standard"}function a6(Q){return Q.double_sided??!1}function GQ(){return 60}function Dj(){return 255}function wj(){if(typeof Group>"u")return 0;if(typeof Cube>"u")return 0;let Q=0,W=Group.all??[],$=Cube.all??[];Q+=W.length;for(let Y of $){let J=Y.parent;if(J instanceof Group){if(J.children.filter((G)=>G instanceof Cube).length>1)Q+=1}else Q+=1}return Q}function HQ(){let Q=wj(),W=Dj(),$=Q<=W;return{valid:$,count:Q,max:W,message:$?void 0:`Node count (${Q}) exceeds Hytale limit of ${W} nodes.`}}function pK(){if(!o6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale tools registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale tools"),R("hytale_get_format_info",{description:"Returns information about the current Hytale format. Requires the Hytale plugin and a Hytale format project to be active.",annotations:{title:"Get Hytale Format Info",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!z0())throw Error("Current project is not using a Hytale format. Create or open a Hytale character or prop project first.");let Q=i8(),W=n8(),$=HQ();return JSON.stringify({formatType:Q,blockSize:W,animationFPS:GQ(),nodeCount:$.count,maxNodes:$.max,nodeCountValid:$.valid,features:{boneRig:!0,animationFiles:!0,quaternionInterpolation:!0,uvRotation:!0,stretchCubes:!0,attachments:!0,quads:!0}})}},"experimental"),R("hytale_validate_model",{description:"Validates the current Hytale model against Hytale engine constraints (node count, UV sizes, etc.).",annotations:{title:"Validate Hytale Model",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!z0())throw Error("Current project is not using a Hytale format.");let Q=HQ(),W=[];if(!Q.valid)W.push(Q.message);let $=Project?.textures??[],Y=n8();for(let J of $)if(J.width!==Y||J.height<Y){if(J.height%Y!==0)W.push(`Texture "${J.name}" has invalid dimensions (${J.width}x${J.height}). Expected width ${Y} and height multiple of ${Y}.`)}return JSON.stringify({valid:W.length===0,nodeCount:Q.count,maxNodes:Q.max,issues:W,blockSize:Y,textureCount:$.length})}},"experimental"),R("hytale_set_cube_properties",{description:"Sets Hytale-specific properties on a cube: shading_mode (flat, standard, fullbright, reflective) and double_sided.",annotations:{title:"Set Hytale Cube Properties",destructiveHint:!1},parameters:V.object({cube_id:V.string().describe("ID or name of the cube to modify. Uses selected cube if not provided.").optional(),shading_mode:V.enum(mK).describe("Shading mode: flat (no lighting), standard (normal), fullbright (emissive), reflective").optional(),double_sided:V.boolean().describe("Whether to render both sides of faces").optional()}),async execute({cube_id:Q,shading_mode:W,double_sided:$}){if(!z0())throw Error("Current project is not using a Hytale format.");let Y;if(Q){let X=J1(Q);if(!(X instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);Y=X}else{let X=Cube.selected[0];if(!X)throw Error("No cube selected and no cube_id provided.");Y=X}Undo.initEdit({elements:[Y]});let J=Y;if(W!==void 0)J.shading_mode=W;if($!==void 0)J.double_sided=$;return Undo.finishEdit("Set Hytale cube properties"),JSON.stringify({uuid:Y.uuid,name:Y.name,shading_mode:r6(Y),double_sided:a6(Y)})}},"experimental"),R("hytale_get_cube_properties",{description:"Gets Hytale-specific properties from a cube (shading_mode, double_sided).",annotations:{title:"Get Hytale Cube Properties",readOnlyHint:!0},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional()}),async execute({cube_id:Q}){if(!z0())throw Error("Current project is not using a Hytale format.");let W;if(Q){let $=J1(Q);if(!($ instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);W=$}else{let $=Cube.selected[0];if(!$)throw Error("No cube selected and no cube_id provided.");W=$}return JSON.stringify({uuid:W.uuid,name:W.name,shading_mode:r6(W),double_sided:a6(W)})}},"experimental"),R("hytale_create_quad",{description:"Creates a Hytale quad (2D plane) with a specified normal direction. Quads are single-face elements useful for flat surfaces.",annotations:{title:"Create Hytale Quad",destructiveHint:!1},parameters:V.object({name:V.string().describe("Name for the quad"),position:V.array(V.number()).length(3).describe("Position [x, y, z]").default([0,0,0]),normal:V.enum(cK).describe("Normal direction: +X, -X, +Y, -Y, +Z, -Z").default("+Y"),size:V.array(V.number()).length(2).describe("Size [width, height]").default([16,16]),group:V.string().describe("Parent group/bone name").optional(),double_sided:V.boolean().describe("Whether to render both sides").default(!0)}),async execute({name:Q,position:W,normal:$,size:Y,group:J,double_sided:X}){if(!z0())throw Error("Current project is not using a Hytale format.");let G;if(J)G=u0(J);let[H,B]=Y,[K,F,q]=W,U,L;switch($){case"+X":case"-X":U=[K,F,q],L=[K,F+B,q+H];break;case"+Y":case"-Y":U=[K,F,q],L=[K+H,F,q+B];break;case"+Z":case"-Z":U=[K,F,q],L=[K+H,F+B,q];break;default:U=[K,F,q],L=[K+H,F+B,q]}Undo.initEdit({outliner:!0,elements:[]});let D=new Cube({name:Q,from:U,to:L,autouv:1}).init(),w=D;if(w.double_sided=X,w.shading_mode="standard",G)D.addTo(G);return Undo.finishEdit("Create Hytale quad"),Canvas.updateAll(),JSON.stringify({uuid:D.uuid,name:D.name,normal:$,from:U,to:L,double_sided:X})}},"experimental"),R("hytale_list_attachments",{description:"Lists all attachment collections in the current Hytale project.",annotations:{title:"List Hytale Attachments",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!z0())throw Error("Current project is not using a Hytale format.");let Q=JQ();return JSON.stringify({count:Q.length,attachments:Q.map((W)=>({uuid:W.uuid,name:W.name,texture:W.texture??null,elementCount:W.children?.length??0}))})}},"experimental"),R("hytale_set_attachment_piece",{description:"Marks or unmarks a group as an attachment piece. Attachment pieces attach to like-named bones in the main model.",annotations:{title:"Set Attachment Piece",destructiveHint:!1},parameters:V.object({group_name:V.string().describe("Name of the group to mark as attachment piece"),is_piece:V.boolean().describe("Whether the group is an attachment piece")}),async execute({group_name:Q,is_piece:W}){if(!z0())throw Error("Current project is not using a Hytale format.");let $=u0(Q);return Undo.initEdit({outliner:!0}),$.is_piece=W,Undo.finishEdit("Set attachment piece"),JSON.stringify({uuid:$.uuid,name:$.name,is_piece:W})}},"experimental"),R("hytale_list_attachment_pieces",{description:"Lists all groups marked as attachment pieces.",annotations:{title:"List Attachment Pieces",readOnlyHint:!0},parameters:V.object({}),async execute(){if(!z0())throw Error("Current project is not using a Hytale format.");let Q=XQ();return JSON.stringify({count:Q.length,pieces:Q.map((W)=>({uuid:W.uuid,name:W.name,origin:W.origin}))})}},"experimental"),R("hytale_create_visibility_keyframe",{description:"Creates a visibility keyframe for a bone. Hytale supports toggling node visibility at keyframes.",annotations:{title:"Create Visibility Keyframe",destructiveHint:!1},parameters:V.object({bone_name:V.string().describe("Name of the bone/group"),time:V.number().describe("Time in seconds for the keyframe"),visible:V.boolean().describe("Whether the bone is visible at this keyframe"),animation_id:V.string().describe("Animation UUID or name. Uses current animation if not provided.").optional()}),async execute({bone_name:Q,time:W,visible:$,animation_id:Y}){if(!z0())throw Error("Current project is not using a Hytale format.");let J;if(Y){if(J=Animation.all.find((H)=>H.uuid===Y||H.name===Y),!J)throw Error(`Animation "${Y}" not found.`)}else if(J=Animation.selected,!J)throw Error("No animation selected and no animation_id provided.");let X=J.getBoneAnimator(u0(Q));if(!X)throw Error(`Could not get animator for bone "${Q}".`);Undo.initEdit({animations:[J]});let G=X.addKeyframe({channel:"visibility",time:W,data_points:[{visible:$}]});if(Undo.finishEdit("Create visibility keyframe"),typeof updateKeyframeSelection==="function")updateKeyframeSelection();return JSON.stringify({success:!0,animation:J.name,bone:Q,time:W,visible:$,keyframe_uuid:G?.uuid})}},"experimental"),R("hytale_set_animation_loop",{description:'Sets the loop mode for a Hytale animation. Hytale supports "loop" (continuous) or "hold" (freeze on last frame).',annotations:{title:"Set Animation Loop Mode",destructiveHint:!1},parameters:V.object({animation_id:V.string().describe("Animation UUID or name. Uses current animation if not provided.").optional(),loop_mode:V.enum(["loop","hold","once"]).describe("Loop mode: loop (continuous), hold (freeze on last frame), once (play once)")}),async execute({animation_id:Q,loop_mode:W}){if(!z0())throw Error("Current project is not using a Hytale format.");let $;if(Q){if($=Animation.all.find((Y)=>Y.uuid===Q||Y.name===Q),!$)throw Error(`Animation "${Q}" not found.`)}else if($=Animation.selected,!$)throw Error("No animation selected and no animation_id provided.");return Undo.initEdit({animations:[$]}),$.loop=W,Undo.finishEdit("Set animation loop mode"),JSON.stringify({animation:$.name,uuid:$.uuid,loop_mode:W})}},"experimental"),R("hytale_set_cube_stretch",{description:"Sets the stretch values for a cube. Hytale uses stretch instead of float sizes for better UV handling.",annotations:{title:"Set Cube Stretch",destructiveHint:!1},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional(),stretch:V.array(V.number()).length(3).describe("Stretch values [x, y, z]")}),async execute({cube_id:Q,stretch:W}){if(!z0())throw Error("Current project is not using a Hytale format.");let $;if(Q){let Y=J1(Q);if(!(Y instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);$=Y}else{let Y=Cube.selected[0];if(!Y)throw Error("No cube selected and no cube_id provided.");$=Y}return Undo.initEdit({elements:[$]}),$.stretch=[...W],Undo.finishEdit("Set cube stretch"),Canvas.updateAll(),JSON.stringify({uuid:$.uuid,name:$.name,stretch:W})}},"experimental"),R("hytale_get_cube_stretch",{description:"Gets the stretch values for a cube.",annotations:{title:"Get Cube Stretch",readOnlyHint:!0},parameters:V.object({cube_id:V.string().describe("ID or name of the cube. Uses selected cube if not provided.").optional()}),async execute({cube_id:Q}){if(!z0())throw Error("Current project is not using a Hytale format.");let W;if(Q){let Y=J1(Q);if(!(Y instanceof Cube))throw Error(`Element "${Q}" is not a cube.`);W=Y}else{let Y=Cube.selected[0];if(!Y)throw Error("No cube selected and no cube_id provided.");W=Y}let $=W.stretch??[1,1,1];return JSON.stringify({uuid:W.uuid,name:W.name,stretch:$})}},"experimental"),console.log("[MCP] Hytale tools registered successfully")}function dK(){if(!o6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale resources registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale resources"),h1("hytale-format",{uriTemplate:"hytale://format",title:"Hytale Format Information",description:"Returns comprehensive information about the current Hytale format, including format type, block size, node limits, and feature support.",async listCallback(){if(!z0())return{resources:[]};return{resources:[{uri:"hytale://format",name:`Hytale ${i8()} format`,description:`Block size: ${n8()}, FPS: ${GQ()}`,mimeType:"application/json"}]}},async readCallback(Q){if(!z0())return{contents:[{uri:Q.href,text:JSON.stringify({active:!1,message:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let W=i8(),$=n8(),Y=HQ();return{contents:[{uri:Q.href,text:JSON.stringify({active:!0,formatType:W,formatId:W==="character"?"hytale_character":"hytale_prop",blockSize:$,animationFPS:GQ(),nodeCount:Y.count,maxNodes:Y.max,nodeCountValid:Y.valid,features:{boneRig:!0,animationFiles:!0,quaternionInterpolation:!0,uvRotation:!0,stretchCubes:!0,attachments:!0,quads:!0,shadingModes:["flat","standard","fullbright","reflective"],doubleSided:!0,visibilityKeyframes:!0}}),mimeType:"application/json"}]}}}),h1("hytale-attachments",{uriTemplate:"hytale://attachments/{id}",title:"Hytale Attachments",description:"Returns information about attachment collections in the current Hytale project. Attachments are separate models that can be attached to bones.",async listCallback(){if(!z0())return{resources:[]};return{resources:JQ().map((W)=>({uri:`hytale://attachments/${W.uuid}`,name:W.name,description:`Attachment collection${W.texture?" with texture":""}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!z0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=JQ();if(W){let Y=$.find((J)=>J.uuid===W||J.name===W);if(!Y)throw Error(`Attachment "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,texture:Y.texture??null,elementCount:Y.children?.length??0,exportCodec:Y.export_codec}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,attachments:$.map((Y)=>({uuid:Y.uuid,name:Y.name,texture:Y.texture??null,elementCount:Y.children?.length??0}))}),mimeType:"application/json"}]}}}),h1("hytale-pieces",{uriTemplate:"hytale://pieces/{id}",title:"Hytale Attachment Pieces",description:"Returns information about groups marked as attachment pieces. Attachment pieces connect to like-named bones in the main model.",async listCallback(){if(!z0())return{resources:[]};return{resources:XQ().map((W)=>({uri:`hytale://pieces/${W.uuid}`,name:W.name,description:"Attachment piece bone",mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!z0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=XQ();if(W){let Y=$.find((J)=>J.uuid===W||J.name===W);if(!Y)throw Error(`Attachment piece "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,origin:Y.origin,rotation:Y.rotation,is_piece:!0,childCount:Y.children?.length??0}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,pieces:$.map((Y)=>({uuid:Y.uuid,name:Y.name,origin:Y.origin}))}),mimeType:"application/json"}]}}}),h1("hytale-cubes",{uriTemplate:"hytale://cubes/{id}",title:"Hytale Cubes",description:"Returns information about cubes with Hytale-specific properties (shading_mode, double_sided, stretch).",async listCallback(){if(!z0())return{resources:[]};return{resources:(Cube.all??[]).map((W)=>({uri:`hytale://cubes/${W.uuid}`,name:W.name,description:`Shading: ${r6(W)}, Double-sided: ${a6(W)}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!z0())return{contents:[{uri:Q.href,text:JSON.stringify({error:"No Hytale format project is currently active."}),mimeType:"application/json"}]};let $=Cube.all??[];if(W){let Y=$.find((X)=>X.uuid===W||X.name===W);if(!Y)throw Error(`Cube "${W}" not found.`);let J=Y;return{contents:[{uri:Q.href,text:JSON.stringify({uuid:Y.uuid,name:Y.name,from:Y.from,to:Y.to,origin:Y.origin,rotation:Y.rotation,stretch:Y.stretch??[1,1,1],shading_mode:r6(Y),double_sided:a6(Y),autouv:Y.autouv,visibility:Y.visibility}),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({count:$.length,cubes:$.map((Y)=>({uuid:Y.uuid,name:Y.name,shading_mode:r6(Y),double_sided:a6(Y),stretch:Y.stretch??[1,1,1]}))}),mimeType:"application/json"}]}}}),console.log("[MCP] Hytale resources registered successfully")}function iK(){if(!o6()){console.log("[MCP] Hytale plugin not detected, skipping Hytale prompts registration");return}console.log("[MCP] Hytale plugin detected, registering Hytale prompts"),z6("hytale_model_creation",{title:"Hytale Model Creation Guide",description:"Comprehensive guide for creating Hytale character and prop models. Covers format selection, node limits, shading modes, stretch, quads, and best practices.",argsSchema:V.object({format_type:V.enum(["character","prop","both"]).describe("Which format type to focus on").optional().default("both")}),async generate({format_type:Q}){let W=await`# Hytale Model Creation Guide

This guide covers creating 3D models for Hytale using Blockbench with the Hytale plugin.

## Format Selection

Hytale uses two model formats:

### Character Format (\`hytale_character\`)
- **Block Size**: 64 pixels
- **Use Case**: Humanoid/creature models with complex rigs
- **Features**: Full bone hierarchy, attachments, animations

### Prop Format (\`hytale_prop\`)
- **Block Size**: 32 pixels
- **Use Case**: Items, weapons, decorative objects
- **Features**: Simpler structure, optimized for props

## Key Concepts

### Node Limit
Hytale has a **maximum of 255 nodes** per model. Nodes include:
- Groups/bones
- Individual cubes (excluding the main shape cube of a group)

Use \`hytale_validate_model\` tool to check node count.

### Shading Modes
Cubes support four shading modes:
- \`standard\` - Normal lighting (default)
- \`flat\` - No lighting/shadows
- \`fullbright\` - Always fully lit (emissive effect)
- \`reflective\` - Reflective material

Set with \`hytale_set_cube_properties\` tool.

### Double-Sided Faces
Enable \`double_sided\` on cubes to render both front and back faces. Useful for:
- Thin planes/quads
- Cloth/fabric elements
- Transparency effects

### Stretch vs Size
Hytale prefers **stretch** over floating-point sizes:
- Stretch is a multiplier [x, y, z] applied to the base cube
- Better UV handling than fractional sizes
- Use \`hytale_set_cube_stretch\` / \`hytale_get_cube_stretch\` tools

### Quads
Hytale supports single-face quads (2D planes):
- Created with \`hytale_create_quad\` tool
- Specify normal direction: +X, -X, +Y, -Y, +Z, -Z
- Automatically double-sided by default

## Workflow

1. **Create Project**: Use \`create_project\` with format \`bedrock\` (Hytale uses similar format structure)
2. **Build Skeleton**: Create bone hierarchy using \`add_group\` with proper origins
3. **Add Geometry**: Use \`place_cube\` for cubes, \`hytale_create_quad\` for flat surfaces
4. **Set Properties**: Apply shading modes and double-sided as needed
5. **Validate**: Run \`hytale_validate_model\` before export

## Texture Guidelines

- Character textures: 64x64 or multiples for flipbooks
- Prop textures: 32x32 or multiples for flipbooks
- UV size must match texture resolution
- Use integer positions for pixel-perfect UVs

## Tips

- Keep node count under 255
- Use stretch for scaling instead of fractional sizes
- Group related cubes under bones for animation
- Mark attachment bones with \`is_piece: true\` using \`hytale_set_attachment_piece\`
`,$="";if(Q==="character")$=`
## Character-Specific Guidelines

You are creating a **Hytale Character** model (64px block size).

Key considerations:
- Complex bone hierarchies for humanoid/creature rigs
- Full animation support with all channels
- Attachment system for equipment
- Higher detail level (64px textures)

Typical bone structure:
\`\`\`
root
 body
    head
       [face details]
    arm_left
       hand_left
    arm_right
       hand_right
    leg_left
       foot_left
    leg_right
        foot_right
 [accessories]
\`\`\`
`;else if(Q==="prop")$=`
## Prop-Specific Guidelines

You are creating a **Hytale Prop** model (32px block size).

Key considerations:
- Simpler structure optimized for items/objects
- May have minimal or no animation
- Often single-bone or simple hierarchy
- Lower detail level (32px textures)

Common prop types:
- Weapons (sword, axe, bow)
- Tools (pickaxe, shovel)
- Items (food, potions, keys)
- Decorations (furniture, plants)
`;return{messages:[{role:"user",content:{type:"text",text:W+$}}]}}},"experimental"),z6("hytale_animation_workflow",{title:"Hytale Animation Workflow",description:"Guide for creating animations for Hytale models. Covers 60 FPS timing, quaternion rotations, visibility keyframes, loop modes, and common animation patterns.",argsSchema:V.object({animation_type:V.enum(["walk","idle","attack","general"]).describe("Type of animation to focus on").optional().default("general")}),async generate({animation_type:Q}){let W=await`# Hytale Animation Workflow

This guide covers creating animations for Hytale models using Blockbench with the Hytale plugin.

## Animation Basics

### Frame Rate
Hytale animations run at **60 FPS**. When setting keyframe times:
- 1 second = 60 frames
- 0.5 seconds = 30 frames
- Use decimal seconds in tools (e.g., 0.5, 1.0, 2.5)

### File Format
Animations are stored in \`.blockyanim\` files, separate from the model (\`.blockymodel\`).

## Animation Channels

Hytale supports these animation channels per bone:

### Position
- Channel: \`position\`
- Values: [x, y, z] offset from rest pose

### Rotation (Quaternion)
- Channel: \`rotation\`
- Hytale uses **quaternion interpolation** for smooth 3D rotations
- Avoids gimbal lock issues

### Scale (Stretch)
- Channel: \`scale\`
- Values: [x, y, z] scale factors
- Linked to cube stretch system

### Visibility (Hytale-specific)
- Channel: \`visibility\`
- Values: boolean (true/false)
- Toggle bone visibility at keyframes
- Use \`hytale_create_visibility_keyframe\` tool

## Interpolation Types

- \`linear\` - Constant rate between keyframes
- \`smooth\` - Catmull-Rom spline for natural easing (default for Hytale)

## Loop Modes

Set with \`hytale_set_animation_loop\`:

- \`loop\` - Continuous playback, restarts from beginning
- \`hold\` - Play once, freeze on last frame
- \`once\` - Play once, return to rest pose

## Workflow

### 1. Create Animation
\`\`\`
Use create_animation tool:
- name: "walk_cycle"
- animation_length: 1.0 (1 second)
- loop: true
\`\`\`

### 2. Add Keyframes
Use animation tools to add keyframes:
- \`manage_keyframes\` for position/rotation/scale
- \`hytale_create_visibility_keyframe\` for visibility toggles

### 3. Set Interpolation
Use \`animation_graph_editor\` to adjust curves:
- \`smooth\` for organic movements
- \`linear\` for mechanical movements
- \`stepped\` for snappy transitions

### 4. Multi-Bone Animation
Hytale supports **duplicate bone names**:
- Multiple bones with same name receive same animation
- Useful for symmetrical limbs (left_leg, left_leg)
- Animation is automatically copied

## Tips

### Visibility Animations
Use visibility keyframes for:
- Showing/hiding alternate body parts
- Weapon swapping effects
- Damage states

### Attachment Animations
Attachment pieces inherit parent bone animation:
- Mark bones as attachment pieces with \`is_piece: true\`
- Attachments connect to matching bone names

### Performance
- Keep keyframes sparse, interpolation fills gaps
- Use linear interpolation for simple movements
- Quaternion rotation prevents flip issues

## Common Patterns

### Walk Cycle (1 second loop)
1. Contact pose (0s): Extended legs
2. Passing pose (0.25s): Mid-stride
3. Contact pose (0.5s): Opposite leg forward
4. Passing pose (0.75s): Return to start

### Idle Animation (2-3 second loop)
- Subtle breathing (scale Y on chest)
- Slight head movement
- Small position shifts for life

### Attack Animation (0.5-1 second)
- Wind-up phase with anticipation
- Quick strike (linear interpolation)
- Recovery with easing
`,$="";if(Q==="walk")$=`
## Walk Cycle Focus

Creating a walk cycle animation:

1. **Timing** (1 second loop at 60 FPS)
   - Frame 0: Right foot forward (contact)
   - Frame 15: Right foot passing
   - Frame 30: Left foot forward (contact)
   - Frame 45: Left foot passing
   - Frame 60: Loop to frame 0

2. **Key Bones**
   - Legs: Primary motion drivers
   - Arms: Counter-swing to legs
   - Body: Slight up/down bob
   - Head: Subtle stabilization

3. **Interpolation**
   - Use \`smooth\` for organic feel
   - Slight ease-in/out on contacts
`;else if(Q==="idle")$=`
## Idle Animation Focus

Creating a breathing/idle animation:

1. **Timing** (2-3 second loop)
   - Slow, subtle movements
   - Natural breathing rhythm

2. **Key Elements**
   - Chest: Scale Y for breathing (1.0  1.02  1.0)
   - Head: Tiny rotation shifts
   - Arms: Minimal sway
   - Weight shifts: Subtle body position

3. **Tips**
   - Keep movements very small
   - Use smooth interpolation
   - Avoid mechanical repetition
`;else if(Q==="attack")$=`
## Attack Animation Focus

Creating a combat animation:

1. **Timing** (0.5-1 second)
   - Anticipation: 0.1-0.2s (wind-up)
   - Strike: 0.1s (fast action)
   - Recovery: 0.2-0.5s (return)

2. **Key Phases**
   - Wind-up: Draw weapon back
   - Strike: Quick forward motion
   - Impact: Slight pause/emphasis
   - Recovery: Return to ready pose

3. **Interpolation**
   - Anticipation: Smooth ease-in
   - Strike: Linear (fast)
   - Recovery: Smooth ease-out

4. **Tips**
   - Exaggerate wind-up for readability
   - Strike should be 2-3x faster than wind-up
   - Add slight overshoot on recovery
`;return{messages:[{role:"user",content:{type:"text",text:W+$}}]}}},"experimental"),z6("hytale_attachments",{title:"Hytale Attachments System",description:"Guide for creating and managing attachments in Hytale models. Covers attachment collections, piece bones, modular equipment, and best practices.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Hytale Attachments System

This guide covers the attachment system in Hytale models for creating modular equipment, accessories, and interchangeable parts.

## What Are Attachments?

Attachments are separate models that can be dynamically attached to bones in a base model. Common uses:
- Armor pieces
- Weapons and tools
- Accessories (hats, capes)
- Alternate body parts
- Equipment variations

## Key Concepts

### Attachment Collections
Attachments are organized as **Collections** in Blockbench:
- Each collection is a separate exportable unit
- Collections have their own textures
- Export codec: \`blockymodel\`

Use \`hytale_list_attachments\` to see all attachment collections.

### Attachment Pieces
Groups marked as **attachment pieces** define connection points:
- Set with \`hytale_set_attachment_piece\` tool
- Pieces attach to bones with matching names in the base model
- Origin point defines the attachment anchor

Use \`hytale_list_attachment_pieces\` to see marked pieces.

## Workflow

### Creating an Attachment

1. **Create Collection**
   - Use Blockbench's collection panel
   - Set export codec to \`blockymodel\`

2. **Build Geometry**
   - Add cubes/meshes to the collection
   - Structure under bones as needed

3. **Mark Piece Bones**
   \`\`\`
   hytale_set_attachment_piece:
   - group_name: "hand_right"
   - is_piece: true
   \`\`\`
   This bone will attach to \`hand_right\` in the base model.

4. **Assign Texture**
   - Each attachment can have its own texture
   - Texture is stored in collection metadata

### Attachment Naming Convention

For automatic attachment:
- Base model has bone: \`hand_right\`
- Attachment has piece bone: \`hand_right\`
- Attachment snaps to base bone at runtime

### Multiple Attachments

A single bone can have multiple possible attachments:
- Create separate collections for each variant
- All share the same piece bone name
- Game logic selects which to display

## Resources

### hytale://attachments
Lists all attachment collections with:
- UUID and name
- Associated texture
- Element count

### hytale://pieces
Lists all attachment piece bones with:
- UUID and name
- Origin position
- Rotation

## Tips

### Pivot Points
Set piece bone origins carefully:
- Origin = attachment point
- Rotation = attachment orientation
- Match base model's bone origin for perfect fit

### Animation Inheritance
Attached pieces inherit animation from base:
- No separate animation needed
- Follows parent bone transforms
- Visibility can be animated

### Texture Organization
Keep attachment textures separate:
- One texture per attachment collection
- Allows mixing and matching
- Efficient for palette swaps

### Performance
- Attachments are lightweight
- Only active attachment is rendered
- Use for equipment variations instead of model variants

## Common Patterns

### Armor System
\`\`\`
Base Model: character.blockymodel
 body
    [geometry]
 arm_left (can have attachments)
 arm_right (can have attachments)
 head (can have attachments)

Attachments:
 helmet.blockymodel
    head (is_piece: true)
 chestplate.blockymodel
    body (is_piece: true)
 gauntlet_left.blockymodel
     arm_left (is_piece: true)
\`\`\`

### Weapon Slots
\`\`\`
character.blockymodel
 hand_right

Weapon Attachments:
 sword.blockymodel  hand_right
 axe.blockymodel  hand_right
 pickaxe.blockymodel  hand_right
\`\`\`

### Accessory Layers
\`\`\`
Base: character.blockymodel
 head
 back

Accessories:
 hat.blockymodel  head
 glasses.blockymodel  head
 cape.blockymodel  back
\`\`\`
`}}]}}},"experimental"),console.log("[MCP] Hytale prompts registered successfully")}var Aj=[vK,CK,kK,TK,_K,lK,xK,yK,gK,hK,fK,uK],Oj=[pK,dK,iK];for(let Q of Aj)Q();for(let Q of Oj)Q();h1("projects",{uriTemplate:"projects://{id}",title:"Blockbench Projects",description:"Returns information about available projects in Blockbench. Use without an ID to list all projects, or provide a project UUID/name to get details about a specific project.",async listCallback(){let Q=ModelProject.all;if(!Q||Q.length===0)return{resources:[]};return{resources:Q.map((W)=>({uri:`projects://${W.uuid}`,name:W.name||W.uuid,description:`${W.format?.name??"Unknown format"} project${W.saved?"":" (unsaved)"}`,mimeType:"application/json"}))}},async readCallback(Q,{id:W}){let $=ModelProject.all;if(!$||$.length===0)return{contents:[{uri:Q.href,text:JSON.stringify({projects:[],count:0}),mimeType:"application/json"}]};let Y=(J)=>({uuid:J.uuid,name:J.name,selected:J.selected,saved:J.saved,format:J.format?.id??null,formatName:J.format?.name??null,boxUv:J.box_uv,textureWidth:J.texture_width,textureHeight:J.texture_height,savePath:J.save_path||null,exportPath:J.export_path||null,elementCount:J.elements?.length??0,groupCount:J.groups?.length??0,textureCount:J.textures?.length??0,animationCount:J.animations?.length??0,modelIdentifier:J.model_identifier||null,geometryName:J.geometry_name||null});if(W){let J=$.find((X)=>X.uuid===W||X.name===W);if(!J)throw Error(`Project with ID "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify(Y(J)),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({projects:$.map(Y),count:$.length,activeProject:Project?Project.uuid:null}),mimeType:"application/json"}]}}});h1("nodes",{uriTemplate:"nodes://{id}",title:"Blockbench Nodes",description:"Returns the current nodes in the Blockbench editor.",async listCallback(){if(!Project?.nodes_3d)return{resources:[]};return{resources:Object.values(Project.nodes_3d).map((W)=>({uri:`nodes://${W.uuid}`,name:W.name||W.uuid,description:"3D node in current project",mimeType:"application/json"}))}},async readCallback(Q,{id:W}){if(!Project?.nodes_3d)throw Error("No nodes found in the Blockbench editor.");let $=Project.nodes_3d[W]??Object.values(Project.nodes_3d).find((H)=>H.name===W||H.uuid===W);if(!$)throw Error(`Node with ID "${W}" not found.`);let{position:Y,rotation:J,scale:X,...G}=$;return{contents:[{uri:Q.href,text:JSON.stringify({...G,position:Y.toArray(),rotation:J.toArray(),scale:X.toArray()}),mimeType:"application/json"}]}}});h1("textures",{uriTemplate:"textures://{id}",title:"Blockbench Textures",description:"Returns information about textures in the current Blockbench project. Use without an ID to list all textures, or provide a texture UUID/name to get details about a specific texture.",async listCallback(){let Q=Project?.textures??[];if(Q.length===0)return{resources:[]};return{resources:Q.map((W)=>({uri:`textures://${W.uuid}`,name:W.name||W.uuid,mimeType:"application/json",description:W.path?`Texture from ${W.path}`:"Embedded texture"}))}},async readCallback(Q,{id:W}){let $=Project?.textures??[];if($.length===0)return{contents:[{uri:Q.href,text:JSON.stringify({textures:[],count:0}),mimeType:"application/json"}]};let Y=(J)=>({uuid:J.uuid,name:J.name,id:J.id,width:J.width,height:J.height,frameCount:J.frameCount,ratio:J.ratio,path:J.path||null,folder:J.folder||null,namespace:J.namespace||null,particle:J.particle??!1,render_mode:J.render_mode||"default",render_sides:J.render_sides||"auto",visible:J.visible??!0,saved:J.saved??!1,selected:J.selected??!1,source:J.source||null});if(W){let J=$.find((X)=>X.uuid===W||X.name===W||X.id===W);if(!J)throw Error(`Texture with ID "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify(Y(J)),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({textures:$.map(Y),count:$.length}),mimeType:"application/json"}]}}});if(Plugins.installed.some((Q)=>Q.id==="reference_models"))h1("reference_models",{uriTemplate:"reference_models://{id}",title:"Reference Models",description:"Returns information about reference models in the current Blockbench project. Requires the Reference Models plugin. Use without an ID to list all reference models, or provide a UUID/name to get details about a specific reference model.",async listCallback(){let W=(Outliner?.elements??[]).filter(($)=>$.type==="reference_model");if(W.length===0)return{resources:[]};return{resources:W.map(($)=>({uri:`reference_models://${$.uuid}`,name:$.name||$.uuid,description:$.path?`Reference model from ${$.path}`:"Reference model",mimeType:"application/json"}))}},async readCallback(Q,{id:W}){let Y=(Outliner?.elements??[]).filter((G)=>G.type==="reference_model");if(Y.length===0)return{contents:[{uri:Q.href,text:JSON.stringify({referenceModels:[],count:0}),mimeType:"application/json"}]};let J=(G,H)=>{if(!G)return H;if(Array.isArray(G)&&G.length>=3)return[Number(G[0]),Number(G[1]),Number(G[2])];if(typeof G==="object"&&"x"in G&&"y"in G&&"z"in G){let B=G;return[Number(B.x),Number(B.y),Number(B.z)]}return H},X=(G)=>{let H=G;return{uuid:H.uuid,name:H.name,path:H.path||null,origin:J(H.origin,[0,0,0]),rotation:J(H.rotation,[0,0,0]),scale:J(H.scale,[1,1,1]),visibility:H.visibility??!0}};if(W){let G=Y.find((H)=>H.uuid===W||H.name===W);if(!G)throw Error(`Reference model with ID "${W}" not found.`);return{contents:[{uri:Q.href,text:JSON.stringify(X(G)),mimeType:"application/json"}]}}return{contents:[{uri:Q.href,text:JSON.stringify({referenceModels:Y.map(X),count:Y.length}),mimeType:"application/json"}]}}});z6("blockbench_native_apis",{description:"Essential information about Blockbench v5.0 native API security model and requireNativeModule() usage. Use this when working with Node.js modules, file system access, or native APIs in Blockbench plugins.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Blockbench v5.0 Native API Security Model

**CRITICAL: Read this carefully before using any Node.js APIs or native modules in Blockbench plugins.**

## Overview

Blockbench v5.0 introduces a new security model that significantly changes how plugins access native Node.js APIs. These changes give users more control and trust over plugin capabilities.

## Key Changes from Previous Versions

### 1. Global Module Variables Removed

- **OLD (pre-v5.0)**: All Node.js APIs were globally available (e.g., \`fs\`, \`os\`, \`child_process\`)
- **NEW (v5.0+)**: Most global variables have been removed
- **EXCEPTION**: \`PathModule\` is still globally available for Node's \`path\` module

### 2. Module Access via \`requireNativeModule()\`

Use the new \`requireNativeModule()\` function instead of \`require()\` for better TypeScript support:

\`\`\`javascript
// TypeScript-friendly with proper type support
const os = requireNativeModule('os');

// Add custom permission message
const child_process = requireNativeModule('child_process', {
    message: 'This permission is required to open ffmpeg and encode the video.'
});
\`\`\`

**IMPORTANT**: \`requireNativeModule()\` will:
- Open a user permission prompt for restricted modules
- Return the module **synchronously** if the user accepts
- Return \`undefined\` if the user denies
- Always check if the module is defined before use!

### 3. Module Categories

#### Safe Modules (No Permission Required)
These can be required without user confirmation:
- \`path\`
- \`crypto\`
- \`events\`
- \`zlib\`
- \`timers\`
- \`url\`
- \`string_decoder\`
- \`querystring\`

#### Restricted Modules (Require User Permission)
These prompt the user for permission:
- \`fs\` (File System - see scoped access below)
- \`child_process\`
- \`electron\`
- \`https\`
- \`net\`
- \`tls\`
- \`util\`
- \`os\`
- \`v8\`

### 4. Scoped File System Access

The \`fs\` module is now limited. For even more restrictive access, use **scoped file systems**:

\`\`\`javascript
// Request scoped fs access to specific directory
const scoped_fs = requireNativeModule('fs', {
    scope: 'C:/path/to/directory'
});

if (scoped_fs) {
    //  Will succeed - inside scope
    scoped_fs.writeFileSync('C:/path/to/directory/file.json', 'hello world');
    
    //  Will throw error - outside scope
    scoped_fs.writeFileSync('C:/foo/bar.json', 'hello world');
}
\`\`\`

**Benefits**:
- Gives users more control over file access
- Builds trust by limiting plugin scope
- Prevents accidental or malicious file system access

### 5. Limited File System Capabilities

Even with permission, the \`fs\` module has reduced capabilities:
-  Reading and writing files is allowed
-  Advanced operations like modifying file permissions are NOT available

### 6. SystemInfo Interface

For basic system information, use the new \`SystemInfo\` global instead of requiring \`os\` or \`process\`:

\`\`\`javascript
// Available properties:
SystemInfo.platform          // 'win32' | 'darwin' | 'linux'
SystemInfo.home_directory    // 'path/to/home'
SystemInfo.arch             // 'x64' | 'arm64'
SystemInfo.appdata_directory // 'C:\\\\Users\\\\Name\\\\AppData\\\\Roaming'
SystemInfo.os_version       // 'Windows 11 Home', etc.
\`\`\`

## Best Practices for Plugin Development

### 1. Request Permissions On-Demand

**DON'T** request modules during plugin load:
\`\`\`javascript
//  BAD - Bombards user with prompts on install
BBPlugin.register('my_plugin', {
    onload() {
        const fs = requireNativeModule('fs');
        const os = requireNativeModule('os');
        const child_process = requireNativeModule('child_process');
    }
});
\`\`\`

**DO** request when actually needed:
\`\`\`javascript
//  GOOD - User knows why permission is needed
BBPlugin.register('my_plugin', {
    onload() {
        // Setup without requiring modules
    }
});

function exportModel() {
    const fs = requireNativeModule('fs', {
        message: 'File system access needed to save your model.'
    });
    
    if (!fs) {
        Blockbench.showQuickMessage('Export cancelled - file system access denied', 2000);
        return;
    }
    
    // Proceed with export...
}
\`\`\`

### 2. Always Check for undefined

\`\`\`javascript
const os = requireNativeModule('os');

//  ALWAYS check before use
if (!os) {
    console.warn('OS module access denied');
    return;
}

// Now safe to use
const platform = os.platform();
\`\`\`

### 3. Use Scoped Access When Possible

If you only need access to specific directories, use scoped file systems:

\`\`\`javascript
// Instead of full fs access
const project_dir = 'C:/Users/Name/Projects/MyProject';
const scoped_fs = requireNativeModule('fs', {
    scope: project_dir,
    message: 'Access needed to read/write project files in ' + project_dir
});

if (scoped_fs) {
    // Limited to project_dir only - safer!
    scoped_fs.writeFileSync(PathModule.join(project_dir, 'output.json'), data);
}
\`\`\`

### 4. Provide Clear Permission Messages

\`\`\`javascript
const child_process = requireNativeModule('child_process', {
    message: 'This plugin needs to run FFmpeg to encode your animation as a video file.'
});
\`\`\`

### 5. Use SystemInfo for Basic Info

\`\`\`javascript
//  No permission needed
if (SystemInfo.platform === 'win32') {
    // Windows-specific code
}

//  Requires permission unnecessarily
const os = requireNativeModule('os');
if (os?.platform() === 'win32') {
    // Windows-specific code
}
\`\`\`

## Example: Safe Plugin Structure

\`\`\`javascript
BBPlugin.register('safe_exporter', {
    title: 'Safe Model Exporter',
    onload() {
        // Minimal setup - no permissions yet
        new Action('export_custom', {
            name: 'Export Custom Format',
            icon: 'save',
            click: () => this.exportModel()
        });
    },
    
    exportModel() {
        // Request permission only when needed
        const fs = requireNativeModule('fs', {
            message: 'Save your model to disk'
        });
        
        if (!fs) {
            Blockbench.showMessageBox({
                title: 'Permission Required',
                message: 'File system access is required to save the model.'
            });
            return;
        }
        
        // Proceed with export
        try {
            const data = this.generateModelData();
            fs.writeFileSync(this.getExportPath(), data);
            Blockbench.showQuickMessage('Export successful!', 2000);
        } catch (error) {
            console.error('Export failed:', error);
            Blockbench.showQuickMessage('Export failed', 2000);
        }
    }
});
\`\`\`

## Migration from Pre-v5.0 Plugins

| Old (Pre-v5.0) | New (v5.0+) |
|----------------|-------------|
| \`fs.readFileSync()\` | \`const fs = requireNativeModule('fs'); if (fs) fs.readFileSync()\` |
| \`os.platform()\` | \`SystemInfo.platform\` |
| \`process.cwd()\` | Use Blockbench APIs or SystemInfo |
| \`require('path')\` | \`PathModule\` (still global) |
| Module at load time | Module on-demand with permission check |

## Summary Checklist

When using native APIs in Blockbench v5.0 plugins:

- [ ] Use \`requireNativeModule()\` instead of \`require()\`
- [ ] Always check if module is defined before use
- [ ] Request permissions on-demand, not during plugin load
- [ ] Provide clear permission messages
- [ ] Use \`SystemInfo\` for basic system info instead of \`os\`
- [ ] Consider scoped file system access for better security
- [ ] Use \`PathModule\` for path operations (no permission needed)
- [ ] Test with user denying permissions to ensure graceful failures

---

**Remember**: These changes improve user trust and security. Embrace them to build better, safer plugins!
`}}]}}});z6("blockbench_code_eval_safety",{description:"Critical safety guide for agents using code evaluation/execution tools with Blockbench v5.0+. Contains breaking changes, quick reference, common mistakes, and safe code patterns for native module usage. MUST READ before generating or executing Blockbench plugin code.",argsSchema:V.object({}),async generate(){return{messages:[{role:"user",content:{type:"text",text:await`# Blockbench Code Evaluation Safety Guide

**FOR AGENTS USING CODE EVALUATION TOOLS (e.g., \`risky_eval\`, code execution, REPL tools)**

## Critical Security Changes in Blockbench v5.0+

###  BREAKING: Global Node.js APIs Removed

\`\`\`javascript
//  THESE NO LONGER WORK IN v5.0+
fs.readFileSync()         // undefined
os.platform()             // undefined  
child_process.spawn()     // undefined

//  USE THESE INSTEAD
const fs = requireNativeModule('fs');
SystemInfo.platform
PathModule.join()         // Still global
\`\`\`

## Quick Reference for Code Generation

### File System Operations
\`\`\`javascript
// Always wrap in permission check
const fs = requireNativeModule('fs', {
    message: 'Describe why you need file system access'
});

if (!fs) {
    // User denied - handle gracefully
    return { error: 'File system access denied' };
}

// Now safe to use
fs.writeFileSync(path, data);
\`\`\`

### System Information
\`\`\`javascript
// No permission needed - USE THIS
const platform = SystemInfo.platform;        // 'win32' | 'darwin' | 'linux'
const home = SystemInfo.home_directory;
const arch = SystemInfo.arch;                // 'x64' | 'arm64'
const appdata = SystemInfo.appdata_directory;
const version = SystemInfo.os_version;
\`\`\`

### Path Operations
\`\`\`javascript
// No permission needed - USE THIS
const joined = PathModule.join('path', 'to', 'file');
const dirname = PathModule.dirname(path);
const basename = PathModule.basename(path);
\`\`\`

### Child Process (Requires Permission)
\`\`\`javascript
const child_process = requireNativeModule('child_process', {
    message: 'Execute external commands (e.g., FFmpeg for video encoding)'
});

if (!child_process) {
    return { error: 'Process execution denied' };
}

child_process.spawn('command', ['args']);
\`\`\`

## Module Permission Matrix

| Module | Permission | Alternative |
|--------|-----------|-------------|
| \`path\` |  None | Use \`PathModule\` |
| \`crypto\` |  None | Direct require |
| \`fs\` |  User prompt | \`requireNativeModule('fs')\` |
| \`os\` |  User prompt | Use \`SystemInfo\` instead |
| \`child_process\` |  User prompt | \`requireNativeModule('child_process')\` |
| \`http/https\` |  User prompt | \`requireNativeModule('https')\` |

## Code Generation Template

When generating Blockbench plugin code, use this pattern:

\`\`\`javascript
//  SAFE PATTERN FOR v5.0+
function myFeature() {
    // 1. Check if we need native modules
    const needsFileSystem = true; // or false
    
    if (needsFileSystem) {
        // 2. Request permission with clear message
        const fs = requireNativeModule('fs', {
            message: 'Save configuration to disk'
        });
        
        // 3. Handle denial gracefully
        if (!fs) {
            Blockbench.showQuickMessage('Feature requires file system access', 2000);
            return false;
        }
        
        // 4. Use the module
        try {
            fs.writeFileSync(path, data);
            return true;
        } catch (error) {
            console.error('Failed:', error);
            return false;
        }
    }
    
    // 5. Use SystemInfo for basic system checks
    if (SystemInfo.platform === 'win32') {
        // Windows-specific code
    }
}
\`\`\`

## Common Mistakes to Avoid

###  Don't Do This
\`\`\`javascript
// Requesting at plugin load
BBPlugin.register('my_plugin', {
    onload() {
        const fs = requireNativeModule('fs');
        const os = requireNativeModule('os');
        const cp = requireNativeModule('child_process');
        // Bombards user with 3 permission prompts!
    }
});

// Using without checking
const fs = requireNativeModule('fs');
fs.readFileSync(path); // Crashes if user denied!

// Using old globals
if (process.platform === 'win32') { // undefined in v5.0!
\`\`\`

###  Do This
\`\`\`javascript
// Request on-demand
BBPlugin.register('my_plugin', {
    onload() {
        // Just setup, no permissions yet
        new Action('my_action', {
            click: () => this.doWork()
        });
    },
    
    doWork() {
        // Request only when needed
        const fs = requireNativeModule('fs', {
            message: 'Save your work'
        });
        
        if (!fs) {
            return; // Handle gracefully
        }
        
        // Use safely
        fs.writeFileSync(path, data);
    }
});

// Use SystemInfo instead of process/os
if (SystemInfo.platform === 'win32') {
    // Windows-specific
}
\`\`\`

## Scoped File System (Enhanced Security)

For directory-specific access:

\`\`\`javascript
const project_fs = requireNativeModule('fs', {
    scope: '/path/to/project',
    message: 'Access project files in /path/to/project'
});

if (project_fs) {
    //  Works - inside scope
    project_fs.writeFileSync('/path/to/project/file.json', data);
    
    //  Throws - outside scope  
    project_fs.writeFileSync('/etc/passwd', data);
}
\`\`\`

## Evaluation Safety Checklist

Before running ANY generated code in Blockbench v5.0+:

- [ ] Uses \`requireNativeModule()\` instead of \`require()\` for native modules
- [ ] Checks if module is defined before use (\`if (!module) return\`)
- [ ] Uses \`SystemInfo\` for platform/arch/home instead of \`os\`/\`process\`
- [ ] Uses \`PathModule\` for path operations
- [ ] Requests permissions on-demand, not at plugin load
- [ ] Includes clear permission messages
- [ ] Handles user denial gracefully
- [ ] Avoids direct use of \`fs\`, \`os\`, \`child_process\` globals

## Migration Quick-Fixes

| Old Code | New Code |
|----------|----------|
| \`fs.readFileSync()\` | \`const fs = requireNativeModule('fs'); if (fs) fs.readFileSync()\` |
| \`os.platform()\` | \`SystemInfo.platform\` |
| \`os.homedir()\` | \`SystemInfo.home_directory\` |
| \`process.platform\` | \`SystemInfo.platform\` |
| \`require('path')\` | \`PathModule\` |
| At plugin load | On-demand in action handlers |

---

**Remember**: Code that works in Blockbench 4.x WILL BREAK in 5.0+ if it uses native modules. Always use the new patterns above.
`}}]}}});z6("model_creation_strategy",{description:"A strategy for creating a new 3D model in Blockbench.",argsSchema:V.object({format:V.enum(["java_block","bedrock"]).optional(),approach:V.enum(["ui","programmatic","import"]).optional()}),async generate({format:Q,approach:W}){let $=[];if(Q==="java_block")$.push(await`Create a new block model for Minecraft: Java Edition.
- Rotations are limited to 22.5 degree steps and one axis per element
- The model is limited to a size of 3 by 3 by 3 blocks. Display settings can make item models larger though
`);if(Q==="bedrock")$.push(await`Create a new block model for Minecraft: Bedrock Edition.
- Size total size of a block is limited to 30 pixels in all dimensions. The limit can be off-centered in all directions by 7 pixels from the block center.
`);if(W==="ui")$.push(await"### Prefer tools, actions, and UI interactivity to assemble models\nWhen creating Blockbench models, use the following MCP tools (if available). They are listed in order of preference.\n\n1. `list_outline` - Check to see what the current project structure is like. This returns the 3D model outline information for the current project.\n2. `create_project` - If no project is open, or if the prompt calls for a new project, create a new project in Blockbench prior to attempting to use other tools.\n3. `add_group` - Organize meshes into bones\n4. `place_cube` - Creates new cube meshes in the project, with optional texture assignment.\n5. `modify_cube` - Edits existing cubes in the current project.\n6. `remove_element` - Removes a mesh from the active project.\n7. `trigger_action` - Dispatches default event for the given Blockbench Action name. Some actions will require follow-up with `fill_dialog` \n8. `fill_dialog` - Attempts to populate and submit form values in the currently open or visible Dialog window\n9. `emulate_clicks` - Attempts to dispatch click events at the given position in the app window.");if(W==="programmatic")$.push(await`### Lean on your programming expertise when creating Blockbench models

- Utilize the \`risky_eval\` MCP tool to call Blockbench, Node.js, Electron, and JavaScript functions and run scripts.
- The MCP server has access to all variables and functions in the global scope.
- Blockbench exposes much of its API functionality on the \`Blockbench\` global variable namespace.
- Functions and classes can be converted to strings and logged to the console to inspect their source to determine how to properly use them.
- The API reference on the [Blockbench Wiki](https://www.blockbench.net/wiki) is incomplete.
- Never use these tools or APIs to make system changes.`);if(W==="import")$.push(await"# Generate valid .geo.json directly\n- Use tool `from_geo_json` to import .geo.json string(s) directly into Blockbench.");return{messages:[{role:"user",content:{type:"text",text:$.join(`
`)}}]}}});class nK{sessions=new Map;listeners=new Set;removalCallback=null;add(Q){if(this.sessions.has(Q)){this.updateActivity(Q);return}let W={id:Q,connectedAt:new Date,lastActivity:new Date};this.resetTimeout(W),this.sessions.set(Q,W),this.notifyListeners(),console.log(`[MCP] Session connected: ${Q.slice(0,8)}...`)}remove(Q){let W=this.sessions.get(Q);if(!W)return;if(W.timeoutHandle)clearTimeout(W.timeoutHandle);if(this.sessions.delete(Q),this.notifyListeners(),console.log(`[MCP] Session disconnected: ${Q.slice(0,8)}...`),this.removalCallback)try{this.removalCallback(Q)}catch($){console.error("[MCP] Session removal callback error:",$)}}updateActivity(Q){let W=this.sessions.get(Q);if(W)W.lastActivity=new Date,this.resetTimeout(W)}updateClientInfo(Q,W,$){let Y=this.sessions.get(Q);if(Y){Y.clientName=W,Y.clientVersion=$,this.notifyListeners();let J=W||Q.slice(0,8)+"...";console.log(`[MCP] Session identified: ${J}${$?` v${$}`:""}`)}}resetTimeout(Q){if(Q.timeoutHandle)clearTimeout(Q.timeoutHandle);Q.timeoutHandle=setTimeout(()=>{console.log(`[MCP] Session timed out: ${Q.id.slice(0,8)}...`),this.remove(Q.id)},300000)}getAll(){return[...this.sessions.values()]}getCount(){return this.sessions.size}has(Q){return this.sessions.has(Q)}subscribe(Q){return this.listeners.add(Q),Q(this.getAll()),()=>this.listeners.delete(Q)}setRemovalCallback(Q){this.removalCallback=Q}notifyListeners(){let Q=this.getAll();this.listeners.forEach((W)=>{try{W(Q)}catch($){console.error("[MCP] Session listener error:",$)}})}clear(){for(let Q of this.sessions.values())if(Q.timeoutHandle)clearTimeout(Q.timeoutHandle);this.sessions.clear(),this.listeners.clear()}}var q1=new nK;var oK="#mcp-status-bar{display:flex;align-items:center;gap:8px;padding:4px 12px;background-color:var(--color-dark);border-block-start:1px solid var(--color-border);font-size:0.85em;user-select:none}#mcp-status-bar .mcp-status-indicator{display:flex;align-items:center;gap:6px;cursor:pointer;padding:2px 8px;border-radius:4px;transition:background-color 0.2s}#mcp-status-bar .mcp-status-indicator:hover{background-color:var(--color-button)}#mcp-status-bar .mcp-status-dot{inline-size:8px;block-size:8px;border-radius:50%;background-color:var(--color-subtle_text);transition:background-color 0.3s}#mcp-status-bar .mcp-status-dot.connected{background-color:#4caf50;box-shadow:0 0 8px rgba(76,175,80,0.6);animation:pulse 2s ease-in-out infinite}#mcp-status-bar .mcp-status-dot.disconnected{background-color:#f44336}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}#mcp-status-bar .mcp-status-text{color:var(--color-text);font-weight:500}#mcp-status-bar .mcp-server-info{color:var(--color-subtle_text);font-size:0.9em;margin-inline-start:4px}";var t6,eW;function rK(Q){let W=Settings.get("mcp_port")||3000,$=Settings.get("mcp_endpoint")||"/bb-mcp";Blockbench.addCSS(oK),t6=document.createElement("div"),t6.id="mcp-status-bar";let Y=document.createElement("div");Y.className="mcp-status-indicator",Y.title=tl("mcp.tooltip.click_to_view_panel");let J=document.createElement("div");J.className="mcp-status-dot";let X=document.createElement("span");X.className="mcp-status-text",X.textContent=tl("mcp.status.server");let G=document.createElement("span");G.className="mcp-server-info",G.textContent=`(${W}${$})`,Y.appendChild(J),Y.appendChild(X),Y.appendChild(G),t6.appendChild(Y);let H=(K)=>{let F=K.length;if(F>0)J.classList.remove("disconnected"),J.classList.add("connected"),X.textContent=F===1?tl("mcp.status.server_one_client"):tl("mcp.status.server_clients",[F]);else J.classList.remove("connected"),J.classList.add("disconnected"),X.textContent=tl("mcp.status.server")};eW=q1.subscribe(H),Y.addEventListener("click",()=>{let K=Panels.mcp_panel;if(!K)return;if(K.folded){K.fold(!1);return}if(K.slot==="float")K.moveToFront()});let B=document.getElementById("status_bar");if(!B){console.warn("Could not find status_bar element");return}B.appendChild(t6)}function aK(){if(eW)eW(),eW=void 0;if(t6)t6.remove(),t6=void 0}function Q4(Q){let W=Q._def,$=W.typeName,Y=!1,J=!1,X=W.description,G=void 0,H,B,K,F;if($==="ZodOptional"||$==="ZodNullable"){Y=!0;let U=W.innerType;return{...Q4(U),isOptional:!0}}if($==="ZodDefault"){G=W.defaultValue?.();let U=W.innerType;return{...Q4(U),defaultValue:G,isOptional:!0}}if($==="ZodArray")J=!0,F=W.type;if($==="ZodEnum")H=W.values;if($==="ZodNumber")W.checks?.forEach((L)=>{if(L.kind==="min")B=L.value;if(L.kind==="max")K=L.value});let q="text";switch($){case"ZodString":q="text";break;case"ZodNumber":q="number";break;case"ZodBoolean":q="checkbox";break;case"ZodEnum":q="select";break;case"ZodArray":q="textarea";break;case"ZodObject":q="textarea";break;case"ZodUnion":q="textarea";break;default:q="text"}return{type:q,isOptional:Y,isArray:J,description:X,defaultValue:G,enumValues:H,min:B,max:K,innerType:F}}function Mj(Q){let W={};for(let[$,Y]of Object.entries(Q)){let J=Q4(Y),X=Y._def,G={label:`${$}${J.isOptional?"":" *"}`,description:J.description||`Parameter: ${$}`,type:J.type};if(J.defaultValue!==void 0)if(J.type==="textarea")G.value=JSON.stringify(J.defaultValue,null,2);else G.value=J.defaultValue;if(J.description)G.placeholder=J.description;if(J.enumValues){G.options={};for(let H of J.enumValues)G.options[H]=H}if(J.min!==void 0)G.min=J.min;if(J.max!==void 0)G.max=J.max;if(J.type==="textarea"){if(G.height=100,J.isArray)G.placeholder=tl("mcp.dialog.json_array_placeholder"),G.value=G.value??"[]";else if(X.typeName==="ZodObject")G.placeholder=tl("mcp.dialog.json_object_placeholder"),G.value=G.value??"{}"}W[$]=G}return W}function tK(Q,W){let $={};for(let[Y,J]of Object.entries(W)){let X=Q[Y],G=Q4(J);if(G.isOptional&&(X===""||X===void 0||X===null))continue;if(G.type==="textarea"&&typeof X==="string")try{$[Y]=JSON.parse(X)}catch{$[Y]=X}else if(G.type==="number"&&typeof X==="string")$[Y]=parseFloat(X);else $[Y]=X}return $}var p7=null;function sK(Q,W,$){let Y=typeof W==="string"?W:JSON.stringify(W,null,2);p7?.hide(),p7=new Dialog({id:"mcp_tool_result",title:tl("mcp.dialog.result_title",[Q]),width:600,lines:[`<pre style="
        background: var(--color-back);
        padding: 12px;
        border-radius: 4px;
        overflow: auto;
        max-height: 400px;
        white-space: pre-wrap;
        word-break: break-word;
        color: ${$?"var(--color-error)":"var(--color-text)"};
        font-family: var(--font-code);
        font-size: 12px;
      ">${jj(Y)}</pre>`],singleButton:!0,buttons:[tl("mcp.dialog.close")]}),p7.show()}function jj(Q){return Q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var d7=null;function eK(Q){let $=GK()[Q];if(!$){Blockbench.showQuickMessage(tl("mcp.dialog.tool_not_found",[Q]),2000);return}d7?.hide();let Y=Mj($.inputSchema),J=Object.keys(Y).length>0;d7=new Dialog({id:"mcp_tool_test",title:$.title||Q,width:500,form:J?Y:void 0,lines:J?void 0:[`<p style="color: var(--color-subtle_text); font-style: italic;">${tl("mcp.dialog.no_parameters")}</p>`],buttons:[tl("mcp.dialog.run_tool"),tl("mcp.dialog.copy_input"),tl("mcp.dialog.cancel")],confirmIndex:0,cancelIndex:2,onButton(X){if(X===1){let H=this.form?.result??{},B=J?tK(H,$.inputSchema):{},K=JSON.stringify({tool:Q,arguments:B},null,2);return navigator.clipboard.writeText(K).then(()=>{Blockbench.showQuickMessage(tl("mcp.dialog.input_copied"),1500)}).catch(()=>{Blockbench.showQuickMessage(tl("mcp.dialog.copy_failed"),1500)}),!1}},async onConfirm(X){let G=J?tK(X,$.inputSchema):{};Blockbench.showQuickMessage(tl("mcp.dialog.running_tool"),1000);try{let H=await $.execute(G),B;if(typeof H==="string")B=H;else if(H&&typeof H==="object"&&"content"in H)B=H.content.map((F)=>{if(F.type==="text")return F.text;if(F.type==="image")return`[Image: ${F.data?.slice(0,50)}...]`;return JSON.stringify(F)}).join(`
`);else B=H;sK(Q,B,!1)}catch(H){let B=H instanceof Error?H.message:String(H);sK(Q,`Error: ${B}`,!0)}}}),d7.show()}function o7(Q){let W=Q._def,$=W.typeName,Y=!1,J=W.description,X=void 0,G;if($==="ZodOptional"||$==="ZodNullable"){Y=!0;let B=W.innerType;return{...o7(B),isOptional:!0}}if($==="ZodDefault"){X=W.defaultValue?.();let B=W.innerType;return{...o7(B),defaultValue:X,isOptional:!0}}if($==="ZodEnum")G=W.values;let H="text";switch($){case"ZodString":H="text";break;case"ZodNumber":H="number";break;case"ZodBoolean":H="checkbox";break;case"ZodEnum":H="select";break;default:H="text"}return{type:H,isOptional:Y,description:J,defaultValue:X,enumValues:G}}function zj(Q){let W={};for(let[$,Y]of Object.entries(Q)){let J=o7(Y),X={label:`${$}${J.isOptional?"":" *"}`,description:J.description||`Argument: ${$}`,type:J.type};if(J.defaultValue!==void 0)X.value=J.defaultValue;if(J.description)X.placeholder=J.description;if(J.enumValues){X.options={"":"(none)"};for(let G of J.enumValues)X.options[G]=G}W[$]=X}return W}function WF(Q){return Q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var i7=null;function QF(Q,W,$=!1){i7?.hide(),i7=new Dialog({id:"mcp_prompt_content",title:tl("mcp.dialog.prompt_title",[Q]),width:700,lines:[`<pre style="
        background: var(--color-back);
        padding: 12px;
        border-radius: 4px;
        overflow: auto;
        max-height: 500px;
        white-space: pre-wrap;
        word-break: break-word;
        color: ${$?"var(--color-error)":"var(--color-text)"};
        font-family: var(--font-code);
        font-size: 12px;
        line-height: 1.5;
      ">${WF(W)}</pre>`],buttons:[tl("mcp.dialog.copy"),tl("mcp.dialog.close")],onButton(Y){if(Y===0)return navigator.clipboard.writeText(W).then(()=>{Blockbench.showQuickMessage(tl("mcp.dialog.prompt_copied"),1500)}).catch(()=>{Blockbench.showQuickMessage(tl("mcp.dialog.copy_failed"),1500)}),!1}}),i7.show()}var n7=null;function $F(Q){let $=FK()[Q];if(!$){Blockbench.showQuickMessage(tl("mcp.dialog.prompt_not_found",[Q]),2000);return}n7?.hide();let Y=$.argsSchema&&Object.keys($.argsSchema).length>0,J=Y?zj($.argsSchema):{};n7=new Dialog({id:"mcp_prompt_preview",title:$.title||Q,width:500,form:Y?J:void 0,lines:[`<p style="margin-bottom: 12px; color: var(--color-subtle_text);">${WF($.description)}</p>`,...Y?[]:[`<p style="color: var(--color-subtle_text); font-style: italic;">${tl("mcp.dialog.no_arguments")}</p>`]],buttons:[tl("mcp.dialog.generate_prompt"),tl("mcp.dialog.cancel")],confirmIndex:0,cancelIndex:1,async onConfirm(X){let G={};for(let[H,B]of Object.entries(X))if(B!==""&&B!==void 0&&B!==null)G[H]=B;Blockbench.showQuickMessage(tl("mcp.dialog.generating_prompt"),1000);try{let B=(await $.generate(G)).messages.map((K)=>{let F=K.role==="user"?tl("mcp.dialog.role_user"):tl("mcp.dialog.role_assistant"),q=typeof K.content==="string"?K.content:K.content.text;return`[${F}]
${q}`}).join(`

---

`);QF(Q,B)}catch(H){let B=H instanceof Error?H.message:String(H);QF(Q,`Error: ${B}`,!0)}}}),n7.show()}var YF={"mcp.panel.sessions":"Sessions","mcp.panel.server":"Server","mcp.panel.tools":"Tools","mcp.panel.resources":"Resources","mcp.panel.prompts":"Prompts","mcp.sessions.no_clients":"No clients connected","mcp.server.name":"Server Name","mcp.server.version":"Server Version","mcp.server.connected_clients":"Connected Clients","mcp.filter.tools_placeholder":"Filter tools...","mcp.filter.resources_placeholder":"Filter resources...","mcp.filter.prompts_placeholder":"Filter prompts...","mcp.filter.show_experimental":"Show Experimental","mcp.tools.no_match":"No tools match your filter.","mcp.tools.none_available":"No tools available.","mcp.resources.no_match":"No resources match your filter.","mcp.resources.none_available":"No resources available.","mcp.prompts.no_match":"No prompts match your filter.","mcp.prompts.none_available":"No prompts available.","mcp.prompts.argument_count":"%0 argument","mcp.prompts.argument_count_plural":"%0 arguments","mcp.tooltip.click_to_test":"Click to test %0","mcp.tooltip.click_to_preview":"Click to preview %0","mcp.tooltip.click_to_view_panel":"Click to view MCP panel","mcp.status.experimental_tooltip":"This tool is experimental","mcp.status.server":"MCP Server","mcp.status.server_one_client":"MCP Server (1 client)","mcp.status.server_clients":"MCP Server (%0 clients)","mcp.settings.instructions_name":"MCP System Instructions","mcp.settings.instructions_desc":"Instructions for the MCP system.","mcp.settings.port_name":"MCP Server Port","mcp.settings.port_desc":"Port for the MCP server.","mcp.settings.endpoint_name":"MCP Server Endpoint","mcp.settings.endpoint_desc":"Endpoint for the MCP server.","mcp.dialog.result_title":"Result: %0","mcp.dialog.no_parameters":"This tool has no parameters.","mcp.dialog.run_tool":"Run Tool","mcp.dialog.copy_input":"Copy Input","mcp.dialog.cancel":"Cancel","mcp.dialog.close":"Close","mcp.dialog.json_array_placeholder":"Enter JSON array, e.g. [1, 2, 3]","mcp.dialog.json_object_placeholder":"Enter JSON object","mcp.dialog.input_copied":"Input copied to clipboard","mcp.dialog.copy_failed":"Failed to copy to clipboard","mcp.dialog.running_tool":"Running tool...","mcp.dialog.tool_not_found":'Tool "%0" not found',"mcp.dialog.prompt_title":"Prompt: %0","mcp.dialog.copy":"Copy","mcp.dialog.prompt_copied":"Prompt copied to clipboard","mcp.dialog.no_arguments":"This prompt has no arguments.","mcp.dialog.generate_prompt":"Generate Prompt","mcp.dialog.generating_prompt":"Generating prompt...","mcp.dialog.prompt_not_found":'Prompt "%0" not found',"mcp.dialog.role_user":"User","mcp.dialog.role_assistant":"Assistant"},Pj={"mcp.panel.sessions":"Sitzungen","mcp.panel.server":"Server","mcp.panel.tools":"Werkzeuge","mcp.panel.resources":"Ressourcen","mcp.panel.prompts":"Prompts","mcp.sessions.no_clients":"Keine Clients verbunden","mcp.server.name":"Servername","mcp.server.version":"Serverversion","mcp.server.connected_clients":"Verbundene Clients","mcp.filter.tools_placeholder":"Werkzeuge filtern...","mcp.filter.resources_placeholder":"Ressourcen filtern...","mcp.filter.prompts_placeholder":"Prompts filtern...","mcp.filter.show_experimental":"Experimentelle anzeigen","mcp.tools.no_match":"Keine Werkzeuge entsprechen Ihrem Filter.","mcp.tools.none_available":"Keine Werkzeuge verfgbar.","mcp.resources.no_match":"Keine Ressourcen entsprechen Ihrem Filter.","mcp.resources.none_available":"Keine Ressourcen verfgbar.","mcp.prompts.no_match":"Keine Prompts entsprechen Ihrem Filter.","mcp.prompts.none_available":"Keine Prompts verfgbar.","mcp.prompts.argument_count":"%0 Argument","mcp.prompts.argument_count_plural":"%0 Argumente","mcp.tooltip.click_to_test":"Klicken zum Testen von %0","mcp.tooltip.click_to_preview":"Klicken zur Vorschau von %0","mcp.tooltip.click_to_view_panel":"Klicken zum Anzeigen des MCP-Panels","mcp.status.experimental_tooltip":"Dieses Werkzeug ist experimentell","mcp.status.server":"MCP Server","mcp.status.server_one_client":"MCP Server (1 Client)","mcp.status.server_clients":"MCP Server (%0 Clients)","mcp.settings.instructions_name":"MCP Systemanweisungen","mcp.settings.instructions_desc":"Anweisungen fr das MCP-System.","mcp.settings.port_name":"MCP Server Port","mcp.settings.port_desc":"Port fr den MCP-Server.","mcp.settings.endpoint_name":"MCP Server Endpunkt","mcp.settings.endpoint_desc":"Endpunkt fr den MCP-Server.","mcp.dialog.result_title":"Ergebnis: %0","mcp.dialog.no_parameters":"Dieses Werkzeug hat keine Parameter.","mcp.dialog.run_tool":"Werkzeug ausfhren","mcp.dialog.copy_input":"Eingabe kopieren","mcp.dialog.cancel":"Abbrechen","mcp.dialog.close":"Schlieen","mcp.dialog.json_array_placeholder":"JSON-Array eingeben, z.B. [1, 2, 3]","mcp.dialog.json_object_placeholder":"JSON-Objekt eingeben","mcp.dialog.input_copied":"Eingabe in Zwischenablage kopiert","mcp.dialog.copy_failed":"Kopieren in Zwischenablage fehlgeschlagen","mcp.dialog.running_tool":"Werkzeug wird ausgefhrt...","mcp.dialog.tool_not_found":'Werkzeug "%0" nicht gefunden',"mcp.dialog.prompt_title":"Prompt: %0","mcp.dialog.copy":"Kopieren","mcp.dialog.prompt_copied":"Prompt in Zwischenablage kopiert","mcp.dialog.no_arguments":"Dieser Prompt hat keine Argumente.","mcp.dialog.generate_prompt":"Prompt generieren","mcp.dialog.generating_prompt":"Prompt wird generiert...","mcp.dialog.prompt_not_found":'Prompt "%0" nicht gefunden',"mcp.dialog.role_user":"Benutzer","mcp.dialog.role_assistant":"Assistent"},Ej={"mcp.panel.sessions":"","mcp.panel.server":"","mcp.panel.tools":"","mcp.panel.resources":"","mcp.panel.prompts":"","mcp.sessions.no_clients":"","mcp.server.name":"","mcp.server.version":"","mcp.server.connected_clients":"","mcp.filter.tools_placeholder":"...","mcp.filter.resources_placeholder":"...","mcp.filter.prompts_placeholder":"...","mcp.filter.show_experimental":"","mcp.tools.no_match":"","mcp.tools.none_available":"","mcp.resources.no_match":"","mcp.resources.none_available":"","mcp.prompts.no_match":"","mcp.prompts.none_available":"","mcp.prompts.argument_count":"%0 ","mcp.prompts.argument_count_plural":"%0 ","mcp.tooltip.click_to_test":" %0 ","mcp.tooltip.click_to_preview":" %0 ","mcp.tooltip.click_to_view_panel":"MCP","mcp.status.experimental_tooltip":"","mcp.status.server":"MCP","mcp.status.server_one_client":"MCP (1)","mcp.status.server_clients":"MCP (%0)","mcp.settings.instructions_name":"MCP","mcp.settings.instructions_desc":"MCP","mcp.settings.port_name":"MCP","mcp.settings.port_desc":"MCP","mcp.settings.endpoint_name":"MCP","mcp.settings.endpoint_desc":"MCP","mcp.dialog.result_title":": %0","mcp.dialog.no_parameters":"","mcp.dialog.run_tool":"","mcp.dialog.copy_input":"","mcp.dialog.cancel":"","mcp.dialog.close":"","mcp.dialog.json_array_placeholder":"JSON (: [1, 2, 3])","mcp.dialog.json_object_placeholder":"JSON","mcp.dialog.input_copied":"","mcp.dialog.copy_failed":"","mcp.dialog.running_tool":"...","mcp.dialog.tool_not_found":' "%0" ',"mcp.dialog.prompt_title":": %0","mcp.dialog.copy":"","mcp.dialog.prompt_copied":"","mcp.dialog.no_arguments":"","mcp.dialog.generate_prompt":"","mcp.dialog.generating_prompt":"...","mcp.dialog.prompt_not_found":' "%0" ',"mcp.dialog.role_user":"","mcp.dialog.role_assistant":""},Rj={"mcp.panel.sessions":"","mcp.panel.server":"","mcp.panel.tools":"","mcp.panel.resources":"","mcp.panel.prompts":"","mcp.sessions.no_clients":"","mcp.server.name":"","mcp.server.version":"","mcp.server.connected_clients":"","mcp.filter.tools_placeholder":"...","mcp.filter.resources_placeholder":"...","mcp.filter.prompts_placeholder":"...","mcp.filter.show_experimental":"","mcp.tools.no_match":"","mcp.tools.none_available":"","mcp.resources.no_match":"","mcp.resources.none_available":"","mcp.prompts.no_match":"","mcp.prompts.none_available":"","mcp.prompts.argument_count":"%0 ","mcp.prompts.argument_count_plural":"%0 ","mcp.tooltip.click_to_test":" %0","mcp.tooltip.click_to_preview":" %0","mcp.tooltip.click_to_view_panel":"MCP","mcp.status.experimental_tooltip":"","mcp.status.server":"MCP","mcp.status.server_one_client":"MCP (1)","mcp.status.server_clients":"MCP (%0)","mcp.settings.instructions_name":"MCP","mcp.settings.instructions_desc":"MCP","mcp.settings.port_name":"MCP","mcp.settings.port_desc":"MCP","mcp.settings.endpoint_name":"MCP","mcp.settings.endpoint_desc":"MCP","mcp.dialog.result_title":": %0","mcp.dialog.no_parameters":"","mcp.dialog.run_tool":"","mcp.dialog.copy_input":"","mcp.dialog.cancel":"","mcp.dialog.close":"","mcp.dialog.json_array_placeholder":"JSON [1, 2, 3]","mcp.dialog.json_object_placeholder":"JSON","mcp.dialog.input_copied":"","mcp.dialog.copy_failed":"","mcp.dialog.running_tool":"...","mcp.dialog.tool_not_found":' "%0"',"mcp.dialog.prompt_title":": %0","mcp.dialog.copy":"","mcp.dialog.prompt_copied":"","mcp.dialog.no_arguments":"","mcp.dialog.generate_prompt":"","mcp.dialog.generating_prompt":"...","mcp.dialog.prompt_not_found":' "%0"',"mcp.dialog.role_user":"","mcp.dialog.role_assistant":""},Ij={en:YF,de:Pj,ja:Ej,zh:Rj};function JF(){Language.addTranslations("en",YF);for(let[Q,W]of Object.entries(Ij))if(Q!=="en")Language.addTranslations(Q,W)}function XF(Q){if(Q===1)return tl("mcp.prompts.argument_count",[Q]);return tl("mcp.prompts.argument_count_plural",[Q])}var GF='.mcp-panel{display:grid;grid-template-rows:auto 1fr auto;max-block-size:66vh;overflow:auto;padding:10px;details{overflow:auto}summary{cursor:pointer}dl{display:grid;grid-template-columns:1fr 1fr;grid-auto-flow:row;margin:0;padding:0;dt{font-size:0.825em;font-weight:bold;grid-column:1;margin:0;padding:0}dd{grid-column:2;margin:0;padding:0}}.tool-toggle-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--color-border)}.tool-toggle-row:last-child{border-bottom:none}.tool-toggle-row.clickable{cursor:pointer;padding:8px;margin:0 -8px;border-radius:4px;transition:background-color 0.15s ease}.tool-toggle-row.clickable:hover{background-color:var(--color-button)}.tool-toggle-row.clickable:active{background-color:var(--color-accent)}.tool-toggle-row.clickable .tool-name::after{content:"chevron_right";font-family:"Material Icons";font-size:16px;margin-left:4px;opacity:0.5;vertical-align:middle}.tool-info{flex:1;min-width:0}.tool-name{font-weight:bold;font-size:0.9em;margin-bottom:2px}.tool-description{font-size:0.8em;color:var(--color-subtle_text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tool-description+.tool-description{margin-top:4px}.tool-toggle{margin-left:12px;flex-shrink:0;label{font-size:0.9em}}.tool-status.experimental{font-family:"Material Icons";font-size:14px;margin-left:6px;vertical-align:middle;line-height:1}.tool-status.experimental::before{content:"science"}.session-item{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--color-border);font-size:0.85em}.session-item:last-child{border-bottom:none}.session-id{font-family:monospace;color:var(--color-text)}.session-time{color:var(--color-subtle_text);font-size:0.9em}.no-sessions{color:var(--color-subtle_text);font-style:italic;padding:8px 0}.no-results{color:var(--color-subtle_text);font-style:italic;padding:12px 0;text-align:center}.filter-bar{display:flex;flex-direction:row;align-items:center;gap:10px;padding:8px 0;margin-bottom:4px;border-bottom:1px solid var(--color-border)}.filter-input{flex:1;min-width:0;padding:6px 8px;border:1px solid var(--color-border);border-radius:4px;background:var(--color-back);color:var(--color-text);font-size:0.85em;box-sizing:border-box}.filter-input:focus{outline:none;border-color:var(--color-accent)}.filter-input::placeholder{color:var(--color-subtle_text)}.filter-switch{display:inline-flex;align-items:center;gap:6px;font-size:0.75em;color:var(--color-subtle_text);cursor:pointer;user-select:none;white-space:nowrap}.filter-switch input[type="checkbox"]{display:none}.switch-slider{position:relative;width:28px;height:16px;background:var(--color-button);border-radius:8px;transition:background-color 0.2s ease}.switch-slider::before{content:"";position:absolute;top:2px;left:2px;width:12px;height:12px;background:var(--color-text);border-radius:50%;transition:transform 0.2s ease}.filter-switch input:checked+.switch-slider{background:var(--color-accent)}.filter-switch input:checked+.switch-slider::before{transform:translateX(12px)}.switch-label{color:var(--color-subtle_text)}.filter-switch input:checked~.switch-label{color:var(--color-text)}}';var HF=`<div class="mcp-panel"><details name="mcp_panel" open><summary>{{tl('mcp.panel.sessions')}} ({{sessions.length}})</summary><div v-if="sessions.length > 0"><div v-for="session in sessions" :key="session.id" class="session-item" :title="session.id"><span class="session-id">{{formatSessionId(session)}}</span><span class="session-time">{{formatTime(session.connectedAt)}}</span></div></div><div v-else class="no-sessions"> {{tl('mcp.sessions.no_clients')}} </div></details><details name="mcp_panel"><summary>{{tl('mcp.panel.server')}}</summary><dl><dt>{{tl('mcp.server.name')}}</dt><dd>{{server.name}}</dd><dt>{{tl('mcp.server.version')}}</dt><dd><a href="https://github.com/jasonjgardner/blockbench-mcp-plugin/releases/" target="_blank" rel="noopener noreferrer">{{server.version}}</a></dd><dt>{{tl('mcp.server.connected_clients')}}</dt><dd>{{sessions.length}}</dd></dl></details><details name="mcp_panel" @toggle="onToolsToggle"><summary>{{tl('mcp.panel.tools')}} ({{filteredTools.length}}/{{tools.length}})</summary><div class="filter-bar"><input type="text" v-model="toolsFilter.search" :placeholder="tl('mcp.filter.tools_placeholder')" :aria-label="tl('mcp.filter.tools_placeholder')" class="filter-input" @input="toolsFilter.search=$event.target.value"><label class="filter-switch"><input type="checkbox" v-model="toolsFilter.showExperimental"><span class="switch-slider"></span><span class="switch-label">{{tl('mcp.filter.show_experimental')}}</span></label></div><div v-if="filteredTools.length > 0"><div v-for="tool in filteredTools" :key="tool.name" class="tool-toggle-row clickable" @click="openToolTest(tool.name)" :title="tl('mcp.tooltip.click_to_test', [getDisplayName(tool.name)])"><div class="tool-info"><div class="tool-name"> {{getDisplayName(tool.name)}} <span v-if="tool.status==='experimental'" class="tool-status experimental" :title="tl('mcp.status.experimental_tooltip')"></span></div><div class="tool-description" :title="tool.description">{{tool.description}}</div></div></div></div><div v-else-if="tools.length > 0" class="no-results"> {{tl('mcp.tools.no_match')}} </div><div v-else><p>{{tl('mcp.tools.none_available')}}</p></div></details><details name="mcp_panel" @toggle="onResourcesToggle"><summary>{{tl('mcp.panel.resources')}} ({{filteredResources.length}}/{{resources.length}})</summary><div class="filter-bar"><input type="text" v-model="resourcesFilter.search" :placeholder="tl('mcp.filter.resources_placeholder')" :aria-label="tl('mcp.filter.resources_placeholder')" class="filter-input" @input="resourcesFilter.search=$event.target.value"></div><div v-if="filteredResources.length > 0"><div v-for="resource in filteredResources" :key="resource.name" class="tool-toggle-row"><div class="tool-info"><div class="tool-name">{{getDisplayName(resource.name)}}</div><div class="tool-description" :title="resource.description">{{resource.description}}</div><div class="tool-description" style="font-style: italic; margin-top: 2px;" :title="resource.uriTemplate">{{resource.uriTemplate}}</div></div></div></div><div v-else-if="resources.length > 0" class="no-results"> {{tl('mcp.resources.no_match')}} </div><div v-else><p>{{tl('mcp.resources.none_available')}}</p></div></details><details name="mcp_panel" @toggle="onPromptsToggle"><summary>{{tl('mcp.panel.prompts')}} ({{filteredPrompts.length}}/{{prompts.length}})</summary><div class="filter-bar"><input type="text" v-model="promptsFilter.search" :placeholder="tl('mcp.filter.prompts_placeholder')" :aria-label="tl('mcp.filter.prompts_placeholder')" class="filter-input" @input="promptsFilter.search=$event.target.value"><label class="filter-switch"><input type="checkbox" v-model="promptsFilter.showExperimental"><span class="switch-slider"></span><span class="switch-label">{{tl('mcp.filter.show_experimental')}}</span></label></div><div v-if="filteredPrompts.length > 0"><div v-for="prompt in filteredPrompts" :key="prompt.name" class="tool-toggle-row clickable" @click="openPromptPreview(prompt.name)" :title="tl('mcp.tooltip.click_to_preview', [getDisplayName(prompt.name)])"><div class="tool-info"><div class="tool-name"> {{getDisplayName(prompt.name)}} <span v-if="prompt.status==='experimental'" class="tool-status experimental" :title="tl('mcp.status.experimental_tooltip')"></span></div><div class="tool-description" :title="prompt.description">{{prompt.description}}</div><div v-if="prompt.argumentCount > 0" class="tool-description" style="font-style: italic; margin-top: 2px;"> {{formatArgumentCount(prompt.argumentCount)}} </div></div></div></div><div v-else-if="prompts.length > 0" class="no-results"> {{tl('mcp.prompts.no_match')}} </div><div v-else><p>{{tl('mcp.prompts.none_available')}}</p></div></details></div>`;var r7,W4;function BF({server:Q,tools:W,resources:$,prompts:Y}){return Blockbench.addCSS(GF),rK(Q),r7=new Panel("mcp_panel",{id:"mcp_panel",icon:"robot",name:"MCP",default_side:"right",resizable:!0,component:{mounted(){let J=this;W4=q1.subscribe((X)=>{J.sessions=X.map((G)=>({id:G.id,connectedAt:G.connectedAt,lastActivity:G.lastActivity,clientName:G.clientName,clientVersion:G.clientVersion})),J.server.connected=X.length>0})},beforeDestroy(){if(W4)W4(),W4=void 0},data:()=>({sessions:[],server:{connected:!1,name:"Blockbench MCP",version:Q8},tools:Object.values(W).map((J)=>({name:J.name,description:J.description,enabled:J.enabled,status:J.status})),resources:Object.values($).map((J)=>({name:J.name,description:J.description,uriTemplate:J.uriTemplate})),prompts:Object.values(Y).map((J)=>({name:J.name,description:J.description,enabled:J.enabled,status:J.status,argumentCount:Object.keys(J.arguments).length})),toolsFilter:{search:"",showExperimental:!0},resourcesFilter:{search:""},promptsFilter:{search:"",showExperimental:!0}}),computed:{filteredTools(){let{tools:J,toolsFilter:X}=this,G=X.search.toLowerCase();return J.filter((H)=>{if(H.status==="experimental"&&!X.showExperimental)return!1;if(G&&!H.name.toLowerCase().includes(G))return!1;return!0})},filteredResources(){let{resources:J,resourcesFilter:X}=this,G=X.search.toLowerCase();if(!G)return J;return J.filter((H)=>H.name.toLowerCase().includes(G))},filteredPrompts(){let{prompts:J,promptsFilter:X}=this,G=X.search.toLowerCase();return J.filter((H)=>{if(H.status==="experimental"&&!X.showExperimental)return!1;if(G&&!H.name.toLowerCase().includes(G))return!1;return!0})}},methods:{tl(J,X){return tl(J,X)},getDisplayName(J){return J.replace("blockbench_","")},formatSessionId(J){if(J.clientName)return J.clientVersion?`${J.clientName} v${J.clientVersion}`:J.clientName;return J.id.slice(0,8)+"..."},formatTime(J){return new Date(J).toLocaleTimeString()},openToolTest(J){eK(J)},openPromptPreview(J){$F(J)},formatArgumentCount:XF,onToolsToggle(J){if(!J.target.open)this.toolsFilter.search=""},onResourcesToggle(J){if(!J.target.open)this.resourcesFilter.search=""},onPromptsToggle(J){if(!J.target.open)this.promptsFilter.search=""}},name:"mcp_panel",template:HF},expand_button:!0}),r7}function KF(){aK(),r7?.delete()}var FF=[];function VF(){FF.push(new Setting("mcp_instructions",{name:tl("mcp.settings.instructions_name"),description:tl("mcp.settings.instructions_desc"),type:"text",value:"Generate simple, low-poly models for Minecraft inside Blockbench.",category:"general",icon:"psychology"}),new Setting("mcp_port",{name:tl("mcp.settings.port_name"),description:tl("mcp.settings.port_desc"),type:"number",value:3000,category:"general",icon:"numbers"}),new Setting("mcp_endpoint",{name:tl("mcp.settings.endpoint_name"),description:tl("mcp.settings.endpoint_desc"),type:"text",value:"/bb-mcp",category:"general",icon:"webhook"}))}function a7(){FF.forEach((Q)=>{Q.delete()})}class t7{constructor(Q={}){this._started=!1,this._streamMapping=new Map,this._requestToStreamMapping=new Map,this._requestResponseMap=new Map,this._initialized=!1,this._enableJsonResponse=!1,this._standaloneSseStreamId="_GET_stream",this.sessionIdGenerator=Q.sessionIdGenerator,this._enableJsonResponse=Q.enableJsonResponse??!1,this._eventStore=Q.eventStore,this._onsessioninitialized=Q.onsessioninitialized,this._onsessionclosed=Q.onsessionclosed,this._allowedHosts=Q.allowedHosts,this._allowedOrigins=Q.allowedOrigins,this._enableDnsRebindingProtection=Q.enableDnsRebindingProtection??!1,this._retryInterval=Q.retryInterval}async start(){if(this._started)throw Error("Transport already started");this._started=!0}createJsonErrorResponse(Q,W,$,Y){let J={code:W,message:$};if(Y?.data!==void 0)J.data=Y.data;return new Response(JSON.stringify({jsonrpc:"2.0",error:J,id:null}),{status:Q,headers:{"Content-Type":"application/json",...Y?.headers}})}validateRequestHeaders(Q){if(!this._enableDnsRebindingProtection)return;if(this._allowedHosts&&this._allowedHosts.length>0){let W=Q.headers.get("host");if(!W||!this._allowedHosts.includes(W)){let $=`Invalid Host header: ${W}`;return this.onerror?.(Error($)),this.createJsonErrorResponse(403,-32000,$)}}if(this._allowedOrigins&&this._allowedOrigins.length>0){let W=Q.headers.get("origin");if(W&&!this._allowedOrigins.includes(W)){let $=`Invalid Origin header: ${W}`;return this.onerror?.(Error($)),this.createJsonErrorResponse(403,-32000,$)}}return}async handleRequest(Q,W){let $=this.validateRequestHeaders(Q);if($)return $;switch(Q.method){case"POST":return this.handlePostRequest(Q,W);case"GET":return this.handleGetRequest(Q);case"DELETE":return this.handleDeleteRequest(Q);default:return this.handleUnsupportedRequest()}}async writePrimingEvent(Q,W,$,Y){if(!this._eventStore)return;if(Y<"2025-11-25")return;let J=await this._eventStore.storeEvent($,{}),X=`id: ${J}
data: 

`;if(this._retryInterval!==void 0)X=`id: ${J}
retry: ${this._retryInterval}
data: 

`;Q.enqueue(W.encode(X))}async handleGetRequest(Q){if(!Q.headers.get("accept")?.includes("text/event-stream"))return this.createJsonErrorResponse(406,-32000,"Not Acceptable: Client must accept text/event-stream");let $=this.validateSession(Q);if($)return $;let Y=this.validateProtocolVersion(Q);if(Y)return Y;if(this._eventStore){let B=Q.headers.get("last-event-id");if(B)return this.replayEvents(B)}if(this._streamMapping.get(this._standaloneSseStreamId)!==void 0)return this.createJsonErrorResponse(409,-32000,"Conflict: Only one SSE stream is allowed per session");let J=new TextEncoder,X,G=new ReadableStream({start:(B)=>{X=B},cancel:()=>{this._streamMapping.delete(this._standaloneSseStreamId)}}),H={"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive"};if(this.sessionId!==void 0)H["mcp-session-id"]=this.sessionId;return this._streamMapping.set(this._standaloneSseStreamId,{controller:X,encoder:J,cleanup:()=>{this._streamMapping.delete(this._standaloneSseStreamId);try{X.close()}catch{}}}),new Response(G,{headers:H})}async replayEvents(Q){if(!this._eventStore)return this.createJsonErrorResponse(400,-32000,"Event store not configured");try{let W;if(this._eventStore.getStreamIdForEventId){if(W=await this._eventStore.getStreamIdForEventId(Q),!W)return this.createJsonErrorResponse(400,-32000,"Invalid event ID format");if(this._streamMapping.get(W)!==void 0)return this.createJsonErrorResponse(409,-32000,"Conflict: Stream already has an active connection")}let $={"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive"};if(this.sessionId!==void 0)$["mcp-session-id"]=this.sessionId;let Y=new TextEncoder,J,X=new ReadableStream({start:(H)=>{J=H},cancel:()=>{}}),G=await this._eventStore.replayEventsAfter(Q,{send:async(H,B)=>{if(!this.writeSSEEvent(J,Y,B,H)){this.onerror?.(Error("Failed replay events"));try{J.close()}catch{}}}});return this._streamMapping.set(G,{controller:J,encoder:Y,cleanup:()=>{this._streamMapping.delete(G);try{J.close()}catch{}}}),new Response(X,{headers:$})}catch(W){return this.onerror?.(W),this.createJsonErrorResponse(500,-32000,"Error replaying events")}}writeSSEEvent(Q,W,$,Y){try{let J=`event: message
`;if(Y)J+=`id: ${Y}
`;return J+=`data: ${JSON.stringify($)}

`,Q.enqueue(W.encode(J)),!0}catch{return!1}}handleUnsupportedRequest(){return new Response(JSON.stringify({jsonrpc:"2.0",error:{code:-32000,message:"Method not allowed."},id:null}),{status:405,headers:{Allow:"GET, POST, DELETE","Content-Type":"application/json"}})}async handlePostRequest(Q,W){try{let $=Q.headers.get("accept");if(!$?.includes("application/json")||!$.includes("text/event-stream"))return this.createJsonErrorResponse(406,-32000,"Not Acceptable: Client must accept both application/json and text/event-stream");let Y=Q.headers.get("content-type");if(!Y||!Y.includes("application/json"))return this.createJsonErrorResponse(415,-32000,"Unsupported Media Type: Content-Type must be application/json");let J={headers:Object.fromEntries(Q.headers.entries())},X;if(W?.parsedBody!==void 0)X=W.parsedBody;else try{X=await Q.json()}catch{return this.createJsonErrorResponse(400,-32700,"Parse error: Invalid JSON")}let G;try{if(Array.isArray(X))G=X.map((A)=>z$.parse(A));else G=[z$.parse(X)]}catch{return this.createJsonErrorResponse(400,-32700,"Parse error: Invalid JSON-RPC message")}let H=G.some(P$);if(H){if(this._initialized&&this.sessionId!==void 0)return this.createJsonErrorResponse(400,-32600,"Invalid Request: Server already initialized");if(G.length>1)return this.createJsonErrorResponse(400,-32600,"Invalid Request: Only one initialization request is allowed");if(this.sessionId=this.sessionIdGenerator?.(),this._initialized=!0,this.sessionId&&this._onsessioninitialized)await Promise.resolve(this._onsessioninitialized(this.sessionId))}if(!H){let A=this.validateSession(Q);if(A)return A;let O=this.validateProtocolVersion(Q);if(O)return O}if(!G.some(K6)){for(let A of G)this.onmessage?.(A,{authInfo:W?.authInfo,requestInfo:J});return new Response(null,{status:202})}let K=crypto.randomUUID(),F=G.find((A)=>P$(A)),q=F?F.params.protocolVersion:Q.headers.get("mcp-protocol-version")??sX;if(this._enableJsonResponse)return new Promise((A)=>{this._streamMapping.set(K,{resolveJson:A,cleanup:()=>{this._streamMapping.delete(K)}});for(let O of G)if(K6(O))this._requestToStreamMapping.set(O.id,K);for(let O of G)this.onmessage?.(O,{authInfo:W?.authInfo,requestInfo:J})});let U=new TextEncoder,L,D=new ReadableStream({start:(A)=>{L=A},cancel:()=>{this._streamMapping.delete(K)}}),w={"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"};if(this.sessionId!==void 0)w["mcp-session-id"]=this.sessionId;for(let A of G)if(K6(A))this._streamMapping.set(K,{controller:L,encoder:U,cleanup:()=>{this._streamMapping.delete(K);try{L.close()}catch{}}}),this._requestToStreamMapping.set(A.id,K);await this.writePrimingEvent(L,U,K,q);for(let A of G){let O,j;if(K6(A)&&this._eventStore&&q>="2025-11-25")O=()=>{this.closeSSEStream(A.id)},j=()=>{this.closeStandaloneSSEStream()};this.onmessage?.(A,{authInfo:W?.authInfo,requestInfo:J,closeSSEStream:O,closeStandaloneSSEStream:j})}return new Response(D,{status:200,headers:w})}catch($){return this.onerror?.($),this.createJsonErrorResponse(400,-32700,"Parse error",{data:String($)})}}async handleDeleteRequest(Q){let W=this.validateSession(Q);if(W)return W;let $=this.validateProtocolVersion(Q);if($)return $;return await Promise.resolve(this._onsessionclosed?.(this.sessionId)),await this.close(),new Response(null,{status:200})}validateSession(Q){if(this.sessionIdGenerator===void 0)return;if(!this._initialized)return this.createJsonErrorResponse(400,-32000,"Bad Request: Server not initialized");let W=Q.headers.get("mcp-session-id");if(!W)return this.createJsonErrorResponse(400,-32000,"Bad Request: Mcp-Session-Id header is required");if(W!==this.sessionId)return this.createJsonErrorResponse(404,-32001,"Session not found");return}validateProtocolVersion(Q){let W=Q.headers.get("mcp-protocol-version");if(W!==null&&!D9.includes(W))return this.createJsonErrorResponse(400,-32000,`Bad Request: Unsupported protocol version: ${W} (supported versions: ${D9.join(", ")})`);return}async close(){this._streamMapping.forEach(({cleanup:Q})=>{Q()}),this._streamMapping.clear(),this._requestResponseMap.clear(),this.onclose?.()}closeSSEStream(Q){let W=this._requestToStreamMapping.get(Q);if(!W)return;let $=this._streamMapping.get(W);if($)$.cleanup()}closeStandaloneSSEStream(){let Q=this._streamMapping.get(this._standaloneSseStreamId);if(Q)Q.cleanup()}async send(Q,W){let $=W?.relatedRequestId;if(p1(Q)||j8(Q))$=Q.id;if($===void 0){if(p1(Q)||j8(Q))throw Error("Cannot send a response on a standalone SSE stream unless resuming a previous client request");let X;if(this._eventStore)X=await this._eventStore.storeEvent(this._standaloneSseStreamId,Q);let G=this._streamMapping.get(this._standaloneSseStreamId);if(G===void 0)return;if(G.controller&&G.encoder)this.writeSSEEvent(G.controller,G.encoder,Q,X);return}let Y=this._requestToStreamMapping.get($);if(!Y)throw Error(`No connection established for request ID: ${String($)}`);let J=this._streamMapping.get(Y);if(!this._enableJsonResponse&&J?.controller&&J?.encoder){let X;if(this._eventStore)X=await this._eventStore.storeEvent(Y,Q);this.writeSSEEvent(J.controller,J.encoder,Q,X)}if(p1(Q)||j8(Q)){this._requestResponseMap.set($,Q);let X=Array.from(this._requestToStreamMapping.entries()).filter(([H,B])=>B===Y).map(([H])=>H);if(X.every((H)=>this._requestResponseMap.has(H))){if(!J)throw Error(`No connection established for request ID: ${String($)}`);if(this._enableJsonResponse&&J.resolveJson){let H={"Content-Type":"application/json"};if(this.sessionId!==void 0)H["mcp-session-id"]=this.sessionId;let B=X.map((K)=>this._requestResponseMap.get(K));if(B.length===1)J.resolveJson(new Response(JSON.stringify(B[0]),{status:200,headers:H}));else J.resolveJson(new Response(JSON.stringify(B),{status:200,headers:H}))}else J.cleanup();for(let H of X)this._requestResponseMap.delete(H),this._requestToStreamMapping.delete(H)}}}}function qF(Q){return{200:"OK",201:"Created",204:"No Content",400:"Bad Request",404:"Not Found",405:"Method Not Allowed",409:"Conflict",500:"Internal Server Error"}[Q]||"Unknown"}function s7({createServer:Q},{port:W,endpoint:$}){let Y=new Map;q1.setRemovalCallback(async(X)=>{let G=Y.get(X);if(G){console.log(`[MCP] Closing transport for session: ${X.slice(0,8)}...`);try{await G.transport.close()}catch(H){console.error("[MCP] Error closing transport:",H)}finally{Y.delete(X)}}});let J=Q((X)=>{let G=Buffer.alloc(0),H=!1;X.on("data",(q)=>{if(H)return;G=Buffer.concat([G,q]),B().catch((U)=>{if(console.error("[MCP] Unhandled error in processHttpRequests:",U),!X.destroyed)try{F(X,500,{"content-type":"application/json"},JSON.stringify({error:"Internal server error"}),void 0)}catch(L){console.error("[MCP] Failed to send error response:",L),X.destroy()}})}),X.on("error",(q)=>{if(q.message!=="read ECONNRESET")console.error("[MCP] Socket error:",q.message);X.destroy()}),X.on("close",()=>{G=Buffer.alloc(0)});async function B(){while(!0){if(H||X.destroyed||!X.writable)return;let q=G.indexOf(`\r
\r
`);if(q===-1)return;let L=G.subarray(0,q).toString().split(`\r
`),[D,w]=L[0].split(" "),A={};for(let B0=1;B0<L.length;B0++){let m0=L[B0].indexOf(":");if(m0>0){let e0=L[B0].substring(0,m0).trim().toLowerCase(),u1=L[B0].substring(m0+1).trim();A[e0]=u1}}let O=q+4,j=parseInt(A["content-length"]||"0",10),z=O+j;if(G.length<z)return;let S=G.subarray(O,z).toString();G=G.subarray(z);let Z=`http://localhost:${W}${w}`,O0=new Headers;for(let[B0,m0]of Object.entries(A))O0.set(B0,m0);let I0={method:D,headers:O0};if(D!=="GET"&&D!=="HEAD"&&S)I0.body=S;let b1=new Request(Z,I0);if(w.split("?")[0]!==$&&!w.startsWith($+"/")&&!w.startsWith($+"?")){F(X,404,{"content-type":"text/plain"},"Not Found",A.connection);continue}try{let B0=A["mcp-session-id"],m0=B0?Y.get(B0):null;if(B0&&!m0){console.log(`[MCP] Invalid session ID: ${B0.slice(0,8)}... (session expired or not found)`),F(X,409,{"content-type":"application/json"},JSON.stringify({jsonrpc:"2.0",error:{code:-32600,message:"Session expired or not found. Please reconnect."},id:null}),A.connection);continue}if(!m0){let L1=t9();HK(L1),KK(L1),VK(L1);let e6=new t7({sessionIdGenerator:()=>crypto.randomUUID(),enableJsonResponse:!0,onsessioninitialized:(X1)=>{console.log(`[MCP] Session initialized: ${X1.slice(0,8)}...`),q1.add(X1);let o8=Y.get("__pending__");if(o8){Y.delete("__pending__"),Y.set(X1,o8);let KQ=o8.server.server;KQ.oninitialized=()=>{let Y4=KQ.getClientVersion();if(Y4)q1.updateClientInfo(X1,Y4.name,Y4.version)}}},onsessionclosed:(X1)=>{console.log(`[MCP] Session closed: ${X1.slice(0,8)}...`),Y.delete(X1),q1.remove(X1)}});if(await L1.connect(e6),m0={transport:e6,server:L1},!B0)Y.set("__pending__",m0)}if(B0)q1.updateActivity(B0);let e0=await m0.transport.handleRequest(b1),u1={};e0.headers.forEach((L1,e6)=>{u1[e6]=L1});let BQ=e0.headers.get("content-type")||"";if(!BQ&&e0.status!==204)u1["content-type"]="application/json";if(BQ.includes("text/event-stream"))if(K(X,e0.status,u1),e0.body){let L1=e0.body.getReader(),e6=new TextDecoder;try{while(!0){if(H||X.destroyed||!X.writable)break;let{done:X1,value:o8}=await L1.read();if(X1)break;let KQ=e6.decode(o8,{stream:!0});X.write(KQ)}}catch(X1){console.error("[MCP] SSE stream error:",X1)}finally{H=!0,X.end()}}else H=!0,X.end();else{let L1=await e0.text();F(X,e0.status,u1,L1,A.connection)}}catch(B0){console.error("[MCP] Request handler error:",B0),F(X,500,{"content-type":"application/json"},JSON.stringify({error:String(B0)}),A.connection)}}}function K(q,U,L){if(H||q.destroyed||!q.writable)return!1;let D=`HTTP/1.1 ${U} ${qF(U)}\r
`;delete L["content-length"],L["cache-control"]="no-cache",L.connection="keep-alive";for(let[w,A]of Object.entries(L))D+=`${w}: ${A}\r
`;return D+=`\r
`,q.write(D),!0}function F(q,U,L,D,w){if(H||q.destroyed||!q.writable)return!1;let A=`HTTP/1.1 ${U} ${qF(U)}\r
`,O=Buffer.byteLength(D);L["content-length"]=O.toString();let j=w?.toLowerCase()==="keep-alive";if(L.connection=j?"keep-alive":"close",!L.date)L.date=new Date().toUTCString();for(let[z,S]of Object.entries(L))A+=`${z}: ${S}\r
`;if(A+=`\r
`,A+=D,!j)H=!0,q.write(A,()=>{q.end()});else q.write(A);return!0}});return J.listen(W,()=>{console.log(`[MCP] Server listening on http://localhost:${W}${$}`)}),J.on("error",(X)=>{console.error("[MCP] Server error:",X),Blockbench.showQuickMessage(`MCP Server error: ${X.message}`,3000)}),[J,Y]}var $4=null,e7=null;BBPlugin.register("mcp",{version:Q8,title:"MCP Server",author:"Jason J. Gardner",description:"Create an MCP server inside Blockbench.",tags:["MCP","AI"],icon:"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMzMzLjg5IDM3Mi44NCI+PHBhdGggZD0iTTI1OS41NCw3NC4yNGM2MC43MS03LjQxLDk3LjU2LDYyLjA2LDU2LjQsMTA4LjlsLTEzNC40MywxMzMuODFjLTEuMDksMi4xMS0xLjY1LDQuODQtLjAyLDYuODVsMjkuMywyOS43YzQuNzgsMTIuNS02LjA1LDIzLjA5LTE4LjEzLDE3LjEzLTMuNzctMS44Ni0yNy4zNS0yNS41OS0zMC45Mi0zMC4wNC0xMC4zNS0xMi45My05LjYxLTI4LjA0LjE1LTQxLjAxbDEzNy40Ni0xMzYuOTljMjguNjMtMzguOTktMjIuMjktODUuMDgtNTguMzQtNTIuMzhsLTExMS45NywxMTIuMDNjLTEyLjMyLDguMDEtMjUuNzItNy44NC0xNy4wMy0xOS4wM2wxMTQuNDgtMTE0Ljc0YzI2LjkyLTM4LjYxLTIxLjA1LTgyLjcyLTU3LjYxLTUxLjg5TDIxLjkyLDE4NC4wN2MtMTQuNjMsMTAuMS0yOS40My04LjM0LTE2LjQtMjAuMzVMMTU3LjYzLDEyLjgyYzM0LjEzLTI1LjQ3LDg0LjYxLTkuNTQsOTguNjksMzAuMTQuNTUsMS41NSwzLjIzLDEwLjAzLDMuMjMsMTAuNzd2MjAuNVoiIHN0eWxlPSJmaWxsOiM3ODc4Nzg7IHN0cm9rZTojZmZmOyBzdHJva2UtbWl0ZXJsaW1pdDoxMDsiLz48cGF0aCBkPSJNMjAxLjk2LDc2LjY1Yy0zMC45NSwzMy42Ny02NS45OSw2My44Ny05Ny40Nyw5Ny4wMy03LjI4LDcuNjctMTQuOCwxNC44Ni0xNy40OCwyNS41Mi05Ljg0LDM5LjE3LDM3Ljc3LDY0LjY1LDY2LjA2LDM2LjA2bDEwOS4xLTEwOC45YzExLjg5LTUuNTMsMjQuMTcsNi40NCwxNy4yMiwxOC4yMmwtMTE3LjMzLDExNi42N2MtNjQuMTksNDMuNDMtMTM2LjctMzcuNDEtODQuNTctOTYuNTQsMzMuMjItMzcuNjgsNzQuOTgtNzEuNjUsMTA5LjEzLTEwOC44OSwxMS0xMC4wMSwyNi42NywxLjk2LDIwLjMsMTUuMzEtMS4xLDIuMzEtMy40MSwzLjgxLTQuOTgsNS41MloiIHN0eWxlPSJmaWxsOiM3ODc4Nzg7IHN0cm9rZTojZmZmOyBzdHJva2UtbWl0ZXJsaW1pdDoxMDsiLz48L3N2Zz4=",variant:"desktop",async onload(){let Q=requireNativeModule("net",{message:"Network access is required for the MCP server to accept connections.",detail:"The MCP plugin needs to create a local server that AI assistants can connect to.",optional:!1});if(!Q){console.error("[MCP] Failed to get net module - server will not start"),Blockbench.showQuickMessage("MCP Server requires network permission",3000);return}JF(),VF(),[$4,e7]=s7(Q,{port:Number(Settings.get("mcp_port")||3000),endpoint:String(Settings.get("mcp_endpoint")||"/bb-mcp")});let W=t9();BF({server:W,tools:p6,resources:u8,prompts:d6})},onunload(){if($4)$4.close(),$4=null;let Q=Array.from(e7?.values()??[]);for(let W of Q)W.transport.close();e7?.clear(),q1.clear(),KF(),a7()},oninstall(){Blockbench.showQuickMessage("Installed MCP Server plugin",2000)},onuninstall(){Blockbench.showQuickMessage("Uninstalled MCP Server plugin",2000),a7()}});
